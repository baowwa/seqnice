## 1. 分析项目管理界面

### 分析项目列表页
```
┌─────────────────────────────────────────────────────────┐
│ 分析项目管理                            [新建分析项目] [+] │
├─────────────────────────────────────────────────────────┤
│ 搜索: [____________] 筛选: ▾ 所有类别 ▾ 所有状态       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 分析项目列表:                                          │
│ ┌──┬────────────┬────────────┬──────────┬────────────┐ │
│ │  │ 项目编码   │ 项目名称    │ 项目类别  │   状态     │ │
│ ├──┼────────────┼────────────┼──────────┼────────────┤ │
│ │□ │ EGFR_MUT   │ EGFR基因突变检测│ 基因突变 │ 🔘 启用    │ │
│ │□ │ KRAS_MUT   │ KRAS基因突变检测│ 基因突变 │ 🔘 启用    │ │
│ │□ │ TMB        │ 肿瘤突变负荷   │ 生物标志物│ 🔘 启用    │ │
│ │□ │ MSI        │ 微卫星不稳定性 │ 生物标志物│ 🔘 启用    │ │
│ │□ │ CNV        │ 拷贝数变异分析 │ 基因变异 │ 🔘 启用    │ │
│ └──┴────────────┴────────────┴──────────┴────────────┘ │
│                                                         │
│ [批量启用] [批量停用] [导出列表]                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 分析项目详情/编辑页
```
┌─────────────────────────────────────────────────────────┐
│ 分析项目详情: EGFR_MUT-EGFR基因突变检测  [保存] [启用/停用] │
├─────────────────────────────────────────────────────────┤
│ 基本信息:                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 项目编码: EGFR_MUT               状态: 🔘 启用     │ │
│ │ 项目名称: [EGFR基因突变检测]                        │ │
│ │ 项目类别: ▾ 基因突变                                │ │
│ │ 检测类型: ▾ 定性                                    │ │
│ │ 报告顺序: [1] (数字越小越靠前)                     │ │
│ │ 项目描述: [______________________________________] │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 检测参数:                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 单位: [突变位点]                                    │ │
│ │ 正常值: [未检出突变]                                │ │
│ │ 参考范围: [野生型]                                  │ │
│ │ 异常判断标准: [检出突变]                            │ │
│ │ 临界值: [________]                                  │ │
│ │ 计算方法: [______________________________________] │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 样本与临床:                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 适用样本类型: ▾ 血液 ▾ 组织 ▾ 体液                 │ │
│ │ 临床意义: [用于指导EGFR靶向治疗药物选择]           │ │
│ │ 临床注释: [______________________________________] │ │
│ │ 参考文献: [______________________________________] │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 关联的检测项目:                                        │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 已关联检测项目 (2个):                               │ │
│ │ • TP001-肺癌基因检测                                │ │
│ │ • TP002-肿瘤综合基因检测                            │ │
│ │                                                     │ │
│ │ 可关联检测项目:                                     │ │
│ │ ┌──┬────────────┬──────────────────────────────┐ │ │
│ │ │□ │ TP003      │ 晚期肿瘤基因检测              │ │ │
│ │ │□ │ TP004      │ 耐药基因检测                  │ │ │
│ │ └──┴────────────┴──────────────────────────────┘ │ │
│ │                                                     │ │
│ │ [关联选中项目] [取消关联]                          │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 2. 检测项目管理界面

### 检测项目列表页
```
┌─────────────────────────────────────────────────────────┐
│ 检测项目管理                            [新建检测项目] [+] │
├─────────────────────────────────────────────────────────┤
│ 搜索: [____________] 筛选: ▾ 所有状态 ▾ 所有科室       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 检测项目列表:                                          │
│ ┌──┬────────────┬────────────┬──────────┬────────────┐ │
│ │  │ 项目编码   │ 项目名称    │ 方法学   │   状态     │ │
│ ├──┼────────────┼────────────┼──────────┼────────────┤ │
│ │□ │ TP001      │ 肺癌基因检测│ NGS      │ 🔘 启用    │ │
│ │□ │ TP002      │ 结直肠癌基因检测│ NGS   │ 🔘 启用    │ │
│ │□ │ TP003      │ 乳腺癌基因检测│ NGS     │ 🔘 启用    │ │
│ │□ │ TP004      │ 遗传病筛查  │ NGS      │ 🔘 启用    │ │
│ │□ │ TP005      │ 病原微生物检测│ PCR     │ ⚪ 停用   │ │
│ └──┴────────────┴────────────┴──────────┴────────────┘ │
│                                                         │
│ [批量启用] [批量停用] [导出列表]                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 检测项目详情/编辑页
```
┌─────────────────────────────────────────────────────────┐
│ 检测项目详情: TP001-肺癌基因检测         [保存] [启用/停用] │
├─────────────────────────────────────────────────────────┤
│ 基本信息:                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 项目编码: TP001                  状态: 🔘 启用     │ │
│ │ 项目名称: [肺癌基因检测]                            │ │
│ │ 英文名称: [Lung Cancer Gene Detection]             │ │
│ │ 所属科室: ▾ 分子病理科            负责人: ▾ 张三    │ │
│ │ 样本类型: ▾ 组织 ▾ 血液 ▾ 胸腔积液                 │ │
│ │ 报告周期: [7] 个工作日            价格: [5000] 元  │ │
│ │ 项目描述: [______________________________________] │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 方法学配置:                                            │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 主要方法学: ▾ NGS (下一代测序)                     │ │
│ │ 备用方法学: ▾ PCR ▾ Sanger测序                     │ │
│ │                                                     │ │
│ │ 方法学参数:                                         │ │
│ │ • 测序平台: ▾ Illumina NovaSeq 6000               │ │
│ │ • 测序深度: ▾ 500x                                │ │
│ │ • 覆盖度: ▾ >99%                                  │ │
│ │ • 检测基因: ▾ EGFR, KRAS, BRAF, ALK, ROS1等      │ │
│ │ • 质控标准: ▾ CLIA认证标准                        │ │
│ │                                                     │ │
│ │ SOP文档: [肺癌基因检测SOP_v2.1.pdf] [上传新文档]   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 包含的分析项目:                                        │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 已包含分析项目 (5个):                               │ │
│ │ 1. EGFR_MUT - EGFR基因突变检测 (报告顺序: 1)       │ │
│ │ 2. KRAS_MUT - KRAS基因突变检测 (报告顺序: 2)       │ │
│ │ 3. BRAF_MUT - BRAF基因突变检测 (报告顺序: 3)       │ │
│ │ 4. TMB - 肿瘤突变负荷分析 (报告顺序: 4)            │ │
│ │ 5. MSI - 微卫星不稳定性分析 (报告顺序: 5)          │ │
│ │                                                     │ │
│ │ 可添加的分析项目:                                   │ │
│ │ ┌──┬────────────┬──────────────────────────────┐ │ │
│ │ │□ │ CNV        │ 拷贝数变异分析                │ │ │
│ │ │□ │ FUSION     │ 融合基因分析                  │ │ │
│ │ └──┴────────────┴──────────────────────────────┘ │ │
│ │                                                     │ │
│ │ [添加选中项目] [调整顺序] [移除项目]               │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 报告配置:                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 报告模板: ▾ 标准肿瘤基因检测报告                    │ │
│ │ 报告语言: ▾ 中文 ▾ 英文                            │ │
│ │ 自动发送报告: ▾ 是                                  │ │
│ │ 报告接收人: [__________________________________] │ │
│ │ 特殊说明: [____________________________________] │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 3. 方法学管理界面

### 方法学列表页
```
┌─────────────────────────────────────────────────────────┐
│ 方法学管理                              [新建方法学] [+]   │
├─────────────────────────────────────────────────────────┤
│ 搜索: [____________] 筛选: ▾ 所有类型 ▾ 所有状态       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 方法学列表:                                            │
│ ┌──┬────────────┬────────────┬──────────┬────────────┐ │
│ │  │ 方法学编码 │ 方法学名称  │ 类型     │ 使用项目数  │ │
│ ├──┼────────────┼────────────┼──────────┼────────────┤ │
│ │□ │ MT001      │ NGS        │ 测序     │     8      │ │
│ │□ │ MT002      │ PCR        │ 扩增     │     3      │ │
│ │□ │ MT003      │ Sanger测序 │ 测序     │     2      │ │
│ │□ │ MT004      │ 数字PCR    │ 扩增     │     1      │ │
│ │□ │ MT005      │ 质谱       │ 质谱     │     2      │ │
│ │□ │ MT006      │ 免疫组化   │ 染色     │     4      │ │
│ └──┴────────────┴────────────┴──────────┴────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 方法学详情页
```
┌─────────────────────────────────────────────────────────┐
│ 方法学详情: MT001-NGS                   [编辑] [复制]    │
├─────────────────────────────────────────────────────────┤
│ 基本信息:                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 方法学编码: MT001                 状态: 🔘 启用     │ │
│ │ 方法学名称: [NGS (下一代测序)]                      │ │
│ │ 方法学类型: ▾ 测序技术                              │ │
│ │ 技术原理: [大规模平行测序]                          │ │
│ │ 描述: [__________________________________________] │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 技术参数:                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 通量: ▾ 高通量                                      │ │
│ │ 灵敏度: [99.9] %                                    │ │
│ │ 特异性: [99.5] %                                    │ │
│ │ 检测限: [1] %                                       │ │
│ │ 精密度: CV < [5] %                                  │ │
│ │ 准确度: > [99] %                                    │ │
│ │ 线性范围: [0.1-100] %                               │ │
│ │ 可报告范围: [__________________________________]   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 仪器设备要求:                                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 主要仪器: ▾ Illumina NovaSeq 6000                  │ │
│ │ 辅助仪器: ▾ Qubit, Bioanalyzer, PCR仪              │ │
│ │ 校准要求: ▾ 定期校准                                │ │
│ │ 维护周期: [3] 个月                                  │ │
│ │ 环境要求: [______________________________________] │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 样本要求:                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 样本类型: ▾ 血液 ▾ 组织 ▾ 体液 ▾ 细胞              │ │
│ │ 最小样本量: [10] ng DNA                             │ │
│ │ 样本质量: 260/280在[1.8-2.2]之间                   │ │
│ │ 保存条件: [-20℃以下]                               │ │
│ │ 运输要求: [干冰运输]                               │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ 使用此方法学的检测项目 (8个):                         │
│ TP001(肺癌基因检测), TP002(结直肠癌基因检测), TP003(乳腺癌基因检测)... │
│                                                         │
│ SOP文档: [NGS标准操作流程_v3.2.pdf] [上传新版本]      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 4. 数据库设计调整

### 核心表结构
```sql
-- 检测项目表
CREATE TABLE detection_projects (
    project_code VARCHAR(20) PRIMARY KEY,
    project_name VARCHAR(100) NOT NULL,
    english_name VARCHAR(100),
    department VARCHAR(50),
    responsible_person VARCHAR(50),
    sample_types JSON,
    report_period INT,
    price DECIMAL(10,2),
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 方法学表
CREATE TABLE methodologies (
    methodology_code VARCHAR(20) PRIMARY KEY,
    methodology_name VARCHAR(100) NOT NULL,
    methodology_type VARCHAR(50),
    description TEXT,
    technical_parameters JSON,
    instrument_requirements JSON,
    sample_requirements JSON,
    sop_document VARCHAR(255),
    is_active BOOLEAN DEFAULT TRUE,
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 分析项目表
CREATE TABLE analysis_projects (
    analysis_code VARCHAR(20) PRIMARY KEY,
    analysis_name VARCHAR(100) NOT NULL,
    analysis_category VARCHAR(50),
    detection_type ENUM('qualitative', 'quantitative'),
    unit VARCHAR(50),
    normal_value VARCHAR(100),
    reference_range VARCHAR(100),
    abnormal_criteria VARCHAR(100),
    critical_value VARCHAR(100),
    calculation_method TEXT,
    sample_types JSON,
    clinical_significance TEXT,
    clinical_notes TEXT,
    references TEXT,
    report_order INT,
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 检测项目-方法学关系表
CREATE TABLE project_methodology (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_code VARCHAR(20),
    methodology_code VARCHAR(20),
    is_primary BOOLEAN DEFAULT FALSE,
    parameters JSON,
    UNIQUE KEY uk_project_methodology (project_code, methodology_code),
    FOREIGN KEY (project_code) REFERENCES detection_projects(project_code),
    FOREIGN KEY (methodology_code) REFERENCES methodologies(methodology_code)
);

-- 检测项目-分析项目关系表
CREATE TABLE project_analysis (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_code VARCHAR(20),
    analysis_code VARCHAR(20),
    report_order INT,
    is_required BOOLEAN DEFAULT TRUE,
    UNIQUE KEY uk_project_analysis (project_code, analysis_code),
    FOREIGN KEY (project_code) REFERENCES detection_projects(project_code),
    FOREIGN KEY (analysis_code) REFERENCES analysis_projects(analysis_code)
);
```

## 5. 业务逻辑验证

### 唯一性约束
```javascript
// 检测项目-方法学唯一性验证
class ProjectMethodologyValidator {
  static async validateUniqueCombination(projectCode, methodologyCode) {
    const existing = await ProjectMethodology.findOne({
      where: {
        project_code: projectCode,
        methodology_code: methodologyCode
      }
    });
    
    if (existing) {
      throw new Error(`检测项目 ${projectCode} 与方法学 ${methodologyCode} 的组合已存在`);
    }
    return true;
  }
}

// 分析项目报告顺序验证
class AnalysisProjectValidator {
  static async validateReportOrder(projectCode, analysisCode, reportOrder) {
    // 检查同一检测项目中报告顺序是否重复
    const existing = await ProjectAnalysis.findOne({
      where: {
        project_code: projectCode,
        report_order: reportOrder
      }
    });
    
    if (existing && existing.analysis_code !== analysisCode) {
      throw new Error(`报告顺序 ${reportOrder} 在该检测项目中已被占用`);
    }
    return true;
  }
}
```

## 6. 用户操作流程

### 新建检测项目的完整流程：
```
1. 填写检测项目基本信息
   ↓
2. 选择主要方法学和备用方法学
   ↓  
3. 配置方法学参数
   ↓
4. 选择包含的分析项目
   ↓
5. 设置分析项目报告顺序
   ↓
6. 配置报告模板
   ↓
7. 验证并启用检测项目
```

### 关键业务规则：
1. **检测项目+方法学唯一**：同一检测项目可以关联多个方法学，但同一组合不能重复
2. **主要方法学唯一**：每个检测项目必须有且仅有一个主要方法学
3. **报告顺序唯一**：同一检测项目中各分析项目的报告顺序不能重复
4. **状态管理**：启用/停用状态控制项目是否可用
5. **版本控制**：SOP文档支持版本管理

这样的设计确保了：

✅ **清晰的职责分离**：方法学与检测项目绑定，分析项目独立管理
✅ **灵活的组合配置**：支持检测项目与方法学的多对多关系
✅ **完整的业务信息**：包含所有必要的检测和分析参数
✅ **实用的报告功能**：报告顺序控制输出格式
✅ **易于维护扩展**：模块化设计，便于新增项目和方法学