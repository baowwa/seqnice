import{j as e}from"./index-B0AWbMnF.js";import{r as t}from"./react-vendor-By8n_QN6.js";import{_ as s,c as i,e as l,a,P as r,F as n,Q as o,Y as d,ad as c,af as m,a0 as x,ag as p,a1 as u,B as h,a2 as j,U as g,N as y,a3 as f,al as w,as as v,at as I,ah as C,W as b,X as S,m as T,ae as A,V as N,au as _,S as q,a7 as k,a9 as z,ar as D,aq as $,aa as B,ab as Y,ac as P,s as F}from"./antd-vendor-BtuZ_fxs.js";const{Search:M}=x,{Option:R}=u,{TextArea:H}=x,{Step:L}=A,O=()=>{const[L,O]=t.useState(!1),[Q,V]=t.useState([]),[W,E]=t.useState(null),[J,K]=t.useState(!1),[U,X]=t.useState(!1),[G,Z]=t.useState(!1),[ee,te]=t.useState(null),[se,ie]=t.useState(""),[le,ae]=t.useState(""),[re,ne]=t.useState(""),[oe]=s.useForm(),de=[{id:"1",sampleCode:"S2024001",sampleName:"土壤样本A",sampleType:"土壤",method:"dna_extraction",protocol:"CTAB法DNA提取",status:"in_progress",progress:65,startTime:"2024-01-15 09:00:00",operator:"张三",equipment:"DNA提取仪A",inputAmount:5,outputAmount:3.2,yield:64,concentration:125.5,purity:1.85,qualityScore:85,notes:"样本质量良好，按标准流程进行"},{id:"2",sampleCode:"S2024002",sampleName:"水体样本B",sampleType:"水体",method:"rna_extraction",protocol:"TRIzol法RNA提取",status:"completed",progress:100,startTime:"2024-01-14 08:30:00",endTime:"2024-01-14 16:00:00",operator:"李四",equipment:"RNA提取仪B",inputAmount:10,outputAmount:7.8,yield:78,concentration:89.3,purity:2.05,qualityScore:92,notes:"提取效果优秀，RNA完整性良好"},{id:"3",sampleCode:"S2024003",sampleName:"植物样本C",sampleType:"植物",method:"protein_extraction",protocol:"蛋白质提取标准流程",status:"failed",progress:30,startTime:"2024-01-13 10:00:00",endTime:"2024-01-13 14:30:00",operator:"王五",equipment:"蛋白提取仪C",inputAmount:2.5,notes:"样本降解严重，需要重新处理"}],ce=[{id:"1",stepName:"样本预处理",description:"样本清洗和研磨",duration:30,reagents:["PBS缓冲液","液氮"],status:"completed",startTime:"2024-01-15 09:00:00",endTime:"2024-01-15 09:30:00",notes:"样本研磨充分"},{id:"2",stepName:"细胞裂解",description:"使用裂解缓冲液破坏细胞壁",duration:45,temperature:65,reagents:["CTAB缓冲液","β-巯基乙醇"],status:"completed",startTime:"2024-01-15 09:30:00",endTime:"2024-01-15 10:15:00",notes:"裂解完全"},{id:"3",stepName:"蛋白质去除",description:"使用氯仿-异戊醇去除蛋白质",duration:60,speed:12e3,reagents:["氯仿","异戊醇"],status:"in_progress",startTime:"2024-01-15 10:15:00",notes:"正在离心分离"},{id:"4",stepName:"DNA沉淀",description:"使用异丙醇沉淀DNA",duration:30,reagents:["异丙醇","3M醋酸钠"],status:"pending",notes:"等待上一步完成"},{id:"5",stepName:"DNA洗涤",description:"使用70%乙醇洗涤DNA",duration:20,reagents:["70%乙醇"],status:"pending",notes:"等待DNA沉淀完成"}];t.useEffect(()=>{me()},[]);const me=async()=>{O(!0);try{await new Promise(e=>setTimeout(e,1e3)),V(de)}catch(e){}finally{O(!1)}},xe=e=>({dna_extraction:"DNA提取",rna_extraction:"RNA提取",protein_extraction:"蛋白质提取",purification:"纯化",concentration:"浓缩",fragmentation:"片段化"}[e]),pe=e=>({dna_extraction:"blue",rna_extraction:"green",protein_extraction:"orange",purification:"purple",concentration:"cyan",fragmentation:"magenta"}[e]),ue=e=>({pending:"default",in_progress:"processing",completed:"success",failed:"error",paused:"warning"}[e]),he=e=>({pending:"待处理",in_progress:"处理中",completed:"已完成",failed:"失败",paused:"暂停"}[e]),je=e=>e?e>=90?{text:"优秀",color:"success"}:e>=80?{text:"良好",color:"processing"}:e>=70?{text:"合格",color:"warning"}:{text:"不合格",color:"error"}:{text:"未评估",color:"default"},ge=Q.filter(e=>{const t=!se||e.sampleCode.toLowerCase().includes(se.toLowerCase())||e.sampleName.toLowerCase().includes(se.toLowerCase())||e.protocol.toLowerCase().includes(se.toLowerCase()),s=!le||e.status===le,i=!re||e.method===re;return t&&s&&i}),ye={name:"file",multiple:!0,action:"/api/upload",onChange(e){const{status:t}=e.file;"done"===t?F.success(`${e.file.name} 文件上传成功`):"error"===t&&F.error(`${e.file.name} 文件上传失败`)}},fe=[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:120,fixed:"left"},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:150,ellipsis:!0},{title:"处理方法",dataIndex:"method",key:"method",width:120,render:t=>e.jsx(b,{color:pe(t),icon:e.jsx(n,{}),children:xe(t)})},{title:"协议",dataIndex:"protocol",key:"protocol",width:150,ellipsis:!0,render:(t,s)=>e.jsx(h,{type:"link",size:"small",onClick:()=>(e=>{E(e),Z(!0)})(s),children:t})},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(b,{color:ue(t),children:he(t)})},{title:"进度",dataIndex:"progress",key:"progress",width:120,render:(t,s)=>e.jsx(S,{percent:t,size:"small",status:"failed"===s.status?"exception":"active"})},{title:"产率",key:"yield",width:80,render:(e,t)=>t.yield?`${t.yield}%`:"-"},{title:"质量评分",dataIndex:"qualityScore",key:"qualityScore",width:100,render:t=>{const s=je(t);return t?e.jsxs(b,{color:s.color,children:[t,"分 (",s.text,")"]}):"-"}},{title:"操作人",dataIndex:"operator",key:"operator",width:100},{title:"设备",dataIndex:"equipment",key:"equipment",width:120,ellipsis:!0},{title:"开始时间",dataIndex:"startTime",key:"startTime",width:150,render:e=>y(e).format("MM-DD HH:mm")},{title:"操作",key:"action",width:200,fixed:"right",render:(t,s)=>e.jsxs(q,{size:"small",children:[e.jsx(k,{title:"查看详情",children:e.jsx(h,{type:"text",icon:e.jsx(z,{}),onClick:()=>(e=>{E(e),X(!0)})(s)})}),"pending"===s.status&&e.jsx(k,{title:"开始处理",children:e.jsx(h,{type:"text",icon:e.jsx(D,{}),onClick:()=>(async e=>{try{await new Promise(e=>setTimeout(e,500)),V(t=>t.map(t=>t.id===e?{...t,status:"in_progress"}:t)),F.success("开始处理")}catch(t){F.error("操作失败")}})(s.id)})}),"in_progress"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(k,{title:"暂停处理",children:e.jsx(h,{type:"text",icon:e.jsx($,{}),onClick:()=>(async e=>{try{await new Promise(e=>setTimeout(e,500)),V(t=>t.map(t=>t.id===e?{...t,status:"paused"}:t)),F.success("已暂停处理")}catch(t){F.error("操作失败")}})(s.id)})}),e.jsx(k,{title:"完成处理",children:e.jsx(h,{type:"text",icon:e.jsx(d,{}),onClick:()=>(async e=>{try{await new Promise(e=>setTimeout(e,500)),V(t=>t.map(t=>t.id===e?{...t,status:"completed",progress:100,endTime:y().format("YYYY-MM-DD HH:mm:ss")}:t)),F.success("处理完成")}catch(t){F.error("操作失败")}})(s.id)})})]}),e.jsx(k,{title:"编辑",children:e.jsx(h,{type:"text",icon:e.jsx(B,{}),onClick:()=>(e=>{te(e),oe.setFieldsValue(e),K(!0)})(s)})}),e.jsx(Y,{title:"确定要删除这条记录吗？",onConfirm:()=>(async e=>{try{await new Promise(e=>setTimeout(e,500)),V(t=>t.filter(t=>t.id!==e)),F.success("删除成功")}catch(t){F.error("删除失败")}})(s.id),children:e.jsx(k,{title:"删除",children:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(P,{})})})})]})}];return e.jsxs("div",{children:[e.jsxs(i,{gutter:16,style:{marginBottom:16},children:[e.jsx(l,{span:6,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"总处理数",value:Q.length,prefix:e.jsx(n,{})})})}),e.jsx(l,{span:6,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"处理中",value:Q.filter(e=>"in_progress"===e.status).length,valueStyle:{color:"#1890ff"},prefix:e.jsx(o,{})})})}),e.jsx(l,{span:6,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"已完成",value:Q.filter(e=>"completed"===e.status).length,valueStyle:{color:"#3f8600"},prefix:e.jsx(d,{})})})}),e.jsx(l,{span:6,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"失败/异常",value:Q.filter(e=>"failed"===e.status).length,valueStyle:{color:"#cf1322"},prefix:e.jsx(c,{})})})})]}),Q.some(e=>"failed"===e.status)&&e.jsx(m,{message:"发现处理失败的样本",description:`有 ${Q.filter(e=>"failed"===e.status).length} 个样本处理失败，请检查并重新处理`,type:"error",showIcon:!0,closable:!0,style:{marginBottom:16}}),e.jsx(a,{size:"small",style:{marginBottom:16},children:e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:8,children:e.jsx(M,{placeholder:"搜索样本编号、名称或协议",value:se,onChange:e=>ie(e.target.value),onSearch:me,enterButton:e.jsx(p,{})})}),e.jsx(l,{span:4,children:e.jsxs(u,{placeholder:"状态筛选",value:le,onChange:ae,allowClear:!0,style:{width:"100%"},children:[e.jsx(R,{value:"pending",children:"待处理"}),e.jsx(R,{value:"in_progress",children:"处理中"}),e.jsx(R,{value:"completed",children:"已完成"}),e.jsx(R,{value:"failed",children:"失败"}),e.jsx(R,{value:"paused",children:"暂停"})]})}),e.jsx(l,{span:4,children:e.jsxs(u,{placeholder:"方法筛选",value:re,onChange:ne,allowClear:!0,style:{width:"100%"},children:[e.jsx(R,{value:"dna_extraction",children:"DNA提取"}),e.jsx(R,{value:"rna_extraction",children:"RNA提取"}),e.jsx(R,{value:"protein_extraction",children:"蛋白质提取"}),e.jsx(R,{value:"purification",children:"纯化"}),e.jsx(R,{value:"concentration",children:"浓缩"}),e.jsx(R,{value:"fragmentation",children:"片段化"})]})}),e.jsx(l,{span:4,children:e.jsx(h,{type:"primary",icon:e.jsx(j,{}),onClick:()=>{te(null),oe.resetFields(),K(!0)},children:"新增处理"})}),e.jsx(l,{span:4,children:e.jsx(h,{onClick:me,loading:L,children:"刷新数据"})})]})}),e.jsx(a,{title:"前处理列表",size:"small",children:e.jsx(g,{columns:fe,dataSource:ge,rowKey:"id",loading:L,scroll:{x:1600},pagination:{total:ge.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}),e.jsx(f,{title:ee?"编辑前处理":"新增前处理",open:J,onCancel:()=>K(!1),onOk:()=>oe.submit(),width:800,children:e.jsxs(s,{form:oe,layout:"vertical",onFinish:async e=>{try{if(await new Promise(e=>setTimeout(e,500)),ee)V(t=>t.map(t=>t.id===ee.id?{...t,...e}:t)),F.success("更新成功");else{const t={id:Date.now().toString(),...e,status:"pending",progress:0,startTime:y().format("YYYY-MM-DD HH:mm:ss"),operator:"当前用户"};V(e=>[...e,t]),F.success("添加成功")}K(!1),oe.resetFields()}catch(t){F.error("保存失败")}},children:[e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(s.Item,{name:"sampleCode",label:"样本编号",rules:[{required:!0,message:"请输入样本编号"}],children:e.jsx(x,{placeholder:"请输入样本编号"})})}),e.jsx(l,{span:12,children:e.jsx(s.Item,{name:"sampleName",label:"样本名称",rules:[{required:!0,message:"请输入样本名称"}],children:e.jsx(x,{placeholder:"请输入样本名称"})})})]}),e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(s.Item,{name:"sampleType",label:"样本类型",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsxs(u,{placeholder:"请选择样本类型",children:[e.jsx(R,{value:"土壤",children:"土壤"}),e.jsx(R,{value:"水体",children:"水体"}),e.jsx(R,{value:"植物",children:"植物"}),e.jsx(R,{value:"动物",children:"动物"}),e.jsx(R,{value:"微生物",children:"微生物"})]})})}),e.jsx(l,{span:12,children:e.jsx(s.Item,{name:"method",label:"处理方法",rules:[{required:!0,message:"请选择处理方法"}],children:e.jsxs(u,{placeholder:"请选择处理方法",children:[e.jsx(R,{value:"dna_extraction",children:"DNA提取"}),e.jsx(R,{value:"rna_extraction",children:"RNA提取"}),e.jsx(R,{value:"protein_extraction",children:"蛋白质提取"}),e.jsx(R,{value:"purification",children:"纯化"}),e.jsx(R,{value:"concentration",children:"浓缩"}),e.jsx(R,{value:"fragmentation",children:"片段化"})]})})})]}),e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(s.Item,{name:"protocol",label:"处理协议",rules:[{required:!0,message:"请输入处理协议"}],children:e.jsx(x,{placeholder:"请输入处理协议"})})}),e.jsx(l,{span:12,children:e.jsx(s.Item,{name:"equipment",label:"使用设备",rules:[{required:!0,message:"请输入使用设备"}],children:e.jsx(x,{placeholder:"请输入使用设备"})})})]}),e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:8,children:e.jsx(s.Item,{name:"inputAmount",label:"输入量",rules:[{required:!0,message:"请输入输入量"}],children:e.jsx(w,{min:0,style:{width:"100%"},addonAfter:"ml/g"})})}),e.jsx(l,{span:8,children:e.jsx(s.Item,{name:"outputAmount",label:"输出量",children:e.jsx(w,{min:0,style:{width:"100%"},addonAfter:"ml/g"})})}),e.jsx(l,{span:8,children:e.jsx(s.Item,{name:"concentration",label:"浓度",children:e.jsx(w,{min:0,style:{width:"100%"},addonAfter:"ng/μl"})})})]}),e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:8,children:e.jsx(s.Item,{name:"purity",label:"纯度(A260/A280)",children:e.jsx(w,{min:0,max:5,step:.01,style:{width:"100%"}})})}),e.jsx(l,{span:8,children:e.jsx(s.Item,{name:"qualityScore",label:"质量评分",children:e.jsx(w,{min:0,max:100,style:{width:"100%"}})})}),e.jsx(l,{span:8,children:e.jsx(s.Item,{name:"yield",label:"产率(%)",children:e.jsx(w,{min:0,max:100,style:{width:"100%"}})})})]}),e.jsx(s.Item,{name:"notes",label:"备注",children:e.jsx(H,{rows:3,placeholder:"请输入备注信息"})}),e.jsx(s.Item,{name:"attachments",label:"附件上传",children:e.jsx(v,{...ye,children:e.jsx(h,{icon:e.jsx(I,{}),children:"上传文件"})})})]})}),e.jsx(f,{title:"前处理详情",open:U,onCancel:()=>X(!1),footer:null,width:800,children:W&&e.jsxs("div",{children:[e.jsxs(C,{bordered:!0,size:"small",column:2,children:[e.jsx(C.Item,{label:"样本编号",children:W.sampleCode}),e.jsx(C.Item,{label:"样本名称",children:W.sampleName}),e.jsx(C.Item,{label:"样本类型",children:W.sampleType}),e.jsx(C.Item,{label:"处理方法",children:e.jsx(b,{color:pe(W.method),children:xe(W.method)})}),e.jsx(C.Item,{label:"处理协议",span:2,children:W.protocol}),e.jsx(C.Item,{label:"状态",children:e.jsx(b,{color:ue(W.status),children:he(W.status)})}),e.jsx(C.Item,{label:"进度",children:e.jsx(S,{percent:W.progress,size:"small"})}),e.jsx(C.Item,{label:"操作人",children:W.operator}),e.jsx(C.Item,{label:"使用设备",children:W.equipment}),e.jsxs(C.Item,{label:"输入量",children:[W.inputAmount," ml/g"]}),e.jsx(C.Item,{label:"输出量",children:W.outputAmount?`${W.outputAmount} ml/g`:"-"}),e.jsx(C.Item,{label:"产率",children:W.yield?`${W.yield}%`:"-"}),e.jsx(C.Item,{label:"浓度",children:W.concentration?`${W.concentration} ng/μl`:"-"}),e.jsx(C.Item,{label:"纯度",children:W.purity?W.purity:"-"}),e.jsx(C.Item,{label:"质量评分",children:W.qualityScore?e.jsxs(b,{color:je(W.qualityScore).color,children:[W.qualityScore,"分 (",je(W.qualityScore).text,")"]}):"-"}),e.jsx(C.Item,{label:"开始时间",children:W.startTime}),e.jsx(C.Item,{label:"结束时间",children:W.endTime||"-"}),e.jsx(C.Item,{label:"备注",span:2,children:W.notes||"无"})]}),e.jsx(T,{children:"处理步骤"}),e.jsx(A,{direction:"vertical",size:"small",current:2,items:ce.map(t=>({title:t.stepName,description:e.jsxs("div",{children:[e.jsx("div",{children:t.description}),e.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:4},children:["预计耗时: ",t.duration,"分钟",t.temperature&&` | 温度: ${t.temperature}°C`,t.speed&&` | 转速: ${t.speed}rpm`]}),e.jsxs("div",{style:{fontSize:12,color:"#999",marginTop:2},children:["试剂: ",t.reagents.join(", ")]})]}),status:"failed"===t.status?"error":"in_progress"===t.status?"process":"completed"===t.status?"finish":"wait"}))})]})}),e.jsx(f,{title:"处理协议详情",open:G,onCancel:()=>Z(!1),footer:null,width:600,children:W&&e.jsxs("div",{children:[e.jsx("h4",{children:W.protocol}),e.jsx(N,{items:ce.map(t=>({children:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:t.stepName}),e.jsx("div",{style:{marginTop:4},children:t.description}),e.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:4},children:["耗时: ",t.duration,"分钟",t.temperature&&` | 温度: ${t.temperature}°C`,t.speed&&` | 转速: ${t.speed}rpm`]}),e.jsxs("div",{style:{fontSize:12,color:"#999",marginTop:2},children:["所需试剂: ",t.reagents.join(", ")]})]})}))}),e.jsx("div",{style:{marginTop:16,textAlign:"center"},children:e.jsx(h,{type:"primary",icon:e.jsx(_,{}),children:"下载协议文档"})})]})})]})};export{O as default};
