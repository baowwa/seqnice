import{j as e}from"./index-bgfNE6VX.js";import{r as t}from"./react-vendor-By8n_QN6.js";import{_ as s,c as a,d as r,a as l,P as i,F as n,ap as d,S as o,a0 as c,a1 as p,B as m,a2 as u,U as x,N as h,af as j,ae as g,a3 as y,a4 as S,ah as I,W as D,ao as f,X as w,l as v,V as T,s as N,a7 as b,a9 as C,n as Y,aa as q,aq as k,ar as A,ab as _,ac as M,ad as E,Y as Z,Q as P}from"./antd-vendor-Cii6xr0v.js";const{Option:L}=p,{TextArea:B}=c,{Step:F}=g,{TabPane:X}=d,z=()=>{const[z,H]=t.useState([]),[$,O]=t.useState([]),[R,K]=t.useState([]),[Q,V]=t.useState(!1),[G,J]=t.useState(!1),[U,W]=t.useState(!1),[ee,te]=t.useState(!1),[se,ae]=t.useState(null),[re,le]=t.useState(null),[ie]=s.useForm(),[ne,de]=t.useState(""),[oe,ce]=t.useState(""),[pe,me]=t.useState("batches");t.useEffect(()=>{(async()=>{V(!0);try{await new Promise(e=>setTimeout(e,500)),H([{id:"1",code:"EXP001",name:"肠道菌群测序批次-202401",description:"包含20个肠道菌群样本的16S rRNA测序",status:"in_progress",priority:"high",sampleCount:20,samples:[{id:"1",sampleCode:"S001",sampleName:"肠道样本A",sampleType:"粪便",projectName:"肠道菌群多样性研究",clientName:"医科大学",receivedDate:"2024-01-15",status:"completed"},{id:"2",sampleCode:"S002",sampleName:"肠道样本B",sampleType:"粪便",projectName:"肠道菌群多样性研究",clientName:"医科大学",receivedDate:"2024-01-15",status:"completed"},{id:"3",sampleCode:"S003",sampleName:"肠道样本C",sampleType:"粪便",projectName:"肠道菌群多样性研究",clientName:"医科大学",receivedDate:"2024-01-15",status:"processing"}],completedSamples:15,startDate:"2024-01-15",expectedEndDate:"2024-01-25",actualEndDate:null,currentStep:"library_prep",progress:75,operatorId:"1",operatorName:"张三",equipmentId:"1",equipmentName:"Illumina NovaSeq 6000",notes:"进展顺利，预计按时完成",createdAt:"2024-01-15T09:00:00Z",updatedAt:"2024-01-20T14:30:00Z"},{id:"2",code:"EXP002",name:"土壤微生物宏基因组测序",description:"土壤样本的宏基因组shotgun测序",status:"pending",priority:"medium",sampleCount:12,samples:[{id:"4",sampleCode:"S004",sampleName:"土壤样本A",sampleType:"土壤",projectName:"土壤微生物功能研究",clientName:"农科院",receivedDate:"2024-01-20",status:"pending"},{id:"5",sampleCode:"S005",sampleName:"土壤样本B",sampleType:"土壤",projectName:"土壤微生物功能研究",clientName:"农科院",receivedDate:"2024-01-20",status:"pending"}],completedSamples:0,startDate:"2024-02-01",expectedEndDate:"2024-02-15",actualEndDate:null,currentStep:"sample_prep",progress:10,operatorId:"2",operatorName:"李四",equipmentId:"2",equipmentName:"Illumina HiSeq X Ten",notes:"等待样本质检完成",createdAt:"2024-01-25T10:00:00Z",updatedAt:"2024-01-25T10:00:00Z"},{id:"3",code:"EXP003",name:"海洋微生物多样性分析",description:"海水样本的16S+18S双重测序",status:"completed",priority:"high",sampleCount:30,completedSamples:30,startDate:"2023-12-01",expectedEndDate:"2023-12-20",actualEndDate:"2023-12-18",currentStep:"completed",progress:100,operatorId:"1",operatorName:"张三",equipmentId:"1",equipmentName:"Illumina NovaSeq 6000",notes:"提前完成，数据质量优异",createdAt:"2023-12-01T08:00:00Z",updatedAt:"2023-12-18T16:00:00Z"}])}catch(e){N.error("获取实验批次列表失败")}finally{V(!1)}})(),(async()=>{O([{id:"1",code:"S001",barcode:"BC001234567890",name:"肠道菌群样本-患者001",projectId:"1",projectName:"肠道菌群多样性分析项目",sampleTypeId:"1",sampleTypeName:"粪便样本",status:"processing",priority:"high",receivedDate:"2024-01-15",expectedDate:"2024-01-20",volume:5,concentration:120.5,purity:1.85,qualityScore:95,storageLocation:"A1-01-001",temperature:-80,receiverId:"1",receiverName:"张三",notes:"样本状态良好，无异常",qcPassed:!0,createdAt:"2024-01-15T09:00:00Z",updatedAt:"2024-01-15T10:30:00Z"}])})(),(async()=>{K([{id:"1",name:"样本前处理",code:"sample_prep",description:"样本DNA/RNA提取和质检",order:1,estimatedDuration:480,status:"completed",startTime:"2024-01-15T09:00:00Z",endTime:"2024-01-15T17:00:00Z",operatorId:"1",operatorName:"张三",notes:"提取效果良好",isActive:!0,createdAt:"2024-01-15T09:00:00Z",updatedAt:"2024-01-15T17:00:00Z"},{id:"2",name:"文库构建",code:"library_prep",description:"PCR扩增和文库制备",order:2,estimatedDuration:360,status:"in_progress",startTime:"2024-01-16T09:00:00Z",endTime:null,operatorId:"1",operatorName:"张三",notes:"正在进行PCR扩增",isActive:!0,createdAt:"2024-01-16T09:00:00Z",updatedAt:"2024-01-20T14:30:00Z"},{id:"3",name:"上机测序",code:"sequencing",description:"高通量测序",order:3,estimatedDuration:1440,status:"pending",startTime:null,endTime:null,operatorId:"2",operatorName:"李四",notes:"等待文库构建完成",isActive:!0,createdAt:"2024-01-15T09:00:00Z",updatedAt:"2024-01-15T09:00:00Z"},{id:"4",name:"数据质控",code:"quality_control",description:"原始数据质量评估",order:4,estimatedDuration:120,status:"pending",startTime:null,endTime:null,operatorId:"3",operatorName:"王五",notes:"等待测序完成",isActive:!0,createdAt:"2024-01-15T09:00:00Z",updatedAt:"2024-01-15T09:00:00Z"}])})()},[]);const ue=e=>({pending:"orange",in_progress:"blue",completed:"green",failed:"red",paused:"gray"}[e]),xe=e=>({pending:"待开始",in_progress:"进行中",completed:"已完成",failed:"失败",paused:"暂停"}[e]),he=e=>({high:"red",medium:"orange",low:"green"}[e]),je=e=>({high:"高",medium:"中",low:"低"}[e]),ge=t=>({pending:e.jsx(P,{style:{color:"#faad14"}}),in_progress:e.jsx(A,{style:{color:"#1890ff"}}),completed:e.jsx(Z,{style:{color:"#52c41a"}}),failed:e.jsx(E,{style:{color:"#f5222d"}}),paused:e.jsx(k,{style:{color:"#8c8c8c"}})}[t]),ye=[{title:"批次编号",dataIndex:"code",key:"code",width:120,fixed:"left"},{title:"批次名称",dataIndex:"name",key:"name",width:200,ellipsis:{showTitle:!1},render:t=>e.jsx(b,{placement:"topLeft",title:t,children:t})},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(D,{color:ue(t),children:xe(t)})},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:t=>e.jsx(D,{color:he(t),children:je(t)})},{title:"样本数量",dataIndex:"sampleCount",key:"sampleCount",width:100,render:(t,s)=>e.jsxs("span",{children:[s.completedSamples,"/",t]})},{title:"进度",dataIndex:"progress",key:"progress",width:120,render:t=>e.jsx(w,{percent:t,size:"small",status:100===t?"success":"active"})},{title:"当前步骤",dataIndex:"currentStep",key:"currentStep",width:120,render:e=>({sample_prep:"样本前处理",library_prep:"文库构建",sequencing:"上机测序",quality_control:"数据质控",completed:"已完成"}[e]||e)},{title:"操作员",dataIndex:"operatorName",key:"operatorName",width:100},{title:"设备",dataIndex:"equipmentName",key:"equipmentName",width:150,ellipsis:!0},{title:"开始日期",dataIndex:"startDate",key:"startDate",width:110,render:e=>h(e).format("YYYY-MM-DD")},{title:"预期完成",dataIndex:"expectedEndDate",key:"expectedEndDate",width:110,render:e=>h(e).format("YYYY-MM-DD")},{title:"操作",key:"action",width:180,fixed:"right",render:(t,s)=>e.jsxs(o,{size:"small",children:[e.jsx(b,{title:"查看详情",children:e.jsx(m,{type:"text",icon:e.jsx(C,{}),onClick:()=>Ie(s)})}),e.jsx(b,{title:"工作流",children:e.jsx(m,{type:"text",icon:e.jsx(Y,{}),onClick:()=>De(s)})}),e.jsx(b,{title:"编辑",children:e.jsx(m,{type:"text",icon:e.jsx(q,{}),onClick:()=>Se(s)})}),"in_progress"===s.status&&e.jsx(b,{title:"暂停",children:e.jsx(m,{type:"text",icon:e.jsx(k,{}),onClick:()=>fe(s.id)})}),"paused"===s.status&&e.jsx(b,{title:"继续",children:e.jsx(m,{type:"text",icon:e.jsx(A,{}),onClick:()=>we(s.id)})}),e.jsx(_,{title:"确定要删除这个实验批次吗？",onConfirm:()=>ve(s.id),okText:"确定",cancelText:"取消",children:e.jsx(b,{title:"删除",children:e.jsx(m,{type:"text",danger:!0,icon:e.jsx(M,{})})})})]})}],Se=e=>{ae(e),ie.setFieldsValue({...e,startDate:h(e.startDate),expectedEndDate:h(e.expectedEndDate)}),J(!0)},Ie=e=>{le(e),W(!0)},De=e=>{le(e),te(!0)},fe=async e=>{try{await new Promise(e=>setTimeout(e,500)),H(z.map(t=>t.id===e?{...t,status:"paused"}:t)),N.success("实验批次已暂停")}catch(t){N.error("暂停实验批次失败")}},we=async e=>{try{await new Promise(e=>setTimeout(e,500)),H(z.map(t=>t.id===e?{...t,status:"in_progress"}:t)),N.success("实验批次已继续")}catch(t){N.error("继续实验批次失败")}},ve=async e=>{try{await new Promise(e=>setTimeout(e,500)),H(z.filter(t=>t.id!==e)),N.success("实验批次删除成功")}catch(t){N.error("删除实验批次失败")}},Te=z.filter(e=>{const t=!ne||e.name.toLowerCase().includes(ne.toLowerCase())||e.code.toLowerCase().includes(ne.toLowerCase())||e.description.toLowerCase().includes(ne.toLowerCase()),s=!oe||e.status===oe;return t&&s}),Ne={total:z.length,pending:z.filter(e=>"pending"===e.status).length,inProgress:z.filter(e=>"in_progress"===e.status).length,completed:z.filter(e=>"completed"===e.status).length,totalSamples:z.reduce((e,t)=>e+t.sampleCount,0),completedSamples:z.reduce((e,t)=>e+t.completedSamples,0)};return e.jsxs("div",{children:[e.jsxs(a,{gutter:16,style:{marginBottom:16},children:[e.jsx(r,{span:6,children:e.jsx(l,{children:e.jsx(i,{title:"实验批次总数",value:Ne.total,prefix:e.jsx(n,{})})})}),e.jsx(r,{span:6,children:e.jsx(l,{children:e.jsx(i,{title:"进行中",value:Ne.inProgress,valueStyle:{color:"#1890ff"}})})}),e.jsx(r,{span:6,children:e.jsx(l,{children:e.jsx(i,{title:"样本完成率",value:Ne.totalSamples>0?Ne.completedSamples/Ne.totalSamples*100:0,precision:1,suffix:"%",valueStyle:{color:Ne.completedSamples/Ne.totalSamples>.8?"#52c41a":"#1890ff"}})})}),e.jsx(r,{span:6,children:e.jsx(l,{children:e.jsx(i,{title:"已完成批次",value:Ne.completed,valueStyle:{color:"#52c41a"}})})})]}),e.jsx(l,{children:e.jsxs(d,{activeKey:pe,onChange:me,children:[e.jsxs(X,{tab:"实验批次",children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(o,{children:[e.jsx(c.Search,{placeholder:"搜索批次名称、编号或描述",value:ne,onChange:e=>de(e.target.value),style:{width:300}}),e.jsxs(p,{placeholder:"筛选状态",value:oe,onChange:ce,style:{width:120},allowClear:!0,children:[e.jsx(L,{value:"pending",children:"待开始"}),e.jsx(L,{value:"in_progress",children:"进行中"}),e.jsx(L,{value:"completed",children:"已完成"}),e.jsx(L,{value:"failed",children:"失败"}),e.jsx(L,{value:"paused",children:"暂停"})]}),e.jsx(m,{type:"primary",icon:e.jsx(u,{}),onClick:()=>{ae(null),ie.resetFields(),J(!0)},children:"创建实验批次"})]})}),e.jsx(x,{columns:ye,dataSource:Te,rowKey:"id",loading:Q,scroll:{x:1600},pagination:{total:Te.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})]},"batches"),e.jsxs(X,{tab:"工作流模板",children:[e.jsx(j,{message:"工作流步骤",description:"标准的微生物测序实验流程包含以下步骤",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(g,{direction:"vertical",current:1,children:R.map((t,s)=>e.jsx(F,{title:t.name,description:e.jsxs("div",{children:[e.jsx("p",{children:t.description}),e.jsxs("p",{children:["预计耗时: ",Math.floor(t.estimatedDuration/60),"小时",t.estimatedDuration%60,"分钟"]}),e.jsxs("p",{children:["操作员: ",t.operatorName]}),t.notes&&e.jsxs("p",{children:["备注: ",t.notes]})]}),status:"completed"===t.status?"finish":"in_progress"===t.status?"process":"failed"===t.status?"error":"wait",icon:ge(t.status)},t.id))})]},"workflow")]})}),e.jsx(y,{title:se?"编辑实验批次":"创建实验批次",open:G,onCancel:()=>{J(!1),ie.resetFields()},footer:null,width:800,children:e.jsxs(s,{form:ie,layout:"vertical",onFinish:async e=>{try{V(!0),await new Promise(e=>setTimeout(e,1e3));const t={...e,startDate:e.startDate.format("YYYY-MM-DD"),expectedEndDate:e.expectedEndDate.format("YYYY-MM-DD"),progress:0,completedSamples:0,currentStep:"sample_prep"};if(se){const e={...se,...t,updatedAt:(new Date).toISOString()};H(z.map(t=>t.id===se.id?e:t)),N.success("实验批次更新成功")}else{const e={id:Date.now().toString(),code:`EXP${String(z.length+1).padStart(3,"0")}`,...t,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};H([...z,e]),N.success("实验批次创建成功")}J(!1),ie.resetFields()}catch(t){N.error("操作失败")}finally{V(!1)}},children:[e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"name",label:"批次名称",rules:[{required:!0,message:"请输入批次名称"}],children:e.jsx(c,{placeholder:"请输入批次名称"})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"priority",label:"优先级",rules:[{required:!0,message:"请选择优先级"}],children:e.jsxs(p,{placeholder:"请选择优先级",children:[e.jsx(L,{value:"high",children:"高"}),e.jsx(L,{value:"medium",children:"中"}),e.jsx(L,{value:"low",children:"低"})]})})})]}),e.jsx(s.Item,{name:"description",label:"批次描述",rules:[{required:!0,message:"请输入批次描述"}],children:e.jsx(B,{rows:3,placeholder:"请输入批次描述"})}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"sampleCount",label:"样本数量",rules:[{required:!0,message:"请输入样本数量"}],children:e.jsx(c,{type:"number",min:1,placeholder:"请输入样本数量"})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"startDate",label:"开始日期",rules:[{required:!0,message:"请选择开始日期"}],children:e.jsx(S,{style:{width:"100%"}})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"expectedEndDate",label:"预期完成日期",rules:[{required:!0,message:"请选择预期完成日期"}],children:e.jsx(S,{style:{width:"100%"}})})})]}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"operatorId",label:"操作员",rules:[{required:!0,message:"请选择操作员"}],children:e.jsxs(p,{placeholder:"请选择操作员",children:[e.jsx(L,{value:"1",children:"张三"}),e.jsx(L,{value:"2",children:"李四"}),e.jsx(L,{value:"3",children:"王五"})]})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"equipmentId",label:"测序设备",rules:[{required:!0,message:"请选择测序设备"}],children:e.jsxs(p,{placeholder:"请选择测序设备",children:[e.jsx(L,{value:"1",children:"Illumina NovaSeq 6000"}),e.jsx(L,{value:"2",children:"Illumina HiSeq X Ten"}),e.jsx(L,{value:"3",children:"Ion Torrent PGM"})]})})})]}),e.jsx(s.Item,{name:"status",label:"批次状态",rules:[{required:!0,message:"请选择批次状态"}],children:e.jsxs(p,{placeholder:"请选择批次状态",children:[e.jsx(L,{value:"pending",children:"待开始"}),e.jsx(L,{value:"in_progress",children:"进行中"}),e.jsx(L,{value:"completed",children:"已完成"}),e.jsx(L,{value:"paused",children:"暂停"})]})}),e.jsx(s.Item,{name:"notes",label:"备注",children:e.jsx(B,{rows:3,placeholder:"请输入备注信息"})}),e.jsx(s.Item,{style:{textAlign:"right",marginBottom:0},children:e.jsxs(o,{children:[e.jsx(m,{onClick:()=>J(!1),children:"取消"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:Q,children:se?"更新":"创建"})]})})]})}),e.jsx(y,{title:"实验批次详情",open:U,onCancel:()=>W(!1),footer:[e.jsx(m,{onClick:()=>W(!1),children:"关闭"},"close")],width:900,children:re&&e.jsxs("div",{children:[e.jsxs(I,{bordered:!0,column:2,children:[e.jsx(I.Item,{label:"批次编号",children:re.code}),e.jsx(I.Item,{label:"批次名称",children:re.name}),e.jsx(I.Item,{label:"状态",children:e.jsx(D,{color:ue(re.status),children:xe(re.status)})}),e.jsx(I.Item,{label:"优先级",children:e.jsx(D,{color:he(re.priority),children:je(re.priority)})}),e.jsxs(I.Item,{label:"样本数量",children:[e.jsx(f,{count:re.sampleCount,showZero:!0,color:"#1890ff"}),e.jsxs("span",{style:{marginLeft:8},children:["已完成: ",re.completedSamples]})]}),e.jsx(I.Item,{label:"进度",children:e.jsx(w,{percent:re.progress,size:"small"})}),e.jsx(I.Item,{label:"操作员",children:re.operatorName}),e.jsx(I.Item,{label:"测序设备",children:re.equipmentName}),e.jsx(I.Item,{label:"开始日期",children:h(re.startDate).format("YYYY-MM-DD")}),e.jsx(I.Item,{label:"预期完成",children:h(re.expectedEndDate).format("YYYY-MM-DD")}),e.jsx(I.Item,{label:"实际完成",children:re.actualEndDate?h(re.actualEndDate).format("YYYY-MM-DD"):"未完成"}),e.jsxs(I.Item,{label:"当前步骤",children:["sample_prep"===re.currentStep&&"样本前处理","library_prep"===re.currentStep&&"文库构建","sequencing"===re.currentStep&&"上机测序","quality_control"===re.currentStep&&"数据质控","completed"===re.currentStep&&"已完成"]})]}),e.jsx(v,{}),e.jsxs(I,{bordered:!0,column:1,children:[e.jsx(I.Item,{label:"批次描述",children:re.description}),e.jsx(I.Item,{label:"样本清单",children:e.jsx(x,{dataSource:re.samples||[],columns:[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:120},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:150},{title:"样本类型",dataIndex:"sampleType",key:"sampleType",width:100,render:t=>e.jsx(D,{color:"blue",children:t})},{title:"项目名称",dataIndex:"projectName",key:"projectName",width:200},{title:"客户名称",dataIndex:"clientName",key:"clientName",width:120},{title:"接收日期",dataIndex:"receivedDate",key:"receivedDate",width:120,render:e=>h(e).format("YYYY-MM-DD")},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>{const s={completed:{color:"green",text:"已完成"},processing:{color:"blue",text:"处理中"},pending:{color:"orange",text:"待处理"},failed:{color:"red",text:"失败"}}[t]||{color:"default",text:t};return e.jsx(D,{color:s.color,children:s.text})}}],pagination:!1,size:"small",scroll:{y:300}})}),e.jsx(I.Item,{label:"备注",children:re.notes||"无备注"})]})]})}),e.jsx(y,{title:"实验工作流",open:ee,onCancel:()=>te(!1),footer:[e.jsx(m,{onClick:()=>te(!1),children:"关闭"},"close")],width:800,children:re&&e.jsxs("div",{children:[e.jsx(j,{message:`批次: ${re.name}`,description:`当前进度: ${re.progress}% | 当前步骤: ${re.currentStep}`,type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(T,{children:R.map(t=>e.jsx(T.Item,{dot:ge(t.status),color:"completed"===t.status?"green":"in_progress"===t.status?"blue":"failed"===t.status?"red":"gray",children:e.jsxs("div",{children:[e.jsx("h4",{children:t.name}),e.jsx("p",{children:t.description}),e.jsxs("p",{children:[e.jsx("strong",{children:"状态:"}),e.jsx(D,{color:ue(t.status),style:{marginLeft:8},children:xe(t.status)})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"操作员:"})," ",t.operatorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"预计耗时:"})," ",Math.floor(t.estimatedDuration/60),"小时",t.estimatedDuration%60,"分钟"]}),t.startTime&&e.jsxs("p",{children:[e.jsx("strong",{children:"开始时间:"})," ",h(t.startTime).format("YYYY-MM-DD HH:mm")]}),t.endTime&&e.jsxs("p",{children:[e.jsx("strong",{children:"结束时间:"})," ",h(t.endTime).format("YYYY-MM-DD HH:mm")]}),t.notes&&e.jsxs("p",{children:[e.jsx("strong",{children:"备注:"})," ",t.notes]})]})},t.id))})]})})]})};export{z as default};
