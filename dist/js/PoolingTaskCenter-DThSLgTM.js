import{j as e}from"./index-BLG7Shib.js";import{r as t}from"./react-vendor-CntIoGE-.js";import{$ as i,T as r,c as n,d as a,a as l,Q as s,G as o,ax as d,Z as c,aG as x,am as m,S as u,ay as h,B as p,a1 as j,V as y,a5 as g,O as b,a3 as k,at as C,a6 as w,l as N,X as I,D as v,ad as S,ac as f,aL as B,ah as z,Y as q,I as R,s as V,a4 as D}from"./antd-vendor-D5rArj2z.js";const{TabPane:L}=m,{Option:M}=D,{TextArea:O}=k,{Title:T,Text:F}=r,Y=()=>{const[r,D]=t.useState("pending-libraries"),[L,M]=t.useState([]),[Y,$]=t.useState(!1),[K,Q]=t.useState(!1),[P,Z]=t.useState(!1),[_,J]=t.useState(null),[A]=i.useForm(),[G]=i.useForm(),[H,X]=t.useState([{id:"1",libraryNumber:"LIB001",libraryName:"文库1",sampleNumber:"S001",concentration:15.5,volume:50,insertSize:350,customerName:"客户A",experimentBatch:"B001",completedDate:"2024-01-15",status:"pending",priority:"high",qcResults:{concentration:15.5,purity:1.8,integrity:"良好"}},{id:"2",libraryNumber:"LIB002",libraryName:"文库2",sampleNumber:"S002",concentration:12.3,volume:45,insertSize:380,customerName:"客户B",experimentBatch:"B002",completedDate:"2024-01-16",status:"pending",priority:"medium",qcResults:{concentration:12.3,purity:1.9,integrity:"良好"}},{id:"3",libraryNumber:"LIB003",libraryName:"文库3",sampleNumber:"S003",concentration:18.7,volume:40,insertSize:320,customerName:"客户C",experimentBatch:"B003",completedDate:"2024-01-17",status:"pending",priority:"low",qcResults:{concentration:18.7,purity:1.7,integrity:"优秀"}}]),[E,U]=t.useState([{id:"1",poolNumber:"POOL001",poolName:"混样池1",status:"in_progress",createdBy:"张三",createdDate:"2024-01-15",libraryCount:4,targetConcentration:10,totalVolume:100,estimatedCompletion:"2024-01-18",libraries:[],poolingRatios:[]},{id:"2",poolNumber:"POOL002",poolName:"混样池2",status:"in_progress",createdBy:"李四",createdDate:"2024-01-16",libraryCount:6,targetConcentration:12,totalVolume:120,estimatedCompletion:"2024-01-19",libraries:[],poolingRatios:[]}]),[W,ee]=t.useState([{id:"3",poolNumber:"POOL003",poolName:"混样池3",status:"completed",createdBy:"王五",createdDate:"2024-01-10",libraryCount:8,targetConcentration:15,totalVolume:150,estimatedCompletion:"2024-01-14",libraries:[],poolingRatios:[],qcResults:{finalConcentration:14.8,totalVolume:148,qualityScore:95}}]),te=[{title:"选择",dataIndex:"select",width:60,render:(t,i)=>e.jsx(h,{checked:L.includes(i.id),onChange:e=>ne(i.id,e.target.checked)})},{title:"文库编号",dataIndex:"libraryNumber",key:"libraryNumber",width:120},{title:"文库名称",dataIndex:"libraryName",key:"libraryName",width:150},{title:"样本编号",dataIndex:"sampleNumber",key:"sampleNumber",width:120},{title:"浓度 (nM)",dataIndex:"concentration",key:"concentration",width:100,render:t=>e.jsx(I,{color:"blue",children:t})},{title:"体积 (μL)",dataIndex:"volume",key:"volume",width:100},{title:"插入片段 (bp)",dataIndex:"insertSize",key:"insertSize",width:120},{title:"客户名称",dataIndex:"customerName",key:"customerName",width:120},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:t=>e.jsx(I,{color:"high"===t?"red":"medium"===t?"orange":"default",children:"high"===t?"高":"medium"===t?"中":"低"})},{title:"完成日期",dataIndex:"completedDate",key:"completedDate",width:120},{title:"操作",key:"action",width:120,render:(t,i)=>e.jsx(u,{size:"small",children:e.jsx(p,{type:"link",size:"small",onClick:()=>ae(i.id),children:"加入混样"})})}],ie=[{title:"混样编号",dataIndex:"poolNumber",key:"poolNumber",width:120},{title:"混样名称",dataIndex:"poolName",key:"poolName",width:150},{title:"文库数量",dataIndex:"libraryCount",key:"libraryCount",width:80,render:t=>e.jsx(S,{count:t,showZero:!0,color:"blue"})},{title:"目标浓度 (nM)",dataIndex:"targetConcentration",key:"targetConcentration",width:120,render:t=>e.jsx(I,{color:"green",children:t})},{title:"总体积 (μL)",dataIndex:"totalVolume",key:"totalVolume",width:100},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(I,{color:"processing",children:"in_progress"===t?"进行中":"待开始"})},{title:"创建人",dataIndex:"createdBy",key:"createdBy",width:100},{title:"预计完成",dataIndex:"estimatedCompletion",key:"estimatedCompletion",width:120},{title:"操作",key:"action",width:200,render:(t,i)=>e.jsxs(u,{size:"small",children:[e.jsx(p,{type:"link",size:"small",icon:e.jsx(z,{}),onClick:()=>le(i),children:"查看详情"}),e.jsx(p,{type:"link",size:"small",icon:e.jsx(B,{}),onClick:()=>se(i),children:"比例计算"})]})}],re=[{title:"混样编号",dataIndex:"poolNumber",key:"poolNumber",width:120},{title:"混样名称",dataIndex:"poolName",key:"poolName",width:150},{title:"文库数量",dataIndex:"libraryCount",key:"libraryCount",width:80,render:t=>e.jsx(S,{count:t,showZero:!0,color:"green"})},{title:"最终浓度 (nM)",dataIndex:"qcResults",key:"finalConcentration",width:120,render:t=>e.jsx(I,{color:"success",children:(null==t?void 0:t.finalConcentration)||"-"})},{title:"质量评分",dataIndex:"qcResults",key:"qualityScore",width:100,render:t=>e.jsx(q,{type:"circle",size:40,percent:(null==t?void 0:t.qualityScore)||0,format:e=>`${e}`})},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(I,{color:"completed"===t?"success":"error",children:"completed"===t?"已完成":"失败"})},{title:"创建人",dataIndex:"createdBy",key:"createdBy",width:100},{title:"完成日期",dataIndex:"estimatedCompletion",key:"estimatedCompletion",width:120},{title:"操作",key:"action",width:150,render:(t,i)=>e.jsxs(u,{size:"small",children:[e.jsx(p,{type:"link",size:"small",icon:e.jsx(z,{}),onClick:()=>le(i),children:"查看详情"}),e.jsx(p,{type:"link",size:"small",icon:e.jsx(R,{}),children:"QC报告"})]})}],ne=(e,t)=>{M(t?[...L,e]:L.filter(t=>t!==e))},ae=e=>{g.confirm({title:"选择混样任务",content:"请选择要加入的混样任务",onOk:()=>{V.success("文库已加入混样任务")}})},le=e=>{J(e),Q(!0)},se=e=>{J(e),Z(!0)};return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx(T,{level:2,children:"混样任务中心"}),e.jsxs(n,{gutter:16,style:{marginTop:"16px"},children:[e.jsx(a,{span:6,children:e.jsx(l,{children:e.jsx(s,{title:"待混样文库",value:H.length,prefix:e.jsx(o,{}),valueStyle:{color:"#1890ff"}})})}),e.jsx(a,{span:6,children:e.jsx(l,{children:e.jsx(s,{title:"进行中混样",value:E.length,prefix:e.jsx(d,{}),valueStyle:{color:"#52c41a"}})})}),e.jsx(a,{span:6,children:e.jsx(l,{children:e.jsx(s,{title:"已完成混样",value:W.length,prefix:e.jsx(c,{}),valueStyle:{color:"#722ed1"}})})}),e.jsx(a,{span:6,children:e.jsx(l,{children:e.jsx(s,{title:"今日混样数",value:12,prefix:e.jsx(x,{}),valueStyle:{color:"#fa8c16"}})})})]})]}),e.jsx(l,{children:e.jsx(m,{activeKey:r,onChange:D,items:[{key:"pending-libraries",label:e.jsxs("span",{children:[e.jsx(o,{}),"待混样文库 (",H.length,")"]}),children:e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsxs(u,{children:[e.jsx(h,{checked:L.length===H.length&&H.length>0,indeterminate:L.length>0&&L.length<H.length,onChange:e=>{return t=e.target.checked,void M(t?H.map(e=>e.id):[]);var t},children:"全选"}),e.jsxs(p,{type:"primary",icon:e.jsx(j,{}),onClick:()=>{$(!0)},disabled:0===L.length,children:["创建混样任务并加入选中文库 (",L.length,")"]})]})}),e.jsx(y,{columns:te,dataSource:H,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})]})},{key:"in-progress-poolings",label:e.jsxs("span",{children:[e.jsx(d,{}),"进行中混样 (",E.length,")"]}),children:e.jsx(y,{columns:ie,dataSource:E,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})},{key:"completed-poolings",label:e.jsxs("span",{children:[e.jsx(c,{}),"已完成混样 (",W.length,")"]}),children:e.jsx(y,{columns:re,dataSource:W,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}]})}),e.jsx(g,{title:"创建混样任务",open:Y,onOk:async()=>{try{const e=await A.validateFields(),t={id:Date.now().toString(),poolNumber:`POOL${String(Date.now()).slice(-3)}`,poolName:e.poolName,status:"pending",createdBy:"当前用户",createdDate:b().format("YYYY-MM-DD"),libraryCount:L.length,targetConcentration:e.targetConcentration,totalVolume:e.totalVolume,estimatedCompletion:e.estimatedCompletion.format("YYYY-MM-DD"),libraries:H.filter(e=>L.includes(e.id)),poolingRatios:[]};U([...E,t]),X(H.filter(e=>!L.includes(e.id))),M([]),$(!1),A.resetFields(),V.success("混样任务创建成功")}catch(e){}},onCancel:()=>{$(!1),A.resetFields()},width:600,children:e.jsxs(i,{form:A,layout:"vertical",initialValues:{estimatedCompletion:b().add(2,"day"),targetConcentration:10,totalVolume:100},children:[e.jsxs(n,{gutter:16,children:[e.jsx(a,{span:12,children:e.jsx(i.Item,{name:"poolName",label:"混样名称",rules:[{required:!0,message:"请输入混样名称"}],children:e.jsx(k,{placeholder:"请输入混样名称"})})}),e.jsx(a,{span:12,children:e.jsx(i.Item,{name:"targetConcentration",label:"目标浓度 (nM)",rules:[{required:!0,message:"请输入目标浓度"}],children:e.jsx(C,{min:.1,max:100,step:.1,placeholder:"请输入目标浓度",style:{width:"100%"}})})})]}),e.jsxs(n,{gutter:16,children:[e.jsx(a,{span:12,children:e.jsx(i.Item,{name:"totalVolume",label:"总体积 (μL)",rules:[{required:!0,message:"请输入总体积"}],children:e.jsx(C,{min:10,max:1e3,step:10,placeholder:"请输入总体积",style:{width:"100%"}})})}),e.jsx(a,{span:12,children:e.jsx(i.Item,{name:"estimatedCompletion",label:"预计完成时间",rules:[{required:!0,message:"请选择预计完成时间"}],children:e.jsx(w,{style:{width:"100%"}})})})]}),e.jsx(i.Item,{name:"notes",label:"备注",children:e.jsx(O,{rows:3,placeholder:"请输入备注信息"})}),e.jsx(N,{}),e.jsxs("div",{children:[e.jsxs(F,{strong:!0,children:["选中的文库 (",L.length,")"]}),e.jsx("div",{style:{marginTop:"8px",maxHeight:"200px",overflowY:"auto"},children:H.filter(e=>L.includes(e.id)).map(t=>e.jsxs(I,{style:{margin:"2px"},children:[t.libraryNumber," - ",t.concentration,"nM"]},t.id))})]})]})}),e.jsx(v,{title:`混样详情 - ${null==_?void 0:_.poolNumber}`,placement:"right",width:800,open:K,onClose:()=>Q(!1),children:_&&e.jsxs("div",{children:[e.jsxs(l,{title:"混样信息",style:{marginBottom:"16px"},children:[e.jsxs(n,{gutter:16,children:[e.jsxs(a,{span:8,children:[e.jsx(F,{strong:!0,children:"混样编号："}),e.jsx("br",{}),e.jsx(F,{children:_.poolNumber})]}),e.jsxs(a,{span:8,children:[e.jsx(F,{strong:!0,children:"混样名称："}),e.jsx("br",{}),e.jsx(F,{children:_.poolName})]}),e.jsxs(a,{span:8,children:[e.jsx(F,{strong:!0,children:"状态："}),e.jsx("br",{}),e.jsx(I,{color:"completed"===_.status?"success":"processing",children:"completed"===_.status?"已完成":"in_progress"===_.status?"进行中":"待开始"})]})]}),e.jsxs(n,{gutter:16,style:{marginTop:"16px"},children:[e.jsxs(a,{span:8,children:[e.jsx(F,{strong:!0,children:"创建人："}),e.jsx("br",{}),e.jsx(F,{children:_.createdBy})]}),e.jsxs(a,{span:8,children:[e.jsx(F,{strong:!0,children:"创建时间："}),e.jsx("br",{}),e.jsx(F,{children:_.createdDate})]}),e.jsxs(a,{span:8,children:[e.jsx(F,{strong:!0,children:"文库数量："}),e.jsx("br",{}),e.jsx(S,{count:_.libraryCount,showZero:!0,color:"blue"})]})]}),e.jsxs(n,{gutter:16,style:{marginTop:"16px"},children:[e.jsxs(a,{span:8,children:[e.jsx(F,{strong:!0,children:"目标浓度："}),e.jsx("br",{}),e.jsxs(F,{children:[_.targetConcentration," nM"]})]}),e.jsxs(a,{span:8,children:[e.jsx(F,{strong:!0,children:"总体积："}),e.jsx("br",{}),e.jsxs(F,{children:[_.totalVolume," μL"]})]}),e.jsxs(a,{span:8,children:[e.jsx(F,{strong:!0,children:"预计完成："}),e.jsx("br",{}),e.jsx(F,{children:_.estimatedCompletion})]})]})]}),_.qcResults&&e.jsx(l,{title:"QC结果",style:{marginBottom:"16px"},children:e.jsxs(n,{gutter:16,children:[e.jsx(a,{span:8,children:e.jsx(s,{title:"最终浓度 (nM)",value:_.qcResults.finalConcentration,precision:1})}),e.jsx(a,{span:8,children:e.jsx(s,{title:"实际体积 (μL)",value:_.qcResults.totalVolume,precision:0})}),e.jsx(a,{span:8,children:e.jsx(s,{title:"质量评分",value:_.qcResults.qualityScore,suffix:"%"})})]})}),e.jsx(l,{title:"包含文库",children:e.jsx(y,{size:"small",columns:[{title:"文库编号",dataIndex:"libraryNumber",key:"libraryNumber"},{title:"样本编号",dataIndex:"sampleNumber",key:"sampleNumber"},{title:"浓度 (nM)",dataIndex:"concentration",key:"concentration"},{title:"体积 (μL)",dataIndex:"volume",key:"volume"},{title:"插入片段 (bp)",dataIndex:"insertSize",key:"insertSize"}],dataSource:_.libraries,rowKey:"id",pagination:!1})})]})}),e.jsx(g,{title:`混样比例计算 - ${null==_?void 0:_.poolNumber}`,open:P,onCancel:()=>Z(!1),width:1e3,footer:[e.jsxs(p,{type:"primary",onClick:()=>{if(!_)return;const e=_.libraries,t=_.targetConcentration,i=_.totalVolume,r=100/e.length,n=e.map(e=>{const n=i*r/100,a=e.concentration/t;return{libraryId:e.id,libraryNumber:e.libraryNumber,originalConcentration:e.concentration,targetRatio:r,requiredVolume:n,dilutionFactor:a}}),a={..._,poolingRatios:n};J(a),V.success("混样比例计算完成")},children:[e.jsx(B,{})," 计算比例"]},"calculate"),e.jsx(p,{onClick:()=>Z(!1),children:"关闭"},"close")],children:_&&e.jsxs("div",{children:[e.jsx(f,{message:"混样比例计算",description:`目标浓度: ${_.targetConcentration} nM，总体积: ${_.totalVolume} μL`,type:"info",style:{marginBottom:"16px"}}),e.jsx(y,{size:"small",columns:[{title:"文库编号",dataIndex:"libraryNumber",key:"libraryNumber"},{title:"原始浓度 (nM)",dataIndex:"originalConcentration",key:"originalConcentration"},{title:"目标比例 (%)",dataIndex:"targetRatio",key:"targetRatio",render:e=>null==e?void 0:e.toFixed(1)},{title:"所需体积 (μL)",dataIndex:"requiredVolume",key:"requiredVolume",render:e=>null==e?void 0:e.toFixed(1)},{title:"稀释倍数",dataIndex:"dilutionFactor",key:"dilutionFactor",render:e=>null==e?void 0:e.toFixed(2)}],dataSource:_.poolingRatios,rowKey:"libraryId",pagination:!1})]})})]})};export{Y as default};
