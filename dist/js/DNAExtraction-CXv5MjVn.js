import{j as e}from"./index-DyvGJ5NW.js";import{a as t}from"./react-vendor-DKSb2WWV.js";import{O as a,a0 as i,s,a as n,T as l,G as r,a1 as d,V as o,ad as c,al as p,_ as m,an as h,D as x,a2 as y,a4 as u,m as g,W as j,a3 as v,S as w,B as f,a5 as D,c as b,e as C,n as S,aa as N,ag as k,Y as I}from"./antd-vendor-CqkZOb36.js";const{Title:T,Text:A}=l,{Option:R}=v,{TextArea:Y}=y,{TabPane:K}=d,{Search:B}=y,_=()=>{const[l,A]=t.useState("pending"),[Y,K]=t.useState([]),[_,M]=t.useState([]),[z,G]=t.useState(!1),[E,Q]=t.useState([]),[$,P]=t.useState(!1),[F,L]=t.useState(null),[O,Z]=t.useState(!1),[q,J]=t.useState([]),[V,W]=t.useState([]),[H,U]=t.useState(""),[X,ee]=t.useState(a()),[te,ae]=t.useState(""),[ie,se]=t.useState(""),[ne,le]=t.useState([]),[re,de]=t.useState([]),[oe,ce]=t.useState([]),[pe,me]=t.useState([]),[he]=i.useForm();t.useEffect(()=>{ye(),ue(),ge(),je()},[]);const xe=e=>{switch(e){case"pending":return Y.filter(e=>"pending"===e.status);case"processing":return Y.filter(e=>"in_progress"===e.status);case"completed":return Y.filter(e=>"completed"===e.status);case"error":return Y.filter(e=>"failed"===e.status);default:return Y}},ye=async()=>{G(!0);try{K([{id:"1",sampleCode:"S2024001",sampleName:"血液样本001",sampleType:"blood",status:"pending",receivedDate:"2024-01-15",projectName:"基因检测项目A",department:"clinical",priority:"high"},{id:"2",sampleCode:"S2024002",sampleName:"组织样本002",sampleType:"tissue",status:"in_progress",receivedDate:"2024-01-16",projectName:"基因检测项目B",department:"pathology",priority:"medium",operator:"张三",extractionDate:"2024-01-17"},{id:"3",sampleCode:"S2024003",sampleName:"唾液样本003",sampleType:"saliva",status:"completed",receivedDate:"2024-01-14",projectName:"基因检测项目A",department:"genetics",priority:"low",operator:"李四",extractionDate:"2024-01-16",concentration:125.6,purityRatio:1.85},{id:"4",sampleCode:"S2024004",sampleName:"尿液样本004",sampleType:"urine",status:"pending",receivedDate:"2024-01-18",projectName:"基因检测项目C",department:"clinical",priority:"urgent"},{id:"5",sampleCode:"S2024005",sampleName:"血液样本005",sampleType:"blood",status:"failed",receivedDate:"2024-01-17",projectName:"基因检测项目A",department:"clinical",priority:"high",operator:"王五",extractionDate:"2024-01-18",notes:"样本质量不佳，需重新采集"},{id:"6",sampleCode:"S2024006",sampleName:"组织样本006",sampleType:"tissue",status:"quality_check",receivedDate:"2024-01-19",projectName:"基因检测项目B",department:"pathology",priority:"medium",operator:"赵六",extractionDate:"2024-01-20",concentration:98.3,purityRatio:1.92},{id:"7",sampleCode:"S2024007",sampleName:"唾液样本007",sampleType:"saliva",status:"pending",receivedDate:"2024-01-20",projectName:"基因检测项目D",department:"genetics",priority:"low"},{id:"8",sampleCode:"S2024008",sampleName:"血液样本008",sampleType:"blood",status:"in_progress",receivedDate:"2024-01-21",projectName:"基因检测项目A",department:"clinical",priority:"high",operator:"孙七",extractionDate:"2024-01-22"},{id:"9",sampleCode:"S2024009",sampleName:"其他样本009",sampleType:"other",status:"completed",receivedDate:"2024-01-19",projectName:"基因检测项目E",department:"research",priority:"medium",operator:"周八",extractionDate:"2024-01-21",concentration:156.8,purityRatio:1.78},{id:"10",sampleCode:"S2024010",sampleName:"组织样本010",sampleType:"tissue",status:"pending",receivedDate:"2024-01-22",projectName:"基因检测项目B",department:"pathology",priority:"urgent"}])}catch(e){s.error("加载样本数据失败")}finally{G(!1)}},ue=async()=>{try{M([{id:"1",sampleId:"3",sampleCode:"S2024003",operator:"李四",method:"Qiagen DNeasy Kit",startTime:"2024-01-16 09:00:00",endTime:"2024-01-16 11:30:00",concentration:125.6,purityRatio:1.85,totalAmount:2512,status:"completed",notes:"提取顺利，质量良好"},{id:"2",sampleId:"2",sampleCode:"S2024002",operator:"张三",method:"TIANamp Genomic DNA Kit",startTime:"2024-01-17 10:00:00",status:"in_progress",notes:"正在进行中"},{id:"3",sampleId:"9",sampleCode:"S2024009",operator:"周八",method:"QIAamp DNA Mini Kit",startTime:"2024-01-21 08:30:00",endTime:"2024-01-21 12:15:00",concentration:156.8,purityRatio:1.78,totalAmount:3136,status:"completed",notes:"提取效果优秀"},{id:"4",sampleId:"6",sampleCode:"S2024006",operator:"赵六",method:"Invitrogen PureLink Kit",startTime:"2024-01-20 14:00:00",endTime:"2024-01-20 17:30:00",concentration:98.3,purityRatio:1.92,totalAmount:1966,status:"quality_check",notes:"等待质检结果"},{id:"5",sampleId:"8",sampleCode:"S2024008",operator:"孙七",method:"Qiagen DNeasy Kit",startTime:"2024-01-22 09:15:00",status:"in_progress",notes:"提取进行中，预计下午完成"},{id:"6",sampleId:"5",sampleCode:"S2024005",operator:"王五",method:"TIANamp Genomic DNA Kit",startTime:"2024-01-18 11:00:00",endTime:"2024-01-18 14:30:00",concentration:45.2,purityRatio:1.45,totalAmount:904,status:"failed",notes:"样本质量差，浓度过低，建议重新采集"},{id:"7",sampleId:"1",sampleCode:"S2024001",operator:"李四",method:"QIAamp DNA Mini Kit",startTime:"2024-01-23 10:00:00",status:"pending",notes:"待开始提取"}])}catch(e){s.error("加载提取记录失败")}},ge=async()=>{try{ce([{id:"1",code:"R001",name:"Qiagen DNeasy Blood & Tissue Kit",brand:"Qiagen",expiryDate:"2024-12-31",batchNumber:"QG20240101"},{id:"2",code:"R002",name:"TIANamp Genomic DNA Kit",brand:"TIANGEN",expiryDate:"2024-11-30",batchNumber:"TG20240201"},{id:"3",code:"R003",name:"Proteinase K",brand:"Thermo Fisher",expiryDate:"2024-10-15",batchNumber:"TF20240301"},{id:"4",code:"R004",name:"RNase A",brand:"Sigma-Aldrich",expiryDate:"2025-01-20",batchNumber:"SA20240401"}])}catch(e){s.error("加载试剂数据失败")}},je=async()=>{try{me([{id:"1",code:"E001",name:"离心机",brand:"Eppendorf",model:"5424R",status:"available"},{id:"2",code:"E002",name:"恒温振荡器",brand:"Thermo Fisher",model:"MaxQ 4000",status:"available"},{id:"3",code:"E003",name:"移液器",brand:"Gilson",model:"Pipetman P1000",status:"in_use"},{id:"4",code:"E004",name:"水浴锅",brand:"Grant",model:"JB Nova",status:"available"},{id:"5",code:"E005",name:"涡旋混合器",brand:"Scientific Industries",model:"Vortex-Genie 2",status:"maintenance"}])}catch(e){s.error("加载设备数据失败")}},ve=[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:120,fixed:"left"},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:150},{title:"样本类型",dataIndex:"sampleType",key:"sampleType",width:100,render:e=>({blood:"血液",tissue:"组织",saliva:"唾液",urine:"尿液",other:"其他"}[e])},{title:"状态",dataIndex:"status",key:"status",width:120,render:t=>(t=>{const a={pending:{color:"default",text:"待提取",icon:e.jsx(o,{})},in_progress:{color:"processing",text:"提取中",icon:e.jsx(p,{})},completed:{color:"success",text:"已完成",icon:e.jsx(m,{})},failed:{color:"error",text:"失败",icon:e.jsx(h,{})},quality_check:{color:"warning",text:"质检中",icon:e.jsx(r,{})}}[t];return e.jsx(I,{color:a.color,icon:a.icon,children:a.text})})(t)},{title:"项目名称",dataIndex:"projectName",key:"projectName",width:150},{title:"接收日期",dataIndex:"receivedDate",key:"receivedDate",width:120},{title:"操作员",dataIndex:"operator",key:"operator",width:100},{title:"DNA浓度(ng/μL)",dataIndex:"concentration",key:"concentration",width:130,render:e=>e?e.toFixed(2):"-"},{title:"纯度比值",dataIndex:"purityRatio",key:"purityRatio",width:100,render:e=>e?e.toFixed(2):"-"}],we=e=>0===E.length?void s.warning("请先选择样本"):void Z(!0),fe=(e,t)=>{Q(e),J(t)},De=()=>{Z(!1),Q([]),J([]),W([]),U(""),ee(a()),ae(""),se(""),le([]),de([])},be=t=>{const a=xe(t);return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(b,{gutter:16,children:[e.jsx(C,{span:6,children:e.jsx(B,{placeholder:"样本条码或名称",allowClear:!0,onSearch:e=>{}})}),e.jsx(C,{span:6,children:e.jsxs(v,{placeholder:"检验科室",allowClear:!0,style:{width:"100%"},children:[e.jsx(R,{value:"clinical",children:"临床检验科"}),e.jsx(R,{value:"pathology",children:"病理科"}),e.jsx(R,{value:"genetics",children:"遗传学科"}),e.jsx(R,{value:"microbiology",children:"微生物科"}),e.jsx(R,{value:"immunology",children:"免疫科"})]})}),e.jsx(C,{span:6,children:e.jsxs(v,{placeholder:"样本类型",allowClear:!0,style:{width:"100%"},children:[e.jsx(R,{value:"blood",children:"血液"}),e.jsx(R,{value:"tissue",children:"组织"}),e.jsx(R,{value:"saliva",children:"唾液"}),e.jsx(R,{value:"urine",children:"尿液"}),e.jsx(R,{value:"other",children:"其他"})]})}),e.jsx(C,{span:6,children:e.jsx(f,{icon:e.jsx(S,{}),onClick:ye,children:"刷新"})})]})}),"pending"===t&&e.jsx("div",{style:{marginBottom:16},children:e.jsxs(w,{children:[e.jsx(f,{type:"primary",icon:e.jsx(D,{}),onClick:()=>we(),children:"新增提取"}),e.jsx(f,{icon:e.jsx(N,{}),children:"导出"})]})}),e.jsx(j,{columns:ve,dataSource:a,rowKey:"id",loading:z,scroll:{x:1500},rowSelection:"pending"===t||"error"===t?{selectedRowKeys:E,onChange:fe,getCheckboxProps:e=>({disabled:"completed"===e.status})}:void 0,pagination:{total:a.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条/共 ${e} 条`}})]})};return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(n,{children:[e.jsxs(T,{level:2,children:[e.jsx(r,{})," DNA提取"]}),e.jsx(d,{activeKey:l,onChange:A,items:[{key:"pending",label:e.jsxs("span",{children:[e.jsx(o,{}),"待处理 ",e.jsx(c,{count:xe("pending").length,showZero:!0})]}),children:be("pending")},{key:"processing",label:e.jsxs("span",{children:[e.jsx(p,{}),"处理中 ",e.jsx(c,{count:xe("processing").length,showZero:!0})]}),children:be("processing")},{key:"completed",label:e.jsxs("span",{children:[e.jsx(m,{}),"已处理 ",e.jsx(c,{count:xe("completed").length,showZero:!0})]}),children:be("completed")},{key:"error",label:e.jsxs("span",{children:[e.jsx(h,{}),"处理异常 ",e.jsx(c,{count:xe("error").length,showZero:!0})]}),children:be("error")}]})]}),e.jsx(x,{title:"DNA提取",placement:"right",width:"60%",onClose:De,open:O,extra:e.jsxs(w,{children:[e.jsx(f,{onClick:De,children:"取消"}),e.jsx(f,{type:"primary",onClick:()=>we(),children:"新增提取"})]}),children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{display:"flex",marginBottom:16,gap:24},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1},children:[e.jsxs("span",{style:{width:100,textAlign:"right",marginRight:16},children:[e.jsx("span",{style:{color:"red"},children:"*"})," 提取批次："]}),e.jsx(y,{value:H,onChange:e=>U(e.target.value),placeholder:"请输入提取批次号",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1},children:[e.jsxs("span",{style:{width:100,textAlign:"right",marginRight:16},children:[e.jsx("span",{style:{color:"red"},children:"*"})," 提取时间："]}),e.jsx(u,{value:X,onChange:e=>ee(e),placeholder:"选择提取时间",style:{flex:1}})]})]}),e.jsxs("div",{style:{display:"flex",marginBottom:16,gap:24},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1},children:[e.jsxs("span",{style:{width:100,textAlign:"right",marginRight:16},children:[e.jsx("span",{style:{color:"red"},children:"*"})," 操作人员："]}),e.jsx(y,{value:te,onChange:e=>ae(e.target.value),placeholder:"请输入操作人员",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1},children:[e.jsxs("span",{style:{width:100,textAlign:"right",marginRight:16},children:[e.jsx("span",{style:{color:"red"},children:"*"})," 复核人员："]}),e.jsx(y,{value:ie,onChange:e=>se(e.target.value),placeholder:"请输入复核人员",style:{flex:1}})]})]})]}),e.jsx(g,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(T,{level:5,style:{margin:"0 0 16px 0"},children:"试剂列表"}),e.jsx(j,{columns:[{title:"试剂编码",dataIndex:"code",key:"code",width:150,render:(t,a,i)=>e.jsx(v,{value:t,placeholder:"选择试剂编码",style:{width:"100%"},showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase()),onChange:e=>{const t=oe.find(t=>t.code===e);if(t){const e=[...ne];e[i]={...t,id:a.id},le(e)}},children:oe.map(t=>e.jsx(R,{value:t.code,children:t.code},t.code))})},{title:"试剂名称",dataIndex:"name",key:"name",width:200},{title:"品牌",dataIndex:"brand",key:"brand",width:120},{title:"有效期至",dataIndex:"expiryDate",key:"expiryDate",width:150,render:(t,i,s)=>e.jsx(u,{value:a(t),onChange:e=>{const a=[...ne];a[s]={...a[s],expiryDate:(null==e?void 0:e.format("YYYY-MM-DD"))||t},le(a)},format:"YYYY-MM-DD",size:"small",style:{width:"100%"}})},{title:"操作",key:"action",width:120,render:(t,i,s)=>e.jsxs(w,{size:"small",children:[e.jsx(f,{type:"link",size:"small",style:{color:"#1890ff",padding:0},icon:e.jsx(D,{}),onClick:()=>{const e={id:`temp_${Date.now()}`,code:"",name:"",brand:"",expiryDate:a().format("YYYY-MM-DD"),batchNumber:""},t=[...ne];t.splice(s+1,0,e),le(t)},children:"新增"}),e.jsx(f,{type:"link",size:"small",danger:!0,onClick:()=>{const e=ne.filter((e,t)=>t!==s);le(e)},children:"删除"})]})}],dataSource:ne.length>0?ne:[{id:`temp_${Date.now()}`,code:"",name:"",brand:"",expiryDate:a().format("YYYY-MM-DD"),batchNumber:""}],rowKey:"id",pagination:!1,size:"small",locale:{emptyText:"暂无试剂"}})]}),e.jsx(g,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(T,{level:5,style:{margin:0},children:"设备列表"})}),e.jsx(j,{columns:[{title:"设备编码",dataIndex:"code",key:"code",width:150,render:(t,a,i)=>e.jsx(v,{value:t,placeholder:"选择设备编码",style:{width:"100%"},showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase()),onChange:e=>{const t=pe.find(t=>t.code===e);if(t){const e=[...re];e[i]={...t,id:a.id},de(e)}},children:pe.map(t=>e.jsx(R,{value:t.code,children:t.code},t.code))})},{title:"设备名称",dataIndex:"name",key:"name",width:200},{title:"品牌",dataIndex:"brand",key:"brand",width:120},{title:"型号",dataIndex:"model",key:"model",width:120},{title:"操作",key:"action",width:120,render:(t,a,i)=>e.jsxs(w,{children:[e.jsx(f,{type:"link",size:"small",style:{color:"#1890ff",padding:0},icon:e.jsx(D,{}),onClick:()=>{const e={id:`temp_${Date.now()}`,code:"",name:"",brand:"",model:"",status:"available"};de([...re,e])},children:"新增"}),e.jsx(f,{type:"link",size:"small",danger:!0,onClick:()=>{const e=re.filter((e,t)=>t!==i);de(e)},children:"删除"})]})}],dataSource:re.length>0?re:[{id:`temp_${Date.now()}`,code:"",name:"",brand:"",model:"",status:"available"}],rowKey:"id",pagination:!1,size:"small",locale:{emptyText:"暂无设备，点击新增按钮添加设备"}})]}),e.jsx(g,{}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs(T,{level:5,children:["选中的样本 (",q.length,")"]}),e.jsxs(f,{danger:!0,disabled:0===V.length,onClick:()=>{0!==V.length?k.confirm({title:"确认移除",content:`确定要移除选中的 ${V.length} 个样本吗？`,onOk:()=>{const e=q.filter(e=>!V.includes(e.id)),t=E.filter(e=>!V.includes(e));J(e),Q(t),W([]),s.success(`成功移除 ${V.length} 个样本`)}}):s.warning("请先选择要移除的样本")},children:["移除选中 (",V.length,")"]})]}),e.jsx(j,{columns:[{title:"样本条码",dataIndex:"sampleCode",key:"sampleCode",width:120},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:120},{title:"样本类型",dataIndex:"sampleType",key:"sampleType",width:100,render:e=>({blood:"血液",tissue:"组织",saliva:"唾液",urine:"尿液",other:"其他"}[e]||e)},{title:"检验科室",dataIndex:"department",key:"department",width:120},{title:"项目名称",dataIndex:"projectName",key:"projectName",width:150},{title:"接收日期",dataIndex:"receivedDate",key:"receivedDate",width:120,render:e=>a(e).format("YYYY-MM-DD")}],dataSource:q,rowKey:"id",rowSelection:{selectedRowKeys:V,onChange:e=>{W(e)},getCheckboxProps:()=>({})},pagination:!1,scroll:{y:300},size:"small"})]})]})})]})};export{_ as default};
