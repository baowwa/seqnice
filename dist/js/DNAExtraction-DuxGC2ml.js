import{j as e}from"./index-BD7k3pCu.js";import{r as t}from"./react-vendor-BSBC8BLg.js";import{O as a,$ as i,s,a as n,T as r,G as l,am as d,U as o,ad as c,ax as p,Z as m,aq as h,D as x,a3 as y,a6 as u,m as j,V as g,a4 as v,S as w,B as D,a1 as f,c as N,e as S,n as b,a9 as C,X as k}from"./antd-vendor-DCQn9U8Y.js";const{Title:I,Text:T}=r,{Option:A}=v,{TextArea:R}=y,{TabPane:Y}=d,{Search:K}=y,B=()=>{const[r,T]=t.useState("pending"),[R,Y]=t.useState([]),[B,_]=t.useState([]),[M,z]=t.useState(!1),[G,E]=t.useState([]),[Q,$]=t.useState(!1),[F,L]=t.useState(null),[P,Z]=t.useState(!1),[q,O]=t.useState([]),[J,V]=t.useState(""),[U,X]=t.useState(a()),[H,W]=t.useState(""),[ee,te]=t.useState(""),[ae,ie]=t.useState([]),[se,ne]=t.useState([]),[re,le]=t.useState([]),[de,oe]=t.useState([]),[ce]=i.useForm();t.useEffect(()=>{me(),he(),xe(),ye()},[]);const pe=e=>{switch(e){case"pending":return R.filter(e=>"pending"===e.status);case"processing":return R.filter(e=>"in_progress"===e.status);case"completed":return R.filter(e=>"completed"===e.status);case"error":return R.filter(e=>"failed"===e.status);default:return R}},me=async()=>{z(!0);try{Y([{id:"1",sampleCode:"S2024001",sampleName:"血液样本001",sampleType:"blood",status:"pending",receivedDate:"2024-01-15",projectName:"基因检测项目A",department:"clinical",priority:"high"},{id:"2",sampleCode:"S2024002",sampleName:"组织样本002",sampleType:"tissue",status:"in_progress",receivedDate:"2024-01-16",projectName:"基因检测项目B",department:"pathology",priority:"medium",operator:"张三",extractionDate:"2024-01-17"},{id:"3",sampleCode:"S2024003",sampleName:"唾液样本003",sampleType:"saliva",status:"completed",receivedDate:"2024-01-14",projectName:"基因检测项目A",department:"genetics",priority:"low",operator:"李四",extractionDate:"2024-01-16",concentration:125.6,purityRatio:1.85},{id:"4",sampleCode:"S2024004",sampleName:"尿液样本004",sampleType:"urine",status:"pending",receivedDate:"2024-01-18",projectName:"基因检测项目C",department:"clinical",priority:"urgent"},{id:"5",sampleCode:"S2024005",sampleName:"血液样本005",sampleType:"blood",status:"failed",receivedDate:"2024-01-17",projectName:"基因检测项目A",department:"clinical",priority:"high",operator:"王五",extractionDate:"2024-01-18",notes:"样本质量不佳，需重新采集"},{id:"6",sampleCode:"S2024006",sampleName:"组织样本006",sampleType:"tissue",status:"quality_check",receivedDate:"2024-01-19",projectName:"基因检测项目B",department:"pathology",priority:"medium",operator:"赵六",extractionDate:"2024-01-20",concentration:98.3,purityRatio:1.92},{id:"7",sampleCode:"S2024007",sampleName:"唾液样本007",sampleType:"saliva",status:"pending",receivedDate:"2024-01-20",projectName:"基因检测项目D",department:"genetics",priority:"low"},{id:"8",sampleCode:"S2024008",sampleName:"血液样本008",sampleType:"blood",status:"in_progress",receivedDate:"2024-01-21",projectName:"基因检测项目A",department:"clinical",priority:"high",operator:"孙七",extractionDate:"2024-01-22"},{id:"9",sampleCode:"S2024009",sampleName:"其他样本009",sampleType:"other",status:"completed",receivedDate:"2024-01-19",projectName:"基因检测项目E",department:"research",priority:"medium",operator:"周八",extractionDate:"2024-01-21",concentration:156.8,purityRatio:1.78},{id:"10",sampleCode:"S2024010",sampleName:"组织样本010",sampleType:"tissue",status:"pending",receivedDate:"2024-01-22",projectName:"基因检测项目B",department:"pathology",priority:"urgent"}])}catch(e){s.error("加载样本数据失败")}finally{z(!1)}},he=async()=>{try{_([{id:"1",sampleId:"3",sampleCode:"S2024003",operator:"李四",method:"Qiagen DNeasy Kit",startTime:"2024-01-16 09:00:00",endTime:"2024-01-16 11:30:00",concentration:125.6,purityRatio:1.85,totalAmount:2512,status:"completed",notes:"提取顺利，质量良好"},{id:"2",sampleId:"2",sampleCode:"S2024002",operator:"张三",method:"TIANamp Genomic DNA Kit",startTime:"2024-01-17 10:00:00",status:"in_progress",notes:"正在进行中"},{id:"3",sampleId:"9",sampleCode:"S2024009",operator:"周八",method:"QIAamp DNA Mini Kit",startTime:"2024-01-21 08:30:00",endTime:"2024-01-21 12:15:00",concentration:156.8,purityRatio:1.78,totalAmount:3136,status:"completed",notes:"提取效果优秀"},{id:"4",sampleId:"6",sampleCode:"S2024006",operator:"赵六",method:"Invitrogen PureLink Kit",startTime:"2024-01-20 14:00:00",endTime:"2024-01-20 17:30:00",concentration:98.3,purityRatio:1.92,totalAmount:1966,status:"quality_check",notes:"等待质检结果"},{id:"5",sampleId:"8",sampleCode:"S2024008",operator:"孙七",method:"Qiagen DNeasy Kit",startTime:"2024-01-22 09:15:00",status:"in_progress",notes:"提取进行中，预计下午完成"},{id:"6",sampleId:"5",sampleCode:"S2024005",operator:"王五",method:"TIANamp Genomic DNA Kit",startTime:"2024-01-18 11:00:00",endTime:"2024-01-18 14:30:00",concentration:45.2,purityRatio:1.45,totalAmount:904,status:"failed",notes:"样本质量差，浓度过低，建议重新采集"},{id:"7",sampleId:"1",sampleCode:"S2024001",operator:"李四",method:"QIAamp DNA Mini Kit",startTime:"2024-01-23 10:00:00",status:"pending",notes:"待开始提取"}])}catch(e){s.error("加载提取记录失败")}},xe=async()=>{try{le([{id:"1",code:"R001",name:"Qiagen DNeasy Blood & Tissue Kit",brand:"Qiagen",expiryDate:"2024-12-31",batchNumber:"QG20240101"},{id:"2",code:"R002",name:"TIANamp Genomic DNA Kit",brand:"TIANGEN",expiryDate:"2024-11-30",batchNumber:"TG20240201"},{id:"3",code:"R003",name:"Proteinase K",brand:"Thermo Fisher",expiryDate:"2024-10-15",batchNumber:"TF20240301"},{id:"4",code:"R004",name:"RNase A",brand:"Sigma-Aldrich",expiryDate:"2025-01-20",batchNumber:"SA20240401"}])}catch(e){s.error("加载试剂数据失败")}},ye=async()=>{try{oe([{id:"1",code:"E001",name:"离心机",brand:"Eppendorf",model:"5424R",status:"available"},{id:"2",code:"E002",name:"恒温振荡器",brand:"Thermo Fisher",model:"MaxQ 4000",status:"available"},{id:"3",code:"E003",name:"移液器",brand:"Gilson",model:"Pipetman P1000",status:"in_use"},{id:"4",code:"E004",name:"水浴锅",brand:"Grant",model:"JB Nova",status:"available"},{id:"5",code:"E005",name:"涡旋混合器",brand:"Scientific Industries",model:"Vortex-Genie 2",status:"maintenance"}])}catch(e){s.error("加载设备数据失败")}},ue=[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:120,fixed:"left"},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:150},{title:"样本类型",dataIndex:"sampleType",key:"sampleType",width:100,render:e=>({blood:"血液",tissue:"组织",saliva:"唾液",urine:"尿液",other:"其他"}[e])},{title:"状态",dataIndex:"status",key:"status",width:120,render:t=>(t=>{const a={pending:{color:"default",text:"待提取",icon:e.jsx(o,{})},in_progress:{color:"processing",text:"提取中",icon:e.jsx(p,{})},completed:{color:"success",text:"已完成",icon:e.jsx(m,{})},failed:{color:"error",text:"失败",icon:e.jsx(h,{})},quality_check:{color:"warning",text:"质检中",icon:e.jsx(l,{})}}[t];return e.jsx(k,{color:a.color,icon:a.icon,children:a.text})})(t)},{title:"项目名称",dataIndex:"projectName",key:"projectName",width:150},{title:"接收日期",dataIndex:"receivedDate",key:"receivedDate",width:120},{title:"操作员",dataIndex:"operator",key:"operator",width:100},{title:"DNA浓度(ng/μL)",dataIndex:"concentration",key:"concentration",width:130,render:e=>e?e.toFixed(2):"-"},{title:"纯度比值",dataIndex:"purityRatio",key:"purityRatio",width:100,render:e=>e?e.toFixed(2):"-"}],je=e=>0===G.length?void s.warning("请先选择样本"):void Z(!0),ge=(e,t)=>{E(e),O(t)},ve=()=>{Z(!1),E([]),O([]),V(""),X(a()),W(""),te(""),ie([]),ne([])},we=t=>{const a=pe(t);return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(N,{gutter:16,children:[e.jsx(S,{span:6,children:e.jsx(K,{placeholder:"样本条码或名称",allowClear:!0,onSearch:e=>{}})}),e.jsx(S,{span:6,children:e.jsxs(v,{placeholder:"检验科室",allowClear:!0,style:{width:"100%"},children:[e.jsx(A,{value:"clinical",children:"临床检验科"}),e.jsx(A,{value:"pathology",children:"病理科"}),e.jsx(A,{value:"genetics",children:"遗传学科"}),e.jsx(A,{value:"microbiology",children:"微生物科"}),e.jsx(A,{value:"immunology",children:"免疫科"})]})}),e.jsx(S,{span:6,children:e.jsxs(v,{placeholder:"样本类型",allowClear:!0,style:{width:"100%"},children:[e.jsx(A,{value:"blood",children:"血液"}),e.jsx(A,{value:"tissue",children:"组织"}),e.jsx(A,{value:"saliva",children:"唾液"}),e.jsx(A,{value:"urine",children:"尿液"}),e.jsx(A,{value:"other",children:"其他"})]})}),e.jsx(S,{span:6,children:e.jsx(D,{icon:e.jsx(b,{}),onClick:me,children:"刷新"})})]})}),"pending"===t&&e.jsx("div",{style:{marginBottom:16},children:e.jsxs(w,{children:[e.jsx(D,{type:"primary",icon:e.jsx(f,{}),onClick:()=>je(),children:"新增提取"}),e.jsx(D,{icon:e.jsx(C,{}),children:"导出"})]})}),e.jsx(g,{columns:ue,dataSource:a,rowKey:"id",loading:M,scroll:{x:1500},rowSelection:"pending"===t||"error"===t?{selectedRowKeys:G,onChange:ge,getCheckboxProps:e=>({disabled:"completed"===e.status})}:void 0,pagination:{total:a.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条/共 ${e} 条`}})]})};return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(n,{children:[e.jsxs(I,{level:2,children:[e.jsx(l,{})," DNA提取"]}),e.jsx(d,{activeKey:r,onChange:T,items:[{key:"pending",label:e.jsxs("span",{children:[e.jsx(o,{}),"待处理 ",e.jsx(c,{count:pe("pending").length,showZero:!0})]}),children:we("pending")},{key:"processing",label:e.jsxs("span",{children:[e.jsx(p,{}),"处理中 ",e.jsx(c,{count:pe("processing").length,showZero:!0})]}),children:we("processing")},{key:"completed",label:e.jsxs("span",{children:[e.jsx(m,{}),"已处理 ",e.jsx(c,{count:pe("completed").length,showZero:!0})]}),children:we("completed")},{key:"error",label:e.jsxs("span",{children:[e.jsx(h,{}),"处理异常 ",e.jsx(c,{count:pe("error").length,showZero:!0})]}),children:we("error")}]})]}),e.jsx(x,{title:"DNA提取",placement:"right",width:"60%",onClose:ve,open:P,extra:e.jsxs(w,{children:[e.jsx(D,{onClick:ve,children:"取消"}),e.jsx(D,{type:"primary",onClick:()=>je(),children:"新增提取"})]}),children:e.jsxs("div",{style:{padding:"16px 0"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs("div",{style:{display:"flex",marginBottom:16,gap:24},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1},children:[e.jsxs("span",{style:{width:100,textAlign:"right",marginRight:16},children:[e.jsx("span",{style:{color:"red"},children:"*"})," 提取批次："]}),e.jsx(y,{value:J,onChange:e=>V(e.target.value),placeholder:"请输入提取批次号",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1},children:[e.jsxs("span",{style:{width:100,textAlign:"right",marginRight:16},children:[e.jsx("span",{style:{color:"red"},children:"*"})," 提取时间："]}),e.jsx(u,{value:U,onChange:e=>X(e),placeholder:"选择提取时间",style:{flex:1}})]})]}),e.jsxs("div",{style:{display:"flex",marginBottom:16,gap:24},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1},children:[e.jsxs("span",{style:{width:100,textAlign:"right",marginRight:16},children:[e.jsx("span",{style:{color:"red"},children:"*"})," 操作人员："]}),e.jsx(y,{value:H,onChange:e=>W(e.target.value),placeholder:"请输入操作人员",style:{flex:1}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1},children:[e.jsxs("span",{style:{width:100,textAlign:"right",marginRight:16},children:[e.jsx("span",{style:{color:"red"},children:"*"})," 复核人员："]}),e.jsx(y,{value:ee,onChange:e=>te(e.target.value),placeholder:"请输入复核人员",style:{flex:1}})]})]})]}),e.jsx(j,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx(I,{level:5,style:{margin:"0 0 16px 0"},children:"试剂列表"}),e.jsx(g,{columns:[{title:"试剂编码",dataIndex:"code",key:"code",width:150,render:(t,a,i)=>e.jsx(v,{value:t,placeholder:"选择试剂编码",style:{width:"100%"},showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase()),onChange:e=>{const t=re.find(t=>t.code===e);if(t){const e=[...ae];e[i]={...t,id:a.id},ie(e)}},children:re.map(t=>e.jsx(A,{value:t.code,children:t.code},t.code))})},{title:"试剂名称",dataIndex:"name",key:"name",width:200},{title:"品牌",dataIndex:"brand",key:"brand",width:120},{title:"有效期至",dataIndex:"expiryDate",key:"expiryDate",width:150,render:(t,i,s)=>e.jsx(u,{value:a(t),onChange:e=>{const a=[...ae];a[s]={...a[s],expiryDate:(null==e?void 0:e.format("YYYY-MM-DD"))||t},ie(a)},format:"YYYY-MM-DD",size:"small",style:{width:"100%"}})},{title:"操作",key:"action",width:120,render:(t,i,s)=>e.jsxs(w,{size:"small",children:[e.jsx(D,{type:"link",size:"small",style:{color:"#1890ff",padding:0},icon:e.jsx(f,{}),onClick:()=>{const e={id:`temp_${Date.now()}`,code:"",name:"",brand:"",expiryDate:a().format("YYYY-MM-DD"),batchNumber:""},t=[...ae];t.splice(s+1,0,e),ie(t)},children:"新增"}),e.jsx(D,{type:"link",size:"small",danger:!0,onClick:()=>{const e=ae.filter((e,t)=>t!==s);ie(e)},children:"删除"})]})}],dataSource:ae.length>0?ae:[{id:`temp_${Date.now()}`,code:"",name:"",brand:"",expiryDate:a().format("YYYY-MM-DD"),batchNumber:""}],rowKey:"id",pagination:!1,size:"small",locale:{emptyText:"暂无试剂"}})]}),e.jsx(j,{}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(I,{level:5,style:{margin:0},children:"设备列表"})}),e.jsx(g,{columns:[{title:"设备编码",dataIndex:"code",key:"code",width:150,render:(t,a,i)=>e.jsx(v,{value:t,placeholder:"选择设备编码",style:{width:"100%"},showSearch:!0,filterOption:(e,t)=>String((null==t?void 0:t.label)??"").toLowerCase().includes(e.toLowerCase()),onChange:e=>{const t=de.find(t=>t.code===e);if(t){const e=[...se];e[i]={...t,id:a.id},ne(e)}},children:de.map(t=>e.jsx(A,{value:t.code,children:t.code},t.code))})},{title:"设备名称",dataIndex:"name",key:"name",width:200},{title:"品牌",dataIndex:"brand",key:"brand",width:120},{title:"型号",dataIndex:"model",key:"model",width:120},{title:"操作",key:"action",width:120,render:(t,a,i)=>e.jsxs(w,{children:[e.jsx(D,{type:"link",size:"small",style:{color:"#1890ff",padding:0},icon:e.jsx(f,{}),onClick:()=>{const e={id:`temp_${Date.now()}`,code:"",name:"",brand:"",model:"",status:"available"};ne([...se,e])},children:"新增"}),e.jsx(D,{type:"link",size:"small",danger:!0,onClick:()=>{const e=se.filter((e,t)=>t!==i);ne(e)},children:"删除"})]})}],dataSource:se.length>0?se:[{id:`temp_${Date.now()}`,code:"",name:"",brand:"",model:"",status:"available"}],rowKey:"id",pagination:!1,size:"small",locale:{emptyText:"暂无设备，点击新增按钮添加设备"}})]}),e.jsx(j,{}),e.jsxs("div",{children:[e.jsxs(I,{level:5,children:["选中的样本 (",q.length,")"]}),e.jsx(g,{columns:[{title:"样本条码",dataIndex:"sampleCode",key:"sampleCode",width:120},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:120},{title:"样本类型",dataIndex:"sampleType",key:"sampleType",width:100,render:e=>({blood:"血液",tissue:"组织",saliva:"唾液",urine:"尿液",other:"其他"}[e]||e)},{title:"检验科室",dataIndex:"department",key:"department",width:120},{title:"项目名称",dataIndex:"projectName",key:"projectName",width:150},{title:"接收日期",dataIndex:"receivedDate",key:"receivedDate",width:120,render:e=>a(e).format("YYYY-MM-DD")}],dataSource:q,rowKey:"id",pagination:!1,scroll:{y:300},size:"small"})]})]})})]})};export{B as default};
