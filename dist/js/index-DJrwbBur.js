import{j as e}from"./index-B3ZSLooO.js";import{r as t}from"./react-vendor-BSBC8BLg.js";import{$ as s,c as a,d as r,a as l,Q as n,F as i,V as d,O as c,S as o,a3 as m,a4 as u,B as h,a1 as p,a5 as x,a6 as j,X as g,Y as y,l as D,x as v,s as f,ag as w,ah as C,ai as S,ak as I,al as A}from"./antd-vendor-BuqAAsAf.js";const{Option:b}=u,{TextArea:T}=m,{RangePicker:Y}=j,Z=()=>{var j,Z,k;const[M,N]=t.useState([]),[P,z]=t.useState([]),[L,R]=t.useState([]),[_,q]=t.useState(!1),[B,F]=t.useState(!1),[J,O]=t.useState(!1),[V,$]=t.useState(null),[H,K]=t.useState(null),[Q]=s.useForm(),[U,E]=t.useState(""),[X,G]=t.useState("");t.useEffect(()=>{(async()=>{q(!0);try{await new Promise(e=>setTimeout(e,500)),N([{id:"1",name:"肠道菌群多样性分析项目",code:"PRJ001",customerId:"1",customerName:"北京大学医学院",description:"研究肠道菌群与疾病的关系",status:"in_progress",priority:"high",startDate:"2024-01-15",endDate:"2024-03-15",estimatedDays:60,actualDays:45,progress:75,managerId:"1",managerName:"张三",teamMembers:["张三","李四","王五"],budget:5e4,actualCost:37500,sampleCount:120,completedSamples:90,createdAt:"2024-01-10T10:00:00Z",updatedAt:"2024-02-25T15:30:00Z"},{id:"2",name:"土壤微生物群落结构研究",code:"PRJ002",customerId:"2",customerName:"中科院生态环境研究中心",description:"分析不同土壤类型的微生物群落结构",status:"planning",priority:"medium",startDate:"2024-03-01",endDate:"2024-05-01",estimatedDays:60,actualDays:0,progress:10,managerId:"2",managerName:"李四",teamMembers:["李四","王五"],budget:8e4,actualCost:8e3,sampleCount:200,completedSamples:0,createdAt:"2024-02-20T09:00:00Z",updatedAt:"2024-02-25T11:20:00Z"},{id:"3",name:"海洋微生物基因组测序",code:"PRJ003",customerId:"3",customerName:"青岛海洋大学",description:"深海微生物基因组测序与功能分析",status:"completed",priority:"high",startDate:"2023-10-01",endDate:"2023-12-31",estimatedDays:90,actualDays:85,progress:100,managerId:"1",managerName:"张三",teamMembers:["张三","赵六"],budget:12e4,actualCost:115e3,sampleCount:50,completedSamples:50,createdAt:"2023-09-25T14:00:00Z",updatedAt:"2023-12-31T18:00:00Z"},{id:"4",name:"结核分枝杆菌耐药基因检测",code:"PRJ004",customerId:"4",customerName:"北京胸科医院",description:"结核分枝杆菌（Mycobacterium tuberculosis）耐药基因检测与分析",status:"in_progress",priority:"high",startDate:"2024-02-01",endDate:"2024-04-01",estimatedDays:60,actualDays:30,progress:50,managerId:"2",managerName:"李四",teamMembers:["李四","王五","赵六"],budget:95e3,actualCost:47500,sampleCount:150,completedSamples:75,createdAt:"2024-01-25T08:30:00Z",updatedAt:"2024-03-01T16:45:00Z"},{id:"5",name:"HIV病毒载量检测与基因型分析",code:"PRJ005",customerId:"5",customerName:"首都医科大学附属北京佑安医院",description:"人类免疫缺陷病毒（Human Immunodeficiency Virus, HIV）病毒载量检测与耐药基因型分析",status:"planning",priority:"high",startDate:"2024-03-15",endDate:"2024-06-15",estimatedDays:90,actualDays:0,progress:5,managerId:"1",managerName:"张三",teamMembers:["张三","李四"],budget:11e4,actualCost:5500,sampleCount:200,completedSamples:0,createdAt:"2024-03-01T09:15:00Z",updatedAt:"2024-03-05T14:20:00Z"}])}catch(e){f.error("获取项目列表失败")}finally{q(!1)}})(),(async()=>{z([{id:"1",name:"北京大学医学院",code:"PKU001",type:"university",contactPerson:"王教授",phone:"010-12345678",email:"wang@pku.edu.cn",address:"北京市海淀区学院路38号",isActive:!0,createdAt:"2023-01-01T00:00:00Z",updatedAt:"2023-01-01T00:00:00Z"},{id:"2",name:"中科院生态环境研究中心",code:"CAS001",type:"research_institute",contactPerson:"李研究员",phone:"010-87654321",email:"li@rcees.ac.cn",address:"北京市海淀区双清路18号",isActive:!0,createdAt:"2023-01-01T00:00:00Z",updatedAt:"2023-01-01T00:00:00Z"},{id:"3",name:"青岛海洋大学",code:"OUC001",type:"university",contactPerson:"赵教授",phone:"0532-12345678",email:"zhao@ouc.edu.cn",address:"山东省青岛市崂山区松岭路238号",isActive:!0,createdAt:"2023-01-01T00:00:00Z",updatedAt:"2023-01-01T00:00:00Z"}])})(),(async()=>{R([{id:"1",username:"admin",name:"张三",email:"zhang@example.com",role:"admin",department:"管理部",isActive:!0,createdAt:"2023-01-01T00:00:00Z",updatedAt:"2023-01-01T00:00:00Z"},{id:"2",username:"manager1",name:"李四",email:"li@example.com",role:"analyst",department:"分析部",isActive:!0,createdAt:"2023-01-01T00:00:00Z",updatedAt:"2023-01-01T00:00:00Z"},{id:"3",username:"tech1",name:"王五",email:"wang@example.com",role:"technician",department:"实验部",isActive:!0,createdAt:"2023-01-01T00:00:00Z",updatedAt:"2023-01-01T00:00:00Z"},{id:"4",username:"analyst1",name:"赵六",email:"zhao@example.com",role:"analyst",department:"分析部",isActive:!0,createdAt:"2023-01-01T00:00:00Z",updatedAt:"2023-01-01T00:00:00Z"}])})()},[]);const W=e=>({planning:"blue",in_progress:"orange",completed:"green",cancelled:"red",on_hold:"gray"}[e]),ee=e=>({planning:"规划中",in_progress:"进行中",completed:"已完成",cancelled:"已取消",on_hold:"暂停"}[e]),te=e=>({high:"red",medium:"orange",low:"green"}[e]),se=e=>({high:"高",medium:"中",low:"低"}[e]),ae=[{title:"项目编号",dataIndex:"code",key:"code",width:120,fixed:"left"},{title:"项目名称",dataIndex:"name",key:"name",width:200,fixed:"left",ellipsis:{showTitle:!1},render:t=>e.jsx(w,{placement:"topLeft",title:t,children:t})},{title:"客户",dataIndex:"customerName",key:"customerName",width:150},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(g,{color:W(t),children:ee(t)})},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:t=>e.jsx(g,{color:te(t),children:se(t)})},{title:"进度",dataIndex:"progress",key:"progress",width:120,render:t=>e.jsx(y,{percent:t,size:"small",status:100===t?"success":"active"})},{title:"项目经理",dataIndex:"managerName",key:"managerName",width:100},{title:"样本数量",key:"sampleProgress",width:120,render:(t,s)=>e.jsxs("span",{children:[s.completedSamples,"/",s.sampleCount]})},{title:"预算/实际",key:"budget",width:120,render:(t,s)=>{var a,r;return e.jsxs("div",{children:[e.jsxs("div",{children:["¥",null==(a=s.budget)?void 0:a.toLocaleString()]}),e.jsxs("div",{style:{color:"#666",fontSize:"12px"},children:["¥",null==(r=s.actualCost)?void 0:r.toLocaleString()]})]})}},{title:"开始日期",dataIndex:"startDate",key:"startDate",width:110,render:e=>c(e).format("YYYY-MM-DD")},{title:"结束日期",dataIndex:"endDate",key:"endDate",width:110,render:e=>c(e).format("YYYY-MM-DD")},{title:"操作",key:"action",width:150,fixed:"right",render:(t,s)=>e.jsxs(o,{size:"small",children:[e.jsx(w,{title:"查看详情",children:e.jsx(h,{type:"text",icon:e.jsx(C,{}),onClick:()=>le(s)})}),e.jsx(w,{title:"编辑",children:e.jsx(h,{type:"text",icon:e.jsx(S,{}),onClick:()=>re(s)})}),e.jsx(I,{title:"确定要删除这个项目吗？",onConfirm:()=>ne(s.id),okText:"确定",cancelText:"取消",children:e.jsx(w,{title:"删除",children:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(A,{})})})})]})}],re=e=>{$(e),Q.setFieldsValue({...e,dateRange:[c(e.startDate),c(e.endDate)]}),F(!0)},le=e=>{K(e),O(!0)},ne=async e=>{try{await new Promise(e=>setTimeout(e,500)),N(M.filter(t=>t.id!==e)),f.success("项目删除成功")}catch(t){f.error("删除项目失败")}},ie=M.filter(e=>{const t=!U||e.name.toLowerCase().includes(U.toLowerCase())||e.code.toLowerCase().includes(U.toLowerCase())||e.customerName.toLowerCase().includes(U.toLowerCase()),s=!X||e.status===X;return t&&s}),de={total:M.length,planning:M.filter(e=>"planning"===e.status).length,inProgress:M.filter(e=>"in_progress"===e.status).length,completed:M.filter(e=>"completed"===e.status).length,totalBudget:M.reduce((e,t)=>e+(t.budget||0),0),totalCost:M.reduce((e,t)=>e+(t.actualCost||0),0)};return e.jsxs("div",{children:[e.jsxs(a,{gutter:16,style:{marginBottom:16},children:[e.jsx(r,{span:6,children:e.jsx(l,{children:e.jsx(n,{title:"项目总数",value:de.total,prefix:e.jsx(i,{})})})}),e.jsx(r,{span:6,children:e.jsx(l,{children:e.jsx(n,{title:"进行中",value:de.inProgress,valueStyle:{color:"#1890ff"}})})}),e.jsx(r,{span:6,children:e.jsx(l,{children:e.jsx(n,{title:"已完成",value:de.completed,valueStyle:{color:"#52c41a"}})})}),e.jsx(r,{span:6,children:e.jsx(l,{children:e.jsx(n,{title:"预算执行率",value:de.totalBudget>0?de.totalCost/de.totalBudget*100:0,precision:1,suffix:"%",valueStyle:{color:de.totalCost/de.totalBudget>.9?"#f5222d":"#52c41a"}})})})]}),e.jsx(l,{title:"项目管理",extra:e.jsxs(o,{children:[e.jsx(m.Search,{placeholder:"搜索项目名称、编号或客户",value:U,onChange:e=>E(e.target.value),style:{width:250}}),e.jsxs(u,{placeholder:"筛选状态",value:X,onChange:G,style:{width:120},allowClear:!0,children:[e.jsx(b,{value:"planning",children:"规划中"}),e.jsx(b,{value:"in_progress",children:"进行中"}),e.jsx(b,{value:"completed",children:"已完成"}),e.jsx(b,{value:"cancelled",children:"已取消"}),e.jsx(b,{value:"on_hold",children:"暂停"})]}),e.jsx(h,{type:"primary",icon:e.jsx(p,{}),onClick:()=>{$(null),Q.resetFields(),F(!0)},children:"新建项目"})]}),children:e.jsx(d,{columns:ae,dataSource:ie,rowKey:"id",loading:_,scroll:{x:1500},pagination:{total:ie.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}),e.jsx(x,{title:V?"编辑项目":"新建项目",open:B,onCancel:()=>{F(!1),Q.resetFields()},footer:null,width:800,children:e.jsxs(s,{form:Q,layout:"vertical",onFinish:async e=>{var t,s;try{q(!0),await new Promise(e=>setTimeout(e,1e3));const a={...e,startDate:e.dateRange[0].format("YYYY-MM-DD"),endDate:e.dateRange[1].format("YYYY-MM-DD"),estimatedDays:e.dateRange[1].diff(e.dateRange[0],"day"),customerName:null==(t=P.find(t=>t.id===e.customerId))?void 0:t.name,managerName:null==(s=L.find(t=>t.id===e.managerId))?void 0:s.name,progress:V?V.progress:0,actualDays:V?V.actualDays:0,completedSamples:V?V.completedSamples:0,actualCost:V?V.actualCost:0};if(V){const e={...V,...a,updatedAt:(new Date).toISOString()};N(M.map(t=>t.id===V.id?e:t)),f.success("项目更新成功")}else{const e={id:Date.now().toString(),code:`PRJ${String(M.length+1).padStart(3,"0")}`,...a,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};N([...M,e]),f.success("项目创建成功")}F(!1),Q.resetFields()}catch(a){f.error("操作失败")}finally{q(!1)}},children:[e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"name",label:"项目名称",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(m,{placeholder:"请输入项目名称"})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"customerId",label:"客户",rules:[{required:!0,message:"请选择客户"}],children:e.jsx(u,{placeholder:"请选择客户",children:P.map(t=>e.jsx(b,{value:t.id,children:t.name},t.id))})})})]}),e.jsx(s.Item,{name:"description",label:"项目描述",rules:[{required:!0,message:"请输入项目描述"}],children:e.jsx(T,{rows:3,placeholder:"请输入项目描述"})}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"priority",label:"优先级",rules:[{required:!0,message:"请选择优先级"}],children:e.jsxs(u,{placeholder:"请选择优先级",children:[e.jsx(b,{value:"high",children:"高"}),e.jsx(b,{value:"medium",children:"中"}),e.jsx(b,{value:"low",children:"低"})]})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"managerId",label:"项目经理",rules:[{required:!0,message:"请选择项目经理"}],children:e.jsx(u,{placeholder:"请选择项目经理",children:L.filter(e=>"admin"===e.role||"analyst"===e.role).map(t=>e.jsx(b,{value:t.id,children:t.name},t.id))})})}),e.jsx(r,{span:8,children:e.jsx(s.Item,{name:"sampleCount",label:"样本数量",rules:[{required:!0,message:"请输入样本数量"}],children:e.jsx(m,{type:"number",placeholder:"请输入样本数量"})})})]}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"dateRange",label:"项目周期",rules:[{required:!0,message:"请选择项目周期"}],children:e.jsx(Y,{style:{width:"100%"}})})}),e.jsx(r,{span:12,children:e.jsx(s.Item,{name:"budget",label:"项目预算",rules:[{required:!0,message:"请输入项目预算"}],children:e.jsx(m,{type:"number",placeholder:"请输入项目预算",addonAfter:"元"})})})]}),e.jsx(s.Item,{name:"teamMembers",label:"团队成员",children:e.jsx(u,{mode:"multiple",placeholder:"请选择团队成员",style:{width:"100%"},children:L.map(t=>e.jsxs(b,{value:t.name,children:[t.name," (",t.department,")"]},t.id))})}),e.jsx(s.Item,{style:{textAlign:"right",marginBottom:0},children:e.jsxs(o,{children:[e.jsx(h,{onClick:()=>F(!1),children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",loading:_,children:V?"更新":"创建"})]})})]})}),e.jsx(x,{title:"项目详情",open:J,onCancel:()=>O(!1),footer:[e.jsx(h,{onClick:()=>O(!1),children:"关闭"},"close")],width:800,children:H&&e.jsxs("div",{children:[e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsxs(l,{size:"small",title:"基本信息",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"项目编号："}),H.code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"项目名称："}),H.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"客户："}),H.customerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"项目经理："}),H.managerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"状态："}),e.jsx(g,{color:W(H.status),style:{marginLeft:8},children:ee(H.status)})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"优先级："}),e.jsx(g,{color:te(H.priority),style:{marginLeft:8},children:se(H.priority)})]})]})}),e.jsx(r,{span:12,children:e.jsxs(l,{size:"small",title:"进度信息",children:[e.jsx("p",{children:e.jsx("strong",{children:"整体进度："})}),e.jsx(y,{percent:H.progress}),e.jsxs("p",{children:[e.jsx("strong",{children:"样本进度："}),H.completedSamples,"/",H.sampleCount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"开始日期："}),c(H.startDate).format("YYYY-MM-DD")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"结束日期："}),c(H.endDate).format("YYYY-MM-DD")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"预计天数："}),H.estimatedDays,"天"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"实际天数："}),H.actualDays,"天"]})]})})]}),e.jsx(D,{}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsxs(l,{size:"small",title:"财务信息",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"项目预算："}),"¥",null==(j=H.budget)?void 0:j.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"实际成本："}),"¥",null==(Z=H.actualCost)?void 0:Z.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"预算执行率："}),H.budget&&H.actualCost?`${(H.actualCost/H.budget*100).toFixed(1)}%`:"0%"]})]})}),e.jsx(r,{span:12,children:e.jsxs(l,{size:"small",title:"团队信息",children:[e.jsx("p",{children:e.jsx("strong",{children:"团队成员："})}),e.jsx("div",{children:null==(k=H.teamMembers)?void 0:k.map((t,s)=>e.jsx(g,{icon:e.jsx(v,{}),style:{marginBottom:4},children:t},s))})]})})]}),e.jsx(D,{}),e.jsx(l,{size:"small",title:"项目描述",children:e.jsx("p",{children:H.description})})]})})]})};export{Z as default};
