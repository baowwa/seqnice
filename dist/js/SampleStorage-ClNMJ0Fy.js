import{j as e}from"./index-bgfNE6VX.js";import{r as s}from"./react-vendor-By8n_QN6.js";import{_ as t,N as n,c as i,d as l,a,af as r,a0 as o,ag as d,a1 as c,B as h,ak as x,a2 as u,U as m,a3 as j,al as p,ah as g,W as y,am as f,a7 as C,X as v,an as w,S as _,a9 as I,aa as z,ab as b,ac as k,s as S,ao as D}from"./antd-vendor-Cii6xr0v.js";const{Search:q}=o,{Option:T}=c,{TextArea:L}=o,A=()=>{const[A,B]=s.useState(!1),[N,Q]=s.useState([]),[M,F]=s.useState([]),[R,W]=s.useState(null),[P,Y]=s.useState(!1),[E,O]=s.useState(!1),[$,J]=s.useState(!1),[K,U]=s.useState(null),[V,X]=s.useState(""),[G,H]=s.useState(""),[Z,ee]=s.useState(""),[se,te]=s.useState(""),[ne]=t.useForm(),ie=[{id:"freezer_1",name:"-80°C超低温冰箱A",type:"freezer",capacity:100,currentCount:75,temperature:-80,condition:"frozen_minus80",children:[{id:"freezer_1_rack_1",name:"架子1",type:"rack",capacity:25,currentCount:20,condition:"frozen_minus80",parentId:"freezer_1"},{id:"freezer_1_rack_2",name:"架子2",type:"rack",capacity:25,currentCount:18,condition:"frozen_minus80",parentId:"freezer_1"}]},{id:"freezer_2",name:"-20°C冰箱B",type:"freezer",capacity:80,currentCount:45,temperature:-20,condition:"frozen_minus20"},{id:"fridge_1",name:"4°C冷藏柜A",type:"refrigerator",capacity:60,currentCount:30,temperature:4,condition:"cold_4"}],le=[{id:"1",sampleCode:"S2024001",sampleName:"土壤样本A",sampleType:"土壤",storageLocation:"-80°C超低温冰箱A/架子1",storageCondition:"frozen_minus80",status:"stored",quantity:5,unit:"ml",remainingQuantity:4.5,storageDate:"2024-01-15",expiryDate:"2025-01-15",operator:"张三",containerType:"冷冻管",position:"A1-01",notes:"高质量DNA样本"},{id:"2",sampleCode:"S2024002",sampleName:"水体样本B",sampleType:"水体",storageLocation:"4°C冷藏柜A",storageCondition:"cold_4",status:"in_use",quantity:10,unit:"ml",remainingQuantity:7,storageDate:"2024-01-10",expiryDate:"2024-07-10",operator:"李四",containerType:"离心管",position:"B2-05",notes:"用于微生物分析"},{id:"3",sampleCode:"S2024003",sampleName:"植物样本C",sampleType:"植物",storageLocation:"-20°C冰箱B",storageCondition:"frozen_minus20",status:"expired",quantity:2,unit:"g",remainingQuantity:2,storageDate:"2023-06-15",expiryDate:"2024-01-15",operator:"王五",containerType:"样本袋",position:"C3-12",notes:"已过期，需要处理"}];s.useEffect(()=>{ae(),re()},[]);const ae=async()=>{B(!0);try{await new Promise(e=>setTimeout(e,1e3)),Q(le)}catch(e){}finally{B(!1)}},re=async()=>{try{await new Promise(e=>setTimeout(e,500)),F(ie)}catch(e){}},oe=e=>({room_temp:"室温",cold_4:"4°C",frozen_minus20:"-20°C",frozen_minus80:"-80°C",liquid_nitrogen:"液氮"}[e]),de=e=>({room_temp:"default",cold_4:"blue",frozen_minus20:"cyan",frozen_minus80:"purple",liquid_nitrogen:"magenta"}[e]),ce=e=>({stored:"green",in_use:"orange",consumed:"default",expired:"red",missing:"red"}[e]),he=e=>({stored:"已存储",in_use:"使用中",consumed:"已消耗",expired:"已过期",missing:"缺失"}[e]),xe=s=>s.map(s=>({title:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("span",{children:[e.jsx(x,{style:{marginRight:4}}),s.name]}),e.jsxs("div",{children:[e.jsx(y,{color:de(s.condition),children:oe(s.condition)}),e.jsx(D,{count:s.currentCount,overflowCount:999,style:{backgroundColor:s.currentCount>=.9*s.capacity?"#ff4d4f":"#52c41a"}})]})]}),key:s.id,children:s.children?xe(s.children):void 0})),ue=N.filter(e=>{const s=!V||e.sampleCode.toLowerCase().includes(V.toLowerCase())||e.sampleName.toLowerCase().includes(V.toLowerCase())||e.storageLocation.toLowerCase().includes(V.toLowerCase()),t=!G||e.status===G,n=!Z||e.storageCondition===Z,i=!se||e.storageLocation.includes(se);return s&&t&&n&&i}),me=N.filter(e=>"expired"===e.status||e.expiryDate&&n(e.expiryDate).isBefore(n())).length,je=[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:120,fixed:"left"},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:150,ellipsis:!0},{title:"样本类型",dataIndex:"sampleType",key:"sampleType",width:100},{title:"存储位置",dataIndex:"storageLocation",key:"storageLocation",width:200,ellipsis:!0,render:s=>e.jsx(C,{title:s,children:e.jsxs("span",{children:[e.jsx(x,{style:{marginRight:4}}),s]})})},{title:"存储条件",dataIndex:"storageCondition",key:"storageCondition",width:100,render:s=>e.jsx(y,{color:de(s),icon:e.jsx(x,{}),children:oe(s)})},{title:"状态",dataIndex:"status",key:"status",width:100,render:s=>e.jsx(y,{color:ce(s),children:he(s)})},{title:"数量",key:"quantity",width:120,render:(s,t)=>e.jsxs("div",{children:[e.jsxs("div",{children:[t.remainingQuantity,"/",t.quantity," ",t.unit]}),e.jsx(v,{percent:Math.round(t.remainingQuantity/t.quantity*100),size:"small",showInfo:!1,strokeColor:t.remainingQuantity/t.quantity<.2?"#ff4d4f":"#52c41a"})]})},{title:"位置编号",dataIndex:"position",key:"position",width:100},{title:"存储日期",dataIndex:"storageDate",key:"storageDate",width:120,render:e=>n(e).format("MM-DD")},{title:"过期日期",dataIndex:"expiryDate",key:"expiryDate",width:120,render:s=>{if(!s)return"-";const t=n(s).isBefore(n());return e.jsxs("span",{style:{color:t?"#ff4d4f":void 0},children:[t&&e.jsx(w,{style:{marginRight:4}}),n(s).format("MM-DD")]})}},{title:"操作",key:"action",width:150,fixed:"right",render:(s,t)=>e.jsxs(_,{size:"small",children:[e.jsx(C,{title:"查看详情",children:e.jsx(h,{type:"text",icon:e.jsx(I,{}),onClick:()=>(e=>{W(e),O(!0)})(t)})}),e.jsx(C,{title:"编辑",children:e.jsx(h,{type:"text",icon:e.jsx(z,{}),onClick:()=>(e=>{U(e),ne.setFieldsValue(e),Y(!0)})(t)})}),e.jsx(b,{title:"确定要删除这条记录吗？",onConfirm:()=>(async e=>{try{await new Promise(e=>setTimeout(e,500)),Q(s=>s.filter(s=>s.id!==e)),S.success("删除成功")}catch(s){S.error("删除失败")}})(t.id),children:e.jsx(C,{title:"删除",children:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(k,{})})})})]})}];return e.jsxs("div",{children:[e.jsxs(i,{gutter:16,style:{marginBottom:16},children:[e.jsx(l,{span:6,children:e.jsx(a,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#1890ff"},children:N.length}),e.jsx("div",{style:{color:"#666"},children:"总存储样本"})]})})}),e.jsx(l,{span:6,children:e.jsx(a,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#52c41a"},children:N.filter(e=>"stored"===e.status).length}),e.jsx("div",{style:{color:"#666"},children:"正常存储"})]})})}),e.jsx(l,{span:6,children:e.jsx(a,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#faad14"},children:N.filter(e=>"in_use"===e.status).length}),e.jsx("div",{style:{color:"#666"},children:"使用中"})]})})}),e.jsx(l,{span:6,children:e.jsx(a,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#ff4d4f"},children:me}),e.jsx("div",{style:{color:"#666"},children:"过期/异常"})]})})})]}),me>0&&e.jsx(r,{message:"发现过期样本",description:`有 ${me} 个样本已过期或即将过期，请及时处理`,type:"warning",showIcon:!0,closable:!0,style:{marginBottom:16}}),e.jsx(a,{size:"small",style:{marginBottom:16},children:e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:6,children:e.jsx(q,{placeholder:"搜索样本编号、名称或位置",value:V,onChange:e=>X(e.target.value),onSearch:ae,enterButton:e.jsx(d,{})})}),e.jsx(l,{span:4,children:e.jsxs(c,{placeholder:"状态筛选",value:G,onChange:H,allowClear:!0,style:{width:"100%"},children:[e.jsx(T,{value:"stored",children:"已存储"}),e.jsx(T,{value:"in_use",children:"使用中"}),e.jsx(T,{value:"consumed",children:"已消耗"}),e.jsx(T,{value:"expired",children:"已过期"}),e.jsx(T,{value:"missing",children:"缺失"})]})}),e.jsx(l,{span:4,children:e.jsxs(c,{placeholder:"存储条件",value:Z,onChange:ee,allowClear:!0,style:{width:"100%"},children:[e.jsx(T,{value:"room_temp",children:"室温"}),e.jsx(T,{value:"cold_4",children:"4°C"}),e.jsx(T,{value:"frozen_minus20",children:"-20°C"}),e.jsx(T,{value:"frozen_minus80",children:"-80°C"}),e.jsx(T,{value:"liquid_nitrogen",children:"液氮"})]})}),e.jsxs(l,{span:6,children:[e.jsx(h,{type:"default",icon:e.jsx(x,{}),onClick:()=>J(!0),style:{marginRight:8},children:"存储位置"}),e.jsx(h,{type:"primary",icon:e.jsx(u,{}),onClick:()=>{U(null),ne.resetFields(),Y(!0)},children:"新增存储"})]}),e.jsx(l,{span:4,children:e.jsx(h,{onClick:ae,loading:A,children:"刷新数据"})})]})}),e.jsx(a,{title:"样本存储列表",size:"small",children:e.jsx(m,{columns:je,dataSource:ue,rowKey:"id",loading:A,scroll:{x:1400},pagination:{total:ue.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}),e.jsx(j,{title:K?"编辑样本存储":"新增样本存储",open:P,onCancel:()=>Y(!1),onOk:()=>ne.submit(),width:600,children:e.jsxs(t,{form:ne,layout:"vertical",onFinish:async e=>{try{if(await new Promise(e=>setTimeout(e,500)),K)Q(s=>s.map(s=>s.id===K.id?{...s,...e}:s)),S.success("更新成功");else{const s={id:Date.now().toString(),...e,storageDate:n().format("YYYY-MM-DD"),operator:"当前用户"};Q(e=>[...e,s]),S.success("添加成功")}Y(!1),ne.resetFields()}catch(s){S.error("保存失败")}},children:[e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(t.Item,{name:"sampleCode",label:"样本编号",rules:[{required:!0,message:"请输入样本编号"}],children:e.jsx(o,{placeholder:"请输入样本编号"})})}),e.jsx(l,{span:12,children:e.jsx(t.Item,{name:"sampleName",label:"样本名称",rules:[{required:!0,message:"请输入样本名称"}],children:e.jsx(o,{placeholder:"请输入样本名称"})})})]}),e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(t.Item,{name:"sampleType",label:"样本类型",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsxs(c,{placeholder:"请选择样本类型",children:[e.jsx(T,{value:"土壤",children:"土壤"}),e.jsx(T,{value:"水体",children:"水体"}),e.jsx(T,{value:"植物",children:"植物"}),e.jsx(T,{value:"动物",children:"动物"}),e.jsx(T,{value:"微生物",children:"微生物"})]})})}),e.jsx(l,{span:12,children:e.jsx(t.Item,{name:"storageCondition",label:"存储条件",rules:[{required:!0,message:"请选择存储条件"}],children:e.jsxs(c,{placeholder:"请选择存储条件",children:[e.jsx(T,{value:"room_temp",children:"室温"}),e.jsx(T,{value:"cold_4",children:"4°C"}),e.jsx(T,{value:"frozen_minus20",children:"-20°C"}),e.jsx(T,{value:"frozen_minus80",children:"-80°C"}),e.jsx(T,{value:"liquid_nitrogen",children:"液氮"})]})})})]}),e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:8,children:e.jsx(t.Item,{name:"quantity",label:"总数量",rules:[{required:!0,message:"请输入总数量"}],children:e.jsx(p,{min:0,style:{width:"100%"}})})}),e.jsx(l,{span:8,children:e.jsx(t.Item,{name:"remainingQuantity",label:"剩余数量",rules:[{required:!0,message:"请输入剩余数量"}],children:e.jsx(p,{min:0,style:{width:"100%"}})})}),e.jsx(l,{span:8,children:e.jsx(t.Item,{name:"unit",label:"单位",rules:[{required:!0,message:"请输入单位"}],children:e.jsxs(c,{placeholder:"请选择单位",children:[e.jsx(T,{value:"ml",children:"ml"}),e.jsx(T,{value:"μl",children:"μl"}),e.jsx(T,{value:"g",children:"g"}),e.jsx(T,{value:"mg",children:"mg"}),e.jsx(T,{value:"个",children:"个"})]})})})]}),e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(t.Item,{name:"storageLocation",label:"存储位置",rules:[{required:!0,message:"请输入存储位置"}],children:e.jsx(o,{placeholder:"请输入存储位置"})})}),e.jsx(l,{span:12,children:e.jsx(t.Item,{name:"position",label:"位置编号",rules:[{required:!0,message:"请输入位置编号"}],children:e.jsx(o,{placeholder:"如：A1-01"})})})]}),e.jsxs(i,{gutter:16,children:[e.jsx(l,{span:12,children:e.jsx(t.Item,{name:"containerType",label:"容器类型",rules:[{required:!0,message:"请选择容器类型"}],children:e.jsxs(c,{placeholder:"请选择容器类型",children:[e.jsx(T,{value:"冷冻管",children:"冷冻管"}),e.jsx(T,{value:"离心管",children:"离心管"}),e.jsx(T,{value:"样本袋",children:"样本袋"}),e.jsx(T,{value:"培养皿",children:"培养皿"}),e.jsx(T,{value:"试管",children:"试管"})]})})}),e.jsx(l,{span:12,children:e.jsx(t.Item,{name:"expiryDate",label:"过期日期",children:e.jsx(o,{type:"date"})})})]}),e.jsx(t.Item,{name:"notes",label:"备注",children:e.jsx(L,{rows:3,placeholder:"请输入备注信息"})})]})}),e.jsx(j,{title:"样本存储详情",open:E,onCancel:()=>O(!1),footer:null,width:600,children:R&&e.jsxs(g,{bordered:!0,size:"small",column:2,children:[e.jsx(g.Item,{label:"样本编号",children:R.sampleCode}),e.jsx(g.Item,{label:"样本名称",children:R.sampleName}),e.jsx(g.Item,{label:"样本类型",children:R.sampleType}),e.jsx(g.Item,{label:"存储条件",children:e.jsx(y,{color:de(R.storageCondition),children:oe(R.storageCondition)})}),e.jsx(g.Item,{label:"状态",children:e.jsx(y,{color:ce(R.status),children:he(R.status)})}),e.jsxs(g.Item,{label:"数量",children:[R.remainingQuantity,"/",R.quantity," ",R.unit]}),e.jsxs(g.Item,{label:"存储位置",span:2,children:[e.jsx(x,{style:{marginRight:4}}),R.storageLocation]}),e.jsx(g.Item,{label:"位置编号",children:R.position}),e.jsx(g.Item,{label:"容器类型",children:R.containerType}),e.jsx(g.Item,{label:"存储日期",children:R.storageDate}),e.jsx(g.Item,{label:"过期日期",children:R.expiryDate||"无"}),e.jsx(g.Item,{label:"操作人",children:R.operator}),e.jsx(g.Item,{label:"备注",span:2,children:R.notes||"无"})]})}),e.jsx(j,{title:"存储位置管理",open:$,onCancel:()=>J(!1),footer:null,width:800,children:e.jsx(f,{treeData:xe(M),defaultExpandAll:!0,showLine:!0,showIcon:!1})})]})};export{A as default};
