import{j as e}from"./index-BD7k3pCu.js";import{u as s,r as t}from"./react-vendor-BSBC8BLg.js";import{$ as a,s as l,c as i,e as r,a as n,T as d,G as c,S as o,B as p,a1 as m,a2 as h,af as x,a8 as j,am as u,V as y,ay as g,Y as S,ao as T,ad as C,Q as b,az as f,X as k,a5 as z,a3 as v,a6 as D,b as w,ac as I,D as N,ai as _,aA as Y,o as R,aB as $,Z as B,a4 as E,aC as P,O as M,at as q,aa as H,aD as X}from"./antd-vendor-DCQn9U8Y.js";const{Title:A,Text:F,Paragraph:K}=d,{Option:O}=E,{TextArea:Q}=v,V=()=>{s();const[d]=a.useForm(),[K]=a.useForm(),[V,G]=t.useState("unassigned"),[J,L]=t.useState(!1),[Z,U]=t.useState([]),[W,ee]=t.useState(!1),[se,te]=t.useState(!1),[ae,le]=t.useState(!1),[ie,re]=t.useState(!1),[ne,de]=t.useState(null),[ce,oe]=t.useState(null),[pe,me]=t.useState(null),[he,xe]=t.useState([]),[je,ue]=t.useState([]),[ye,ge]=t.useState([]);t.useEffect(()=>{Se()},[]);const Se=async()=>{L(!0);try{const e=[{id:"S001",sampleCode:"S001",sampleName:"æ ·æœ¬1",sampleType:"DNA",status:"received",receivedDate:"2024-05-20",projectName:"è‚¿ç˜¤æµ‹åºé¡¹ç›®",priority:"high"},{id:"S002",sampleCode:"S002",sampleName:"æ ·æœ¬2",sampleType:"RNA",status:"received",receivedDate:"2024-05-20",projectName:"è‚¿ç˜¤æµ‹åºé¡¹ç›®",priority:"medium"},{id:"S003",sampleCode:"S003",sampleName:"æ ·æœ¬3",sampleType:"DNA",status:"received",receivedDate:"2024-05-20",projectName:"è‚¿ç˜¤æµ‹åºé¡¹ç›®",priority:"high"},{id:"S004",sampleCode:"S004",sampleName:"æ ·æœ¬4",sampleType:"DNA",status:"received",receivedDate:"2024-05-20",projectName:"åŸºå› æ£€æµ‹é¡¹ç›®",priority:"low"}],s=[{id:"EXP001",batchCode:"EXP_20240520_001",batchName:"è‚¿ç˜¤åŸºå› æ£€æµ‹æ‰¹æ¬¡-20240520",status:"in_progress",sampleCount:3,samples:e.slice(0,3),operator:"å¼ ä¸‰",project:"è‚¿ç˜¤æµ‹åºé¡¹ç›®",plannedStartDate:"2024-05-20 09:30",plannedEndDate:"2024-05-20 18:00",actualStartDate:"2024-05-20 09:30",priority:"high",createdBy:"å¼ ä¸‰",createdTime:"2024-05-20 09:00",updatedTime:"2024-05-20 14:30",progress:60,currentStep:"PCRæ‰©å¢",steps:[{stepType:"sample_prep",stepName:"æ ·æœ¬å‰å¤„ç†",status:"completed",operator:"å¼ ä¸‰",startTime:"09:30",endTime:"10:00",duration:30,dataRecorded:!0},{stepType:"nucleic_extraction",stepName:"æ ¸é…¸æå–",status:"completed",operator:"å¼ ä¸‰",startTime:"10:00",endTime:"11:30",duration:90,dataRecorded:!0},{stepType:"pcr",stepName:"PCRæ‰©å¢",status:"in_progress",operator:"å¼ ä¸‰",startTime:"14:30",dataRecorded:!1},{stepType:"library_prep",stepName:"æ–‡åº“æ„å»º",status:"pending",dataRecorded:!1},{stepType:"quantification",stepName:"æ–‡åº“å®šé‡",status:"pending",dataRecorded:!1},{stepType:"qc",stepName:"æœ€ç»ˆQC",status:"pending",dataRecorded:!1}]},{id:"EXP002",batchCode:"EXP_20240519_002",batchName:"åœŸå£¤å¾®ç”Ÿç‰©å¤šæ ·æ€§æµ‹åº",status:"in_progress",sampleCount:12,samples:[],operator:"æå››",project:"ç¯å¢ƒå¾®ç”Ÿç‰©é¡¹ç›®",plannedStartDate:"2024-05-19 08:00",plannedEndDate:"2024-05-20 17:00",actualStartDate:"2024-05-19 08:15",priority:"medium",createdBy:"æå››",createdTime:"2024-05-19 07:30",updatedTime:"2024-05-20 10:00",progress:75,currentStep:"æ ·æœ¬è´¨æ£€",steps:[]},{id:"EXP003",batchCode:"EXP_20240518_003",batchName:"æµ·æ´‹å¾®ç”Ÿç‰©å¤šæ ·æ€§åˆ†æ",status:"in_progress",sampleCount:30,samples:[],operator:"ç‹äº”",project:"æµ·æ´‹ç”Ÿç‰©é¡¹ç›®",plannedStartDate:"2024-05-18 09:00",plannedEndDate:"2024-05-21 16:00",actualStartDate:"2024-05-18 09:20",priority:"low",createdBy:"ç‹äº”",createdTime:"2024-05-18 08:45",updatedTime:"2024-05-20 15:30",progress:85,currentStep:"å·²å®Œæˆ",steps:[]}],t=[{id:"EXP004",batchCode:"EXP_20240517_004",batchName:"å®Œæˆçš„æµ‹åºæ‰¹æ¬¡ç¤ºä¾‹",status:"completed",sampleCount:8,samples:[],operator:"èµµå…­",project:"åŸºå› æ£€æµ‹é¡¹ç›®",plannedStartDate:"2024-05-17 08:00",plannedEndDate:"2024-05-17 18:00",actualStartDate:"2024-05-17 08:10",actualEndDate:"2024-05-17 17:45",priority:"medium",createdBy:"èµµå…­",createdTime:"2024-05-17 07:30",updatedTime:"2024-05-17 17:45",progress:100,currentStep:"å·²å®Œæˆ",steps:[]}];xe(e),ue(s),ge(t)}catch(e){l.error("æ•°æ®åŠ è½½å¤±è´¥")}finally{L(!1)}},Te=()=>{0!==Z.length?ee(!0):l.warning("è¯·å…ˆé€‰æ‹©è¦åŠ å…¥æ‰¹æ¬¡çš„æ ·æœ¬")},Ce=e=>{de(e),te(!0)},be=(e,s)=>{de(e),oe(s),le(!0);const t=fe(e.id,s);if(t)me(t),K.setFieldsValue(t);else{const t={id:`${e.id}_${s}_${Date.now()}`,batchId:e.id,stepType:s,operator:"å½“å‰ç”¨æˆ·",startTime:M().format("YYYY-MM-DD HH:mm"),basicInfo:{},sampleData:{},parameters:{},qcResults:{},attachments:[],notes:"",isDraft:!0};me(t),K.setFieldsValue(t)}},fe=(e,s)=>{const t=`draft_${e}_${s}`,a=localStorage.getItem(t);return a?JSON.parse(a):null},ke=[{title:"æ ·æœ¬ç¼–å·",dataIndex:"sampleCode",key:"sampleCode",width:120},{title:"æ ·æœ¬åç§°",dataIndex:"sampleName",key:"sampleName",width:150},{title:"æ ·æœ¬ç±»å‹",dataIndex:"sampleType",key:"sampleType",width:100,render:s=>e.jsx(k,{color:"DNA"===s?"blue":"RNA"===s?"green":"orange",children:s})},{title:"æ¥æ”¶æ—¥æœŸ",dataIndex:"receivedDate",key:"receivedDate",width:120},{title:"æ“ä½œ",key:"action",width:120,render:(s,t)=>e.jsx(p,{type:"link",size:"small",onClick:()=>U([...Z,t.id]),children:"åŠ å…¥æ‰¹æ¬¡"})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(i,{gutter:24,style:{marginBottom:24},children:[e.jsx(r,{span:18,children:e.jsxs(n,{children:[e.jsxs(A,{level:2,style:{margin:0},children:[e.jsx(c,{style:{marginRight:8}}),"å®éªŒä»»åŠ¡ä¸­å¿ƒ"]}),e.jsx(F,{type:"secondary",children:"ç®¡ç†å®éªŒæ ·æœ¬åˆ†é…ã€æ‰¹æ¬¡æ‰§è¡Œå’Œè¿›åº¦è·Ÿè¸ªï¼Œæ”¯æŒè¯¦ç»†çš„æ•°æ®è®°å½•åŠŸèƒ½"})]})}),e.jsx(r,{span:6,children:e.jsx(n,{title:"å¿«æ·æ“ä½œ",size:"small",children:e.jsxs(o,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(p,{type:"primary",icon:e.jsx(m,{}),onClick:Te,disabled:0===Z.length,block:!0,children:["åˆ›å»ºæ–°æ‰¹æ¬¡ (",Z.length,")"]}),e.jsx(p,{icon:e.jsx(h,{}),block:!0,children:"æ‰¹é‡å¯¼å…¥æ ·æœ¬"}),e.jsx(p,{icon:e.jsx(x,{}),block:!0,children:"æ‰“å°æ ‡ç­¾"}),e.jsx(p,{icon:e.jsx(j,{}),block:!0,children:"å¯¼å‡ºæ•°æ®"})]})})})]}),e.jsxs(i,{gutter:24,children:[e.jsx(r,{span:18,children:e.jsx(n,{children:e.jsx(u,{activeKey:V,onChange:G,items:[{key:"unassigned",label:`ğŸ”˜ å¾…åˆ†é…æ ·æœ¬(${he.length})`,children:e.jsxs("div",{children:[e.jsx(y,{columns:ke,dataSource:he,rowKey:"id",loading:J,rowSelection:{selectedRowKeys:Z,onChange:e=>{U(e)},type:"checkbox"},pagination:{total:he.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`å…± ${e} ä¸ªæ ·æœ¬`}}),e.jsx("div",{style:{marginTop:16,textAlign:"center"},children:e.jsxs(o,{children:[e.jsx(g,{checked:Z.length===he.length&&he.length>0,indeterminate:Z.length>0&&Z.length<he.length,onChange:e=>{e.target.checked?U(he.map(e=>e.id)):U([])},children:"å…¨é€‰"}),e.jsxs(p,{type:"primary",size:"large",onClick:Te,disabled:0===Z.length,children:["åˆ›å»ºæ–°æ‰¹æ¬¡å¹¶åŠ å…¥é€‰ä¸­æ ·æœ¬(",Z.length,")"]})]})})]})},{key:"inProgress",label:`ğŸ”˜ è¿›è¡Œä¸­æ‰¹æ¬¡(${je.length})`,children:e.jsx("div",{children:e.jsx(i,{gutter:16,children:je.map(s=>e.jsx(r,{span:12,style:{marginBottom:16},children:e.jsxs(n,{size:"small",title:e.jsxs("div",{children:[e.jsx(F,{strong:!0,children:s.batchCode}),e.jsx("br",{}),e.jsx(F,{type:"secondary",style:{fontSize:"12px"},children:s.batchName})]}),extra:e.jsx(C,{count:`${s.progress}%`,style:{backgroundColor:"#52c41a"}}),actions:[e.jsx(p,{type:"link",onClick:()=>Ce(s),children:"æŸ¥çœ‹è¯¦æƒ…"},"view")],children:[e.jsx("div",{style:{marginBottom:8},children:e.jsx(S,{percent:s.progress,size:"small"})}),e.jsxs(T,{size:"small",column:1,children:[e.jsx(T.Item,{label:"å½“å‰æ­¥éª¤",children:e.jsx(F,{strong:!0,children:s.currentStep})}),e.jsx(T.Item,{label:"è´Ÿè´£äºº",children:s.operator}),e.jsxs(T.Item,{label:"æ ·æœ¬æ•°",children:[s.sampleCount,"ä¸ª"]}),e.jsx(T.Item,{label:"é¡¹ç›®",children:s.project})]})]})},s.id))})})},{key:"completed",label:`ğŸ”˜ å·²å®Œæˆ(${ye.length})`,children:e.jsx("div",{children:e.jsx(y,{size:"small",dataSource:ye,rowKey:"id",columns:[{title:"æ‰¹æ¬¡ç¼–å·",dataIndex:"batchCode",key:"batchCode"},{title:"æ‰¹æ¬¡åç§°",dataIndex:"batchName",key:"batchName"},{title:"æ ·æœ¬æ•°",dataIndex:"sampleCount",key:"sampleCount",render:e=>`${e}ä¸ª`},{title:"å®Œæˆæ—¶é—´",dataIndex:"actualEndDate",key:"actualEndDate"},{title:"æ“ä½œ",key:"action",render:(s,t)=>e.jsxs(o,{children:[e.jsx(p,{type:"link",size:"small",onClick:()=>Ce(t),children:"æŸ¥çœ‹è¯¦æƒ…"}),e.jsx(p,{type:"link",size:"small",children:"å¯¼å‡ºæŠ¥å‘Š"})]})}]})})}]})})}),e.jsx(r,{span:6,children:e.jsxs(o,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(n,{title:"ç»Ÿè®¡ä¿¡æ¯",size:"small",children:[e.jsx(b,{title:"å¾…åˆ†é…æ ·æœ¬",value:he.length}),e.jsx(b,{title:"è¿›è¡Œä¸­æ‰¹æ¬¡",value:je.length}),e.jsx(b,{title:"å·²å®Œæˆæ‰¹æ¬¡",value:ye.length})]}),e.jsx(n,{title:"è¯•å‰‚çŠ¶æ€",size:"small",children:e.jsx(f,{size:"small",dataSource:[{name:"PCR Mix",status:"å……è¶³",color:"green"},{name:"DNAæå–è¯•å‰‚",status:"ä¸è¶³",color:"red"},{name:"ç£ç ",status:"å……è¶³",color:"green"}],renderItem:s=>e.jsxs(f.Item,{children:[e.jsx(F,{children:s.name}),e.jsx(k,{color:s.color,children:s.status})]})})}),e.jsx(n,{title:"ä»ªå™¨çŠ¶æ€",size:"small",children:e.jsx(f,{size:"small",dataSource:[{name:"PCRä»ª-01",status:"ç©ºé—²",color:"green"},{name:"ç¦»å¿ƒæœº-02",status:"ä½¿ç”¨ä¸­",color:"orange"},{name:"æ°´æµ´é”…-03",status:"ç©ºé—²",color:"green"}],renderItem:s=>e.jsxs(f.Item,{children:[e.jsx(F,{children:s.name}),e.jsx(k,{color:s.color,children:s.status})]})})})]})})]}),e.jsx(z,{title:"åˆ›å»ºæ–°æ‰¹æ¬¡",open:W,onCancel:()=>ee(!1),onOk:()=>d.submit(),confirmLoading:J,width:600,children:e.jsxs(a,{form:d,layout:"vertical",onFinish:async e=>{L(!0);try{const s=he.filter(e=>Z.includes(e.id)),t={id:`EXP${Date.now()}`,batchCode:`EXP_${M().format("YYYYMMDD")}_${String(Math.floor(1e3*Math.random())).padStart(3,"0")}`,batchName:e.batchName,status:"ready",sampleCount:s.length,samples:s,operator:e.operator||"å½“å‰ç”¨æˆ·",project:e.project,plannedStartDate:e.plannedStartDate.format("YYYY-MM-DD HH:mm"),plannedEndDate:e.plannedEndDate.format("YYYY-MM-DD HH:mm"),priority:e.priority,notes:e.notes,createdBy:"å½“å‰ç”¨æˆ·",createdTime:M().format("YYYY-MM-DD HH:mm"),updatedTime:M().format("YYYY-MM-DD HH:mm"),progress:0,currentStep:"å¾…å¼€å§‹",steps:[{stepType:"sample_prep",stepName:"æ ·æœ¬å‰å¤„ç†",status:"pending",dataRecorded:!1},{stepType:"nucleic_extraction",stepName:"æ ¸é…¸æå–",status:"pending",dataRecorded:!1},{stepType:"pcr",stepName:"PCRæ‰©å¢",status:"pending",dataRecorded:!1},{stepType:"library_prep",stepName:"æ–‡åº“æ„å»º",status:"pending",dataRecorded:!1},{stepType:"quantification",stepName:"æ–‡åº“å®šé‡",status:"pending",dataRecorded:!1},{stepType:"qc",stepName:"æœ€ç»ˆQC",status:"pending",dataRecorded:!1}]};ue([...je,t]),xe(he.filter(e=>!Z.includes(e.id))),U([]),l.success("æ‰¹æ¬¡åˆ›å»ºæˆåŠŸï¼"),ee(!1),d.resetFields(),G("inProgress")}catch(s){l.error("æ‰¹æ¬¡åˆ›å»ºå¤±è´¥")}finally{L(!1)}},children:[e.jsx(a.Item,{name:"batchName",label:"æ‰¹æ¬¡åç§°",rules:[{required:!0,message:"è¯·è¾“å…¥æ‰¹æ¬¡åç§°"}],children:e.jsx(v,{placeholder:"è¯·è¾“å…¥æ‰¹æ¬¡åç§°"})}),e.jsx(a.Item,{name:"project",label:"æ‰€å±é¡¹ç›®",rules:[{required:!0,message:"è¯·è¾“å…¥æ‰€å±é¡¹ç›®"}],children:e.jsx(v,{placeholder:"è¯·è¾“å…¥æ‰€å±é¡¹ç›®"})}),e.jsxs(i,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"plannedStartDate",label:"è®¡åˆ’å¼€å§‹æ—¶é—´",rules:[{required:!0,message:"è¯·é€‰æ‹©å¼€å§‹æ—¶é—´"}],children:e.jsx(D,{showTime:!0,style:{width:"100%"},placeholder:"é€‰æ‹©å¼€å§‹æ—¶é—´"})})}),e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"plannedEndDate",label:"è®¡åˆ’ç»“æŸæ—¶é—´",rules:[{required:!0,message:"è¯·é€‰æ‹©ç»“æŸæ—¶é—´"}],children:e.jsx(D,{showTime:!0,style:{width:"100%"},placeholder:"é€‰æ‹©ç»“æŸæ—¶é—´"})})})]}),e.jsx(a.Item,{name:"priority",label:"ä¼˜å…ˆçº§",rules:[{required:!0,message:"è¯·é€‰æ‹©ä¼˜å…ˆçº§"}],children:e.jsxs(w.Group,{children:[e.jsx(w,{value:"low",children:"ä½"}),e.jsx(w,{value:"medium",children:"ä¸­"}),e.jsx(w,{value:"high",children:"é«˜"}),e.jsx(w,{value:"urgent",children:"ç´§æ€¥"})]})}),e.jsx(a.Item,{name:"notes",label:"å¤‡æ³¨",children:e.jsx(Q,{rows:3,placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"})}),e.jsx(I,{message:`å°†åˆ›å»ºåŒ…å« ${Z.length} ä¸ªæ ·æœ¬çš„æ–°æ‰¹æ¬¡`,type:"info",showIcon:!0,style:{marginTop:16}})]})}),e.jsx(N,{title:e.jsxs("div",{children:[e.jsx(p,{type:"text",icon:e.jsx(Y,{}),onClick:()=>te(!1),style:{marginRight:8}}),"å®éªŒæ‰¹æ¬¡: ",null==ne?void 0:ne.batchCode,e.jsx(p,{type:"text",icon:e.jsx(R,{}),style:{marginLeft:8}})]}),placement:"right",width:900,open:se,onClose:()=>te(!1),children:ne&&e.jsxs("div",{children:[e.jsxs(n,{title:"æ‰¹æ¬¡ä¿¡æ¯",size:"small",style:{marginBottom:16},children:[e.jsxs(i,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(b,{title:"çŠ¶æ€",value:"ğŸ”„ è¿›è¡Œä¸­",valueStyle:{fontSize:"16px"}})}),e.jsx(r,{span:8,children:e.jsx(b,{title:"è´Ÿè´£äºº",value:ne.operator,valueStyle:{fontSize:"16px"}})}),e.jsx(r,{span:8,children:e.jsx(b,{title:"åˆ›å»ºæ—¶é—´",value:ne.createdTime,valueStyle:{fontSize:"16px"}})})]}),e.jsxs(i,{gutter:16,style:{marginTop:16},children:[e.jsx(r,{span:8,children:e.jsx(b,{title:"æ ·æœ¬æ•°",value:`${ne.sampleCount}ä¸ª`,valueStyle:{fontSize:"16px"}})}),e.jsx(r,{span:8,children:e.jsx(b,{title:"é¡¹ç›®",value:ne.project,valueStyle:{fontSize:"16px"}})}),e.jsx(r,{span:8,children:e.jsx(b,{title:"é¢„è®¡å®Œæˆ",value:"ä»Šå¤©",valueStyle:{fontSize:"16px"}})})]})]}),e.jsx(n,{title:"æ­¥éª¤è·Ÿè¸ª",size:"small",style:{marginBottom:16},children:e.jsx("div",{style:{marginBottom:16},children:e.jsx(S,{percent:ne.progress,strokeColor:"#52c41a",format:e=>`${e}% å®Œæˆ`})})}),e.jsx(n,{title:"å®éªŒæ­¥éª¤ä¸æ•°æ®è®°å½•",size:"small",style:{marginBottom:16},children:e.jsx(y,{size:"small",dataSource:ne.steps,rowKey:"stepType",pagination:!1,columns:[{title:"æ­¥éª¤",dataIndex:"stepName",key:"stepName",width:120},{title:"çŠ¶æ€",dataIndex:"status",key:"status",width:100,render:s=>(s=>{const t={completed:{color:"success",text:"âœ… å®Œæˆ"},in_progress:{color:"processing",text:"ğŸ”„ è¿›è¡Œä¸­"},failed:{color:"error",text:"âŒ å¤±è´¥"},pending:{color:"default",text:"â³ å¾…å¼€å§‹"}}[s];return e.jsx(k,{color:t.color,children:t.text})})(s)},{title:"æ•°æ®è®°å½•",key:"dataRecord",width:100,render:(s,t)=>"completed"===t.status?e.jsx(p,{type:"link",size:"small",onClick:()=>be(ne,t.stepType),children:"æŸ¥çœ‹/ç¼–è¾‘"}):"in_progress"===t.status?e.jsx(p,{type:"link",size:"small",onClick:()=>be(ne,t.stepType),children:"ç»§ç»­è®°å½•"}):e.jsx(p,{type:"link",size:"small",disabled:"pending"===t.status,onClick:()=>be(ne,t.stepType),children:"å¼€å§‹è®°å½•"})},{title:"æ—¶é—´",key:"time",render:(e,s)=>s.startTime&&s.endTime?`${s.startTime}-${s.endTime}`:s.startTime?`${s.startTime}-`:"-"}]})}),e.jsxs(n,{title:"ğŸ“ å½“å‰æ­¥éª¤å®æ—¶è®°å½•",size:"small",style:{marginBottom:16},children:[e.jsx(I,{message:"PCRæ‰©å¢è¿›è¡Œä¸­",description:"å½“å‰æ­£åœ¨è¿›è¡ŒPCRæ‰©å¢æ­¥éª¤ï¼Œé¢„è®¡16:30å®Œæˆã€‚å¦‚æœ‰å¼‚å¸¸æƒ…å†µè¯·åŠæ—¶è®°å½•ã€‚",type:"info",showIcon:!0,style:{marginBottom:12}}),e.jsxs(o,{children:[e.jsx(p,{size:"small",onClick:()=>re(!0),children:"å¿«é€Ÿè®°å½•å¼‚å¸¸"}),e.jsx(p,{size:"small",icon:e.jsx(h,{}),children:"ä¸Šä¼ é™„ä»¶"}),e.jsx(p,{size:"small",icon:e.jsx(_,{}),children:"æ·»åŠ å¤‡æ³¨"})]})]}),e.jsx(n,{title:"æ ·æœ¬åˆ—è¡¨",size:"small",children:e.jsx(y,{columns:[{title:"æ ·æœ¬ç¼–å·",dataIndex:"sampleCode",key:"sampleCode"},{title:"æ ·æœ¬åç§°",dataIndex:"sampleName",key:"sampleName"},{title:"æ ·æœ¬ç±»å‹",dataIndex:"sampleType",key:"sampleType"},{title:"å½“å‰çŠ¶æ€",dataIndex:"status",key:"status",render:s=>e.jsx(C,{status:"completed"===s?"success":"processing"===s?"processing":"default",text:"completed"===s?"å·²å®Œæˆ":"processing"===s?"å¤„ç†ä¸­":"å¾…å¤„ç†"})},{title:"æ“ä½œ",key:"action",render:(s,t)=>e.jsxs(o,{children:[e.jsx(p,{size:"small",type:"link",children:"æŸ¥çœ‹è¯¦æƒ…"}),e.jsx(p,{size:"small",type:"link",children:"è®°å½•æ•°æ®"})]})}],dataSource:ne.samples,rowKey:"id",size:"small",pagination:!1})})]})}),e.jsx(z,{title:`${ce?{sample_prep:"æ ·æœ¬å‰å¤„ç†",nucleic_extraction:"æ ¸é…¸æå–",pcr:"PCRæ‰©å¢",library_prep:"æ–‡åº“æ„å»º",quantification:"æ–‡åº“å®šé‡",qc:"æœ€ç»ˆQC"}[ce]:""} - æ•°æ®è®°å½•`,open:ae,onCancel:()=>le(!1),width:900,footer:[e.jsxs(p,{onClick:()=>{const e=K.getFieldsValue();if(pe){const s={...pe,...e,isDraft:!0};me(s);const t=`draft_${s.batchId}_${s.stepType}`;localStorage.setItem(t,JSON.stringify(s)),l.success("è‰ç¨¿å·²ä¿å­˜")}},children:[e.jsx($,{}),"ä¿å­˜è‰ç¨¿"]},"draft"),e.jsxs(p,{type:"primary",onClick:async()=>{try{const e=await K.validateFields();if(pe){const s={...pe,...e,isDraft:!1,endTime:M().format("YYYY-MM-DD HH:mm")};if(ne){const e={...ne},s=e.steps.findIndex(e=>e.stepType===ce);if(-1!==s){e.steps[s].status="completed",e.steps[s].dataRecorded=!0,e.steps[s].endTime=M().format("HH:mm");const t=e.steps.filter(e=>"completed"===e.status).length;e.progress=Math.round(t/e.steps.length*100);const a=e.steps.find(e=>"pending"===e.status);a?(e.currentStep=a.stepName,a.status="in_progress"):(e.currentStep="å·²å®Œæˆ",e.status="completed"),ue(je.map(s=>s.id===e.id?e:s)),de(e)}}const t=`draft_${s.batchId}_${s.stepType}`;localStorage.removeItem(t),l.success("æ­¥éª¤è®°å½•å·²å®Œæˆ"),le(!1)}}catch(e){l.error("è¯·å®Œå–„å¿…å¡«ä¿¡æ¯")}},children:[e.jsx(B,{}),"å®Œæˆæ­¥éª¤"]},"complete")],children:ce&&ne?e.jsxs(a,{form:K,layout:"vertical",initialValues:pe||void 0,children:[e.jsx(n,{title:"åŸºæœ¬ä¿¡æ¯",size:"small",style:{marginBottom:16},children:e.jsxs(i,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"operator",label:"æ“ä½œäººå‘˜",rules:[{required:!0,message:"è¯·è¾“å…¥æ“ä½œäººå‘˜"}],children:e.jsx(v,{placeholder:"è¯·è¾“å…¥æ“ä½œäººå‘˜"})})}),e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"startTime",label:"å¼€å§‹æ—¶é—´",rules:[{required:!0,message:"è¯·é€‰æ‹©å¼€å§‹æ—¶é—´"}],children:e.jsx(v,{placeholder:"å¼€å§‹æ—¶é—´"})})})]})}),e.jsx(n,{title:"æ ·æœ¬æ•°æ®è®°å½•",size:"small",style:{marginBottom:16},children:e.jsx(y,{size:"small",dataSource:ne.samples,rowKey:"id",pagination:!1,columns:[{title:"æ ·æœ¬",dataIndex:"sampleCode",key:"sampleCode",width:100},{title:"æµ“åº¦(ng/Î¼l)",key:"concentration",width:120,render:(s,t)=>e.jsx(q,{size:"small",step:.1,placeholder:"æµ“åº¦",style:{width:"100%"}})},{title:"ä½“ç§¯(Î¼l)",key:"volume",width:100,render:(s,t)=>e.jsx(q,{size:"small",step:1,placeholder:"ä½“ç§¯",style:{width:"100%"}})},{title:"260/280",key:"od260280",width:100,render:(s,t)=>e.jsx(q,{size:"small",step:.01,placeholder:"260/280",style:{width:"100%"}})},{title:"æ“ä½œ",key:"action",width:80,render:(s,t)=>e.jsx(p,{size:"small",type:"link",children:"é‡æµ‹"})}]})}),e.jsx(n,{title:"å®éªŒå‚æ•°",size:"small",style:{marginBottom:16},children:e.jsxs(i,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"temperature",label:"æ¸©åº¦(â„ƒ)",children:e.jsx(q,{placeholder:"æ¸©åº¦",style:{width:"100%"}})})}),e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"duration",label:"æ—¶é—´(åˆ†é’Ÿ)",children:e.jsx(q,{placeholder:"æ—¶é—´",style:{width:"100%"}})})})]})}),e.jsx(n,{title:"è´¨é‡æ§åˆ¶",size:"small",style:{marginBottom:16},children:e.jsx(a.Item,{name:"qcChecks",label:"è´¨æ£€é¡¹ç›®",children:e.jsx(g.Group,{children:e.jsxs(i,{children:[e.jsx(r,{span:24,children:e.jsx(g,{value:"concentration",children:"æµ“åº¦æ£€æŸ¥: æ‰€æœ‰æ ·æœ¬ > 10ng/Î¼l"})}),e.jsx(r,{span:24,children:e.jsx(g,{value:"purity",children:"çº¯åº¦æ£€æŸ¥: 260/280åœ¨1.8-2.0ä¹‹é—´"})}),e.jsx(r,{span:24,children:e.jsx(g,{value:"integrity",children:"å®Œæ•´æ€§: ç”µæ³³æ£€æµ‹é€šè¿‡"})})]})})})}),e.jsx(n,{title:"é™„ä»¶",size:"small",style:{marginBottom:16},children:e.jsxs(o,{children:[e.jsx(H,{children:e.jsx(p,{icon:e.jsx(X,{}),size:"small",children:"ä¸Šä¼ ç”µæ³³å›¾"})}),e.jsx(H,{children:e.jsx(p,{icon:e.jsx(h,{}),size:"small",children:"ä¸Šä¼ æ£€æµ‹æŠ¥å‘Š"})}),e.jsx(p,{icon:e.jsx(P,{}),size:"small",children:"æ‹ç…§"})]})}),e.jsx(a.Item,{name:"notes",label:"å¤‡æ³¨",children:e.jsx(Q,{rows:3,placeholder:"è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯"})})]}):null}),ie&&e.jsx("div",{style:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"#fff",borderTop:"1px solid #d9d9d9",padding:"16px",zIndex:1e3,boxShadow:"0 -2px 8px rgba(0,0,0,0.1)"},children:e.jsxs(n,{title:`å¿«é€Ÿè®°å½• - ${null==ne?void 0:ne.currentStep}`,size:"small",extra:e.jsxs(o,{children:[e.jsx(p,{size:"small",onClick:()=>re(!1),children:"éšè—"}),e.jsx(p,{size:"small",icon:e.jsx(R,{}),children:"è®¾ç½®"})]}),children:[e.jsxs(i,{gutter:16,children:[e.jsx(r,{span:6,children:e.jsxs(E,{placeholder:"é€‰æ‹©æ ·æœ¬",style:{width:"100%"},mode:"multiple",children:[null==ne?void 0:ne.samples.map(s=>e.jsx(O,{value:s.id,children:s.sampleCode},s.id)),e.jsx(O,{value:"all",children:"æ‰€æœ‰æ ·æœ¬"})]})}),e.jsx(r,{span:12,children:e.jsxs(o,{children:[e.jsx(p,{size:"small",children:"æ¸©åº¦å¼‚å¸¸"}),e.jsx(p,{size:"small",children:"ä»ªå™¨æŠ¥è­¦"}),e.jsx(p,{size:"small",children:"è¯•å‰‚é—®é¢˜"}),e.jsx(p,{size:"small",children:"æ“ä½œå¤±è¯¯"})]})}),e.jsx(r,{span:6,children:e.jsxs(o,{children:[e.jsx(p,{size:"small",icon:e.jsx(P,{}),children:"æ‹ç…§è®°å½•"}),e.jsx(p,{size:"small",icon:e.jsx(B,{}),children:"æ ‡è®°å®Œæˆ"})]})})]}),e.jsxs(i,{style:{marginTop:8},children:[e.jsx(r,{span:18,children:e.jsx(v,{placeholder:"å¿«é€Ÿå¤‡æ³¨..."})}),e.jsx(r,{span:6,style:{paddingLeft:8},children:e.jsx(p,{type:"primary",size:"small",block:!0,children:"è®°å½•"})})]})]})})]})};export{V as default};
