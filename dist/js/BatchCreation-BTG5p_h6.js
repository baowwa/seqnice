import{j as e}from"./index-COXhhZpd.js";import{u as s,r as t}from"./react-vendor-BSBC8BLg.js";import{$ as l,s as a,a as i,c as n,d as r,T as d,G as c,S as o,B as x,a1 as h,am as j,Q as p,F as m,U as u,ax as g,Z as y,a3 as v,a4 as b,m as C,V as S,y as f,ad as k,aM as I,aN as T,W as w,az as D,v as N,D as A,ao as z,X as q,Y as E,a5 as B,a7 as M,O as $,a6 as R,ac as Y,A as _,aE as P,aO as H,at as L,l as Q,ag as O,ah as G,aw as W,ai as F,ak as K,aP as J,al as U}from"./antd-vendor-BuqAAsAf.js";const{Search:V}=v,{Option:X}=b,{TextArea:Z}=v,{Step:ee}=M,{TabPane:se}=j,{Text:te,Title:le}=d,ae=()=>{const d=s(),[ae,ie]=t.useState("taskCenter"),[ne,re]=t.useState(!1),[de,ce]=t.useState([]),[oe,xe]=t.useState([]),[he,je]=t.useState([]),[pe,me]=t.useState([]),[ue,ge]=t.useState([]),[ye,ve]=t.useState(!1),[be,Ce]=t.useState(!1),[Se,fe]=t.useState(!1),[ke,Ie]=t.useState(!1),[Te,we]=t.useState(null),[De,Ne]=t.useState(null),[Ae,ze]=t.useState(null),[qe,Ee]=t.useState(null),[Be,Me]=t.useState(""),[$e,Re]=t.useState(""),[Ye,_e]=t.useState(""),[Pe,He]=t.useState(""),[Le,Qe]=t.useState(""),[Oe,Ge]=t.useState(0),[We,Fe]=t.useState({}),[Ke]=l.useForm(),[Je]=l.useForm(),Ue=[{id:"1",taskName:"环境样本DNA提取",taskType:"preprocessing",status:"in_progress",priority:"high",assignee:"张三",batchId:"BATCH001",batchName:"环境样本前处理批次",sampleCount:24,estimatedDuration:480,actualDuration:320,startTime:"2024-01-20 09:00:00",progress:67,notes:"进展顺利，预计今日完成",createdTime:"2024-01-19 16:00:00",updatedTime:"2024-01-20 14:30:00"},{id:"2",taskName:"文库构建任务",taskType:"library_construction",status:"pending",priority:"medium",assignee:"李四",sampleCount:12,estimatedDuration:360,progress:0,notes:"等待前处理完成",createdTime:"2024-01-20 10:00:00",updatedTime:"2024-01-20 10:00:00"},{id:"3",taskName:"上机测序",taskType:"sequencing",status:"completed",priority:"high",assignee:"王五",batchId:"BATCH002",batchName:"测序批次A",sampleCount:96,estimatedDuration:1440,actualDuration:1380,startTime:"2024-01-18 08:00:00",endTime:"2024-01-19 07:00:00",progress:100,notes:"测序完成，数据质量良好",createdTime:"2024-01-17 14:00:00",updatedTime:"2024-01-19 07:30:00"}],Ve=[{id:"BATCH001",batchCode:"BATCH001",batchName:"环境样本前处理批次",experimentType:"preprocessing",status:"in_progress",sampleCount:24,samples:[],reagents:[],equipment:[],operator:"张三",plannedStartDate:"2024-01-20",plannedEndDate:"2024-01-22",actualStartDate:"2024-01-20",estimatedDuration:48,priority:"high",notes:"紧急项目，需要优先处理",createdBy:"实验主管",createdTime:"2024-01-19 10:00:00",updatedTime:"2024-01-20 09:30:00",protocol:"DNA提取标准流程v2.1",qualityRequirements:["DNA浓度>50ng/μL","OD260/280比值1.8-2.0"],costEstimate:1250,progress:67},{id:"BATCH002",batchCode:"BATCH002",batchName:"测序批次A",experimentType:"sequencing",status:"completed",sampleCount:96,samples:[],reagents:[],equipment:[],operator:"王五",plannedStartDate:"2024-01-18",plannedEndDate:"2024-01-19",actualStartDate:"2024-01-18",actualEndDate:"2024-01-19",estimatedDuration:24,priority:"high",notes:"测序完成，数据质量良好",createdBy:"测序主管",createdTime:"2024-01-17 14:00:00",updatedTime:"2024-01-19 07:30:00",protocol:"NovaSeq测序标准流程",qualityRequirements:["Q30>85%","数据产出>30Gb"],costEstimate:8500,progress:100}];t.useEffect(()=>{Xe()},[]);const Xe=async()=>{re(!0);try{await new Promise(e=>setTimeout(e,1e3)),ce(Ue),xe(Ve)}catch(e){a.error("加载数据失败")}finally{re(!1)}},Ze=e=>({pending:"orange",in_progress:"blue",completed:"green",failed:"red",cancelled:"gray",paused:"purple",draft:"default",planning:"cyan",ready:"lime"}[e]),es=e=>({pending:"待执行",in_progress:"执行中",completed:"已完成",failed:"失败",cancelled:"已取消",paused:"已暂停",draft:"草稿",planning:"计划中",ready:"就绪"}[e]),ss=e=>({low:"green",medium:"orange",high:"red",urgent:"purple"}[e]),ts=e=>({low:"低",medium:"中",high:"高",urgent:"紧急"}[e]),ls=e=>({preprocessing:"前处理",library_construction:"文库构建",sequencing:"上机测序",analysis:"数据分析"}[e]),as=(e,s)=>{switch(e){case"start":a.success(`任务 ${s.taskName} 已开始执行`);break;case"pause":a.success(`任务 ${s.taskName} 已暂停`);break;case"resume":a.success(`任务 ${s.taskName} 已恢复执行`);break;case"complete":a.success(`任务 ${s.taskName} 已完成`);break;case"cancel":a.success(`任务 ${s.taskName} 已取消`)}},is=(e,s)=>{switch(e){case"start":a.success(`批次 ${s.batchName} 已开始执行`);break;case"pause":a.success(`批次 ${s.batchName} 已暂停`);break;case"resume":a.success(`批次 ${s.batchName} 已恢复执行`);break;case"complete":a.success(`批次 ${s.batchName} 已完成`);break;case"cancel":a.success(`批次 ${s.batchName} 已取消`);break;case"execute":d("/experiment/batch-execution",{state:{batchId:s.id,batchCode:s.batchCode}})}},ns={total:de.length,pending:de.filter(e=>"pending"===e.status).length,inProgress:de.filter(e=>"in_progress"===e.status).length,completed:de.filter(e=>"completed"===e.status).length,failed:de.filter(e=>"failed"===e.status).length},rs={total:oe.length,draft:oe.filter(e=>"draft"===e.status).length,planning:oe.filter(e=>"planning"===e.status).length,inProgress:oe.filter(e=>"in_progress"===e.status).length,completed:oe.filter(e=>"completed"===e.status).length},ds=[{title:"任务名称",dataIndex:"taskName",key:"taskName",width:200,ellipsis:!0},{title:"类型",dataIndex:"taskType",key:"taskType",width:100,render:s=>e.jsx(q,{color:"blue",children:ls(s)})},{title:"状态",dataIndex:"status",key:"status",width:100,render:s=>e.jsx(q,{color:Ze(s),children:es(s)})},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:s=>e.jsx(q,{color:ss(s),children:ts(s)})},{title:"执行人",dataIndex:"assignee",key:"assignee",width:100},{title:"样本数",dataIndex:"sampleCount",key:"sampleCount",width:80,align:"center"},{title:"进度",dataIndex:"progress",key:"progress",width:120,render:s=>e.jsx(E,{percent:s,size:"small",status:100===s?"success":"active"})},{title:"预计时长",dataIndex:"estimatedDuration",key:"estimatedDuration",width:100,render:e=>`${Math.floor(e/60)}h${e%60}m`},{title:"操作",key:"action",width:200,fixed:"right",render:(s,t)=>e.jsxs(o,{size:"small",children:[e.jsx(O,{title:"查看详情",children:e.jsx(x,{type:"text",icon:e.jsx(G,{}),onClick:()=>{we(t),fe(!0)}})}),"pending"===t.status&&e.jsx(O,{title:"开始执行",children:e.jsx(x,{type:"text",icon:e.jsx(g,{}),onClick:()=>as("start",t)})}),"in_progress"===t.status&&e.jsx(O,{title:"暂停",children:e.jsx(x,{type:"text",icon:e.jsx(W,{}),onClick:()=>as("pause",t)})}),"paused"===t.status&&e.jsx(O,{title:"恢复",children:e.jsx(x,{type:"text",icon:e.jsx(g,{}),onClick:()=>as("resume",t)})}),e.jsx(O,{title:"编辑",children:e.jsx(x,{type:"text",icon:e.jsx(F,{}),onClick:()=>{ze(t),ve(!0)}})}),e.jsx(K,{title:"确定要取消这个任务吗？",onConfirm:()=>as("cancel",t),okText:"确定",cancelText:"取消",children:e.jsx(O,{title:"取消",children:e.jsx(x,{type:"text",danger:!0,icon:e.jsx(J,{})})})})]})}],cs=[{title:"批次编号",dataIndex:"batchCode",key:"batchCode",width:120,fixed:"left"},{title:"批次名称",dataIndex:"batchName",key:"batchName",width:200,ellipsis:!0},{title:"实验类型",dataIndex:"experimentType",key:"experimentType",width:100,render:s=>e.jsx(q,{color:"blue",children:ls(s)})},{title:"状态",dataIndex:"status",key:"status",width:100,render:s=>e.jsx(q,{color:Ze(s),children:es(s)})},{title:"样本数",dataIndex:"sampleCount",key:"sampleCount",width:80,align:"center"},{title:"执行人",dataIndex:"operator",key:"operator",width:100},{title:"进度",dataIndex:"progress",key:"progress",width:120,render:s=>e.jsx(E,{percent:s,size:"small",status:100===s?"success":"active"})},{title:"计划时间",key:"plannedTime",width:180,render:(s,t)=>e.jsxs("div",{children:[e.jsx("div",{children:t.plannedStartDate}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["至 ",t.plannedEndDate]})]})},{title:"操作",key:"action",width:200,fixed:"right",render:(s,t)=>e.jsxs(o,{size:"small",children:[e.jsx(O,{title:"查看详情",children:e.jsx(x,{type:"text",icon:e.jsx(G,{}),onClick:()=>{Ne(t),fe(!0)}})}),"ready"===t.status&&e.jsx(O,{title:"开始执行",children:e.jsx(x,{type:"text",icon:e.jsx(g,{}),onClick:()=>is("start",t)})}),"in_progress"===t.status&&e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"进入执行界面",children:e.jsx(x,{type:"text",icon:e.jsx(f,{}),onClick:()=>is("execute",t)})}),e.jsx(O,{title:"暂停",children:e.jsx(x,{type:"text",icon:e.jsx(W,{}),onClick:()=>is("pause",t)})})]}),e.jsx(O,{title:"编辑",children:e.jsx(x,{type:"text",icon:e.jsx(F,{}),onClick:()=>{Ee(t),Ce(!0)}})}),e.jsx(K,{title:"确定要删除这个批次吗？",onConfirm:()=>is("cancel",t),okText:"确定",cancelText:"取消",children:e.jsx(O,{title:"删除",children:e.jsx(x,{type:"text",danger:!0,icon:e.jsx(U,{})})})})]})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(i,{style:{marginBottom:24},children:e.jsxs(n,{gutter:16,align:"middle",children:[e.jsxs(r,{span:12,children:[e.jsxs(le,{level:2,style:{margin:0},children:[e.jsx(c,{style:{marginRight:8}}),"实验任务管理"]}),e.jsx(te,{type:"secondary",children:"📋 任务中心 + 批次管理 | 智能调度 | 实时监控"})]}),e.jsx(r,{span:12,style:{textAlign:"right"},children:e.jsxs(o,{children:[e.jsx(x,{type:"primary",icon:e.jsx(h,{}),onClick:()=>ve(!0),children:"新建任务"}),e.jsx(x,{type:"primary",icon:e.jsx(c,{}),onClick:()=>Ie(!0),style:{backgroundColor:"#52c41a",borderColor:"#52c41a"},children:"批次向导"})]})})]})}),e.jsxs(j,{activeKey:ae,onChange:ie,size:"large",tabBarStyle:{marginBottom:24},children:[e.jsxs(se,{tab:e.jsxs("span",{children:[e.jsx(f,{}),"任务中心",e.jsx(k,{count:ns.inProgress,style:{marginLeft:8}})]}),children:[e.jsxs(n,{gutter:16,style:{marginBottom:24},children:[e.jsx(r,{span:6,children:e.jsx(i,{children:e.jsx(p,{title:"总任务数",value:ns.total,prefix:e.jsx(m,{})})})}),e.jsx(r,{span:6,children:e.jsx(i,{children:e.jsx(p,{title:"待执行",value:ns.pending,valueStyle:{color:"#faad14"},prefix:e.jsx(u,{})})})}),e.jsx(r,{span:6,children:e.jsx(i,{children:e.jsx(p,{title:"执行中",value:ns.inProgress,valueStyle:{color:"#1890ff"},prefix:e.jsx(g,{})})})}),e.jsx(r,{span:6,children:e.jsx(i,{children:e.jsx(p,{title:"已完成",value:ns.completed,valueStyle:{color:"#52c41a"},prefix:e.jsx(y,{})})})})]}),e.jsx(i,{style:{marginBottom:24},children:e.jsxs(n,{gutter:16,children:[e.jsx(r,{span:6,children:e.jsx(V,{placeholder:"搜索任务名称",value:Le,onChange:e=>Qe(e.target.value),allowClear:!0})}),e.jsx(r,{span:4,children:e.jsxs(b,{placeholder:"任务状态",value:Be,onChange:Me,allowClear:!0,style:{width:"100%"},children:[e.jsx(X,{value:"pending",children:"待执行"}),e.jsx(X,{value:"in_progress",children:"执行中"}),e.jsx(X,{value:"completed",children:"已完成"}),e.jsx(X,{value:"failed",children:"失败"}),e.jsx(X,{value:"cancelled",children:"已取消"})]})}),e.jsx(r,{span:4,children:e.jsxs(b,{placeholder:"优先级",value:Ye,onChange:_e,allowClear:!0,style:{width:"100%"},children:[e.jsx(X,{value:"urgent",children:"紧急"}),e.jsx(X,{value:"high",children:"高"}),e.jsx(X,{value:"medium",children:"中"}),e.jsx(X,{value:"low",children:"低"})]})}),e.jsx(r,{span:4,children:e.jsxs(b,{placeholder:"执行人",value:Pe,onChange:He,allowClear:!0,style:{width:"100%"},children:[e.jsx(X,{value:"张三",children:"张三"}),e.jsx(X,{value:"李四",children:"李四"}),e.jsx(X,{value:"王五",children:"王五"})]})}),e.jsx(r,{span:6,children:e.jsxs(o,{children:[e.jsx(x,{icon:e.jsx(C,{}),onClick:Xe,children:"刷新"}),e.jsx(x,{onClick:()=>{Qe(""),Me(""),_e(""),He("")},children:"重置筛选"})]})})]})}),e.jsx(i,{title:"任务列表",children:e.jsx(S,{columns:ds,dataSource:de,rowKey:"id",loading:ne,scroll:{x:1200},pagination:{total:de.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>`第 ${s[0]}-${s[1]} 条/共 ${e} 条`}})})]},"taskCenter"),e.jsxs(se,{tab:e.jsxs("span",{children:[e.jsx(T,{}),"批次管理",e.jsx(k,{count:rs.inProgress,style:{marginLeft:8}})]}),children:[e.jsxs(n,{gutter:16,style:{marginBottom:24},children:[e.jsx(r,{span:6,children:e.jsx(i,{children:e.jsx(p,{title:"总批次数",value:rs.total,prefix:e.jsx(c,{})})})}),e.jsx(r,{span:6,children:e.jsx(i,{children:e.jsx(p,{title:"计划中",value:rs.planning,valueStyle:{color:"#722ed1"},prefix:e.jsx(I,{})})})}),e.jsx(r,{span:6,children:e.jsx(i,{children:e.jsx(p,{title:"执行中",value:rs.inProgress,valueStyle:{color:"#1890ff"},prefix:e.jsx(g,{})})})}),e.jsx(r,{span:6,children:e.jsx(i,{children:e.jsx(p,{title:"已完成",value:rs.completed,valueStyle:{color:"#52c41a"},prefix:e.jsx(y,{})})})})]}),e.jsx(i,{style:{marginBottom:24},children:e.jsxs(n,{gutter:16,children:[e.jsx(r,{span:6,children:e.jsx(V,{placeholder:"搜索批次名称或编号",value:Le,onChange:e=>Qe(e.target.value),allowClear:!0})}),e.jsx(r,{span:4,children:e.jsxs(b,{placeholder:"批次状态",value:$e,onChange:Re,allowClear:!0,style:{width:"100%"},children:[e.jsx(X,{value:"draft",children:"草稿"}),e.jsx(X,{value:"planning",children:"计划中"}),e.jsx(X,{value:"ready",children:"就绪"}),e.jsx(X,{value:"in_progress",children:"执行中"}),e.jsx(X,{value:"completed",children:"已完成"}),e.jsx(X,{value:"cancelled",children:"已取消"})]})}),e.jsx(r,{span:4,children:e.jsxs(b,{placeholder:"实验类型",allowClear:!0,style:{width:"100%"},children:[e.jsx(X,{value:"preprocessing",children:"前处理"}),e.jsx(X,{value:"library_construction",children:"文库构建"}),e.jsx(X,{value:"sequencing",children:"上机测序"}),e.jsx(X,{value:"analysis",children:"数据分析"})]})}),e.jsx(r,{span:4,children:e.jsxs(b,{placeholder:"执行人",allowClear:!0,style:{width:"100%"},children:[e.jsx(X,{value:"张三",children:"张三"}),e.jsx(X,{value:"李四",children:"李四"}),e.jsx(X,{value:"王五",children:"王五"})]})}),e.jsx(r,{span:6,children:e.jsxs(o,{children:[e.jsx(x,{icon:e.jsx(C,{}),onClick:Xe,children:"刷新"}),e.jsx(x,{onClick:()=>{Qe(""),Re("")},children:"重置筛选"})]})})]})}),e.jsx(i,{title:"批次列表",children:e.jsx(S,{columns:cs,dataSource:oe,rowKey:"id",loading:ne,scroll:{x:1400},pagination:{total:oe.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,s)=>`第 ${s[0]}-${s[1]} 条/共 ${e} 条`}})})]},"batchManagement"),e.jsx(se,{tab:e.jsxs("span",{children:[e.jsx(N,{}),"执行监控"]}),children:e.jsxs(n,{gutter:16,children:[e.jsx(r,{span:16,children:e.jsx(i,{title:"实时任务状态",style:{marginBottom:16},children:e.jsxs(w,{children:[e.jsxs(w.Item,{color:"blue",children:[e.jsx("p",{children:"09:30 - 环境样本DNA提取任务开始执行"}),e.jsx("p",{style:{color:"#666",fontSize:"12px"},children:"执行人：张三 | 预计完成时间：18:00"})]}),e.jsxs(w.Item,{color:"green",children:[e.jsx("p",{children:"08:15 - 测序批次A已完成"}),e.jsx("p",{style:{color:"#666",fontSize:"12px"},children:"执行人：王五 | 实际用时：23小时"})]}),e.jsxs(w.Item,{color:"orange",children:[e.jsx("p",{children:"07:45 - 文库构建任务等待中"}),e.jsx("p",{style:{color:"#666",fontSize:"12px"},children:"等待前处理完成"})]})]})})}),e.jsxs(r,{span:8,children:[e.jsx(i,{title:"设备状态",style:{marginBottom:16},children:e.jsx(D,{size:"small",dataSource:[{name:"离心机A",status:"available",color:"green"},{name:"PCR仪B",status:"busy",color:"red"},{name:"测序仪C",status:"available",color:"green"}],renderItem:s=>e.jsx(D.Item,{children:e.jsx(D.Item.Meta,{avatar:e.jsx(k,{status:s.color}),title:s.name,description:"available"===s.status?"空闲":"使用中"})})})}),e.jsx(i,{title:"今日统计",children:e.jsxs(o,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"完成任务"}),e.jsx("span",{style:{fontWeight:"bold"},children:"3个"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"处理样本"}),e.jsx("span",{style:{fontWeight:"bold"},children:"132个"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{children:"设备利用率"}),e.jsx("span",{style:{fontWeight:"bold"},children:"85%"})]})]})})]})]})},"monitoring")]}),e.jsxs(A,{title:Te?"任务详情":"批次详情",placement:"right",width:600,open:Se,onClose:()=>fe(!1),children:[Te&&e.jsxs("div",{children:[e.jsxs(z,{title:"基本信息",bordered:!0,column:1,children:[e.jsx(z.Item,{label:"任务名称",children:Te.taskName}),e.jsx(z.Item,{label:"任务类型",children:e.jsx(q,{color:"blue",children:ls(Te.taskType)})}),e.jsx(z.Item,{label:"状态",children:e.jsx(q,{color:Ze(Te.status),children:es(Te.status)})}),e.jsx(z.Item,{label:"优先级",children:e.jsx(q,{color:ss(Te.priority),children:ts(Te.priority)})}),e.jsx(z.Item,{label:"执行人",children:Te.assignee}),e.jsxs(z.Item,{label:"样本数量",children:[Te.sampleCount,"个"]}),e.jsx(z.Item,{label:"进度",children:e.jsx(E,{percent:Te.progress})})]}),Te.notes&&e.jsx(i,{title:"备注信息",style:{marginTop:16},children:e.jsx("p",{children:Te.notes})})]}),De&&e.jsxs("div",{children:[e.jsxs(z,{title:"基本信息",bordered:!0,column:1,children:[e.jsx(z.Item,{label:"批次编号",children:De.batchCode}),e.jsx(z.Item,{label:"批次名称",children:De.batchName}),e.jsx(z.Item,{label:"实验类型",children:e.jsx(q,{color:"blue",children:ls(De.experimentType)})}),e.jsx(z.Item,{label:"状态",children:e.jsx(q,{color:Ze(De.status),children:es(De.status)})}),e.jsx(z.Item,{label:"执行人",children:De.operator}),e.jsxs(z.Item,{label:"样本数量",children:[De.sampleCount,"个"]}),e.jsx(z.Item,{label:"进度",children:e.jsx(E,{percent:De.progress})}),e.jsxs(z.Item,{label:"成本预估",children:["¥",De.costEstimate]})]}),De.notes&&e.jsx(i,{title:"备注信息",style:{marginTop:16},children:e.jsx("p",{children:De.notes})})]})]}),e.jsxs(B,{title:"批次创建向导",open:ke,onCancel:()=>{Ie(!1),Ge(0),Fe({})},footer:null,width:1e3,destroyOnClose:!0,children:[e.jsxs(M,{current:Oe,style:{marginBottom:24},children:[e.jsx(ee,{title:"基本信息"}),e.jsx(ee,{title:"选择样本"}),e.jsx(ee,{title:"配置资源"}),e.jsx(ee,{title:"确认创建"})]}),e.jsxs("div",{style:{minHeight:500},children:[0===Oe&&e.jsxs(i,{title:"批次基本信息",style:{margin:"0 auto",maxWidth:600},children:[e.jsxs(l,{layout:"vertical",children:[e.jsxs(n,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(l.Item,{label:"批次编号",required:!0,children:e.jsx(v,{placeholder:"自动生成",value:`BATCH_${$().format("YYYYMMDD")}_${String(Math.floor(1e3*Math.random())).padStart(3,"0")}`,disabled:!0})})}),e.jsx(r,{span:12,children:e.jsx(l.Item,{label:"批次名称",required:!0,children:e.jsx(v,{placeholder:"请输入批次名称",value:We.batchName||"",onChange:e=>Fe({...We,batchName:e.target.value})})})})]}),e.jsxs(n,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(l.Item,{label:"实验类型",required:!0,children:e.jsxs(b,{placeholder:"选择实验类型",value:We.experimentType,onChange:e=>Fe({...We,experimentType:e}),children:[e.jsx(X,{value:"preprocessing",children:"样本前处理"}),e.jsx(X,{value:"library_construction",children:"文库构建"}),e.jsx(X,{value:"sequencing",children:"测序"}),e.jsx(X,{value:"analysis",children:"数据分析"})]})})}),e.jsx(r,{span:12,children:e.jsx(l.Item,{label:"优先级",required:!0,children:e.jsxs(b,{placeholder:"选择优先级",value:We.priority,onChange:e=>Fe({...We,priority:e}),children:[e.jsx(X,{value:"urgent",children:e.jsx(q,{color:"red",children:"紧急"})}),e.jsx(X,{value:"high",children:e.jsx(q,{color:"orange",children:"高"})}),e.jsx(X,{value:"medium",children:e.jsx(q,{color:"blue",children:"中"})}),e.jsx(X,{value:"low",children:e.jsx(q,{color:"green",children:"低"})})]})})})]}),e.jsxs(n,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(l.Item,{label:"执行人员",required:!0,children:e.jsxs(b,{placeholder:"选择执行人员",value:We.operator,onChange:e=>Fe({...We,operator:e}),children:[e.jsx(X,{value:"张三",children:"张三"}),e.jsx(X,{value:"李四",children:"李四"}),e.jsx(X,{value:"王五",children:"王五"}),e.jsx(X,{value:"赵六",children:"赵六"})]})})}),e.jsx(r,{span:12,children:e.jsx(l.Item,{label:"计划开始日期",required:!0,children:e.jsx(R,{style:{width:"100%"},placeholder:"选择开始日期",value:We.plannedStartDate?$(We.plannedStartDate):null,onChange:e=>Fe({...We,plannedStartDate:null==e?void 0:e.format("YYYY-MM-DD")})})})})]}),e.jsx(l.Item,{label:"实验协议",children:e.jsxs(b,{placeholder:"选择实验协议",value:We.protocol,onChange:e=>Fe({...We,protocol:e}),children:[e.jsx(X,{value:"DNA提取标准流程v2.1",children:"DNA提取标准流程v2.1"}),e.jsx(X,{value:"RNA提取标准流程v1.5",children:"RNA提取标准流程v1.5"}),e.jsx(X,{value:"文库构建标准流程v3.0",children:"文库构建标准流程v3.0"}),e.jsx(X,{value:"NovaSeq测序标准流程",children:"NovaSeq测序标准流程"})]})}),e.jsx(l.Item,{label:"备注信息",children:e.jsx(Z,{rows:3,placeholder:"请输入备注信息",value:We.notes||"",onChange:e=>Fe({...We,notes:e.target.value})})})]}),e.jsx("div",{style:{textAlign:"right",marginTop:24},children:e.jsx(x,{type:"primary",onClick:()=>Ge(1),disabled:!We.batchName||!We.experimentType||!We.operator,children:"下一步：选择样本"})})]}),1===Oe&&e.jsxs("div",{children:[e.jsx(Y,{message:"样本选择",description:"从可用样本中选择需要处理的样本，支持批量选择和搜索筛选",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(n,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsxs(i,{title:"可用样本",size:"small",children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(V,{placeholder:"搜索样本编号或名称",allowClear:!0,style:{marginBottom:8}}),e.jsxs(o,{children:[e.jsxs(b,{placeholder:"样本类型",style:{width:120},children:[e.jsx(X,{value:"DNA",children:"DNA"}),e.jsx(X,{value:"RNA",children:"RNA"}),e.jsx(X,{value:"蛋白质",children:"蛋白质"})]}),e.jsxs(b,{placeholder:"项目",style:{width:120},children:[e.jsx(X,{value:"项目A",children:"项目A"}),e.jsx(X,{value:"项目B",children:"项目B"}),e.jsx(X,{value:"项目C",children:"项目C"})]})]})]}),e.jsx(D,{size:"small",dataSource:[{id:"S001",name:"环境样本1",type:"DNA",project:"项目A",status:"可用"},{id:"S002",name:"环境样本2",type:"DNA",project:"项目A",status:"可用"},{id:"S003",name:"血液样本1",type:"RNA",project:"项目B",status:"可用"},{id:"S004",name:"血液样本2",type:"RNA",project:"项目B",status:"可用"},{id:"S005",name:"组织样本1",type:"蛋白质",project:"项目C",status:"可用"}],renderItem:s=>e.jsx(D.Item,{actions:[e.jsx(x,{size:"small",type:"link",onClick:()=>{const e=We.selectedSamples||[];e.find(e=>e.id===s.id)||Fe({...We,selectedSamples:[...e,s]})},children:"添加"})],children:e.jsx(D.Item.Meta,{avatar:e.jsx(_,{icon:e.jsx(P,{})}),title:`${s.id} - ${s.name}`,description:e.jsxs(o,{children:[e.jsx(q,{color:"blue",children:s.type}),e.jsx(q,{color:"green",children:s.project}),e.jsx(q,{color:"orange",children:s.status})]})})}),style:{maxHeight:300,overflow:"auto"}})]})}),e.jsx(r,{span:12,children:e.jsx(i,{title:`已选样本 (${(We.selectedSamples||[]).length})`,size:"small",children:0===(We.selectedSamples||[]).length?e.jsx(H,{image:H.PRESENTED_IMAGE_SIMPLE,description:"暂未选择样本"}):e.jsx(D,{size:"small",dataSource:We.selectedSamples||[],renderItem:s=>e.jsx(D.Item,{actions:[e.jsx(x,{size:"small",type:"link",danger:!0,onClick:()=>{const e=We.selectedSamples||[];Fe({...We,selectedSamples:e.filter(e=>e.id!==s.id)})},children:"移除"})],children:e.jsx(D.Item.Meta,{avatar:e.jsx(_,{icon:e.jsx(P,{})}),title:`${s.id} - ${s.name}`,description:e.jsxs(o,{children:[e.jsx(q,{color:"blue",children:s.type}),e.jsx(q,{color:"green",children:s.project})]})})}),style:{maxHeight:300,overflow:"auto"}})})})]}),e.jsx("div",{style:{textAlign:"right",marginTop:24},children:e.jsxs(o,{children:[e.jsx(x,{onClick:()=>Ge(0),children:"上一步"}),e.jsx(x,{type:"primary",onClick:()=>Ge(2),disabled:!(We.selectedSamples||[]).length,children:"下一步：配置资源"})]})})]}),2===Oe&&e.jsxs("div",{children:[e.jsx(Y,{message:"资源配置",description:"为批次配置所需的试剂、设备等实验资源",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(j,{defaultActiveKey:"reagents",children:[e.jsx(se,{tab:"试剂配置",children:e.jsxs(n,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(i,{title:"可用试剂",size:"small",children:e.jsx(D,{size:"small",dataSource:[{id:"R001",name:"DNA提取试剂盒",brand:"Qiagen",lot:"LOT001",expiry:"2024-12-31",quantity:50},{id:"R002",name:"PCR扩增试剂",brand:"Thermo",lot:"LOT002",expiry:"2024-10-15",quantity:100},{id:"R003",name:"文库构建试剂盒",brand:"Illumina",lot:"LOT003",expiry:"2024-11-20",quantity:25}],renderItem:s=>e.jsx(D.Item,{actions:[e.jsx(x,{size:"small",type:"link",onClick:()=>{const e=We.selectedReagents||[];e.find(e=>e.id===s.id)||Fe({...We,selectedReagents:[...e,{...s,usedQuantity:1}]})},children:"添加"})],children:e.jsx(D.Item.Meta,{title:s.name,description:e.jsxs("div",{children:[e.jsxs("div",{children:["品牌: ",s.brand," | 批号: ",s.lot]}),e.jsxs("div",{children:["有效期: ",s.expiry," | 库存: ",s.quantity]})]})})})})})}),e.jsx(r,{span:12,children:e.jsx(i,{title:"已选试剂",size:"small",children:0===(We.selectedReagents||[]).length?e.jsx(H,{image:H.PRESENTED_IMAGE_SIMPLE,description:"暂未选择试剂"}):e.jsx(D,{size:"small",dataSource:We.selectedReagents||[],renderItem:s=>e.jsx(D.Item,{actions:[e.jsx(x,{size:"small",type:"link",danger:!0,onClick:()=>{const e=We.selectedReagents||[];Fe({...We,selectedReagents:e.filter(e=>e.id!==s.id)})},children:"移除"})],children:e.jsx(D.Item.Meta,{title:s.name,description:e.jsx("div",{children:e.jsxs("div",{children:["用量:",e.jsx(L,{size:"small",min:1,max:s.quantity,value:s.usedQuantity,onChange:e=>{const t=(We.selectedReagents||[]).map(t=>t.id===s.id?{...t,usedQuantity:e}:t);Fe({...We,selectedReagents:t})},style:{width:60,margin:"0 8px"}}),"/ ",s.quantity]})})})})})})})]})},"reagents"),e.jsx(se,{tab:"设备配置",children:e.jsxs(n,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(i,{title:"可用设备",size:"small",children:e.jsx(D,{size:"small",dataSource:[{id:"E001",name:"PCR仪A",model:"ABI 9700",status:"空闲",capacity:96,location:"实验室A"},{id:"E002",name:"测序仪B",model:"NovaSeq 6000",status:"空闲",capacity:384,location:"测序中心"},{id:"E003",name:"离心机C",model:"Eppendorf 5424R",status:"使用中",capacity:24,location:"实验室B"}],renderItem:s=>e.jsx(D.Item,{actions:[e.jsx(x,{size:"small",type:"link",disabled:"使用中"===s.status,onClick:()=>{const e=We.selectedEquipment||[];e.find(e=>e.id===s.id)||Fe({...We,selectedEquipment:[...e,s]})},children:"使用中"===s.status?"不可用":"添加"})],children:e.jsx(D.Item.Meta,{title:s.name,description:e.jsxs("div",{children:[e.jsxs("div",{children:["型号: ",s.model," | 位置: ",s.location]}),e.jsxs("div",{children:["状态: ",e.jsx(q,{color:"空闲"===s.status?"green":"red",children:s.status}),"容量: ",s.capacity]})]})})})})})}),e.jsx(r,{span:12,children:e.jsx(i,{title:"已选设备",size:"small",children:0===(We.selectedEquipment||[]).length?e.jsx(H,{image:H.PRESENTED_IMAGE_SIMPLE,description:"暂未选择设备"}):e.jsx(D,{size:"small",dataSource:We.selectedEquipment||[],renderItem:s=>e.jsx(D.Item,{actions:[e.jsx(x,{size:"small",type:"link",danger:!0,onClick:()=>{const e=We.selectedEquipment||[];Fe({...We,selectedEquipment:e.filter(e=>e.id!==s.id)})},children:"移除"})],children:e.jsx(D.Item.Meta,{title:s.name,description:`${s.model} - ${s.location}`})})})})})]})},"equipment")]}),e.jsx("div",{style:{textAlign:"right",marginTop:24},children:e.jsxs(o,{children:[e.jsx(x,{onClick:()=>Ge(1),children:"上一步"}),e.jsx(x,{type:"primary",onClick:()=>Ge(3),children:"下一步：确认创建"})]})})]}),3===Oe&&e.jsxs("div",{children:[e.jsx(Y,{message:"批次信息确认",description:"请仔细核对批次信息，确认无误后点击创建批次",type:"warning",showIcon:!0,style:{marginBottom:16}}),e.jsxs(n,{gutter:16,children:[e.jsxs(r,{span:12,children:[e.jsx(i,{title:"基本信息",size:"small",children:e.jsxs(z,{column:1,size:"small",children:[e.jsx(z.Item,{label:"批次名称",children:We.batchName}),e.jsx(z.Item,{label:"实验类型",children:e.jsx(q,{color:"blue",children:ls(We.experimentType)})}),e.jsx(z.Item,{label:"优先级",children:e.jsx(q,{color:ss(We.priority),children:ts(We.priority)})}),e.jsx(z.Item,{label:"执行人员",children:We.operator}),e.jsx(z.Item,{label:"计划开始",children:We.plannedStartDate}),e.jsx(z.Item,{label:"实验协议",children:We.protocol})]})}),e.jsxs(i,{title:"成本预估",size:"small",style:{marginTop:16},children:[e.jsx(p,{title:"预估总成本",value:2500,precision:2,prefix:"¥",valueStyle:{color:"#3f8600"}}),e.jsx("div",{style:{marginTop:16},children:e.jsxs(te,{type:"secondary",children:["• 试剂成本: ¥1,200",e.jsx("br",{}),"• 设备使用费: ¥800",e.jsx("br",{}),"• 人工成本: ¥500"]})})]})]}),e.jsxs(r,{span:12,children:[e.jsx(i,{title:`样本清单 (${(We.selectedSamples||[]).length}个)`,size:"small",children:e.jsx(D,{size:"small",dataSource:We.selectedSamples||[],renderItem:s=>e.jsx(D.Item,{children:e.jsx(D.Item.Meta,{avatar:e.jsx(_,{size:"small",icon:e.jsx(P,{})}),title:`${s.id} - ${s.name}`,description:e.jsxs(o,{children:[e.jsx(q,{color:"blue",children:s.type}),e.jsx(q,{color:"green",children:s.project})]})})}),style:{maxHeight:200,overflow:"auto"}})}),e.jsxs(i,{title:"资源配置",size:"small",style:{marginTop:16},children:[e.jsxs("div",{children:[e.jsxs(te,{strong:!0,children:["试剂 (",(We.selectedReagents||[]).length,"种):"]}),e.jsx("div",{style:{marginLeft:16,marginTop:8},children:(We.selectedReagents||[]).map(s=>e.jsx("div",{children:e.jsxs(te,{children:[s.name," × ",s.usedQuantity]})},s.id))})]}),e.jsx(Q,{style:{margin:"12px 0"}}),e.jsxs("div",{children:[e.jsxs(te,{strong:!0,children:["设备 (",(We.selectedEquipment||[]).length,"台):"]}),e.jsx("div",{style:{marginLeft:16,marginTop:8},children:(We.selectedEquipment||[]).map(s=>e.jsx("div",{children:e.jsxs(te,{children:[s.name," (",s.model,")"]})},s.id))})]})]})]})]}),e.jsx("div",{style:{textAlign:"right",marginTop:24},children:e.jsxs(o,{children:[e.jsx(x,{onClick:()=>Ge(2),children:"上一步"}),e.jsxs(x,{type:"primary",size:"large",onClick:()=>{const e={id:`BATCH_${Date.now()}`,batchCode:`BATCH_${$().format("YYYYMMDD")}_${String(Math.floor(1e3*Math.random())).padStart(3,"0")}`,batchName:We.batchName,experimentType:We.experimentType,status:"draft",sampleCount:(We.selectedSamples||[]).length,samples:We.selectedSamples||[],reagents:We.selectedReagents||[],equipment:We.selectedEquipment||[],operator:We.operator,plannedStartDate:We.plannedStartDate,plannedEndDate:$(We.plannedStartDate).add(3,"day").format("YYYY-MM-DD"),estimatedDuration:72,priority:We.priority,notes:We.notes,createdBy:"当前用户",createdTime:$().format("YYYY-MM-DD HH:mm:ss"),updatedTime:$().format("YYYY-MM-DD HH:mm:ss"),protocol:We.protocol,qualityRequirements:["样本质量合格","操作规范"],costEstimate:2500,progress:0};xe([...oe,e]),a.success("批次创建成功！"),Ie(!1),Ge(0),Fe({}),ie("batchManagement")},children:[e.jsx(y,{}),"创建批次"]})]})})]})]})]})]})};export{ae as default};
