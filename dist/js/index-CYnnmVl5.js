import{j as e}from"./index-DyvGJ5NW.js";import{u as t,a}from"./react-vendor-DKSb2WWV.js";import{u as r,E as s,P as c,A as o,a as n,b as l}from"./index-COlBQd0-.js";import{s as i,O as d,c as p,e as j,a as m,T as u,a1 as x,ad as h,S as T,B as E,a5 as N,aR as S,W as C,be as y,I as g,G as f,F as I,Y as R,am as O,a4 as A,a2 as v}from"./antd-vendor-CqkZOb36.js";const{Title:D,Text:P}=u,{RangePicker:k}=A,{Search:_}=v,w=[{key:"all",label:"全部项目",icon:e.jsx(y,{}),color:"#1890ff",count:0},{key:l.PRODUCT_REGISTRATION,label:"产品注册",icon:e.jsx(g,{}),color:"#722ed1",count:0},{key:l.RESEARCH_SERVICE,label:"科研服务",icon:e.jsx(f,{}),color:"#52c41a",count:0},{key:l.CLINICAL_DETECTION,label:"临床检测",icon:e.jsx(I,{}),color:"#fa8c16",count:0}],b=e=>{switch(e){case c.DRAFT:case c.PENDING:return"not_started";case c.APPROVED:case c.EXECUTING:return"in_progress";case c.COMPLETED:case c.TERMINATED:return"completed";default:return"not_started"}},G=()=>{const{setBreadcrumbs:u}=r(),y=t(),[A,v]=a.useState([]),[P,k]=a.useState(!1),[_,G]=a.useState("all"),[L,M]=a.useState("all"),[z,U]=a.useState("all"),[V,F]=a.useState(null),[$,H]=a.useState("");a.useEffect(()=>{u([{title:"首页"},{title:"项目档案"},{title:"项目档案"}]),J()},[]);const J=async()=>{k(!0);try{const e=[{id:"1",manageOrgNo:"ORG001",projectCode:"PRJ001",projectName:"基因检测项目A",projectType:l.PRODUCT_REGISTRATION,projectStageType:n.RESEARCH_VALIDATION,customerCode:"CUST001",contractNo:"CONTRACT001",deptNo:"DEPT001",projectManager:"张三",planStartTime:"2024-01-01",planEndTime:"2024-12-31",auditStatus:o.APPROVED,projectStatus:c.EXECUTING,executeStatus:s.EXECUTING,sampleCharacteristics:{sampleName:"血液样本",sampleType:"全血",sampleSource:"临床",samplePlanNum:100},detectionRequirements:[],validationStandards:[],participatingOrganizations:[],attachmentFiles:[],createdAt:"2024-01-01",updatedAt:"2024-01-01"},{id:"2",manageOrgNo:"ORG002",projectCode:"PRJ002",projectName:"肿瘤标志物检测",projectType:l.RESEARCH_SERVICE,projectStageType:n.CLINICAL_VALIDATION,customerCode:"CUST002",contractNo:"CONTRACT002",deptNo:"DEPT002",projectManager:"李四",planStartTime:"2024-02-01",planEndTime:"2024-11-30",auditStatus:o.PENDING,projectStatus:c.PENDING,executeStatus:s.PENDING,sampleCharacteristics:{sampleName:"组织样本",sampleType:"石蜡切片",sampleSource:"病理科",samplePlanNum:50},detectionRequirements:[],validationStandards:[],participatingOrganizations:[],attachmentFiles:[],createdAt:"2024-02-01",updatedAt:"2024-02-01"},{id:"3",manageOrgNo:"ORG003",projectCode:"PRJ003",projectName:"病原体检测平台",projectType:l.CLINICAL_DETECTION,projectStageType:n.PRODUCTION_VALIDATION,customerCode:"CUST003",contractNo:"CONTRACT003",deptNo:"DEPT003",projectManager:"王五",planStartTime:"2024-03-01",planEndTime:"2024-10-31",auditStatus:o.APPROVED,projectStatus:c.COMPLETED,executeStatus:s.COMPLETED,sampleCharacteristics:{sampleName:"咽拭子",sampleType:"拭子",sampleSource:"门诊",samplePlanNum:200},detectionRequirements:[],validationStandards:[],participatingOrganizations:[],attachmentFiles:[],createdAt:"2024-03-01",updatedAt:"2024-03-01"}];v(e)}catch(e){i.error("加载项目档案列表失败")}finally{k(!1)}},B=A.filter(e=>{if("all"!==_&&e.projectType!==_)return!1;if("all"!==L&&b(e.projectStatus)!==L)return!1;if("all"!==z&&e.projectManager!==z)return!1;if($&&!`${e.projectName}`.includes($)&&!`${e.projectCode}`.includes($))return!1;if(V){const t=d(e.planStartTime),[a,r]=V;if(t.isBefore(a,"day")||t.isAfter(r,"day"))return!1}return!0}),X=[{title:"项目名称",dataIndex:"projectName",key:"projectName",width:150,fixed:"left",render:t=>e.jsx("span",{style:{fontWeight:500},children:t})},{title:"项目编码",dataIndex:"projectCode",key:"projectCode",width:120},{title:"项目类型",dataIndex:"projectType",key:"projectType",width:90,sorter:(e,t)=>String(e.projectType).localeCompare(String(t.projectType)),render:t=>{const a=(r=t,{[l.PRODUCT_REGISTRATION]:{icon:e.jsx(g,{}),color:"#722ed1"},[l.RESEARCH_SERVICE]:{icon:e.jsx(f,{}),color:"#52c41a"},[l.CLINICAL_DETECTION]:{icon:e.jsx(I,{}),color:"#fa8c16"}}[r]||{icon:e.jsx(g,{}),color:"#1890ff"});var r;const s=(c=t,{[l.PRODUCT_REGISTRATION]:"产品注册",[l.RESEARCH_SERVICE]:"科研服务",[l.CLINICAL_DETECTION]:"临床检测"}[c]||c);var c;return e.jsx(R,{icon:a.icon,color:a.color,children:s})}},{title:"项目负责人",dataIndex:"projectManager",key:"projectManager",width:100,sorter:(e,t)=>String(e.projectManager).localeCompare(String(t.projectManager)),render:t=>e.jsx("span",{children:t})},{title:"项目状态",dataIndex:"projectStatus",key:"projectStatus",width:80,sorter:(e,t)=>String(e.projectStatus).localeCompare(String(t.projectStatus)),render:t=>(t=>{const a={[c.DRAFT]:{color:"default",text:"草稿"},[c.PENDING]:{color:"processing",text:"待审核"},[c.APPROVED]:{color:"success",text:"审核通过"},[c.REJECTED]:{color:"error",text:"审核拒绝"},[c.EXECUTING]:{color:"processing",text:"执行中"},[c.COMPLETED]:{color:"success",text:"已完成"},[c.TERMINATED]:{color:"default",text:"已终止"}}[t];return e.jsx(R,{color:a.color,children:a.text})})(t)},{title:"计划开始时间",dataIndex:"planStartTime",key:"planStartTime",width:110,sorter:(e,t)=>d(e.planStartTime).valueOf()-d(t.planStartTime).valueOf(),defaultSortOrder:"descend",render:t=>e.jsx("span",{style:{fontSize:"12px"},children:t})},{title:"计划完成时间",dataIndex:"planEndTime",key:"planEndTime",width:110,sorter:(e,t)=>d(e.planEndTime).valueOf()-d(t.planEndTime).valueOf(),render:t=>e.jsx("span",{style:{fontSize:"12px"},children:t})},{title:"操作",key:"action",width:120,fixed:"right",render:(t,a)=>e.jsx("div",{className:"row-action-buttons",children:e.jsxs(T,{size:"small",children:[e.jsx(E,{type:"link",size:"small",onClick:()=>(e=>{y(`/project-archive/create?id=${e.id}&mode=view`)})(a),style:{color:"#1890ff",padding:"0 4px"},children:"查看"}),e.jsx(E,{type:"link",size:"small",onClick:()=>(e=>{y(`/project-archive/create?id=${e.id}&mode=edit`)})(a),style:{color:"#1890ff",padding:"0 4px"},children:"编辑"}),e.jsx(O,{title:"确定要删除这个项目档案吗？",onConfirm:()=>(async()=>{try{i.success("删除成功"),J()}catch(e){i.error("删除失败")}})(a.id),okText:"确定",cancelText:"取消",children:e.jsx(E,{type:"link",size:"small",danger:!0,style:{color:"#ff4d4f",padding:"0 4px"},children:"删除"})})]})})}];return a.useMemo(()=>{const e=new Set;return A.forEach(t=>{t.projectManager&&e.add(String(t.projectManager))}),Array.from(e)},[A]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"project-archive-container",children:e.jsxs(p,{gutter:4,children:[e.jsx(j,{span:5,children:e.jsx(m,{children:e.jsxs("div",{className:"project-types-card",children:[e.jsx("div",{className:"project-types-header",children:e.jsx(D,{level:4,style:{margin:0},children:"项目类型"})}),e.jsx("div",{className:"project-types-content",children:w.map(t=>{const a="all"===t.key?A.length:A.filter(e=>e.projectType===t.key).length;return e.jsxs("div",{className:"project-type-item "+(_===t.key?"active":""),onClick:()=>G(t.key),children:[e.jsx("div",{className:"project-type-icon",style:{color:t.color},children:t.icon}),e.jsxs("div",{className:"project-type-content",children:[e.jsx("div",{className:"project-type-label",children:t.label}),e.jsxs("div",{className:"project-type-count",children:["(",a,")"]})]})]},t.key)})})]})})}),e.jsx(j,{span:19,className:"project-archive-content-card",children:e.jsx(m,{children:e.jsxs("div",{className:"project-archive-content",children:[e.jsxs("div",{className:"content-header",children:[e.jsx("div",{className:"header-left",children:e.jsx(D,{level:4,style:{margin:0},children:"项目档案"})}),e.jsx("div",{className:"header-right"})]}),e.jsx("div",{className:"toolbar-container",children:e.jsx(x,{activeKey:L,onChange:e=>M(e),tabBarExtraContent:e.jsxs(T,{children:[e.jsx(E,{type:"primary",icon:e.jsx(N,{}),onClick:()=>{y("/project-archive/create")},children:"新增项目"}),e.jsx(E,{icon:e.jsx(S,{}),onClick:()=>{i.info("导出功能开发中...")},children:"导出"})]}),items:[{key:"all",label:e.jsxs("span",{children:["全部 ",e.jsx(h,{count:B.length,showZero:!0})]})},{key:"not_started",label:e.jsxs("span",{children:["未开始 ",e.jsx(h,{count:B.filter(e=>"not_started"===b(e.projectStatus)).length,showZero:!0})]})},{key:"in_progress",label:e.jsxs("span",{children:["进行中 ",e.jsx(h,{count:B.filter(e=>"in_progress"===b(e.projectStatus)).length,showZero:!0})]})},{key:"completed",label:e.jsxs("span",{children:["已完成 ",e.jsx(h,{count:B.filter(e=>"completed"===b(e.projectStatus)).length,showZero:!0})]})}]})}),e.jsx("div",{className:"table-container",children:e.jsx(C,{columns:X,dataSource:B,rowKey:"id",loading:P,bordered:!0,size:"small",scroll:{x:1500},pagination:{total:B.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条/共 ${e} 条`}})})]})})})]})})})};export{G as default};
