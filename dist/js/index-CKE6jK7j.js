import{j as e}from"./index-BD7k3pCu.js";import{r as t,u as i,j as l,k as s,h as n,i as r,N as a}from"./react-vendor-BSBC8BLg.js";import{$ as d,a as c,S as o,B as h,a1 as m,V as x,a5 as u,a3 as p,a4 as j,X as g,ai as y,ak as v,al as I,s as C,aA as f,T as b,c as S,e as w,at as k,aa as T,a2 as R,l as q,aB as A,an as P,bj as O,aV as N,D as B,ao as V,ad as z,m as E,w as F,bk as L,M as G,ah as Q,a$ as D,o as M,aP as $,a7 as _,am as U,ac as K,b as H,ag as Y,Z as W,aI as J,ap as X,I as Z,ay as ee,bl as te,bm as ie,aq as le,Y as se,av as ne,bn as re,u as ae}from"./antd-vendor-DCQn9U8Y.js";import{M as de,D as ce,b as oe,c as he}from"./index-CuwEmJ31.js";const{Option:me}=j,xe=()=>{const[i,l]=t.useState([{id:"T-001",code:"TP001",name:"肺癌基因检测",shortName:"肺癌检测",englishName:"Lung Cancer Gene Test",description:"用于后续关系绑定",status:"active",groupId:"G-001"},{id:"T-002",code:"TP002",name:"结直肠癌基因检测",shortName:"结直肠检测",englishName:"Colorectal Cancer Gene Test",description:"用于后续关系绑定",status:"active",groupId:"G-002"},{id:"T-003",code:"TP003",name:"乳腺癌基因检测",shortName:"乳腺检测",englishName:"Breast Cancer Gene Test",description:"用于后续关系绑定",status:"inactive",groupId:"G-003"}]),[s,n]=t.useState([]),[r,a]=t.useState(!1),[f,b]=t.useState(null),[S]=d.useForm();t.useEffect(()=>{try{const e=localStorage.getItem("testItemGroups");if(e){const t=JSON.parse(e),i=Array.isArray(t)?t.map(e=>({id:String(e.id),name:String(e.name),status:"inactive"===e.status?"inactive":"active"})):[];n(i)}}catch(e){}},[]);const w=(e=null)=>{b(e),a(!0),e?S.setFieldsValue(e):S.resetFields()},k=[{title:"检测项目编码",dataIndex:"code",key:"code",width:120,ellipsis:!0},{title:"检测项目名称",dataIndex:"name",key:"name",width:150,ellipsis:!0},{title:"简称",dataIndex:"shortName",key:"shortName",width:100,ellipsis:!0},{title:"英文名称",dataIndex:"englishName",key:"englishName",width:200,ellipsis:!0},{title:"分组",dataIndex:"groupId",key:"groupId",width:100,ellipsis:!0,render:e=>{const t=s.find(t=>t.id===e);return t?t.name:"-"}},{title:"描述",dataIndex:"description",key:"description",width:150,ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:80,render:t=>e.jsx(g,{color:"active"===t?"green":"red",children:"active"===t?"启用":"停用"})},{title:"操作",key:"action",width:150,fixed:"right",render:(t,s)=>e.jsxs(o,{children:[e.jsx(h,{size:"small",type:"link",icon:e.jsx(y,{}),onClick:()=>w(s),children:"编辑"}),e.jsx(h,{size:"small",type:"link",onClick:()=>(e=>{const t=i.map(t=>t.id===e?{...t,status:"active"===t.status?"inactive":"active"}:t);l(t)})(s.id),children:"active"===s.status?"停用":"启用"}),e.jsx(v,{title:"确认删除该项目？",onConfirm:()=>{return e=s.id,l(i.filter(t=>t.id!==e)),void C.success("检测项目已删除");var e},children:e.jsx(h,{size:"small",danger:!0,type:"link",icon:e.jsx(I,{}),children:"删除"})})]})}];return e.jsxs("div",{children:[e.jsxs(c,{title:"检测项目",children:[e.jsx(o,{style:{marginBottom:16},children:e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>w(null),children:"新增检测项目"})}),e.jsx(x,{rowKey:"id",columns:k,dataSource:i,pagination:{pageSize:8},scroll:{x:1e3}})]}),e.jsx(u,{title:f?"编辑检测项目":"新增检测项目",open:r,onCancel:()=>a(!1),onOk:()=>S.submit(),destroyOnClose:!0,children:e.jsxs(d,{form:S,layout:"vertical",onFinish:e=>{if(f){const t=i.map(t=>t.id===f.id?{...f,...e}:t);l(t),C.success("检测项目更新成功")}else{const t={id:`T-${Math.random().toString(36).slice(2,8)}`,...e};l([t,...i]),C.success("检测项目创建成功")}a(!1),b(null),S.resetFields()},initialValues:{status:"active"},children:[e.jsx(d.Item,{label:"检测项目编码",name:"code",rules:[{required:!0,message:"请输入编码"}],children:e.jsx(p,{placeholder:"例如：TP001"})}),e.jsx(d.Item,{label:"检测项目名称",name:"name",rules:[{required:!0,message:"请输入名称"}],children:e.jsx(p,{placeholder:"例如：肺癌基因检测"})}),e.jsx(d.Item,{label:"检测项目简称",name:"shortName",rules:[{required:!0,message:"请输入检测项目简称"}],children:e.jsx(p,{placeholder:"例如：肺癌检测"})}),e.jsx(d.Item,{label:"英文名称",name:"englishName",rules:[{required:!0,message:"请输入英文名称"}],children:e.jsx(p,{placeholder:"例如：Lung Cancer Gene Test"})}),e.jsx(d.Item,{label:"所属分组",name:"groupId",rules:[{required:!0,message:"请选择分组"}],children:e.jsx(j,{placeholder:"请选择分组",children:s.filter(e=>"active"===e.status).map(t=>e.jsx(me,{value:t.id,children:t.name},t.id))})}),e.jsx(d.Item,{label:"描述",name:"description",children:e.jsx(p.TextArea,{rows:3,placeholder:"项目用途或说明"})}),e.jsx(d.Item,{label:"状态",name:"status",rules:[{required:!0}],children:e.jsxs(j,{children:[e.jsx(me,{value:"active",children:"启用"}),e.jsx(me,{value:"inactive",children:"停用"})]})})]})})]})},{Title:ue}=b,{Option:pe}=j,{TextArea:je}=p,ge=()=>{const l=i(),[s]=d.useForm(),[n,r]=t.useState(!1),[a,x]=t.useState([]),u=[{id:"1",name:"BRCA1基因检测",code:"BRCA1",category:"遗传学检测"},{id:"2",name:"BRCA2基因检测",code:"BRCA2",category:"遗传学检测"},{id:"3",name:"TP53基因检测",code:"TP53",category:"肿瘤标志物"},{id:"4",name:"EGFR基因检测",code:"EGFR",category:"肿瘤标志物"},{id:"5",name:"KRAS基因检测",code:"KRAS",category:"肿瘤标志物"}],g=(e,t,i)=>{const l=[...a];if("analysisItemId"===t){const t=u.find(e=>e.id===i);t&&(l[e]={...l[e],id:t.id,name:t.name,code:t.code})}else l[e]={...l[e],[t]:i};x(l)};return e.jsx("div",{style:{padding:"24px",minHeight:"100vh",backgroundColor:"#f5f5f5"},children:e.jsxs(c,{children:[e.jsx("div",{style:{marginBottom:24},children:e.jsxs(o,{children:[e.jsx(h,{icon:e.jsx(f,{}),onClick:()=>l("/detection/test-item"),children:"返回列表"}),e.jsx(ue,{level:3,style:{margin:0},children:"新增检测项目"})]})}),e.jsxs(d,{form:s,layout:"vertical",onFinish:async e=>{try{r(!0);e.mode,e.executionMode,e.templateId,(new Date).toISOString(),(new Date).toISOString();await new Promise(e=>setTimeout(e,1e3)),C.success("检测项目创建成功！"),l("/detection/test-item")}catch(t){C.error("创建失败，请重试")}finally{r(!1)}},initialValues:{isActive:!0,status:"active",duration:5,price:0,mode:"document",executionMode:"reference"},children:[e.jsxs(c,{title:"基本信息",style:{marginBottom:16},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"项目名称",name:"name",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(p,{placeholder:"请输入项目名称"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"英文名称",name:"englishName",children:e.jsx(p,{placeholder:"请输入英文名称"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"项目编码",name:"code",rules:[{required:!0,message:"请输入项目编码"}],children:e.jsx(p,{placeholder:"请输入项目编码"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"项目分类",name:"category",rules:[{required:!0,message:"请选择项目分类"}],children:e.jsxs(j,{placeholder:"请选择项目分类",children:[e.jsx(pe,{value:"遗传学检测",children:"遗传学检测"}),e.jsx(pe,{value:"肿瘤标志物",children:"肿瘤标志物"}),e.jsx(pe,{value:"病原体检测",children:"病原体检测"}),e.jsx(pe,{value:"药物基因组学",children:"药物基因组学"})]})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"所属科室",name:"department",children:e.jsxs(j,{placeholder:"请选择所属科室",children:[e.jsx(pe,{value:"分子诊断科",children:"分子诊断科"}),e.jsx(pe,{value:"病理科",children:"病理科"}),e.jsx(pe,{value:"检验科",children:"检验科"}),e.jsx(pe,{value:"肿瘤科",children:"肿瘤科"})]})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"负责人",name:"responsible",children:e.jsx(p,{placeholder:"请输入负责人"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"项目价格",name:"price",rules:[{required:!0,message:"请输入项目价格"}],children:e.jsx(k,{style:{width:"100%"},placeholder:"请输入项目价格",min:0,precision:2,addonAfter:"元"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"报告周期(工作日)",name:"duration",rules:[{required:!0,message:"请输入报告周期"}],children:e.jsx(k,{style:{width:"100%"},placeholder:"请输入报告周期",min:1,addonAfter:"天"})})})]}),e.jsx(d.Item,{label:"项目描述",name:"description",children:e.jsx(je,{rows:3,placeholder:"请输入项目描述"})})]}),e.jsxs(c,{title:"技术信息",style:{marginBottom:16},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"主方法学",name:"primaryMethodology",rules:[{required:!0,message:"请选择主方法学"}],children:e.jsxs(j,{placeholder:"请选择主方法学",children:[e.jsx(pe,{value:"PCR",children:"PCR"}),e.jsx(pe,{value:"qPCR",children:"qPCR"}),e.jsx(pe,{value:"NGS",children:"NGS"}),e.jsx(pe,{value:"Sanger测序",children:"Sanger测序"}),e.jsx(pe,{value:"FISH",children:"FISH"}),e.jsx(pe,{value:"免疫组化",children:"免疫组化"})]})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"备用方法学",name:"backupMethodologies",children:e.jsxs(j,{mode:"multiple",placeholder:"请选择备用方法学",children:[e.jsx(pe,{value:"PCR",children:"PCR"}),e.jsx(pe,{value:"qPCR",children:"qPCR"}),e.jsx(pe,{value:"NGS",children:"NGS"}),e.jsx(pe,{value:"Sanger测序",children:"Sanger测序"}),e.jsx(pe,{value:"FISH",children:"FISH"}),e.jsx(pe,{value:"免疫组化",children:"免疫组化"})]})})})]}),e.jsx(d.Item,{label:"样本类型",name:"sampleTypes",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsxs(j,{mode:"multiple",placeholder:"请选择样本类型",children:[e.jsx(pe,{value:"全血",children:"全血"}),e.jsx(pe,{value:"血浆",children:"血浆"}),e.jsx(pe,{value:"血清",children:"血清"}),e.jsx(pe,{value:"唾液",children:"唾液"}),e.jsx(pe,{value:"组织",children:"组织"}),e.jsx(pe,{value:"石蜡切片",children:"石蜡切片"}),e.jsx(pe,{value:"尿液",children:"尿液"})]})})]}),e.jsxs(c,{title:"临床信息",style:{marginBottom:16},children:[e.jsx(d.Item,{label:"临床应用",name:"clinicalApplication",children:e.jsx(je,{rows:3,placeholder:"请输入临床应用描述"})}),e.jsx(d.Item,{label:"质量要求",name:"qualityRequirements",children:e.jsx(je,{rows:3,placeholder:"请输入质量要求"})}),e.jsx(d.Item,{label:"报告模板",name:"reportTemplate",children:e.jsxs(j,{placeholder:"请选择报告模板",children:[e.jsx(pe,{value:"标准模板",children:"标准模板"}),e.jsx(pe,{value:"简化模板",children:"简化模板"}),e.jsx(pe,{value:"详细模板",children:"详细模板"}),e.jsx(pe,{value:"自定义模板",children:"自定义模板"})]})})]}),e.jsxs(c,{title:"SOP配置",style:{marginBottom:16},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"配置模式",name:"mode",rules:[{required:!0,message:"请选择配置模式"}],children:e.jsxs(j,{placeholder:"请选择配置模式",children:[e.jsx(pe,{value:"document",children:"文档模式"}),e.jsx(pe,{value:"structured",children:"结构化模式"})]})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"执行模式",name:"executionMode",rules:[{required:!0,message:"请选择执行模式"}],children:e.jsxs(j,{placeholder:"请选择执行模式",children:[e.jsx(pe,{value:"strict",children:"严格模式"}),e.jsx(pe,{value:"guided",children:"引导模式"}),e.jsx(pe,{value:"reference",children:"参考模式"})]})})})]}),e.jsx(d.Item,{label:"SOP文档",name:"sopDocuments",children:e.jsx(T,{multiple:!0,beforeUpload:()=>!1,showUploadList:{showRemoveIcon:!0},children:e.jsx(h,{icon:e.jsx(R,{}),children:"上传SOP文档"})})}),e.jsx(d.Item,{label:"标准模板",name:"templateId",children:e.jsxs(j,{placeholder:"请选择标准模板",children:[e.jsx(pe,{value:"template1",children:"PCR标准模板"}),e.jsx(pe,{value:"template2",children:"NGS标准模板"}),e.jsx(pe,{value:"template3",children:"免疫组化标准模板"}),e.jsx(pe,{value:"template4",children:"FISH标准模板"})]})})]}),e.jsxs(c,{title:"关联分析项目",style:{marginBottom:16},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(h,{type:"dashed",icon:e.jsx(m,{}),onClick:()=>{const e={id:"",name:"",code:"",reportOrder:a.length+1,isRequired:!1,isActive:!0};x([...a,e])},block:!0,children:"添加关联分析项目"})}),a.map((t,i)=>e.jsx(c,{size:"small",style:{marginBottom:8},extra:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(I,{}),onClick:()=>(e=>{const t=a.filter((t,i)=>i!==e);x(t)})(i)}),children:e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"分析项目",style:{marginBottom:0},children:e.jsx(j,{placeholder:"请选择分析项目",value:t.id,onChange:e=>g(i,"analysisItemId",e),children:u.map(t=>e.jsxs(pe,{value:t.id,children:[t.name," (",t.code,")"]},t.id))})})}),e.jsx(w,{span:4,children:e.jsx(d.Item,{label:"报告顺序",style:{marginBottom:0},children:e.jsx(k,{min:1,value:t.reportOrder,onChange:e=>g(i,"reportOrder",e)})})}),e.jsx(w,{span:6,children:e.jsx(d.Item,{label:"是否必需",style:{marginBottom:0},children:e.jsx(q,{checked:t.isRequired,onChange:e=>g(i,"isRequired",e)})})}),e.jsx(w,{span:6,children:e.jsx(d.Item,{label:"是否启用",style:{marginBottom:0},children:e.jsx(q,{checked:t.isActive,onChange:e=>g(i,"isActive",e)})})})]})},i))]}),e.jsx(c,{title:"状态设置",style:{marginBottom:24},children:e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"项目状态",name:"status",rules:[{required:!0,message:"请选择项目状态"}],children:e.jsxs(j,{placeholder:"请选择项目状态",children:[e.jsx(pe,{value:"active",children:"启用"}),e.jsx(pe,{value:"inactive",children:"停用"}),e.jsx(pe,{value:"pending",children:"待审核"})]})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"是否激活",name:"isActive",valuePropName:"checked",children:e.jsx(q,{})})})]})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsxs(o,{size:"large",children:[e.jsx(h,{onClick:()=>l("/detection/test-item"),children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",loading:n,icon:e.jsx(A,{}),children:"保存"})]})})]})]})})},{Option:ye}=j,{TextArea:ve}=p,{Text:Ie}=b,Ce=()=>{const[i,l]=t.useState([{id:"A-TB-001",name:"利福平耐药(rpoB基因)",code:"A-TB-001",englishName:"Rifampicin Resistance (rpoB)",testItemId:"1",testItemName:"结核耐药基因检测",category:"基因突变",type:"qualitative",referenceRange:"野生型",normalValue:"阴性",abnormalCriteria:"阳性",clinicalSignificance:"检测rpoB基因突变，判断利福平耐药性",methodologyId:"1",methodologyName:"NGS测序",sampleType:["痰液","血液"],reportOrder:1,isActive:!0,isRequired:!0,description:"检测rpoB基因突变，判断利福平耐药性",status:"active",createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"A-TB-002",name:"异烟肼耐药(katG基因)",code:"A-TB-002",englishName:"Isoniazid Resistance (katG)",testItemId:"1",testItemName:"结核耐药基因检测",category:"基因突变",type:"qualitative",referenceRange:"野生型",normalValue:"阴性",abnormalCriteria:"阳性",clinicalSignificance:"检测katG基因突变，判断异烟肼耐药性",methodologyId:"1",methodologyName:"NGS测序",sampleType:["痰液","血液"],reportOrder:2,isActive:!0,isRequired:!0,description:"检测katG基因突变，判断异烟肼耐药性",status:"active",createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"A-TB-003",name:"异烟肼低度耐药(inhA基因)",code:"A-TB-003",englishName:"Isoniazid Low-level Resistance (inhA)",testItemId:"1",testItemName:"结核耐药基因检测",category:"基因突变",type:"qualitative",referenceRange:"野生型",normalValue:"阴性",abnormalCriteria:"阳性",clinicalSignificance:"检测inhA基因突变，判断异烟肼低度耐药性",methodologyId:"1",methodologyName:"NGS测序",sampleType:["痰液","血液"],reportOrder:3,isActive:!0,isRequired:!0,description:"检测inhA基因突变，判断异烟肼低度耐药性",status:"active",createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"A-HIV-001",name:"HIV病毒载量定量",code:"A-HIV-001",englishName:"HIV Viral Load Quantification",testItemId:"2",testItemName:"HIV病毒载量检测",category:"病毒载量",type:"quantitative",unit:"copies/mL",referenceRange:"<20",normalValue:"<20",abnormalCriteria:"≥20",clinicalSignificance:"HIV病毒载量定量检测，用于治疗监测",methodologyId:"2",methodologyName:"qPCR",sampleType:["血浆"],reportOrder:1,isActive:!0,isRequired:!0,description:"HIV病毒载量定量检测",status:"active",createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"A-HIV-002",name:"HIV基因型(亚型分析)",code:"A-HIV-002",englishName:"HIV Genotype (Subtype Analysis)",testItemId:"3",testItemName:"HIV基因型分析",category:"基因型分析",type:"text",clinicalSignificance:"HIV基因型分析，确定病毒亚型",methodologyId:"1",methodologyName:"NGS测序",sampleType:["血浆"],reportOrder:1,isActive:!0,isRequired:!0,description:"HIV基因型分析，确定病毒亚型",status:"active",createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"A-NGS-001",name:"EGFR L858R突变",code:"A-NGS-001",englishName:"EGFR L858R Mutation",testItemId:"4",testItemName:"NGS肿瘤基因检测",category:"基因突变",type:"qualitative",referenceRange:"野生型",normalValue:"阴性",abnormalCriteria:"阳性",clinicalSignificance:"EGFR L858R突变检测，用于靶向治疗指导",methodologyId:"1",methodologyName:"NGS测序",sampleType:["血液","组织"],reportOrder:1,isActive:!0,isRequired:!0,description:"EGFR L858R突变检测",status:"active",createdAt:"2024-01-15",updatedAt:"2024-01-15"}]),[s,n]=t.useState(""),[r,a]=t.useState(""),[o,v]=t.useState(""),[f,b]=t.useState(""),[T,R]=t.useState([]),[A,_]=t.useState(!1),[U,K]=t.useState(!1),[H,Y]=t.useState(null),[W]=d.useForm(),[J,X]=t.useState(null),[Z,ee]=t.useState(!1),te=[{id:"1",name:"结核耐药基因检测"},{id:"2",name:"HIV病毒载量检测"},{id:"3",name:"HIV基因型分析"},{id:"4",name:"NGS肿瘤基因检测"}],ie=[{value:"qualitative",label:"定性"},{value:"quantitative",label:"定量"},{value:"text",label:"文本"}],le=[{value:"active",label:"启用"},{value:"pending",label:"待审核"},{value:"inactive",label:"停用"}],se=i.filter(e=>{const t=!s||e.name.toLowerCase().includes(s.toLowerCase())||e.code.toLowerCase().includes(s.toLowerCase())||e.englishName&&e.englishName.toLowerCase().includes(s.toLowerCase()),i=!r||e.type===r,l=!o||e.testItemId===o,n=!f||e.status===f;return t&&i&&l&&n}),ne=e=>{Y(e||null),e?W.setFieldsValue(e):W.resetFields(),K(!0)},re=e=>{switch(e){case"active":return"启用";case"pending":return"待审核";case"inactive":return"停用";default:return e}},ae=e=>{switch(e){case"qualitative":return"定性";case"quantitative":return"定量";case"text":return"文本";default:return e}},de=t=>e.jsxs(G,{children:[e.jsx(G.Item,{icon:e.jsx(y,{}),onClick:()=>ne(t),children:"编辑"},"edit"),e.jsx(G.Item,{icon:e.jsx(Q,{}),onClick:()=>(X(t),void ee(!0)),children:"查看详情"},"view"),e.jsx(G.Item,{icon:e.jsx(D,{}),onClick:()=>(e=>{const t={...e,id:`A-${Date.now()}`,code:`${e.code}_COPY`,name:`${e.name}(副本)`,createdAt:(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};l(e=>[...e,t]),C.success("分析项目复制成功")})(t),children:"复制"},"copy"),e.jsx(G.Item,{icon:e.jsx(M,{}),children:"设置参考范围"},"reference"),e.jsx(G.Divider,{}),e.jsx(G.Item,{icon:e.jsx($,{}),disabled:"inactive"===t.status,children:"停用"},"disable"),e.jsx(G.Item,{icon:e.jsx(I,{}),danger:!0,onClick:()=>{u.confirm({title:"确认删除",content:`确定要删除分析项目"${t.name}"吗？`,onOk:()=>{return e=t.id,l(t=>t.filter(t=>t.id!==e)),void C.success("分析项目删除成功");var e}})},children:"删除"},"delete")]}),ce=[{title:"分析项目编号",dataIndex:"code",key:"code",width:140,fixed:"left",render:t=>e.jsx(Ie,{strong:!0,children:t})},{title:"分析项目名称",dataIndex:"name",key:"name",width:200,render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{children:t}),i.englishName&&e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:i.englishName})]})},{title:"所属检测项目",dataIndex:"testItemName",key:"testItemName",width:160},{title:"结果类型",dataIndex:"type",key:"type",width:100,render:t=>e.jsx(g,{color:"quantitative"===t?"blue":"qualitative"===t?"green":"orange",children:ae(t)})},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(z,{status:"active"===t?"success":"pending"===t?"warning":"error",text:re(t)})},{title:"操作",key:"action",width:80,fixed:"right",render:t=>e.jsx(F,{overlay:de(t),trigger:["click"],children:e.jsx(h,{type:"text",icon:e.jsx(L,{})})})}],oe={selectedRowKeys:T,onChange:e=>R(e),getCheckboxProps:e=>({disabled:"inactive"===e.status})};return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(c,{title:"分析项目管理",style:{marginBottom:16},children:[e.jsx(c,{size:"small",title:"搜索与筛选",style:{marginBottom:16},children:e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(p,{placeholder:"搜索分析项目...",prefix:e.jsx(P,{}),value:s,onChange:e=>n(e.target.value),allowClear:!0})}),e.jsx(w,{span:4,children:e.jsx(j,{placeholder:"结果类型",value:r,onChange:a,allowClear:!0,style:{width:"100%"},children:ie.map(t=>e.jsx(ye,{value:t.value,children:t.label},t.value))})}),e.jsx(w,{span:4,children:e.jsx(j,{placeholder:"检测项目",value:o,onChange:v,allowClear:!0,style:{width:"100%"},children:te.map(t=>e.jsx(ye,{value:t.id,children:t.name},t.id))})}),e.jsx(w,{span:4,children:e.jsx(j,{placeholder:"状态",value:f,onChange:b,allowClear:!0,style:{width:"100%"},children:le.map(t=>e.jsx(ye,{value:t.value,children:t.label},t.value))})}),e.jsx(w,{span:4,children:e.jsx(h,{onClick:()=>{n(""),a(""),v(""),b("")},children:"重置"})})]})}),e.jsxs(S,{gutter:16,style:{marginBottom:16},children:[e.jsx(w,{children:e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>ne(),children:"新增分析项目"})}),e.jsx(w,{children:e.jsx(h,{icon:e.jsx(O,{}),children:"批量导入"})}),e.jsx(w,{children:e.jsx(h,{icon:e.jsx(N,{}),onClick:()=>{0!==T.length?C.success("导出功能开发中..."):C.warning("请选择要导出的分析项目")},children:"导出列表"})}),T.length>0&&e.jsx(e.Fragment,{children:e.jsx(w,{children:e.jsxs(h,{danger:!0,onClick:()=>{0!==T.length?u.confirm({title:"确认删除",content:`确定要删除选中的 ${T.length} 个分析项目吗？`,onOk:()=>{l(e=>e.filter(e=>!T.includes(e.id))),R([]),C.success("批量删除成功")}}):C.warning("请选择要删除的分析项目")},children:["批量删除 (",T.length,")"]})})})]}),e.jsx(x,{columns:ce,dataSource:se,rowKey:"id",rowSelection:oe,loading:A,scroll:{x:1e3},pagination:{total:se.length,pageSize:20,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第${t[0]}-${t[1]}条/共${e}条 总计${i.length}个分析项目`}})]}),e.jsx(B,{title:"分析项目详情",placement:"right",width:800,open:Z,onClose:()=>ee(!1),children:J&&e.jsxs("div",{children:[e.jsxs(V,{title:"基本信息",bordered:!0,column:2,children:[e.jsx(V.Item,{label:"项目编号",children:J.code}),e.jsx(V.Item,{label:"项目名称",children:J.name}),e.jsx(V.Item,{label:"英文名称",children:J.englishName||"-"}),e.jsx(V.Item,{label:"所属检测项目",children:J.testItemName}),e.jsx(V.Item,{label:"项目类别",children:J.category}),e.jsx(V.Item,{label:"结果类型",children:e.jsx(g,{color:"quantitative"===J.type?"blue":"qualitative"===J.type?"green":"orange",children:ae(J.type)})}),e.jsx(V.Item,{label:"单位",children:J.unit||"-"}),e.jsx(V.Item,{label:"参考范围",children:J.referenceRange||"-"}),e.jsx(V.Item,{label:"正常值",children:J.normalValue||"-"}),e.jsx(V.Item,{label:"异常标准",children:J.abnormalCriteria||"-"}),e.jsx(V.Item,{label:"方法学",children:J.methodologyName}),e.jsx(V.Item,{label:"报告顺序",children:J.reportOrder}),e.jsx(V.Item,{label:"是否启用",children:e.jsx(q,{checked:J.isActive,disabled:!0})}),e.jsx(V.Item,{label:"是否必需",children:e.jsx(q,{checked:J.isRequired,disabled:!0})}),e.jsx(V.Item,{label:"状态",children:e.jsx(z,{status:"active"===J.status?"success":"pending"===J.status?"warning":"error",text:re(J.status)})})]}),e.jsx(E,{}),e.jsx(V,{title:"样本类型",bordered:!0,children:e.jsx(V.Item,{label:"适用样本",children:J.sampleType.map(t=>e.jsx(g,{style:{margin:"2px"},children:t},t))})}),e.jsx(E,{}),e.jsxs(V,{title:"临床信息",bordered:!0,children:[e.jsx(V.Item,{label:"临床意义",span:3,children:J.clinicalSignificance}),e.jsx(V.Item,{label:"项目描述",span:3,children:J.description||"-"})]}),e.jsx(E,{}),e.jsxs(V,{title:"时间信息",bordered:!0,column:2,children:[e.jsx(V.Item,{label:"创建时间",children:J.createdAt}),e.jsx(V.Item,{label:"更新时间",children:J.updatedAt})]})]})}),e.jsx(u,{title:H?"编辑分析项目":"新增分析项目",open:U,onOk:async()=>{try{const e=await W.validateFields();if(H)l(t=>t.map(t=>t.id===H.id?{...t,...e,updatedAt:(new Date).toISOString().split("T")[0]}:t)),C.success("分析项目更新成功");else{const t={...e,id:`A-${Date.now()}`,createdAt:(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};l(e=>[...e,t]),C.success("分析项目创建成功")}K(!1),Y(null),W.resetFields()}catch(e){}},onCancel:()=>{K(!1),Y(null),W.resetFields()},width:800,okText:"保存",cancelText:"取消",children:e.jsxs(d,{form:W,labelCol:{span:6},wrapperCol:{span:18},initialValues:{isActive:!0,isRequired:!1,status:"active",reportOrder:1},children:[e.jsx(d.Item,{label:"分析项目编号",name:"code",rules:[{required:!0,message:"请输入分析项目编号"}],children:e.jsx(p,{placeholder:"如：A-TB-001"})}),e.jsx(d.Item,{label:"分析项目名称",name:"name",rules:[{required:!0,message:"请输入分析项目名称"}],children:e.jsx(p,{placeholder:"如：利福平耐药(rpoB基因)"})}),e.jsx(d.Item,{label:"英文名称",name:"englishName",children:e.jsx(p,{placeholder:"如：Rifampicin Resistance (rpoB)"})}),e.jsx(d.Item,{label:"所属检测项目",name:"testItemId",rules:[{required:!0,message:"请选择所属检测项目"}],children:e.jsx(j,{placeholder:"请选择检测项目",children:te.map(t=>e.jsx(ye,{value:t.id,children:t.name},t.id))})}),e.jsx(d.Item,{label:"方法学",name:"methodologyName",rules:[{required:!0,message:"请选择方法学"}],children:e.jsxs(j,{placeholder:"请选择方法学",children:[e.jsx(ye,{value:"NGS测序",children:"NGS测序"}),e.jsx(ye,{value:"PCR扩增",children:"PCR扩增"}),e.jsx(ye,{value:"荧光定量PCR",children:"荧光定量PCR"}),e.jsx(ye,{value:"基因芯片",children:"基因芯片"}),e.jsx(ye,{value:"Sanger测序",children:"Sanger测序"}),e.jsx(ye,{value:"免疫组化",children:"免疫组化"}),e.jsx(ye,{value:"FISH",children:"FISH"}),e.jsx(ye,{value:"质谱分析",children:"质谱分析"})]})}),e.jsx(d.Item,{label:"样本类型",name:"sampleType",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsx(j,{mode:"multiple",placeholder:"请选择样本类型",options:[{label:"血液",value:"血液"},{label:"血浆",value:"血浆"},{label:"血清",value:"血清"},{label:"痰液",value:"痰液"},{label:"组织",value:"组织"},{label:"尿液",value:"尿液"},{label:"唾液",value:"唾液"}]})}),e.jsx(d.Item,{label:"结果类型",name:"type",rules:[{required:!0,message:"请选择结果类型"}],children:e.jsx(j,{placeholder:"请选择结果类型",children:ie.map(t=>e.jsx(ye,{value:t.value,children:t.label},t.value))})}),e.jsx(d.Item,{label:"单位",name:"unit",children:e.jsx(p,{placeholder:"如：copies/mL"})}),e.jsx(d.Item,{label:"参考范围",name:"referenceRange",children:e.jsx(p,{placeholder:"如：野生型"})}),e.jsx(d.Item,{label:"正常值",name:"normalValue",children:e.jsx(p,{placeholder:"如：阴性"})}),e.jsx(d.Item,{label:"异常标准",name:"abnormalCriteria",children:e.jsx(p,{placeholder:"如：阳性"})}),e.jsx(d.Item,{label:"临床意义",name:"clinicalSignificance",rules:[{required:!0,message:"请输入临床意义"}],children:e.jsx(ve,{rows:3,placeholder:"请描述该分析项目的临床意义和应用场景"})}),e.jsx(d.Item,{label:"项目描述",name:"description",children:e.jsx(ve,{rows:2,placeholder:"请输入项目的详细描述（可选）"})}),e.jsx(d.Item,{label:"报告顺序",name:"reportOrder",rules:[{required:!0,message:"请输入报告顺序"}],children:e.jsx(k,{min:1,style:{width:"100%"}})}),e.jsx(d.Item,{label:"状态",name:"status",rules:[{required:!0,message:"请选择状态"}],children:e.jsx(j,{children:le.map(t=>e.jsx(ye,{value:t.value,children:t.label},t.value))})}),e.jsx(d.Item,{label:"是否启用",name:"isActive",valuePropName:"checked",children:e.jsx(q,{})}),e.jsx(d.Item,{label:"是否必需",name:"isRequired",valuePropName:"checked",children:e.jsx(q,{})})]})})]})},{Option:fe}=j,{TextArea:be}=p,{Title:Se,Text:we}=b,{TabPane:ke}=U,Te=()=>{const l=i(),[s]=d.useForm(),[n,r]=t.useState(!1),[a,x]=t.useState(0),[u,g]=t.useState([]),y=(e,t,i)=>{const l=[...u];l[e]={...l[e],[t]:i},g(l)};return e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(c,{style:{marginBottom:24},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(h,{icon:e.jsx(f,{}),onClick:()=>l("/detection/analysis-item"),style:{marginRight:16},children:"返回列表"}),e.jsx(Se,{level:3,style:{margin:0},children:"新增分析项目"})]}),e.jsxs(o,{children:[e.jsx(h,{onClick:()=>s.resetFields(),children:"重置表单"}),e.jsx(h,{type:"primary",icon:e.jsx(A,{}),loading:n,onClick:()=>s.submit(),children:"保存项目"})]})]})}),e.jsx(c,{style:{marginBottom:24},children:e.jsx(_,{current:a,items:[{title:"基本信息",description:"项目基础信息配置"},{title:"检测参数",description:"检测方法和参数设置"},{title:"质量控制",description:"质量控制要求配置"},{title:"报告配置",description:"报告模板和格式设置"}]})}),e.jsxs(d,{form:s,layout:"vertical",onFinish:async e=>{try{r(!0);(new Date).toISOString().split("T")[0],(new Date).toISOString().split("T")[0];await new Promise(e=>setTimeout(e,1e3)),C.success("分析项目创建成功"),l("/detection/analysis-item")}catch(t){C.error("保存失败，请重试")}finally{r(!1)}},onFinishFailed:e=>{C.error("请检查表单填写是否完整")},initialValues:{isActive:!0,isRequired:!1,status:"active",reportOrder:1,type:"qualitative",qualityControl:{cvRequirement:15,accuracyRequirement:95,precisionRequirement:90},reportConfiguration:{format:"pdf",includeGraphs:!0,includeInterpretation:!0}},children:[e.jsxs(U,{activeKey:a.toString(),onChange:e=>x(parseInt(e)),type:"card",children:[e.jsx(ke,{tab:"基本信息",children:e.jsxs(c,{title:"项目基础信息",style:{marginBottom:16},children:[e.jsx(K,{message:"填写提示",description:"请准确填写分析项目的基本信息，项目编号建议使用规范的命名格式，如：A-TB-001",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"分析项目编号",name:"code",rules:[{required:!0,message:"请输入分析项目编号"},{pattern:/^[A-Z]-[A-Z0-9]+-[0-9]+$/,message:"编号格式：A-TB-001"}],tooltip:"建议格式：A-TB-001，其中A表示分析项目，TB表示疾病类型，001表示序号",children:e.jsx(p,{placeholder:"如：A-TB-001"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"分析项目名称",name:"name",rules:[{required:!0,message:"请输入分析项目名称"}],children:e.jsx(p,{placeholder:"如：利福平耐药(rpoB基因)"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"英文名称",name:"englishName",children:e.jsx(p,{placeholder:"如：Rifampicin Resistance (rpoB)"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"所属检测项目",name:"testItemId",rules:[{required:!0,message:"请选择所属检测项目"}],children:e.jsx(j,{placeholder:"请选择检测项目",showSearch:!0,children:[{id:"1",name:"结核耐药基因检测",code:"TB-DRUG-RESISTANCE"},{id:"2",name:"HIV病毒载量检测",code:"HIV-VIRAL-LOAD"},{id:"3",name:"HIV基因型分析",code:"HIV-GENOTYPE"},{id:"4",name:"NGS肿瘤基因检测",code:"NGS-TUMOR-GENE"}].map(t=>e.jsx(fe,{value:t.id,children:e.jsxs("div",{children:[e.jsx("div",{children:t.name}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.code})]})},t.id))})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"项目类别",name:"category",rules:[{required:!0,message:"请输入项目类别"}],children:e.jsxs(j,{placeholder:"请选择或输入项目类别",mode:"tags",children:[e.jsx(fe,{value:"基因突变",children:"基因突变"}),e.jsx(fe,{value:"基因扩增",children:"基因扩增"}),e.jsx(fe,{value:"基因缺失",children:"基因缺失"}),e.jsx(fe,{value:"病毒载量",children:"病毒载量"}),e.jsx(fe,{value:"基因型分析",children:"基因型分析"}),e.jsx(fe,{value:"微卫星",children:"微卫星"}),e.jsx(fe,{value:"融合基因",children:"融合基因"})]})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"结果类型",name:"type",rules:[{required:!0,message:"请选择结果类型"}],children:e.jsx(j,{placeholder:"请选择结果类型",children:[{value:"qualitative",label:"定性",description:"阴性/阳性、野生型/突变型等"},{value:"quantitative",label:"定量",description:"具体数值结果，如拷贝数、浓度等"},{value:"text",label:"文本",description:"描述性结果，如基因型分析报告"}].map(t=>e.jsx(fe,{value:t.value,children:e.jsxs("div",{children:[e.jsx("div",{children:t.label}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.description})]})},t.value))})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"状态",name:"status",rules:[{required:!0,message:"请选择状态"}],children:e.jsxs(j,{children:[e.jsx(fe,{value:"active",children:"启用"}),e.jsx(fe,{value:"pending",children:"待审核"}),e.jsx(fe,{value:"inactive",children:"停用"})]})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"报告顺序",name:"reportOrder",rules:[{required:!0,message:"请输入报告顺序"}],tooltip:"在报告中的显示顺序，数字越小越靠前",children:e.jsx(k,{min:1,max:999,style:{width:"100%"}})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:6,children:e.jsx(d.Item,{label:"是否启用",name:"isActive",valuePropName:"checked",children:e.jsx(q,{checkedChildren:"启用",unCheckedChildren:"禁用"})})}),e.jsx(w,{span:6,children:e.jsx(d.Item,{label:"是否必需",name:"isRequired",valuePropName:"checked",tooltip:"必需项目在检测时不能跳过",children:e.jsx(q,{checkedChildren:"必需",unCheckedChildren:"可选"})})})]}),e.jsx(d.Item,{label:"项目描述",name:"description",children:e.jsx(be,{rows:3,placeholder:"请输入项目的详细描述，包括检测原理、适用范围等"})})]})},"0"),e.jsxs(ke,{tab:"检测参数",children:[e.jsxs(c,{title:"检测方法与参数",style:{marginBottom:16},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"检测方法学",name:"methodologyId",rules:[{required:!0,message:"请选择检测方法学"}],children:e.jsx(j,{placeholder:"请选择检测方法学",showSearch:!0,children:[{id:"1",name:"NGS测序",code:"NGS"},{id:"2",name:"qPCR",code:"qPCR"},{id:"3",name:"Sanger测序",code:"SANGER"},{id:"4",name:"FISH",code:"FISH"},{id:"5",name:"免疫组化",code:"IHC"}].map(t=>e.jsx(fe,{value:t.id,children:e.jsxs("div",{children:[e.jsx("div",{children:t.name}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.code})]})},t.id))})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"样本类型",name:"sampleType",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsx(j,{mode:"multiple",placeholder:"请选择适用的样本类型",optionLabelProp:"label",children:[{label:"血液",value:"血液",description:"全血样本"},{label:"血浆",value:"血浆",description:"血浆样本"},{label:"血清",value:"血清",description:"血清样本"},{label:"痰液",value:"痰液",description:"痰液样本"},{label:"组织",value:"组织",description:"组织样本"},{label:"尿液",value:"尿液",description:"尿液样本"},{label:"唾液",value:"唾液",description:"唾液样本"},{label:"DNA",value:"DNA",description:"提取的DNA样本"},{label:"RNA",value:"RNA",description:"提取的RNA样本"}].map(t=>e.jsx(fe,{value:t.value,label:t.label,children:e.jsxs("div",{children:[e.jsx("div",{children:t.label}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.description})]})},t.value))})})})]}),e.jsx(E,{orientation:"left",children:"结果参数设置"}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"单位",name:"unit",tooltip:"定量检测时的结果单位，如：copies/mL、ng/mL等",children:e.jsx(p,{placeholder:"如：copies/mL"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"参考范围",name:"referenceRange",children:e.jsx(p,{placeholder:"如：野生型、<20 copies/mL"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"正常值",name:"normalValue",children:e.jsx(p,{placeholder:"如：阴性、未检出"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"异常判断标准",name:"abnormalCriteria",children:e.jsx(p,{placeholder:"如：阳性、≥20 copies/mL"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"关联疾病",name:"associatedDiseases",children:e.jsx(j,{mode:"tags",placeholder:"请选择或输入关联疾病",options:["结核病","肺结核","耐药结核","HIV感染","AIDS","肺癌","非小细胞肺癌","肺腺癌","乳腺癌","结直肠癌","胃癌","肝癌","胰腺癌","前列腺癌","卵巢癌"].map(e=>({label:e,value:e}))})})})]}),e.jsx(d.Item,{label:"临床意义",name:"clinicalSignificance",rules:[{required:!0,message:"请输入临床意义"}],children:e.jsx(be,{rows:4,placeholder:"请详细描述该分析项目的临床意义、应用场景和解读要点"})})]}),e.jsxs(c,{title:"解读规则配置",style:{marginBottom:16},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(h,{type:"dashed",icon:e.jsx(m,{}),onClick:()=>{g([...u,{condition:"",interpretation:"",recommendation:""}])},block:!0,children:"添加解读规则"})}),u.map((t,i)=>e.jsx(c,{size:"small",title:`规则 ${i+1}`,extra:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(I,{}),onClick:()=>(e=>{g(u.filter((t,i)=>i!==e))})(i)}),style:{marginBottom:16},children:e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(p,{placeholder:"触发条件",value:t.condition,onChange:e=>y(i,"condition",e.target.value)})}),e.jsx(w,{span:8,children:e.jsx(p,{placeholder:"结果解读",value:t.interpretation,onChange:e=>y(i,"interpretation",e.target.value)})}),e.jsx(w,{span:8,children:e.jsx(p,{placeholder:"临床建议",value:t.recommendation,onChange:e=>y(i,"recommendation",e.target.value)})})]})},i))]})]},"1"),e.jsx(ke,{tab:"质量控制",children:e.jsxs(c,{title:"质量控制要求",style:{marginBottom:16},children:[e.jsx(K,{message:"质量控制说明",description:"设置该分析项目的质量控制要求，包括变异系数(CV)、准确度和精密度等指标",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"变异系数要求 (CV%)",name:["qualityControl","cvRequirement"],tooltip:"批内和批间变异系数的最大允许值",children:e.jsx(k,{min:0,max:100,precision:1,addonAfter:"%",placeholder:"如：15.0",style:{width:"100%"}})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"准确度要求 (%)",name:["qualityControl","accuracyRequirement"],tooltip:"检测结果与真实值的符合程度要求",children:e.jsx(k,{min:0,max:100,precision:1,addonAfter:"%",placeholder:"如：95.0",style:{width:"100%"}})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"精密度要求 (%)",name:["qualityControl","precisionRequirement"],tooltip:"重复检测结果的一致性要求",children:e.jsx(k,{min:0,max:100,precision:1,addonAfter:"%",placeholder:"如：90.0",style:{width:"100%"}})})})]}),e.jsx(E,{orientation:"left",children:"检测限度"}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"检出限 (LOD)",name:["qualityControl","detectionLimit"],tooltip:"能够检出的最低浓度或拷贝数",children:e.jsx(p,{placeholder:"如：10 copies/mL"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"定量限 (LOQ)",name:["qualityControl","quantificationLimit"],tooltip:"能够准确定量的最低浓度或拷贝数",children:e.jsx(p,{placeholder:"如：20 copies/mL"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"线性范围",name:["qualityControl","linearRange"],tooltip:"检测方法的线性检测范围",children:e.jsx(p,{placeholder:"如：20-10^7 copies/mL"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"特异性要求",name:["qualityControl","specificity"],tooltip:"与其他相似目标的交叉反应要求",children:e.jsx(p,{placeholder:"如：无交叉反应"})})})]})]})},"2"),e.jsxs(ke,{tab:"报告配置",children:[e.jsxs(c,{title:"报告模板配置",style:{marginBottom:16},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"报告模板名称",name:["reportConfiguration","template"],children:e.jsx(p,{placeholder:"如：结核耐药基因检测报告模板v2.1"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"报告格式",name:["reportConfiguration","format"],children:e.jsxs(j,{placeholder:"请选择报告格式",children:[e.jsx(fe,{value:"pdf",children:"PDF格式"}),e.jsx(fe,{value:"word",children:"Word格式"}),e.jsx(fe,{value:"html",children:"HTML格式"})]})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"包含图表",name:["reportConfiguration","includeGraphs"],valuePropName:"checked",children:e.jsx(q,{checkedChildren:"包含",unCheckedChildren:"不包含"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"包含解读",name:["reportConfiguration","includeInterpretation"],valuePropName:"checked",children:e.jsx(q,{checkedChildren:"包含",unCheckedChildren:"不包含"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"自动生成",name:["reportConfiguration","autoGenerate"],valuePropName:"checked",children:e.jsx(q,{checkedChildren:"自动",unCheckedChildren:"手动"})})})]}),e.jsx(d.Item,{label:"报告说明",name:["reportConfiguration","description"],children:e.jsx(be,{rows:3,placeholder:"请输入报告的说明信息，如注意事项、免责声明等"})})]}),e.jsx(c,{title:"文档上传",style:{marginBottom:16},children:e.jsx(d.Item,{label:"相关文档",name:"documents",tooltip:"可上传相关的标准操作程序(SOP)、验证报告等文档",children:e.jsx(T,{multiple:!0,beforeUpload:()=>!1,listType:"text",children:e.jsx(h,{icon:e.jsx(R,{}),children:"上传文档"})})})})]},"3")]}),e.jsx(c,{children:e.jsx("div",{style:{textAlign:"center"},children:e.jsxs(o,{size:"large",children:[e.jsx(h,{size:"large",onClick:()=>l("/detection/analysis-item"),children:"取消"}),e.jsx(h,{size:"large",onClick:()=>s.resetFields(),children:"重置"}),e.jsx(h,{type:"primary",size:"large",htmlType:"submit",loading:n,icon:e.jsx(A,{}),children:"保存分析项目"})]})})})]})]})},{Option:Re}=j,{TextArea:qe}=p,{Text:Ae,Title:Pe}=b,{Panel:Oe}=J,{Step:Ne}=_,{TabPane:Be}=U,Ve=()=>{const[i,l]=t.useState([]),[s,n]=t.useState(!1),[r,a]=t.useState(!1),[f,b]=t.useState(!1),[k,T]=t.useState(null),[R,q]=t.useState(null),[A,F]=t.useState(""),[L,G]=t.useState(""),[M,_]=t.useState(""),[K,J]=t.useState(""),[X]=d.useForm(),Z=[{id:"1",code:"M-MOL-001",name:"荧光PCR熔解曲线法",englishName:"Fluorescent PCR Melting Curve Analysis",category:he.MOLECULAR_BIOLOGY,technologyPlatform:oe.PCR,detectionType:ce.QUALITATIVE,status:de.ACTIVE,description:"基于荧光PCR技术和熔解曲线分析，通过检测DNA双链解链温度的变化来识别基因突变",technicalPrinciple:"荧光PCR熔解曲线分析是一种基于PCR扩增产物熔解温度(Tm值)差异的检测技术...",technicalRequirement:{sampleRequirement:{sampleTypes:["血浆","血清","全血"],minimumVolume:"≥200μL",storageCondition:"-80℃",qualityRequirements:"DNA质量符合检测要求，A260/A280=1.8-2.0"},environmentRequirement:{temperature:"18-25℃",humidity:"<70%",cleanliness:"万级实验室"},personnelRequirement:{certifications:["PCR上岗证"],training:["专项培训"],experience:"1年以上"}},experimentSteps:[{id:"1",name:"核酸提取",description:"从样本中提取DNA",requirements:"DNA质量符合检测要求，A260/A280=1.8-2.0",order:1},{id:"2",name:"PCR扩增",description:"进行荧光PCR扩增",requirements:"扩增程序按照试剂盒说明设置",order:2},{id:"3",name:"熔解曲线分析",description:"分析熔解曲线",requirements:"使用仪器配套软件进行分析",order:3}],performanceIndicators:[{id:"1",name:"检测限",requirement:"≤10 copies/μL",verificationMethod:"梯度稀释验证",notes:"95%置信区间"},{id:"2",name:"精密度",requirement:"CV<15%",verificationMethod:"室内质控",notes:"重复20次"}],resourceConfiguration:{equipmentTypes:[{id:"1",name:"实时荧光定量PCR仪",selected:!0},{id:"2",name:"核酸提取仪",selected:!0},{id:"3",name:"离心机",selected:!0}],reagentTypes:[{id:"1",name:"PCR试剂盒",selected:!0},{id:"2",name:"核酸提取试剂盒",selected:!0}]},createdBy:"张主任",createdAt:"2023-06-15",updatedBy:"李研究员",updatedAt:"2024-01-20"},{id:"2",code:"M-MOL-002",name:"实时荧光定量PCR",englishName:"Real-time Quantitative PCR",category:he.MOLECULAR_BIOLOGY,technologyPlatform:oe.PCR,detectionType:ce.QUANTITATIVE,status:de.ACTIVE,description:"基于PCR扩增过程中荧光信号的实时检测，实现核酸的定量分析",technicalPrinciple:"实时荧光定量PCR技术通过在PCR反应体系中加入荧光基团...",technicalRequirement:{sampleRequirement:{sampleTypes:["血浆","血清","组织"],minimumVolume:"≥100μL",storageCondition:"-20℃",qualityRequirements:"RNA质量符合检测要求，RIN≥7.0"},environmentRequirement:{temperature:"20-25℃",humidity:"<60%",cleanliness:"万级实验室"},personnelRequirement:{certifications:["PCR上岗证","分子生物学技术证书"],training:["qPCR专项培训"],experience:"2年以上"}},experimentSteps:[{id:"1",name:"RNA提取",description:"从样本中提取总RNA",requirements:"RNA质量符合检测要求，RIN≥7.0",order:1},{id:"2",name:"逆转录",description:"将RNA逆转录为cDNA",requirements:"逆转录效率>80%",order:2},{id:"3",name:"qPCR扩增",description:"进行实时荧光定量PCR",requirements:"扩增效率90-110%",order:3}],performanceIndicators:[{id:"1",name:"定量限",requirement:"≤50 copies/μL",verificationMethod:"重复性验证",notes:"CV<25%"},{id:"2",name:"线性范围",requirement:"5-10^5 copies",verificationMethod:"线性稀释",notes:"R²>0.98"}],resourceConfiguration:{equipmentTypes:[{id:"1",name:"实时荧光定量PCR仪",selected:!0},{id:"2",name:"RNA提取仪",selected:!0}],reagentTypes:[{id:"1",name:"qPCR试剂盒",selected:!0},{id:"2",name:"逆转录试剂盒",selected:!0}]},createdBy:"王博士",createdAt:"2023-07-10",updatedBy:"李研究员",updatedAt:"2024-02-15"}];t.useEffect(()=>{ee()},[]);const ee=async()=>{n(!0);try{await new Promise(e=>setTimeout(e,1e3)),l(Z)}catch(e){C.error("加载数据失败")}finally{n(!1)}},te=i.filter(e=>{const t=!A||e.name.toLowerCase().includes(A.toLowerCase())||e.code.toLowerCase().includes(A.toLowerCase()),i=!L||e.category===L,l=!M||e.detectionType===M,s=!K||e.status===K;return t&&i&&l&&s}),ie=e=>({[he.MOLECULAR_BIOLOGY]:"分子生物学",[he.IMMUNOLOGY]:"免疫学",[he.MICROBIOLOGY]:"微生物学",[he.BIOCHEMISTRY]:"生物化学",[he.CYTOGENETICS]:"细胞遗传学"}[e]||e),le=e=>({[ce.QUALITATIVE]:"定性检测",[ce.QUANTITATIVE]:"定量检测"}[e]||e),se=e=>({[de.ACTIVE]:{text:"启用",color:"success"},[de.INACTIVE]:{text:"停用",color:"default"}}[e]||{text:e,color:"default"}),ne=[{title:"方法学编号",dataIndex:"code",key:"code",width:120,ellipsis:!0,fixed:"left"},{title:"方法学名称",dataIndex:"name",key:"name",width:200,ellipsis:!0,render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:t}),i.englishName&&e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:i.englishName})]})},{title:"技术分类",dataIndex:"category",key:"category",width:120,render:t=>e.jsx(g,{color:"blue",children:ie(t)})},{title:"检测类型",dataIndex:"detectionType",key:"detectionType",width:100,render:t=>e.jsx(g,{color:t===ce.QUANTITATIVE?"orange":"green",children:le(t)})},{title:"状态",dataIndex:"status",key:"status",width:80,render:t=>{const i=se(t);return e.jsx(z,{status:i.color,text:i.text})}},{title:"操作",key:"action",width:200,fixed:"right",render:(t,i)=>e.jsxs(o,{size:"small",children:[e.jsx(Y,{title:"查看详情",children:e.jsx(h,{type:"text",icon:e.jsx(Q,{}),size:"small",onClick:()=>me(i)})}),e.jsx(Y,{title:"编辑",children:e.jsx(h,{type:"text",icon:e.jsx(y,{}),size:"small",onClick:()=>re(i)})}),e.jsx(Y,{title:"复制",children:e.jsx(h,{type:"text",icon:e.jsx(D,{}),size:"small",onClick:()=>ae(i)})}),e.jsx(Y,{title:i.status===de.ACTIVE?"停用":"启用",children:e.jsx(h,{type:"text",icon:i.status===de.ACTIVE?e.jsx($,{}):e.jsx(W,{}),size:"small",onClick:()=>xe(i)})}),e.jsx(v,{title:"确定要删除这个方法学吗？",onConfirm:()=>ue(i.id),okText:"确定",cancelText:"取消",children:e.jsx(Y,{title:"删除",children:e.jsx(h,{type:"text",icon:e.jsx(I,{}),size:"small",danger:!0})})})]})}],re=e=>{T(e),X.setFieldsValue(e),a(!0)},ae=e=>{const t={...e,id:"",code:"",name:`${e.name} - 副本`,createdAt:(new Date).toISOString().split("T")[0]};T(t),X.setFieldsValue(t),a(!0)},me=e=>{q(e),b(!0)},xe=async e=>{try{const t=e.status===de.ACTIVE?de.INACTIVE:de.ACTIVE;await new Promise(e=>setTimeout(e,500)),l(i=>i.map(i=>i.id===e.id?{...i,status:t,updatedAt:(new Date).toISOString().split("T")[0]}:i)),C.success("方法学已"+(t===de.ACTIVE?"启用":"停用"))}catch(t){C.error("操作失败")}},ue=async e=>{try{await new Promise(e=>setTimeout(e,500)),l(t=>t.filter(t=>t.id!==e)),C.success("删除成功")}catch(t){C.error("删除失败")}};return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(c,{children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx(Pe,{level:4,style:{margin:0},children:"方法学列表"})}),e.jsxs(c,{size:"small",style:{marginBottom:"16px"},children:[e.jsxs(S,{gutter:[16,16],children:[e.jsx(w,{span:6,children:e.jsx(p,{placeholder:"搜索方法学...",prefix:e.jsx(P,{}),value:A,onChange:e=>F(e.target.value),allowClear:!0})}),e.jsx(w,{span:4,children:e.jsxs(j,{placeholder:"技术平台",value:L,onChange:G,allowClear:!0,style:{width:"100%"},children:[e.jsx(Re,{value:he.MOLECULAR_BIOLOGY,children:"分子生物学"}),e.jsx(Re,{value:he.IMMUNOLOGY,children:"免疫学"}),e.jsx(Re,{value:he.MICROBIOLOGY,children:"微生物学"}),e.jsx(Re,{value:he.BIOCHEMISTRY,children:"生物化学"}),e.jsx(Re,{value:he.CYTOGENETICS,children:"细胞遗传学"})]})}),e.jsx(w,{span:4,children:e.jsxs(j,{placeholder:"检测类型",value:M,onChange:_,allowClear:!0,style:{width:"100%"},children:[e.jsx(Re,{value:ce.QUALITATIVE,children:"定性检测"}),e.jsx(Re,{value:ce.QUANTITATIVE,children:"定量检测"})]})}),e.jsx(w,{span:4,children:e.jsxs(j,{placeholder:"状态",value:K,onChange:J,allowClear:!0,style:{width:"100%"},children:[e.jsx(Re,{value:de.ACTIVE,children:"启用"}),e.jsx(Re,{value:de.INACTIVE,children:"停用"})]})}),e.jsx(w,{span:6,children:e.jsxs(o,{children:[e.jsx(h,{onClick:()=>{F(""),G(""),_(""),J("")},children:"重置"}),e.jsx(h,{icon:e.jsx(N,{}),onClick:()=>{C.info("导出功能开发中...")},children:"导出列表"})]})})]}),e.jsx(S,{style:{marginTop:"16px"},children:e.jsx(w,{span:24,children:e.jsxs(o,{children:[e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{T(null),X.resetFields(),a(!0)},children:"新增"}),e.jsx(h,{icon:e.jsx(O,{}),onClick:()=>{C.info("导入功能开发中...")},children:"导入"})]})})})]}),e.jsx(x,{columns:ne,dataSource:te,rowKey:"id",loading:s,scroll:{x:1e3},pagination:{total:te.length,pageSize:20,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第${t[0]}-${t[1]}条/共${e}条方法学`}})]}),e.jsx(u,{title:(null==k?void 0:k.id)?"编辑方法学":"新增方法学",open:r,onCancel:()=>a(!1),footer:null,width:1200,destroyOnClose:!0,children:e.jsxs(d,{form:X,layout:"vertical",onFinish:async e=>{try{if(await new Promise(e=>setTimeout(e,1e3)),null==k?void 0:k.id)l(t=>t.map(t=>t.id===k.id?{...t,...e,updatedAt:(new Date).toISOString().split("T")[0]}:t)),C.success("更新成功");else{const t={...e,id:Date.now().toString(),createdAt:(new Date).toISOString().split("T")[0]};l(e=>[t,...e]),C.success("创建成功")}a(!1),X.resetFields()}catch(t){C.error("保存失败")}},initialValues:{status:de.ACTIVE,category:he.MOLECULAR_BIOLOGY,detectionType:ce.QUALITATIVE,technologyPlatform:oe.PCR},children:[e.jsx(U,{defaultActiveKey:"basic",children:e.jsxs(Be,{tab:"基本信息",children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"方法学编号",name:"code",rules:[{required:!0,message:"请输入方法学编号"}],children:e.jsx(p,{placeholder:"如：M-MOL-004"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"方法学名称",name:"name",rules:[{required:!0,message:"请输入方法学名称"}],children:e.jsx(p,{placeholder:"请输入方法学名称"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"英文名称",name:"englishName",children:e.jsx(p,{placeholder:"请输入英文名称"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"方法学分类",name:"category",rules:[{required:!0,message:"请选择方法学分类"}],children:e.jsxs(j,{placeholder:"请选择方法学分类",children:[e.jsx(Re,{value:he.MOLECULAR_BIOLOGY,children:"分子生物学"}),e.jsx(Re,{value:he.IMMUNOLOGY,children:"免疫学"}),e.jsx(Re,{value:he.MICROBIOLOGY,children:"微生物学"}),e.jsx(Re,{value:he.BIOCHEMISTRY,children:"生物化学"}),e.jsx(Re,{value:he.CYTOGENETICS,children:"细胞遗传学"})]})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"技术平台",name:"technologyPlatform",rules:[{required:!0,message:"请选择技术平台"}],children:e.jsxs(j,{placeholder:"请选择技术平台",children:[e.jsx(Re,{value:oe.PCR,children:"PCR平台"}),e.jsx(Re,{value:oe.DIGITAL_PCR,children:"数字PCR平台"}),e.jsx(Re,{value:oe.NGS,children:"二代测序平台"}),e.jsx(Re,{value:oe.SANGER,children:"Sanger测序平台"}),e.jsx(Re,{value:oe.ELISA,children:"ELISA平台"}),e.jsx(Re,{value:oe.CULTURE,children:"培养平台"}),e.jsx(Re,{value:oe.MASS_SPEC,children:"质谱平台"})]})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"检测类型",name:"detectionType",rules:[{required:!0,message:"请选择检测类型"}],children:e.jsxs(j,{placeholder:"请选择检测类型",children:[e.jsx(Re,{value:ce.QUALITATIVE,children:"定性检测"}),e.jsx(Re,{value:ce.QUANTITATIVE,children:"定量检测"})]})})})]}),e.jsx(S,{gutter:16,children:e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"状态",name:"status",rules:[{required:!0,message:"请选择状态"}],children:e.jsxs(H.Group,{children:[e.jsx(H,{value:de.ACTIVE,children:"启用"}),e.jsx(H,{value:de.INACTIVE,children:"停用"})]})})})}),e.jsx(d.Item,{label:"方法学描述",name:"description",rules:[{required:!0,message:"请输入方法学描述"}],children:e.jsx(qe,{rows:4,placeholder:"请输入方法学描述",showCount:!0,maxLength:500})}),e.jsx(d.Item,{label:"技术原理",name:"technicalPrinciple",rules:[{required:!0,message:"请输入技术原理"}],children:e.jsx(qe,{rows:10,placeholder:"请详细描述技术原理...",showCount:!0,maxLength:2e3})})]},"basic")}),e.jsx(E,{}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(o,{children:[e.jsx(h,{onClick:()=>a(!1),children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",children:"保存"}),e.jsx(h,{type:"primary",htmlType:"submit",children:"保存并新增"})]})})]})}),e.jsx(B,{title:"方法学详情",placement:"right",width:800,open:f,onClose:()=>b(!1),children:R&&e.jsxs("div",{children:[e.jsx(U,{defaultActiveKey:"basic",children:e.jsx(Be,{tab:"基础信息",children:e.jsxs(V,{column:2,bordered:!0,children:[e.jsx(V.Item,{label:"方法学编号",children:R.code}),e.jsx(V.Item,{label:"状态",children:e.jsx(z,{status:se(R.status).color,text:se(R.status).text})}),e.jsx(V.Item,{label:"方法学名称",span:2,children:R.name}),e.jsx(V.Item,{label:"英文名称",span:2,children:R.englishName||"-"}),e.jsx(V.Item,{label:"方法学分类",children:e.jsx(g,{color:"blue",children:ie(R.category)})}),e.jsx(V.Item,{label:"技术平台",children:(pe=R.technologyPlatform,{[oe.PCR]:"PCR平台",[oe.DIGITAL_PCR]:"数字PCR平台",[oe.NGS]:"二代测序平台",[oe.SANGER]:"Sanger测序平台",[oe.ELISA]:"ELISA平台",[oe.CULTURE]:"培养平台",[oe.MASS_SPEC]:"质谱平台"}[pe]||pe)}),e.jsx(V.Item,{label:"检测类型",children:e.jsx(g,{color:R.detectionType===ce.QUANTITATIVE?"orange":"green",children:le(R.detectionType)})}),e.jsx(V.Item,{label:"创建时间",children:R.createdAt}),e.jsx(V.Item,{label:"创建人",children:R.createdBy}),e.jsx(V.Item,{label:"更新时间",children:R.updatedAt||"-"}),e.jsx(V.Item,{label:"更新人",span:2,children:R.updatedBy||"-"}),e.jsx(V.Item,{label:"方法学描述",span:2,children:R.description})]})},"basic")}),e.jsx(E,{}),e.jsx("div",{style:{textAlign:"right"},children:e.jsxs(o,{children:[e.jsx(h,{onClick:()=>re(R),children:"编辑"}),e.jsx(h,{onClick:()=>ae(R),children:"复制新建"}),e.jsx(h,{onClick:()=>b(!1),children:"返回列表"})]})})]})})]});var pe},{Search:ze}=p,{Option:Ee}=j,Fe=()=>{const l=i(),[s,n]=t.useState(!1),[r,a]=t.useState([]),[v,f]=t.useState([]),[b,k]=t.useState(""),[T,R]=t.useState("all"),[q,A]=t.useState(!1),[P]=d.useForm();t.useEffect(()=>{B()},[]);const B=async()=>{n(!0);try{a([{id:"1",name:"肿瘤基因检测",version:"v2.1",status:"active",applicableProjects:["肿瘤测序项目A","肿瘤测序项目B"],description:"用于肿瘤相关基因突变的检测流程",creator:"张三",createTime:"2024-03-15",lastUpdater:"李四",updateTime:"2024-05-20",stepCount:6,fieldCount:25,qcRuleCount:8},{id:"2",name:"病原微生物检测",version:"v1.5",status:"active",applicableProjects:["病原检测项目"],description:"病原微生物基因检测标准流程",creator:"王五",createTime:"2024-02-10",lastUpdater:"赵六",updateTime:"2024-04-15",stepCount:5,fieldCount:18,qcRuleCount:6},{id:"3",name:"遗传病筛查",version:"v3.0",status:"active",applicableProjects:["遗传病筛查项目A","遗传病筛查项目B","新生儿筛查"],description:"遗传性疾病基因筛查检测流程",creator:"钱七",createTime:"2024-01-20",lastUpdater:"孙八",updateTime:"2024-05-10",stepCount:7,fieldCount:32,qcRuleCount:12},{id:"4",name:"药物基因组学",version:"v1.2",status:"inactive",applicableProjects:["药物基因组学项目"],description:"个体化用药基因检测流程",creator:"周九",createTime:"2023-12-05",lastUpdater:"吴十",updateTime:"2024-03-01",stepCount:4,fieldCount:15,qcRuleCount:4},{id:"5",name:"新冠核酸检测",version:"v4.0",status:"active",applicableProjects:["新冠检测项目"],description:"SARS-CoV-2核酸检测标准流程",creator:"郑十一",createTime:"2023-11-15",lastUpdater:"王十二",updateTime:"2024-05-25",stepCount:3,fieldCount:12,qcRuleCount:5}])}catch(e){C.error("加载SOP模板失败")}finally{n(!1)}},V=r.filter(e=>{const t=!b||e.name.toLowerCase().includes(b.toLowerCase())||e.applicableProjects.some(e=>e.toLowerCase().includes(b.toLowerCase())),i="all"===T||e.status===T;return t&&i}),E=e=>{if(0!==v.length)switch(e){case"enable":u.confirm({title:"批量启用",content:`确定要启用选中的${v.length}个SOP模板吗？`,onOk:()=>{C.success("批量启用成功"),f([]),B()}});break;case"disable":u.confirm({title:"批量停用",content:`确定要停用选中的${v.length}个SOP模板吗？`,onOk:()=>{C.success("批量停用成功"),f([]),B()}});break;case"delete":u.confirm({title:"批量删除",content:`确定要删除选中的${v.length}个SOP模板吗？此操作不可恢复。`,okType:"danger",onOk:()=>{C.success("批量删除成功"),f([]),B()}})}else C.warning("请先选择要操作的SOP模板")},G=[{title:"SOP名称",dataIndex:"name",key:"name",width:200,ellipsis:!0,render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:t}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:[i.applicableProjects.slice(0,2).join(", "),i.applicableProjects.length>2&&"..."]})]})},{title:"版本",dataIndex:"version",key:"version",width:100,render:t=>e.jsx(g,{color:"blue",children:t})},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>e.jsx(z,{status:"active"===t?"success":"default",text:"active"===t?"启用":"停用"})},{title:"配置统计",key:"stats",width:120,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["步骤: ",i.stepCount]}),e.jsxs("div",{children:["字段: ",i.fieldCount]}),e.jsxs("div",{children:["质检: ",i.qcRuleCount]})]})},{title:"更新信息",key:"updateInfo",width:150,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{children:i.lastUpdater}),e.jsx("div",{style:{color:"#666"},children:i.updateTime})]})},{title:"操作",key:"action",width:200,render:(t,i)=>e.jsxs(o,{size:"small",children:[e.jsx(Y,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>(e=>{l(`/detection/sop-template/${e.id}`)})(i)})}),e.jsx(Y,{title:"查看",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(Q,{}),onClick:()=>(e=>{l(`/detection/sop-template/${e.id}?mode=view`)})(i)})}),e.jsx(F,{menu:{items:[{key:"copy",label:"复制模板",icon:e.jsx(D,{}),onClick:()=>(e=>{u.confirm({title:"复制SOP模板",content:`确定要复制SOP模板"${e.name}"吗？`,onOk:async()=>{try{C.success("SOP模板复制成功"),B()}catch(e){C.error("复制失败")}}})})(i)},{key:"version",label:"版本管理",icon:e.jsx(X,{}),onClick:()=>(e=>{l(`/detection/sop-version/${e.id}`)})(i)},{type:"divider"},{key:"delete",label:"删除",icon:e.jsx(I,{}),danger:!0,onClick:()=>(async()=>{try{C.success("SOP模板删除成功"),B()}catch(e){C.error("删除失败")}})()}]},trigger:["click"],children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(L,{})})})]})}],M=[{key:"enable",label:"批量启用",onClick:()=>E("enable")},{key:"disable",label:"批量停用",onClick:()=>E("disable")},{type:"divider"},{key:"delete",label:"批量删除",danger:!0,onClick:()=>E("delete")}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(c,{children:[e.jsxs(S,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[e.jsx(w,{children:e.jsx("h2",{style:{margin:0},children:"SOP配置管理"})}),e.jsx(w,{children:e.jsx(o,{children:e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{A(!0)},children:"新建SOP模板"})})})]}),e.jsxs(S,{gutter:16,style:{marginBottom:16},children:[e.jsx(w,{span:8,children:e.jsx(ze,{placeholder:"搜索SOP名称或项目...",allowClear:!0,onSearch:e=>{k(e)},style:{width:"100%"}})}),e.jsx(w,{span:4,children:e.jsxs(j,{placeholder:"状态筛选",allowClear:!0,style:{width:"100%"},value:T,onChange:e=>{R(e)},children:[e.jsx(Ee,{value:"all",children:"全部状态"}),e.jsx(Ee,{value:"active",children:"启用"}),e.jsx(Ee,{value:"inactive",children:"停用"})]})})]}),e.jsx(S,{justify:"space-between",align:"middle",style:{marginBottom:16},children:e.jsx(w,{children:e.jsxs(o,{children:[e.jsx(F,{menu:{items:M},disabled:0===v.length,children:e.jsxs(h,{children:["批量操作 ",v.length>0&&`(${v.length})`]})}),e.jsx(h,{icon:e.jsx(N,{}),onClick:()=>{C.success("SOP列表导出成功")},children:"导出SOP列表"}),e.jsx(h,{icon:e.jsx(O,{}),onClick:()=>{C.info("导入功能开发中")},children:"导入SOP模板"})]})})}),e.jsx(x,{columns:G,dataSource:V,rowKey:"id",loading:s,pagination:{total:V.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条/共 ${e} 条`},rowSelection:{selectedRowKeys:v,onChange:f,preserveSelectedRowKeys:!0},scroll:{x:1e3}})]}),e.jsx(u,{title:"新建SOP模板",open:q,onCancel:()=>{A(!1),P.resetFields()},onOk:()=>P.submit(),width:600,children:e.jsxs(d,{form:P,layout:"vertical",onFinish:async e=>{try{C.success("SOP模板创建成功"),A(!1),P.resetFields(),B()}catch(t){C.error("创建失败")}},children:[e.jsx(d.Item,{name:"name",label:"模板名称",rules:[{required:!0,message:"请输入模板名称"}],children:e.jsx(p,{placeholder:"请输入SOP模板名称"})}),e.jsx(d.Item,{name:"description",label:"模板描述",rules:[{required:!0,message:"请输入模板描述"}],children:e.jsx(p.TextArea,{rows:3,placeholder:"请输入SOP模板描述"})}),e.jsx(d.Item,{name:"applicableProjects",label:"适用项目",rules:[{required:!0,message:"请选择适用项目"}],children:e.jsx(j,{mode:"multiple",placeholder:"请选择适用的检测项目",options:[{label:"肿瘤测序项目A",value:"肿瘤测序项目A"},{label:"肿瘤测序项目B",value:"肿瘤测序项目B"},{label:"病原检测项目",value:"病原检测项目"},{label:"遗传病筛查项目A",value:"遗传病筛查项目A"},{label:"遗传病筛查项目B",value:"遗传病筛查项目B"},{label:"新生儿筛查",value:"新生儿筛查"},{label:"药物基因组学项目",value:"药物基因组学项目"},{label:"新冠检测项目",value:"新冠检测项目"}]})})]})})]})},{Option:Le}=j,{TextArea:Ge}=p,Qe=()=>{const{templateId:n}=l(),r=i(),[a]=s(),v="view"===a.get("mode"),[b,T]=t.useState(!1),[P,N]=t.useState(!1),[V,G]=t.useState(null),[Q,D]=t.useState(!1),[$,_]=t.useState(null),[U,K]=t.useState(!1),[H,J]=t.useState(!1),[X,se]=t.useState(null),[ne,re]=t.useState(!1),[ae,de]=t.useState(null),[ce]=d.useForm(),[oe,he]=t.useState(!1),[me,xe]=t.useState(null),[ue]=d.useForm(),[pe]=d.useForm(),[je]=d.useForm();t.useEffect(()=>{n&&ge(n)},[n]);const ge=async e=>{T(!0);try{const t={id:e,name:"肿瘤基因检测",version:"v2.1",status:"active",applicableProjects:["肿瘤测序项目A","肿瘤测序项目B"],description:"用于肿瘤相关基因突变的检测流程，包含从样本接收到报告生成的完整流程",creator:"张三",createTime:"2024-03-15",lastUpdater:"李四",updateTime:"2024-05-20",steps:[{id:"1",name:"样本接收",type:"info_record",description:"接收并登记样本信息，检查样本质量",isRequired:!0,estimatedTime:30,sortOrder:1,hasQualityControl:!0,fieldCount:8,qcRuleCount:3},{id:"2",name:"核酸提取",type:"experiment",description:"从样本中提取高质量的核酸",isRequired:!0,estimatedTime:90,sortOrder:2,hasQualityControl:!0,fieldCount:12,qcRuleCount:5},{id:"3",name:"文库构建",type:"experiment",description:"构建测序文库，进行PCR扩增",isRequired:!0,estimatedTime:180,sortOrder:3,hasQualityControl:!0,fieldCount:15,qcRuleCount:4},{id:"4",name:"测序",type:"instrument",description:"使用测序仪进行高通量测序",isRequired:!0,estimatedTime:1440,sortOrder:4,hasQualityControl:!0,fieldCount:6,qcRuleCount:2},{id:"5",name:"数据分析",type:"data_analysis",description:"对测序数据进行质控、比对、变异检测等分析",isRequired:!0,estimatedTime:240,sortOrder:5,hasQualityControl:!0,fieldCount:10,qcRuleCount:6},{id:"6",name:"报告生成",type:"report",description:"根据分析结果生成检测报告",isRequired:!0,estimatedTime:60,sortOrder:6,hasQualityControl:!1,fieldCount:5,qcRuleCount:0}]};G(t),pe.setFieldsValue({name:t.name,status:t.status,applicableProjects:t.applicableProjects,description:t.description})}catch(t){C.error("加载SOP模板详情失败")}finally{T(!1)}},ye=e=>{if(X){const t=X.qualityControlPoints.map(t=>({...t,isActive:e}));se({...X,qualityControlPoints:t}),C.success(`已${e?"启用":"禁用"}所有质量控制点`)}},ve=(e,t)=>{if(!V)return;const i=[...V.steps],l=i.findIndex(t=>t.id===e.id);"up"===t&&l>0?[i[l],i[l-1]]=[i[l-1],i[l]]:"down"===t&&l<i.length-1&&([i[l],i[l+1]]=[i[l+1],i[l]]),i.forEach((e,t)=>{e.sortOrder=t+1}),G({...V,steps:i})},Ie=[{label:"信息记录",value:"info_record"},{label:"实验操作",value:"experiment"},{label:"仪器操作",value:"instrument"},{label:"数据分析",value:"data_analysis"},{label:"报告输出",value:"report"}],Ce={info_record:"blue",experiment:"green",instrument:"orange",data_analysis:"purple",report:"red"},fe=[{label:"文本",value:"text"},{label:"数字",value:"number"},{label:"日期",value:"date"},{label:"文件",value:"file"},{label:"下拉选择",value:"select"},{label:"文本域",value:"textarea"},{label:"复选框",value:"checkbox"}],be=[{label:"手动检查",value:"manual"},{label:"自动检查",value:"automatic"},{label:"半自动检查",value:"semi-automatic"}],Se=[{label:"数值范围",value:"range"},{label:"枚举值",value:"enum"},{label:"公式计算",value:"formula"},{label:"文件检查",value:"file"},{label:"目视检查",value:"visual"}],we=[{label:"信息",value:"info"},{label:"警告",value:"warning"},{label:"错误",value:"error"}],ke=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,t,i)=>i+1},{title:"字段名称",dataIndex:"name",key:"name",width:150,render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:t}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:i.identifier})]})},{title:"类型",dataIndex:"type",key:"type",width:100,render:t=>{const i=fe.find(e=>e.value===t);return e.jsx(g,{children:(null==i?void 0:i.label)||t})}},{title:"必填",dataIndex:"isRequired",key:"isRequired",width:80,render:t=>e.jsx(g,{color:t?"success":"default",children:t?"是":"否"})},{title:"默认值",dataIndex:"defaultValue",key:"defaultValue",width:120,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[t&&e.jsx("div",{children:t}),i.unit&&e.jsxs("div",{style:{color:"#666"},children:["单位: ",i.unit]})]})},{title:"高级选项",key:"advanced",width:120,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[i.showInQuickPanel&&e.jsx(g,{size:"small",children:"快速面板"}),i.allowBatchEdit&&e.jsx(g,{size:"small",children:"批量编辑"}),i.participateValidation&&e.jsx(g,{size:"small",children:"数据验证"}),i.generateReport&&e.jsx(g,{size:"small",children:"统计报表"})]})},{title:"操作",key:"action",width:120,render:(t,i)=>e.jsxs(o,{size:"small",children:[e.jsx(Y,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return de(e=i),ce.setFieldsValue(e),void re(!0);var e}})}),e.jsx(Y,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>{return e=i,void u.confirm({title:"删除字段",content:`确定要删除字段"${e.name}"吗？`,onOk:()=>{if(X){const t=X.fields.filter(t=>t.id!==e.id);se({...X,fields:t}),C.success("字段删除成功")}}});var e}})})]})}],Te=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,t,i)=>i+1},{title:"控制点名称",dataIndex:"name",key:"name",width:150,render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:t}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:i.description})]})},{title:"类型",dataIndex:"type",key:"type",width:120,render:(t,i)=>{var l,s;return e.jsxs("div",{children:[e.jsx(g,{color:"automatic"===t?"blue":"manual"===t?"green":"orange",children:(null==(l=be.find(e=>e.value===t))?void 0:l.label)||t}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:null==(s=Se.find(e=>e.value===i.checkType))?void 0:s.label})]})}},{title:"检查规则",dataIndex:"checkRule",key:"checkRule",width:200,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{children:t}),i.triggerCondition&&e.jsxs("div",{style:{color:"#666",marginTop:4},children:["触发条件: ",i.triggerCondition]})]})},{title:"状态",dataIndex:"isActive",key:"isActive",width:100,render:(t,i)=>e.jsxs("div",{children:[e.jsx(g,{color:t?"success":"default",children:t?"启用":"禁用"}),i.isRequired&&e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:"必检项"})]})},{title:"通知级别",dataIndex:"notificationLevel",key:"notificationLevel",width:100,render:t=>{var i;return e.jsx(g,{color:{info:"blue",warning:"orange",error:"red"}[t],children:(null==(i=we.find(e=>e.value===t))?void 0:i.label)||t})}},{title:"操作",key:"action",width:150,render:(t,i)=>e.jsxs(o,{size:"small",children:[e.jsx(Y,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return xe(e=i),ue.setFieldsValue(e),void he(!0);var e}})}),e.jsx(Y,{title:i.isActive?"禁用":"启用",children:e.jsx(h,{type:"link",size:"small",icon:i.isActive?e.jsx(le,{}):e.jsx(W,{}),onClick:()=>(e=>{if(X){const t=X.qualityControlPoints.map(t=>t.id===e.id?{...t,isActive:!t.isActive}:t);se({...X,qualityControlPoints:t}),C.success("质量控制点已"+(e.isActive?"禁用":"启用"))}})(i)})}),e.jsx(Y,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>{return e=i,void u.confirm({title:"删除质量控制点",content:`确定要删除质量控制点"${e.name}"吗？`,onOk:()=>{if(X){const t=X.qualityControlPoints.filter(t=>t.id!==e.id);se({...X,qualityControlPoints:t}),C.success("质量控制点删除成功")}}});var e}})})]})}],Re=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(t,i,l)=>e.jsxs(o,{children:[e.jsx("span",{children:l+1}),!v&&e.jsxs(o,{direction:"vertical",size:0,children:[e.jsx(h,{type:"text",size:"small",icon:e.jsx(te,{}),disabled:0===l,onClick:()=>ve(i,"up")}),e.jsx(h,{type:"text",size:"small",icon:e.jsx(ie,{}),disabled:l===((null==V?void 0:V.steps.length)||0)-1,onClick:()=>ve(i,"down")})]})]})},{title:"步骤名称",dataIndex:"name",key:"name",width:150,render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:t}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["预计 ",i.estimatedTime," 分钟"]})]})},{title:"步骤类型",dataIndex:"type",key:"type",width:100,render:t=>{const i=Ie.find(e=>e.value===t);return e.jsx(g,{color:Ce[t],children:(null==i?void 0:i.label)||t})}},{title:"必填",dataIndex:"isRequired",key:"isRequired",width:80,render:t=>e.jsx(z,{status:t?"success":"default",text:t?"是":"否"})},{title:"配置统计",key:"stats",width:100,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["字段: ",i.fieldCount]}),e.jsxs("div",{children:["质检: ",i.qcRuleCount]})]})},{title:"质量控制",dataIndex:"hasQualityControl",key:"hasQualityControl",width:100,render:t=>e.jsx(z,{status:t?"processing":"default",text:t?"启用":"关闭"})},{title:"操作",key:"action",width:150,render:(t,i)=>e.jsxs(o,{size:"small",children:[e.jsx(Y,{title:"配置字段",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(M,{}),onClick:()=>(e=>{const t={id:e.id,name:e.name,description:e.description,estimatedTime:e.estimatedTime,sortOrder:e.sortOrder,hasQualityControl:e.qcRuleCount>0,fields:[{id:"1",name:"操作人员",identifier:"operator",type:"text",isRequired:!0,placeholder:"请输入操作人员姓名",sortOrder:1,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!1,generateReport:!0},{id:"2",name:"提取方法",identifier:"extraction_method",type:"select",isRequired:!0,defaultValue:"磁珠法",options:["磁珠法","酚氯仿法","柱式法","其他"],placeholder:"请选择核酸提取方法",helpText:"根据样本类型和下游应用选择合适的提取方法",sortOrder:2,showInQuickPanel:!0,allowBatchEdit:!0,participateValidation:!0,generateReport:!0},{id:"3",name:"样本浓度",identifier:"concentration",type:"number",isRequired:!0,unit:"ng/μl",placeholder:"请输入样本浓度",validationRule:">0",sortOrder:3,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!0,generateReport:!0}],qualityControlPoints:[]};se(t),K(!0)})(i)})}),e.jsx(Y,{title:"质量控制",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(W,{}),onClick:()=>(e=>{const t={id:e.id,name:e.name,description:e.description,estimatedTime:e.estimatedTime,sortOrder:e.sortOrder,hasQualityControl:e.qcRuleCount>0,fields:[],qualityControlPoints:[{id:"1",name:"浓度检查",type:"automatic",checkType:"range",description:"检查核酸浓度是否在合理范围内",isRequired:!0,triggerCondition:"提取完成后",checkRule:"浓度 >= 10 ng/μl",warningThreshold:20,errorThreshold:10,autoCorrection:!1,notificationLevel:"error",relatedFields:["concentration"],sortOrder:1,isActive:!0},{id:"2",name:"纯度检查",type:"automatic",checkType:"range",description:"检查核酸纯度（260/280比值）",isRequired:!0,triggerCondition:"浓度检查通过后",checkRule:"1.8 <= 260/280 <= 2.2",warningThreshold:1.7,errorThreshold:1.5,autoCorrection:!1,notificationLevel:"warning",relatedFields:["ratio_260_280"],sortOrder:2,isActive:!0}]};se(t),J(!0)})(i)})}),!v&&e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return _(e=i),je.setFieldsValue(e),void D(!0);var e}})}),e.jsx(Y,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>handleDeleteStep(i)})})]})]})}];return b?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):V?e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(S,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(w,{children:e.jsxs(o,{children:[e.jsx(h,{icon:e.jsx(f,{}),onClick:()=>{r("../sop-config")},children:"返回列表"}),e.jsxs("h2",{style:{margin:0},children:["SOP模板: ",V.name," ",V.version]})]})}),e.jsx(w,{children:e.jsxs(o,{children:[!v&&e.jsx(h,{type:"primary",icon:e.jsx(A,{}),loading:P,onClick:()=>pe.submit(),children:"保存"}),e.jsx(F,{menu:{items:[{key:"version",label:"版本管理",icon:e.jsx(Z,{})},{key:"export",label:"导出模板",icon:e.jsx(R,{})}]},children:e.jsx(h,{icon:e.jsx(L,{}),children:"更多"})})]})})]}),e.jsx(c,{title:"模板基本信息",style:{marginBottom:24},children:e.jsxs(d,{form:pe,layout:"vertical",onFinish:async e=>{N(!0);try{C.success("SOP模板保存成功"),V&&G({...V,...e,updateTime:(new Date).toISOString().split("T")[0],lastUpdater:"当前用户"})}catch(t){C.error("保存失败")}finally{N(!1)}},disabled:v,children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"name",label:"模板名称",rules:[{required:!0,message:"请输入模板名称"}],children:e.jsx(p,{placeholder:"请输入SOP模板名称"})})}),e.jsx(w,{span:4,children:e.jsx(d.Item,{label:"版本号",children:e.jsx(p,{value:V.version,disabled:!0})})}),e.jsx(w,{span:4,children:e.jsx(d.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请选择状态"}],children:e.jsxs(j,{children:[e.jsx(Le,{value:"active",children:"启用"}),e.jsx(Le,{value:"inactive",children:"停用"})]})})})]}),e.jsx(S,{gutter:16,children:e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"applicableProjects",label:"适用项目",rules:[{required:!0,message:"请选择适用项目"}],children:e.jsx(j,{mode:"multiple",placeholder:"请选择适用的检测项目",options:[{label:"肿瘤测序项目A",value:"肿瘤测序项目A"},{label:"肿瘤测序项目B",value:"肿瘤测序项目B"},{label:"病原检测项目",value:"病原检测项目"},{label:"遗传病筛查项目A",value:"遗传病筛查项目A"},{label:"遗传病筛查项目B",value:"遗传病筛查项目B"},{label:"新生儿筛查",value:"新生儿筛查"},{label:"药物基因组学项目",value:"药物基因组学项目"},{label:"新冠检测项目",value:"新冠检测项目"}]})})})}),e.jsx(S,{gutter:16,children:e.jsx(w,{span:16,children:e.jsx(d.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入模板描述"}],children:e.jsx(Ge,{rows:3,placeholder:"请输入SOP模板描述"})})})}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:6,children:e.jsx(d.Item,{label:"创建人",children:e.jsx(p,{value:V.creator,disabled:!0})})}),e.jsx(w,{span:6,children:e.jsx(d.Item,{label:"创建时间",children:e.jsx(p,{value:V.createTime,disabled:!0})})}),e.jsx(w,{span:6,children:e.jsx(d.Item,{label:"最后更新",children:e.jsx(p,{value:V.lastUpdater,disabled:!0})})}),e.jsx(w,{span:6,children:e.jsx(d.Item,{label:"更新时间",children:e.jsx(p,{value:V.updateTime,disabled:!0})})})]})]})}),e.jsx(c,{title:"实验步骤配置",extra:!v&&e.jsxs(o,{children:[e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{_(null),je.resetFields(),D(!0)},children:"添加步骤"}),e.jsx(h,{icon:e.jsx(O,{}),onClick:()=>{C.info("导入步骤模板功能开发中")},children:"导入步骤模板"})]}),children:e.jsx(x,{columns:Re,dataSource:V.steps,rowKey:"id",pagination:!1,scroll:{x:800}})}),e.jsx(u,{title:$?"编辑步骤":"添加步骤",open:Q,onCancel:()=>{D(!1),je.resetFields()},onOk:()=>je.submit(),width:600,children:e.jsxs(d,{form:je,layout:"vertical",onFinish:async e=>{try{if($){if(V){const t=V.steps.map(t=>t.id===$.id?{...t,...e}:t);G({...V,steps:t})}C.success("步骤更新成功")}else{const t={id:Date.now().toString(),...e,sortOrder:V?V.steps.length+1:1,fieldCount:0,qcRuleCount:0};V&&G({...V,steps:[...V.steps,t]}),C.success("步骤添加成功")}D(!1),je.resetFields()}catch(t){C.error("操作失败")}},children:[e.jsx(d.Item,{name:"name",label:"步骤名称",rules:[{required:!0,message:"请输入步骤名称"}],children:e.jsx(p,{placeholder:"请输入步骤名称"})}),e.jsx(d.Item,{name:"type",label:"步骤类型",rules:[{required:!0,message:"请选择步骤类型"}],children:e.jsx(j,{placeholder:"请选择步骤类型",options:Ie})}),e.jsx(d.Item,{name:"description",label:"步骤描述",rules:[{required:!0,message:"请输入步骤描述"}],children:e.jsx(Ge,{rows:3,placeholder:"请输入步骤描述"})}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"estimatedTime",label:"预计耗时（分钟）",rules:[{required:!0,message:"请输入预计耗时"}],children:e.jsx(p,{type:"number",placeholder:"请输入预计耗时"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"isRequired",label:"是否必填",valuePropName:"checked",children:e.jsx(q,{})})})]}),e.jsx(d.Item,{name:"hasQualityControl",label:"启用质量控制",valuePropName:"checked",children:e.jsx(q,{})})]})}),e.jsx(B,{title:`配置字段 - ${(null==X?void 0:X.name)||""}`,placement:"right",width:1200,open:U,onClose:()=>K(!1),extra:e.jsxs(o,{children:[e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{de(null),ce.resetFields(),re(!0)},children:"添加字段"}),e.jsx(h,{onClick:()=>{C.info("批量编辑功能开发中")},children:"批量编辑"}),e.jsx(h,{onClick:()=>{C.success("配置验证通过")},children:"验证配置"})]}),children:X&&e.jsxs("div",{children:[e.jsxs(c,{title:"步骤基本信息",style:{marginBottom:24},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsxs("div",{children:[e.jsx("strong",{children:"步骤名称："}),X.name]})}),e.jsx(w,{span:8,children:e.jsxs("div",{children:[e.jsx("strong",{children:"预计耗时："}),X.estimatedTime," 分钟"]})}),e.jsx(w,{span:8,children:e.jsxs("div",{children:[e.jsx("strong",{children:"排序："}),X.sortOrder]})})]}),e.jsx(S,{gutter:16,style:{marginTop:16},children:e.jsx(w,{span:24,children:e.jsxs("div",{children:[e.jsx("strong",{children:"步骤描述："}),X.description]})})})]}),e.jsx(c,{title:"字段配置",children:e.jsx(x,{columns:ke,dataSource:X.fields,rowKey:"id",pagination:!1,scroll:{x:1e3}})})]})}),e.jsx(B,{title:`质量控制 - ${(null==X?void 0:X.name)||""}`,placement:"right",width:1200,open:H,onClose:()=>J(!1),extra:e.jsxs(o,{children:[e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{xe(null),ue.resetFields(),he(!0)},children:"添加质量控制点"}),e.jsx(h,{onClick:()=>ye(!0),children:"批量启用"}),e.jsx(h,{onClick:()=>ye(!1),children:"批量禁用"}),e.jsx(h,{onClick:()=>{C.success("质量控制规则测试通过")},children:"测试规则"})]}),children:X&&e.jsxs("div",{children:[e.jsx(c,{title:"质量控制概览",style:{marginBottom:24},children:e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:X.qualityControlPoints.length}),e.jsx("div",{children:"总控制点"})]})}),e.jsx(w,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:X.qualityControlPoints.filter(e=>e.isActive).length}),e.jsx("div",{children:"已启用"})]})}),e.jsx(w,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#faad14"},children:X.qualityControlPoints.filter(e=>e.isRequired).length}),e.jsx("div",{children:"必检项"})]})}),e.jsx(w,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#f5222d"},children:X.qualityControlPoints.filter(e=>"automatic"===e.type).length}),e.jsx("div",{children:"自动检查"})]})})]})}),e.jsx(c,{title:"质量控制点配置",children:e.jsx(x,{columns:Te,dataSource:X.qualityControlPoints,rowKey:"id",pagination:!1,scroll:{x:1200}})})]})}),e.jsx(u,{title:ae?"编辑字段":"添加字段",open:ne,onCancel:()=>{re(!1),ce.resetFields()},onOk:()=>ce.submit(),width:800,children:e.jsxs(d,{form:ce,layout:"vertical",onFinish:async e=>{try{if(ae){if(X){const t=X.fields.map(t=>t.id===ae.id?{...t,...e}:t);se({...X,fields:t})}C.success("字段更新成功")}else{const t={id:Date.now().toString(),...e,sortOrder:X?X.fields.length+1:1,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!1};X&&se({...X,fields:[...X.fields,t]}),C.success("字段添加成功")}re(!1),ce.resetFields()}catch(t){C.error("操作失败")}},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"name",label:"字段名称",rules:[{required:!0,message:"请输入字段名称"}],children:e.jsx(p,{placeholder:"请输入字段名称"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"identifier",label:"字段标识",rules:[{required:!0,message:"请输入字段标识"}],children:e.jsx(p,{placeholder:"请输入字段标识（英文）"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"type",label:"字段类型",rules:[{required:!0,message:"请选择字段类型"}],children:e.jsx(j,{placeholder:"请选择字段类型",options:fe})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"isRequired",label:"是否必填",valuePropName:"checked",children:e.jsx(q,{})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"显示顺序",children:e.jsx(k,{min:1,style:{width:"100%"}})})})]}),e.jsx(E,{children:"字段属性配置"}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"defaultValue",label:"默认值",children:e.jsx(p,{placeholder:"请输入默认值"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"unit",label:"单位",children:e.jsx(p,{placeholder:"请输入单位"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"placeholder",label:"提示文本",children:e.jsx(p,{placeholder:"请输入提示文本"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"validationRule",label:"验证规则",children:e.jsx(p,{placeholder:"如：>0, 1.8-2.2"})})})]}),e.jsx(d.Item,{name:"helpText",label:"帮助文本",children:e.jsx(Ge,{rows:2,placeholder:"请输入帮助文本"})}),e.jsx(d.Item,{noStyle:!0,shouldUpdate:(e,t)=>e.type!==t.type,children:({getFieldValue:t})=>"select"===t("type")?e.jsx(d.Item,{name:"options",label:"下拉选项",rules:[{required:!0,message:"请输入下拉选项"}],children:e.jsx(j,{mode:"tags",placeholder:"请输入选项，按回车添加",style:{width:"100%"}})}):null}),e.jsx(E,{children:"高级选项"}),e.jsxs(S,{gutter:16,children:[e.jsxs(w,{span:12,children:[e.jsx(d.Item,{name:"showInQuickPanel",label:"在快速记录面板显示",valuePropName:"checked",children:e.jsx(ee,{})}),e.jsx(d.Item,{name:"allowBatchEdit",label:"允许批量编辑",valuePropName:"checked",children:e.jsx(ee,{})})]}),e.jsxs(w,{span:12,children:[e.jsx(d.Item,{name:"participateValidation",label:"参与数据验证",valuePropName:"checked",children:e.jsx(ee,{})}),e.jsx(d.Item,{name:"generateReport",label:"生成统计报表",valuePropName:"checked",children:e.jsx(ee,{})})]})]})]})}),e.jsx(u,{title:me?"编辑质量控制点":"添加质量控制点",open:oe,onCancel:()=>{he(!1),ue.resetFields()},onOk:()=>ue.submit(),width:800,children:e.jsxs(d,{form:ue,layout:"vertical",onFinish:async e=>{try{if(me){if(X){const t=X.qualityControlPoints.map(t=>t.id===me.id?{...t,...e}:t);se({...X,qualityControlPoints:t})}C.success("质量控制点更新成功")}else{const t={id:Date.now().toString(),...e,sortOrder:X?X.qualityControlPoints.length+1:1,isActive:!0,relatedFields:e.relatedFields||[]};X&&se({...X,qualityControlPoints:[...X.qualityControlPoints,t]}),C.success("质量控制点添加成功")}he(!1),ue.resetFields()}catch(t){C.error("操作失败")}},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"name",label:"控制点名称",rules:[{required:!0,message:"请输入控制点名称"}],children:e.jsx(p,{placeholder:"请输入控制点名称"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"type",label:"检查类型",rules:[{required:!0,message:"请选择检查类型"}],children:e.jsx(j,{placeholder:"请选择检查类型",options:be})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"checkType",label:"检查方式",rules:[{required:!0,message:"请选择检查方式"}],children:e.jsx(j,{placeholder:"请选择检查方式",options:Se})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"notificationLevel",label:"通知级别",rules:[{required:!0,message:"请选择通知级别"}],children:e.jsx(j,{placeholder:"请选择通知级别",options:we})})})]}),e.jsx(d.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入描述"}],children:e.jsx(Ge,{rows:2,placeholder:"请输入质量控制点描述"})}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"triggerCondition",label:"触发条件",rules:[{required:!0,message:"请输入触发条件"}],children:e.jsx(p,{placeholder:"如：提取完成后"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"checkRule",label:"检查规则",rules:[{required:!0,message:"请输入检查规则"}],children:e.jsx(p,{placeholder:"如：浓度 >= 10 ng/μl"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"warningThreshold",label:"警告阈值",children:e.jsx(k,{style:{width:"100%"},placeholder:"警告阈值"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"errorThreshold",label:"错误阈值",children:e.jsx(k,{style:{width:"100%"},placeholder:"错误阈值"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"显示顺序",children:e.jsx(k,{min:1,style:{width:"100%"}})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"isRequired",label:"是否必检",valuePropName:"checked",children:e.jsx(q,{})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"autoCorrection",label:"自动纠正",valuePropName:"checked",children:e.jsx(q,{})})})]}),e.jsx(d.Item,{name:"relatedFields",label:"关联字段",children:e.jsx(j,{mode:"multiple",placeholder:"请选择关联字段",options:(null==X?void 0:X.fields.map(e=>({label:e.name,value:e.identifier})))||[]})})]})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"SOP模板不存在"})},{Option:De}=j,{TextArea:Me}=p,$e=()=>{const{stepId:s}=l(),n=i(),[r,a]=t.useState(!1),[v,b]=t.useState(!1),[P,O]=t.useState(null),[N,B]=t.useState(!1),[V,z]=t.useState(null),[F]=d.useForm(),[L]=d.useForm();t.useEffect(()=>{s&&G(s)},[s]);const G=async e=>{a(!0);try{const t={id:e,name:"核酸提取",description:"从样本中提取高质量的核酸，确保后续实验的成功进行",estimatedTime:90,sortOrder:2,hasQualityControl:!0,sopDocument:"SOP-DNA-001.pdf",fields:[{id:"1",name:"操作人员",identifier:"operator",type:"text",isRequired:!0,placeholder:"请输入操作人员姓名",sortOrder:1,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!1,generateReport:!0},{id:"2",name:"提取方法",identifier:"extraction_method",type:"select",isRequired:!0,defaultValue:"磁珠法",options:["磁珠法","酚氯仿法","柱式法","其他"],placeholder:"请选择核酸提取方法",helpText:"根据样本类型和下游应用选择合适的提取方法",sortOrder:2,showInQuickPanel:!0,allowBatchEdit:!0,participateValidation:!0,generateReport:!0},{id:"3",name:"试剂盒",identifier:"reagent_kit",type:"select",isRequired:!0,options:["QIAamp DNA Mini Kit","DNeasy Blood & Tissue Kit","MagMAX DNA Multi-Sample Kit"],placeholder:"请选择使用的试剂盒",sortOrder:3,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!0,generateReport:!0},{id:"4",name:"样本浓度",identifier:"concentration",type:"number",isRequired:!0,unit:"ng/μl",placeholder:"请输入样本浓度",validationRule:">0",sortOrder:4,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!0,generateReport:!0},{id:"5",name:"260/280",identifier:"ratio_260_280",type:"number",isRequired:!0,placeholder:"请输入260/280比值",validationRule:"1.8-2.2",sortOrder:5,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!0,generateReport:!0},{id:"6",name:"体积",identifier:"volume",type:"number",isRequired:!0,defaultValue:"50",unit:"μl",placeholder:"请输入体积",sortOrder:6,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!1,generateReport:!0},{id:"7",name:"裂解时间",identifier:"lysis_time",type:"number",isRequired:!0,defaultValue:"30",unit:"分钟",placeholder:"请输入裂解时间",sortOrder:7,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!1,generateReport:!1},{id:"8",name:"温度",identifier:"temperature",type:"number",isRequired:!0,defaultValue:"56",unit:"°C",placeholder:"请输入温度",sortOrder:8,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!1,generateReport:!1},{id:"9",name:"电泳图",identifier:"electrophoresis_image",type:"file",isRequired:!1,placeholder:"请上传电泳图",helpText:"支持JPG、PNG、PDF格式",sortOrder:9,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!0},{id:"10",name:"备注",identifier:"remarks",type:"textarea",isRequired:!1,placeholder:"请输入备注信息",sortOrder:10,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!0}]};O(t),F.setFieldsValue({name:t.name,description:t.description,estimatedTime:t.estimatedTime,sortOrder:t.sortOrder,hasQualityControl:t.hasQualityControl})}catch(t){C.error("加载步骤详情失败")}finally{a(!1)}},Q=[{label:"文本",value:"text"},{label:"数字",value:"number"},{label:"日期",value:"date"},{label:"文件",value:"file"},{label:"下拉选择",value:"select"},{label:"文本域",value:"textarea"},{label:"复选框",value:"checkbox"}],D=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,t,i)=>i+1},{title:"字段名称",dataIndex:"name",key:"name",width:150,render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:t}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:i.identifier})]})},{title:"类型",dataIndex:"type",key:"type",width:100,render:t=>{const i=Q.find(e=>e.value===t);return e.jsx(g,{children:(null==i?void 0:i.label)||t})}},{title:"必填",dataIndex:"isRequired",key:"isRequired",width:80,render:t=>e.jsx(g,{color:t?"success":"default",children:t?"是":"否"})},{title:"默认值",dataIndex:"defaultValue",key:"defaultValue",width:120,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[t&&e.jsx("div",{children:t}),i.unit&&e.jsxs("div",{style:{color:"#666"},children:["单位: ",i.unit]})]})},{title:"高级选项",key:"advanced",width:120,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[i.showInQuickPanel&&e.jsx(g,{size:"small",children:"快速面板"}),i.allowBatchEdit&&e.jsx(g,{size:"small",children:"批量编辑"}),i.participateValidation&&e.jsx(g,{size:"small",children:"数据验证"}),i.generateReport&&e.jsx(g,{size:"small",children:"统计报表"})]})},{title:"操作",key:"action",width:120,render:(t,i)=>e.jsxs(o,{size:"small",children:[e.jsx(Y,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return z(e=i),L.setFieldsValue(e),void B(!0);var e}})}),e.jsx(Y,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>{return e=i,void u.confirm({title:"删除字段",content:`确定要删除字段"${e.name}"吗？`,onOk:()=>{if(P){const t=P.fields.filter(t=>t.id!==e.id);O({...P,fields:t}),C.success("字段删除成功")}}});var e}})})]})}];return r?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):P?e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(S,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(w,{children:e.jsxs(o,{children:[e.jsx(h,{icon:e.jsx(f,{}),onClick:()=>{n(-1)},children:"返回"}),e.jsxs("h2",{style:{margin:0},children:["步骤字段配置 - ",P.name]})]})}),e.jsx(w,{children:e.jsx(o,{children:e.jsx(h,{type:"primary",icon:e.jsx(A,{}),loading:v,onClick:()=>F.submit(),children:"保存"})})})]}),e.jsx(c,{title:"步骤基本信息",style:{marginBottom:24},children:e.jsxs(d,{form:F,layout:"vertical",onFinish:async e=>{b(!0);try{C.success("步骤配置保存成功"),P&&O({...P,...e})}catch(t){C.error("保存失败")}finally{b(!1)}},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"name",label:"步骤名称",rules:[{required:!0,message:"请输入步骤名称"}],children:e.jsx(p,{placeholder:"请输入步骤名称"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"estimatedTime",label:"预计耗时（分钟）",rules:[{required:!0,message:"请输入预计耗时"}],children:e.jsx(k,{min:1,style:{width:"100%"},placeholder:"请输入预计耗时"})})}),e.jsx(w,{span:4,children:e.jsx(d.Item,{name:"sortOrder",label:"排序",rules:[{required:!0,message:"请输入排序"}],children:e.jsx(k,{min:1,style:{width:"100%"},placeholder:"排序"})})}),e.jsx(w,{span:4,children:e.jsx(d.Item,{name:"hasQualityControl",label:"质量控制点",valuePropName:"checked",children:e.jsx(q,{})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:16,children:e.jsx(d.Item,{name:"description",label:"步骤描述",rules:[{required:!0,message:"请输入步骤描述"}],children:e.jsx(Me,{rows:3,placeholder:"请输入步骤描述"})})}),e.jsx(w,{span:8,children:e.jsxs(d.Item,{label:"SOP参考文档",children:[e.jsx(T,{children:e.jsx(h,{icon:e.jsx(R,{}),children:"选择文件"})}),P.sopDocument&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(Z,{})," ",P.sopDocument]})]})})]})]})}),e.jsx(c,{title:"字段配置",extra:e.jsxs(o,{children:[e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{z(null),L.resetFields(),B(!0)},children:"添加字段"}),e.jsx(h,{onClick:()=>{C.info("批量编辑功能开发中")},children:"批量编辑"}),e.jsx(h,{onClick:()=>{C.success("配置验证通过")},children:"验证配置"})]}),children:e.jsx(x,{columns:D,dataSource:P.fields,rowKey:"id",pagination:!1,scroll:{x:1e3}})}),e.jsx(u,{title:V?"编辑字段":"添加字段",open:N,onCancel:()=>{B(!1),L.resetFields()},onOk:()=>L.submit(),width:800,children:e.jsxs(d,{form:L,layout:"vertical",onFinish:async e=>{try{if(V){if(P){const t=P.fields.map(t=>t.id===V.id?{...t,...e}:t);O({...P,fields:t})}C.success("字段更新成功")}else{const t={id:Date.now().toString(),...e,sortOrder:P?P.fields.length+1:1,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!1};P&&O({...P,fields:[...P.fields,t]}),C.success("字段添加成功")}B(!1),L.resetFields()}catch(t){C.error("操作失败")}},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"name",label:"字段名称",rules:[{required:!0,message:"请输入字段名称"}],children:e.jsx(p,{placeholder:"请输入字段名称"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"identifier",label:"字段标识",rules:[{required:!0,message:"请输入字段标识"}],children:e.jsx(p,{placeholder:"请输入字段标识（英文）"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"type",label:"字段类型",rules:[{required:!0,message:"请选择字段类型"}],children:e.jsx(j,{placeholder:"请选择字段类型",options:Q})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"isRequired",label:"是否必填",valuePropName:"checked",children:e.jsx(q,{})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"显示顺序",children:e.jsx(k,{min:1,style:{width:"100%"}})})})]}),e.jsx(E,{children:"字段属性配置"}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"defaultValue",label:"默认值",children:e.jsx(p,{placeholder:"请输入默认值"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"unit",label:"单位",children:e.jsx(p,{placeholder:"请输入单位"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"placeholder",label:"提示文本",children:e.jsx(p,{placeholder:"请输入提示文本"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"validationRule",label:"验证规则",children:e.jsx(p,{placeholder:"如：>0, 1.8-2.2"})})})]}),e.jsx(d.Item,{name:"helpText",label:"帮助文本",children:e.jsx(Me,{rows:2,placeholder:"请输入帮助文本"})}),e.jsx(d.Item,{noStyle:!0,shouldUpdate:(e,t)=>e.type!==t.type,children:({getFieldValue:t})=>"select"===t("type")?e.jsx(d.Item,{name:"options",label:"下拉选项",rules:[{required:!0,message:"请输入下拉选项"}],children:e.jsx(j,{mode:"tags",placeholder:"请输入选项，按回车添加",style:{width:"100%"}})}):null}),e.jsx(E,{children:"高级选项"}),e.jsxs(S,{gutter:16,children:[e.jsxs(w,{span:12,children:[e.jsx(d.Item,{name:"showInQuickPanel",label:"在快速记录面板显示",valuePropName:"checked",children:e.jsx(ee,{})}),e.jsx(d.Item,{name:"allowBatchEdit",label:"允许批量编辑",valuePropName:"checked",children:e.jsx(ee,{})})]}),e.jsxs(w,{span:12,children:[e.jsx(d.Item,{name:"participateValidation",label:"参与数据验证",valuePropName:"checked",children:e.jsx(ee,{})}),e.jsx(d.Item,{name:"generateReport",label:"生成统计报表",valuePropName:"checked",children:e.jsx(ee,{})})]})]})]})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"步骤不存在"})},{Option:_e}=j,{TextArea:Ue}=p,Ke=()=>{const{stepId:s}=l(),n=i(),[r,a]=t.useState(!1),[v,b]=t.useState(!1),[T,R]=t.useState(null),[P,O]=t.useState(!1),[N,B]=t.useState(null),[V]=d.useForm(),[z]=d.useForm();t.useEffect(()=>{s&&F(s)},[s]);const F=async e=>{a(!0);try{R({stepId:e,stepName:"核酸提取",description:"核酸提取步骤的质量控制配置",overallPassRate:95.8,lastUpdateTime:"2024-01-15 14:30:00",qualityControlPoints:[{id:"1",name:"浓度检查",type:"automatic",checkType:"range",description:"检查核酸浓度是否在合理范围内",isRequired:!0,triggerCondition:"提取完成后",checkRule:"浓度 >= 10 ng/μl",warningThreshold:20,errorThreshold:10,autoCorrection:!1,notificationLevel:"error",relatedFields:["concentration"],sortOrder:1,isActive:!0},{id:"2",name:"纯度检查",type:"automatic",checkType:"range",description:"检查核酸纯度（260/280比值）",isRequired:!0,triggerCondition:"浓度检查通过后",checkRule:"1.8 <= 260/280 <= 2.2",warningThreshold:1.7,errorThreshold:1.5,autoCorrection:!1,notificationLevel:"warning",relatedFields:["ratio_260_280"],sortOrder:2,isActive:!0},{id:"3",name:"体积确认",type:"manual",checkType:"visual",description:"目视确认提取后的核酸体积",isRequired:!0,triggerCondition:"提取完成后",checkRule:"体积 >= 预期体积的80%",autoCorrection:!1,notificationLevel:"warning",relatedFields:["volume"],sortOrder:3,isActive:!0},{id:"4",name:"电泳质量检查",type:"semi-automatic",checkType:"file",description:"通过电泳图检查核酸完整性",isRequired:!1,triggerCondition:"需要时",checkRule:"主带清晰，无明显降解",autoCorrection:!1,notificationLevel:"info",relatedFields:["electrophoresis_image"],sortOrder:4,isActive:!0},{id:"5",name:"试剂有效期检查",type:"automatic",checkType:"formula",description:"检查使用的试剂是否在有效期内",isRequired:!0,triggerCondition:"实验开始前",checkRule:"当前日期 <= 试剂有效期",autoCorrection:!1,notificationLevel:"error",relatedFields:["reagent_kit"],sortOrder:5,isActive:!0}]})}catch(t){C.error("加载质量控制配置失败")}finally{a(!1)}},L=e=>{if(T){const t=T.qualityControlPoints.map(t=>({...t,isActive:e}));R({...T,qualityControlPoints:t}),C.success(`已${e?"启用":"禁用"}所有质量控制点`)}},G=[{label:"手动检查",value:"manual"},{label:"自动检查",value:"automatic"},{label:"半自动检查",value:"semi-automatic"}],Q=[{label:"数值范围",value:"range"},{label:"枚举值",value:"enum"},{label:"公式计算",value:"formula"},{label:"文件检查",value:"file"},{label:"目视检查",value:"visual"}],D=[{label:"信息",value:"info"},{label:"警告",value:"warning"},{label:"错误",value:"error"}],$=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,t,i)=>i+1},{title:"控制点名称",dataIndex:"name",key:"name",width:150,render:(t,i)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:t}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:i.description})]})},{title:"类型",dataIndex:"type",key:"type",width:120,render:(t,i)=>{var l,s;return e.jsxs("div",{children:[e.jsx(g,{color:"automatic"===t?"blue":"manual"===t?"green":"orange",children:null==(l=G.find(e=>e.value===t))?void 0:l.label}),e.jsx("div",{style:{fontSize:"12px",marginTop:4},children:e.jsx(g,{size:"small",children:null==(s=Q.find(e=>e.value===i.checkType))?void 0:s.label})})]})}},{title:"检查规则",dataIndex:"checkRule",key:"checkRule",width:200,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{children:t}),i.triggerCondition&&e.jsxs("div",{style:{color:"#666",marginTop:4},children:["触发条件: ",i.triggerCondition]})]})},{title:"阈值设置",key:"threshold",width:120,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[i.warningThreshold&&e.jsxs("div",{style:{color:"#faad14"},children:[e.jsx(ne,{})," 警告: ",i.warningThreshold]}),i.errorThreshold&&e.jsxs("div",{style:{color:"#ff4d4f"},children:[e.jsx(le,{})," 错误: ",i.errorThreshold]})]})},{title:"状态",key:"status",width:100,render:(t,i)=>e.jsxs("div",{children:[e.jsx(g,{color:i.isActive?"success":"default",children:i.isActive?"启用":"禁用"}),i.isRequired&&e.jsx(g,{size:"small",color:"red",children:"必需"})]})},{title:"通知级别",dataIndex:"notificationLevel",key:"notificationLevel",width:100,render:t=>{var i;return e.jsx(g,{color:{info:"blue",warning:"orange",error:"red"}[t],children:null==(i=D.find(e=>e.value===t))?void 0:i.label})}},{title:"操作",key:"action",width:150,render:(t,i)=>e.jsxs(o,{size:"small",children:[e.jsx(Y,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return B(e=i),z.setFieldsValue(e),void O(!0);var e}})}),e.jsx(Y,{title:i.isActive?"禁用":"启用",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(M,{}),onClick:()=>(e=>{if(T){const t=T.qualityControlPoints.map(t=>t.id===e.id?{...t,isActive:!t.isActive}:t);R({...T,qualityControlPoints:t}),C.success("质量控制点已"+(e.isActive?"禁用":"启用"))}})(i)})}),e.jsx(Y,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>{return e=i,void u.confirm({title:"删除质量控制点",content:`确定要删除质量控制点"${e.name}"吗？`,onOk:()=>{if(T){const t=T.qualityControlPoints.filter(t=>t.id!==e.id);R({...T,qualityControlPoints:t}),C.success("质量控制点删除成功")}}});var e}})})]})}];return r?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):T?e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(S,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(w,{children:e.jsxs(o,{children:[e.jsx(h,{icon:e.jsx(f,{}),onClick:()=>{n(-1)},children:"返回"}),e.jsxs("h2",{style:{margin:0},children:["质量控制点配置 - ",T.stepName]})]})}),e.jsx(w,{children:e.jsxs(o,{children:[e.jsx(h,{onClick:()=>{C.success("质量控制规则测试通过")},children:"测试规则"}),e.jsx(h,{type:"primary",icon:e.jsx(A,{}),loading:v,onClick:async()=>{b(!0);try{C.success("质量控制配置保存成功")}catch(e){C.error("保存失败")}finally{b(!1)}},children:"保存配置"})]})})]}),e.jsxs(c,{title:"质量控制概览",style:{marginBottom:24},children:[e.jsxs(S,{gutter:24,children:[e.jsx(w,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:[T.overallPassRate,"%"]}),e.jsx("div",{style:{color:"#666"},children:"整体通过率"}),e.jsx(se,{percent:T.overallPassRate,showInfo:!1,strokeColor:"#52c41a",style:{marginTop:8}})]})}),e.jsx(w,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:T.qualityControlPoints.filter(e=>e.isActive).length}),e.jsx("div",{style:{color:"#666"},children:"启用的控制点"})]})}),e.jsx(w,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#faad14"},children:T.qualityControlPoints.filter(e=>e.isRequired).length}),e.jsx("div",{style:{color:"#666"},children:"必需控制点"})]})})]}),e.jsx(E,{}),e.jsx(K,{message:"质量控制配置说明",description:`最后更新时间: ${T.lastUpdateTime}。质量控制点按照设定的规则自动或手动检查实验数据，确保实验质量符合标准。`,type:"info",showIcon:!0})]}),e.jsx(c,{title:"质量控制点配置",extra:e.jsxs(o,{children:[e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{B(null),z.resetFields(),O(!0)},children:"添加控制点"}),e.jsx(h,{onClick:()=>L(!0),children:"批量启用"}),e.jsx(h,{onClick:()=>L(!1),children:"批量禁用"})]}),children:e.jsx(x,{columns:$,dataSource:T.qualityControlPoints,rowKey:"id",pagination:!1,scroll:{x:1200}})}),e.jsx(u,{title:N?"编辑质量控制点":"添加质量控制点",open:P,onCancel:()=>{O(!1),z.resetFields()},onOk:()=>z.submit(),width:900,children:e.jsxs(d,{form:z,layout:"vertical",onFinish:async e=>{try{if(N){if(T){const t=T.qualityControlPoints.map(t=>t.id===N.id?{...t,...e}:t);R({...T,qualityControlPoints:t})}C.success("质量控制点更新成功")}else{const t={id:Date.now().toString(),...e,sortOrder:T?T.qualityControlPoints.length+1:1,isActive:!0,relatedFields:e.relatedFields||[]};T&&R({...T,qualityControlPoints:[...T.qualityControlPoints,t]}),C.success("质量控制点添加成功")}O(!1),z.resetFields()}catch(t){C.error("操作失败")}},children:[e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"name",label:"控制点名称",rules:[{required:!0,message:"请输入控制点名称"}],children:e.jsx(p,{placeholder:"请输入控制点名称"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"type",label:"检查类型",rules:[{required:!0,message:"请选择检查类型"}],children:e.jsx(j,{placeholder:"请选择检查类型",options:G})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"checkType",label:"检查方式",rules:[{required:!0,message:"请选择检查方式"}],children:e.jsx(j,{placeholder:"请选择检查方式",options:Q})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"notificationLevel",label:"通知级别",rules:[{required:!0,message:"请选择通知级别"}],children:e.jsx(j,{placeholder:"请选择通知级别",options:D})})})]}),e.jsx(d.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入描述"}],children:e.jsx(Ue,{rows:2,placeholder:"请输入控制点描述"})}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"triggerCondition",label:"触发条件",rules:[{required:!0,message:"请输入触发条件"}],children:e.jsx(p,{placeholder:"如：提取完成后"})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{name:"checkRule",label:"检查规则",rules:[{required:!0,message:"请输入检查规则"}],children:e.jsx(p,{placeholder:"如：浓度 >= 10 ng/μl"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"warningThreshold",label:"警告阈值",children:e.jsx(k,{style:{width:"100%"},placeholder:"警告阈值"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"errorThreshold",label:"错误阈值",children:e.jsx(k,{style:{width:"100%"},placeholder:"错误阈值"})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"排序",children:e.jsx(k,{min:1,style:{width:"100%"},placeholder:"排序"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"isRequired",label:"是否必需",valuePropName:"checked",children:e.jsx(q,{})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"autoCorrection",label:"自动纠正",valuePropName:"checked",children:e.jsx(q,{})})}),e.jsx(w,{span:8,children:e.jsx(d.Item,{name:"isActive",label:"启用状态",valuePropName:"checked",initialValue:!0,children:e.jsx(q,{})})})]}),e.jsx(d.Item,{name:"relatedFields",label:"关联字段",children:e.jsx(j,{mode:"tags",placeholder:"请选择关联的字段",style:{width:"100%"}})})]})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"步骤不存在"})},{Option:He}=j,{TextArea:Ye}=p,We=()=>{const{templateId:s}=l(),n=i(),[r,a]=t.useState(!1),[y,b]=t.useState([]),[k,T]=t.useState(null),[R,q]=t.useState(!1),[A,P]=t.useState(!1),[O,N]=t.useState([]),[B,E]=t.useState([]),[F]=d.useForm();t.useEffect(()=>{s&&L(s)},[s]);const L=async e=>{a(!0);try{const t=[{id:"1",version:"v2.1.0",templateId:e,templateName:"核酸提取SOP模板",status:"active",description:"优化了质量控制点配置，增加了自动化检查功能",changeLog:"1. 新增自动浓度检查\n2. 优化纯度检查规则\n3. 增加试剂有效期验证",createdBy:"张三",createdTime:"2024-01-15 10:30:00",reviewedBy:"李四",reviewedTime:"2024-01-16 14:20:00",approvedBy:"王五",approvedTime:"2024-01-17 09:15:00",activatedTime:"2024-01-17 10:00:00",isCurrentVersion:!0,stepCount:8,fieldCount:25,qcPointCount:5},{id:"2",version:"v2.0.1",templateId:e,templateName:"核酸提取SOP模板",status:"archived",description:"修复了字段验证规则的问题",changeLog:"1. 修复浓度字段验证规则\n2. 更新帮助文档",createdBy:"张三",createdTime:"2024-01-10 16:45:00",reviewedBy:"李四",reviewedTime:"2024-01-11 10:30:00",approvedBy:"王五",approvedTime:"2024-01-11 15:20:00",activatedTime:"2024-01-12 09:00:00",isCurrentVersion:!1,stepCount:8,fieldCount:23,qcPointCount:4},{id:"3",version:"v2.0.0",templateId:e,templateName:"核酸提取SOP模板",status:"archived",description:"重大版本更新，重构了整个流程结构",changeLog:"1. 重构实验步骤\n2. 新增质量控制模块\n3. 优化用户界面",createdBy:"赵六",createdTime:"2024-01-01 09:00:00",reviewedBy:"李四",reviewedTime:"2024-01-02 14:30:00",approvedBy:"王五",approvedTime:"2024-01-03 11:15:00",activatedTime:"2024-01-05 08:30:00",isCurrentVersion:!1,stepCount:7,fieldCount:20,qcPointCount:3},{id:"4",version:"v1.2.0",templateId:e,templateName:"核酸提取SOP模板",status:"deprecated",description:"增加了电泳检查步骤",changeLog:"1. 新增电泳检查步骤\n2. 更新操作说明",createdBy:"张三",createdTime:"2023-12-15 14:20:00",reviewedBy:"李四",reviewedTime:"2023-12-16 10:45:00",approvedBy:"王五",approvedTime:"2023-12-17 16:30:00",activatedTime:"2023-12-18 09:00:00",isCurrentVersion:!1,stepCount:6,fieldCount:18,qcPointCount:2},{id:"5",version:"v2.2.0-beta",templateId:e,templateName:"核酸提取SOP模板",status:"draft",description:"测试版本，增加AI辅助质量控制功能",changeLog:"1. 集成AI质量控制\n2. 智能异常检测\n3. 自动报告生成",createdBy:"张三",createdTime:"2024-01-20 11:15:00",isCurrentVersion:!1,stepCount:9,fieldCount:28,qcPointCount:7}];T({id:e,name:"核酸提取SOP模板",description:"标准核酸提取操作流程模板",currentVersion:"v2.1.0"}),b(t)}catch(t){C.error("加载版本数据失败")}finally{a(!1)}},G={draft:{color:"default",text:"草稿"},review:{color:"processing",text:"审核中"},approved:{color:"success",text:"已批准"},active:{color:"success",text:"活跃"},archived:{color:"warning",text:"已归档"},deprecated:{color:"error",text:"已废弃"}},M=[{title:"版本号",dataIndex:"version",key:"version",width:120,render:(t,i)=>e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:500},children:[t,i.isCurrentVersion&&e.jsx(z,{status:"success",style:{marginLeft:8}})]}),i.isCurrentVersion&&e.jsx(g,{size:"small",color:"green",children:"当前版本"})]})},{title:"状态",dataIndex:"status",key:"status",width:100,render:t=>{const i=G[t];return e.jsx(g,{color:i.color,children:i.text})}},{title:"描述",dataIndex:"description",key:"description",width:200,ellipsis:!0},{title:"统计信息",key:"stats",width:150,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["步骤: ",i.stepCount]}),e.jsxs("div",{children:["字段: ",i.fieldCount]}),e.jsxs("div",{children:["质控点: ",i.qcPointCount]})]})},{title:"创建信息",key:"createInfo",width:150,render:(t,i)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["创建人: ",i.createdBy]}),e.jsxs("div",{children:["创建时间: ",i.createdTime.split(" ")[0]]})]})},{title:"审批信息",key:"approvalInfo",width:150,render:(t,i)=>{var l;return e.jsxs("div",{style:{fontSize:"12px"},children:[i.approvedBy&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["批准人: ",i.approvedBy]}),e.jsxs("div",{children:["批准时间: ",null==(l=i.approvedTime)?void 0:l.split(" ")[0]]})]}),i.activatedTime&&e.jsxs("div",{style:{color:"#52c41a"},children:["激活时间: ",i.activatedTime.split(" ")[0]]})]})}},{title:"操作",key:"action",width:200,render:(t,i)=>e.jsxs(o,{size:"small",children:[e.jsx(Y,{title:"查看",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(Q,{}),onClick:()=>{var e;n(`/detection/sop-template/${(e=i).templateId}?version=${e.version}`)}})}),e.jsx(Y,{title:"复制",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(D,{}),onClick:()=>{return e=i,void u.confirm({title:"复制版本",content:`确定要基于版本 ${e.version} 创建新版本吗？`,onOk:()=>{C.success("版本复制成功，请编辑新版本信息"),q(!0)}});var e}})}),!i.isCurrentVersion&&"approved"===i.status&&e.jsx(Y,{title:"激活",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(W,{}),onClick:()=>{return e=i,void u.confirm({title:"激活版本",content:`确定要激活版本 ${e.version} 吗？当前活跃版本将被归档。`,onOk:()=>{const t=y.map(t=>({...t,status:t.id===e.id?"active":"active"===t.status?"archived":t.status,isCurrentVersion:t.id===e.id,activatedTime:t.id===e.id?(new Date).toLocaleString():t.activatedTime}));b(t),C.success("版本激活成功")}});var e}})}),!i.isCurrentVersion&&e.jsx(v,{title:"确定要删除这个版本吗？",onConfirm:()=>(e=>{if(e.isCurrentVersion)return void C.error("不能删除当前活跃版本");const t=y.filter(t=>t.id!==e.id);b(t),C.success("版本删除成功")})(i),children:e.jsx(Y,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{})})})})]})}],$=[{title:"字段",dataIndex:"field",key:"field",width:150},{title:"变更类型",dataIndex:"changeType",key:"changeType",width:100,render:t=>e.jsx(g,{color:{added:"success",modified:"warning",deleted:"error"}[t],children:{added:"新增",modified:"修改",deleted:"删除"}[t]})},{title:"旧值",dataIndex:"oldValue",key:"oldValue",width:200,render:e=>e||"-"},{title:"新值",dataIndex:"newValue",key:"newValue",width:200,render:e=>e||"-"}];return r?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(S,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(w,{children:e.jsxs(o,{children:[e.jsx(h,{icon:e.jsx(f,{}),onClick:()=>{n(-1)},children:"返回"}),e.jsxs("h2",{style:{margin:0},children:[e.jsx(re,{})," SOP版本管理 - ",null==k?void 0:k.name]})]})}),e.jsx(w,{children:e.jsxs(o,{children:[e.jsx(h,{onClick:()=>{if(2!==O.length)return void C.warning("请选择两个版本进行比较");E([{field:"步骤数量",oldValue:"8",newValue:"9",changeType:"modified"},{field:"字段数量",oldValue:"25",newValue:"28",changeType:"modified"},{field:"质量控制点",oldValue:"5",newValue:"7",changeType:"modified"},{field:"AI质量控制",oldValue:"",newValue:"已启用",changeType:"added"},{field:"智能异常检测",oldValue:"",newValue:"已启用",changeType:"added"}]),P(!0)},disabled:2!==O.length,children:"版本比较"}),e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{F.resetFields(),q(!0)},children:"创建版本"})]})})]}),e.jsx(c,{title:"模板信息",style:{marginBottom:24},children:e.jsxs(V,{column:3,children:[e.jsx(V.Item,{label:"模板名称",children:null==k?void 0:k.name}),e.jsx(V.Item,{label:"当前版本",children:e.jsx(g,{color:"success",children:null==k?void 0:k.currentVersion})}),e.jsx(V.Item,{label:"版本总数",children:y.length}),e.jsx(V.Item,{label:"模板描述",span:3,children:null==k?void 0:k.description})]})}),e.jsxs(c,{title:e.jsxs(o,{children:[e.jsx(X,{}),"版本历史"]}),children:[e.jsx(K,{message:"版本管理说明",description:"版本管理遵循语义化版本控制规范。主版本号.次版本号.修订号，如 v2.1.0。只有已批准的版本才能激活使用。",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(x,{columns:M,dataSource:y,rowKey:"id",rowSelection:{selectedRowKeys:O,onChange:e=>N(e),getCheckboxProps:e=>({disabled:"draft"===e.status})},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 个版本`},scroll:{x:1200}})]}),e.jsx(u,{title:"创建新版本",open:R,onCancel:()=>{q(!1),F.resetFields()},onOk:()=>F.submit(),width:600,children:e.jsxs(d,{form:F,layout:"vertical",onFinish:async e=>{try{const t={id:Date.now().toString(),templateId:s,templateName:(null==k?void 0:k.name)||"",isCurrentVersion:!1,stepCount:0,fieldCount:0,qcPointCount:0,createdBy:"当前用户",createdTime:(new Date).toLocaleString(),...e};b([t,...y]),q(!1),F.resetFields(),C.success("版本创建成功")}catch(t){C.error("创建失败")}},children:[e.jsx(d.Item,{name:"version",label:"版本号",rules:[{required:!0,message:"请输入版本号"},{pattern:/^v\d+\.\d+\.\d+(-\w+)?$/,message:"版本号格式不正确，如：v2.1.0 或 v2.1.0-beta"}],children:e.jsx(p,{placeholder:"如：v2.1.0 或 v2.1.0-beta"})}),e.jsx(d.Item,{name:"status",label:"初始状态",rules:[{required:!0,message:"请选择初始状态"}],initialValue:"draft",children:e.jsxs(j,{children:[e.jsx(He,{value:"draft",children:"草稿"}),e.jsx(He,{value:"review",children:"提交审核"})]})}),e.jsx(d.Item,{name:"description",label:"版本描述",rules:[{required:!0,message:"请输入版本描述"}],children:e.jsx(p,{placeholder:"请简要描述此版本的主要变更"})}),e.jsx(d.Item,{name:"changeLog",label:"变更日志",rules:[{required:!0,message:"请输入变更日志"}],children:e.jsx(Ye,{rows:4,placeholder:"请详细描述此版本的变更内容，每行一个变更点"})})]})}),e.jsxs(u,{title:"版本比较",open:A,onCancel:()=>P(!1),footer:[e.jsx(h,{onClick:()=>P(!1),children:"关闭"},"close")],width:800,children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(K,{message:`正在比较版本: ${O.join(" vs ")}`,type:"info",showIcon:!0})}),e.jsx(x,{columns:$,dataSource:B,rowKey:"field",pagination:!1,size:"small"})]})]})},{Option:Je}=j,Xe=()=>{const[i,l]=t.useState([{id:"G-001",code:"TP-GRP-01",name:"肿瘤标志物",description:"肿瘤相关标志物检测分组",status:"active"},{id:"G-002",code:"TP-GRP-02",name:"遗传学检测",description:"遗传性疾病相关基因检测分组",status:"active"},{id:"G-003",code:"TP-GRP-03",name:"感染性疾病",description:"病原体检测与鉴定分组",status:"inactive"}]);t.useEffect(()=>{try{const t=localStorage.getItem("testItemGroups");if(t){const i=JSON.parse(t),s=(e=i,Array.isArray(e)?e.map(e=>({id:String(e.id??`G-${Math.random().toString(36).slice(2,8)}`),code:String(e.code??""),name:String(e.name??""),description:String(e.description??""),status:"inactive"===e.status?"inactive":"active"})):[]);s.length>0&&l(s)}}catch(t){}var e},[]),t.useEffect(()=>{try{localStorage.setItem("testItemGroups",JSON.stringify(i))}catch(e){}},[i]);const[s,n]=t.useState(!1),[r,a]=t.useState(null),[f]=d.useForm(),b=(e=null)=>{a(e),n(!0),e?f.setFieldsValue(e):f.resetFields()},S=[{title:"分组编码",dataIndex:"code",key:"code",width:120,ellipsis:!0},{title:"分组名称",dataIndex:"name",key:"name",width:150,ellipsis:!0},{title:"描述",dataIndex:"description",key:"description",width:200,ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:80,render:t=>e.jsx(g,{color:"active"===t?"green":"red",children:"active"===t?"启用":"停用"})},{title:"操作",key:"action",width:150,fixed:"right",render:(t,s)=>e.jsxs(o,{children:[e.jsx(h,{size:"small",type:"link",icon:e.jsx(y,{}),onClick:()=>b(s),children:"编辑"}),e.jsx(h,{size:"small",type:"link",onClick:()=>(e=>{const t=i.map(t=>t.id===e?{...t,status:"active"===t.status?"inactive":"active"}:t);l(t)})(s.id),children:"active"===s.status?"停用":"启用"}),e.jsx(v,{title:"确认删除该分组？",onConfirm:()=>{return e=s.id,l(i.filter(t=>t.id!==e)),void C.success("分组已删除");var e},children:e.jsx(h,{size:"small",danger:!0,type:"link",icon:e.jsx(I,{}),children:"删除"})})]})}];return e.jsxs("div",{children:[e.jsxs(c,{title:"检测项目分组",children:[e.jsx(o,{style:{marginBottom:16},children:e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>b(null),children:"新增分组"})}),e.jsx(x,{rowKey:"id",columns:S,dataSource:i,pagination:{pageSize:8},scroll:{x:700}})]}),e.jsx(u,{title:r?"编辑分组":"新增分组",open:s,onCancel:()=>n(!1),onOk:()=>f.submit(),destroyOnClose:!0,children:e.jsxs(d,{form:f,layout:"vertical",onFinish:e=>{if(r){const t=i.map(t=>t.id===r.id?{...r,...e}:t);l(t),C.success("分组更新成功")}else{const t={id:`G-${Math.random().toString(36).slice(2,8)}`,...e};l([t,...i]),C.success("分组创建成功")}n(!1),a(null),f.resetFields()},initialValues:{status:"active"},children:[e.jsx(d.Item,{label:"分组编码",name:"code",rules:[{required:!0,message:"请输入分组编码"}],children:e.jsx(p,{placeholder:"例如：TP-GRP-01"})}),e.jsx(d.Item,{label:"分组名称",name:"name",rules:[{required:!0,message:"请输入分组名称"}],children:e.jsx(p,{placeholder:"例如：肿瘤标志物"})}),e.jsx(d.Item,{label:"描述",name:"description",children:e.jsx(p.TextArea,{rows:3,placeholder:"分组用途或说明"})}),e.jsx(d.Item,{label:"状态",name:"status",rules:[{required:!0}],children:e.jsxs(j,{children:[e.jsx(Je,{value:"active",children:"启用"}),e.jsx(Je,{value:"inactive",children:"停用"})]})})]})})]})},{Title:Ze}=b,{Option:et}=j,tt=()=>{const l=i(),s=[{id:"T-001",code:"TP001",name:"肺癌基因检测"},{id:"T-002",code:"TP002",name:"结直肠癌基因检测"},{id:"T-003",code:"TP003",name:"乳腺癌基因检测"},{id:"T-004",code:"TP004",name:"卵巢癌基因检测"},{id:"T-005",code:"TP005",name:"前列腺癌基因检测"},{id:"T-006",code:"TP006",name:"胃癌基因检测"}],[n,r]=t.useState({testItemId:"",methodology:"",sampleType:"",equipmentIds:[],reagentIds:[],analysisItemIds:[],sop:{mode:"document",templateId:void 0}}),[a,d]=t.useState([]),[m,u]=t.useState(null),[p,j]=t.useState(!1),[g,y]=t.useState(null),[I,f]=t.useState(""),[b,S]=t.useState(null),[w,k]=t.useState(""),[T,R]=t.useState(null),[q,A]=t.useState(""),[P,O]=t.useState(!1),[N,B]=t.useState([]),[V,z]=t.useState(!1),[E,F]=t.useState([]),[L,G]=t.useState(!1),[Q,D]=t.useState([]),[M,$]=t.useState([]);t.useEffect(()=>{try{const e=localStorage.getItem("experimentProcessPlans");if(e){const t=JSON.parse(e),i=Array.isArray(t)?t.map(e=>({id:String(e.id),name:String(e.name),applicableTestItemIds:Array.isArray(e.applicableTestItemIds)?e.applicableTestItemIds.map(String):[]})):[];$(i)}else $([{id:"P-001",name:"标准NGS流程方案",applicableTestItemIds:["T-001","T-003","T-004"]},{id:"P-002",name:"PCR快速流程方案",applicableTestItemIds:["T-002","T-005"]}])}catch{}},[]),t.useEffect(()=>{try{const e=localStorage.getItem("testItemRelations");let t=!0;if(e){const i=JSON.parse(e);if(Array.isArray(i)&&i.length>0){const e=i.map(e=>{var t,i;return{id:String(e.id??`R-${Math.random().toString(36).slice(2,8)}`),testItemId:String(e.testItemId??""),methodology:String(e.methodology??""),sampleType:String(e.sampleType??""),equipmentIds:Array.isArray(e.equipmentIds)?e.equipmentIds.map(String):[],reagentIds:Array.isArray(e.reagentIds)?e.reagentIds.map(String):[],analysisItemIds:Array.isArray(e.analysisItemIds)?e.analysisItemIds.map(String):[],sop:{mode:"structured"===(null==(t=null==e?void 0:e.sop)?void 0:t.mode)?"structured":"document",templateId:(null==(i=null==e?void 0:e.sop)?void 0:i.templateId)?String(e.sop.templateId):void 0}}});d(e),t=!1}}if(t){const e=[{id:"R-001",testItemId:"T-001",methodology:"NGS",sampleType:"血液",equipmentIds:["E-001","E-004"],reagentIds:["R-001"],analysisItemIds:["A-001","A-004","A-005"],sop:{mode:"document",templateId:"illumina_nextera_xt"}},{id:"R-002",testItemId:"T-002",methodology:"PCR",sampleType:"组织",equipmentIds:["E-002"],reagentIds:["R-002"],analysisItemIds:["A-002"],sop:{mode:"structured",templateId:"dna_extraction_qiaamp"}},{id:"R-003",testItemId:"T-003",methodology:"qPCR",sampleType:"唾液",equipmentIds:["E-005"],reagentIds:["R-003","R-004"],analysisItemIds:["A-003"],sop:{mode:"structured",templateId:"kapa_hyperprep"}},{id:"R-004",testItemId:"T-004",methodology:"Sanger测序",sampleType:"血液",equipmentIds:["E-003"],reagentIds:["R-001","R-003"],analysisItemIds:["A-004","A-005"],sop:{mode:"document",templateId:"magmax_isolation"}},{id:"R-005",testItemId:"T-005",methodology:"NGS",sampleType:"组织",equipmentIds:["E-001","E-004"],reagentIds:["R-001","R-002","R-003"],analysisItemIds:["A-001","A-002","A-003","A-004"],sop:{mode:"structured",templateId:"illumina_nextera_xt"}},{id:"R-006",testItemId:"T-001",methodology:"PCR",sampleType:"尿液",equipmentIds:["E-002","E-005"],reagentIds:["R-002"],analysisItemIds:["A-002"],sop:{mode:"document",templateId:"dna_extraction_qiaamp"}}];d(e),localStorage.setItem("testItemRelations",JSON.stringify(e))}}catch(e){d([{id:"R-001",testItemId:"T-001",methodology:"NGS",sampleType:"血液",equipmentIds:["E-001","E-004"],reagentIds:["R-001"],analysisItemIds:["A-001","A-004","A-005"],sop:{mode:"document",templateId:"illumina_nextera_xt"}}])}},[]),t.useEffect(()=>{try{localStorage.setItem("testItemRelations",JSON.stringify(a))}catch{}},[a]);const _=[{title:"检测项目",dataIndex:"testItemId",width:150,ellipsis:!0,render:e=>{var t;return(null==(t=s.find(t=>t.id===e))?void 0:t.name)||"-"}},{title:"方法学",dataIndex:"methodology",width:120,ellipsis:!0},{title:"设备数",dataIndex:"equipmentIds",width:80,render:e=>e.length},{title:"试剂数",dataIndex:"reagentIds",width:80,render:e=>e.length},{title:"分析项目数",dataIndex:"analysisItemIds",width:100,render:e=>e.length},{title:"SOP模式",dataIndex:["sop","mode"],width:100,render:e=>"structured"===e?"结构化":"文档"},{title:"操作",width:120,fixed:"right",render:(t,i)=>e.jsxs(o,{children:[e.jsx(h,{size:"small",type:"link",onClick:()=>(e=>{l(`/detection/test-item-relation/edit/${e.id}`)})(i),children:"编辑"}),e.jsx(v,{title:"确认删除该关系？",onConfirm:()=>{return e=i.id,d(a.filter(t=>t.id!==e)),void C.success("关系已删除");var e},children:e.jsx(h,{size:"small",danger:!0,type:"link",children:"删除"})})]})}];return e.jsx("div",{style:{padding:24},children:e.jsxs(c,{children:[e.jsxs(o,{style:{width:"100%",justifyContent:"space-between",marginBottom:12},children:[e.jsx(Ze,{level:4,style:{marginBottom:0},children:"检测项目关系配置列表"}),e.jsx(h,{type:"primary",onClick:()=>{l("/detection/test-item-relation/new")},children:"新增关系配置"})]}),e.jsx(x,{rowKey:"id",columns:_,dataSource:a,pagination:{pageSize:8},scroll:{x:770},style:{marginBottom:24}})]})})},{Title:it}=b,{Option:lt}=j,st=({title:i,defaultExpanded:l=!0,children:s})=>{const[n,r]=t.useState(l);return e.jsxs("div",{style:{marginBottom:16,border:"1px solid #e8e8e8",borderRadius:4},children:[e.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#fafafa",cursor:"pointer",borderBottom:n?"1px solid #e8e8e8":"none",borderLeft:"4px solid #1890ff",display:"flex",alignItems:"center",fontSize:"14px",fontWeight:500},onClick:()=>r(!n),children:[e.jsx("span",{children:i}),e.jsx("span",{style:{marginLeft:8,fontSize:"12px",transform:n?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",color:"#666"},children:"▶"})]}),n&&e.jsx("div",{style:{padding:"16px"},children:s})]})},nt=()=>{var s,n,r;const a=i(),{id:m}=l(),p="new"!==m,y=[{id:"T-001",code:"TI001",name:"肠道菌群多样性分析",englishName:"Gut Microbiome Diversity Analysis"},{id:"T-002",code:"TI002",name:"土壤微生物群结构检测",englishName:"Soil Microbial Community Structure Detection"},{id:"T-003",code:"TI003",name:"海水微生物基因组测序",englishName:"Marine Microbial Genome Sequencing"},{id:"T-004",code:"TI004",name:"病原体快速检测",englishName:"Rapid Pathogen Detection"},{id:"T-005",code:"TI005",name:"环境DNA宏基因组分析",englishName:"Environmental DNA Metagenome Analysis"}],I=[{id:"E-001",code:"EQ001",name:"Illumina NextSeq 550",sopConfigCode:"SOP-EQ001"},{id:"E-002",code:"EQ002",name:"ABI 7500 Real-Time PCR",sopConfigCode:"SOP-EQ002"},{id:"E-003",code:"EQ003",name:"Thermo Fisher Ion Torrent",sopConfigCode:"SOP-EQ003"},{id:"E-004",code:"EQ004",name:"Illumina NovaSeq 6000",sopConfigCode:"SOP-EQ004"},{id:"E-005",code:"EQ005",name:"Roche LightCycler 480",sopConfigCode:"SOP-EQ005"}],b=[{id:"R-001",code:"RG001",name:"Nextera XT Library Prep Kit",recommendedSOPTemplateId:"illumina_nextera_xt",sopConfigCode:"SOP-RG001"},{id:"R-002",code:"RG002",name:"QIAamp DNA Mini Kit",recommendedSOPTemplateId:"dna_extraction_qiaamp",sopConfigCode:"SOP-RG002"},{id:"R-003",code:"RG003",name:"KAPA HyperPrep Kit",recommendedSOPTemplateId:"kapa_hyperprep",sopConfigCode:"SOP-RG003"},{id:"R-004",code:"RG004",name:"MagMAX Viral/Pathogen Nucleic Acid Isolation Kit",recommendedSOPTemplateId:"magmax_isolation",sopConfigCode:"SOP-RG004"}],k=[{id:"A-001",code:"AI001",name:"16S rRNA基因测序分析"},{id:"A-002",code:"AI002",name:"宏基因组功能注释"},{id:"A-003",code:"AI003",name:"微生物多样性统计"},{id:"A-004",code:"AI004",name:"病原体鉴定与分型"},{id:"A-005",code:"AI005",name:"抗生素耐药基因检测"}],[T,R]=t.useState({testItemId:"",methodology:"",sampleType:[],equipmentIds:[],reagentIds:[],analysisItemIds:[],sop:{mode:"document",templateId:void 0}}),[q,A]=t.useState(!1),[P,O]=t.useState(!1),[N,B]=t.useState(!1),[V,z]=t.useState([]),[E,F]=t.useState([]),[L,G]=t.useState([]);t.useEffect(()=>{if(p&&m){const e=localStorage.getItem("testItemRelations");if(e){const t=JSON.parse(e).find(e=>e.id===m);t&&R({testItemId:t.testItemId,methodology:t.methodology,sampleType:t.sampleType??"",equipmentIds:t.equipmentIds,reagentIds:t.reagentIds,analysisItemIds:t.analysisItemIds,sop:t.sop})}}},[p,m]);const Q=()=>{a("/detection/test-item-relation")};return e.jsx("div",{style:{padding:24},children:e.jsxs(c,{children:[e.jsxs(o,{style:{width:"100%",justifyContent:"space-between",marginBottom:24},children:[e.jsxs(o,{children:[e.jsx(h,{icon:e.jsx(f,{}),onClick:Q,children:"返回"}),e.jsx(it,{level:4,style:{marginBottom:0},children:p?"编辑关系配置":"新增关系配置"})]}),e.jsxs(o,{children:[e.jsx(h,{onClick:Q,children:"取消"}),e.jsx(h,{type:"primary",onClick:()=>{var e,t;if(!T.testItemId||!T.methodology||!T.sampleType)return void C.error("请填写完整的基本信息");const i=localStorage.getItem("testItemRelations"),l=i?JSON.parse(i):[];if(p&&m){const t=l.findIndex(e=>e.id===m);t>=0&&(l[t]={...l[t],...T,testItem:(null==(e=y.find(e=>e.id===T.testItemId))?void 0:e.name)||"",equipmentCount:T.equipmentIds.length,reagentCount:T.reagentIds.length,analysisItemCount:T.analysisItemIds.length})}else{const e={id:Date.now().toString(),...T,testItem:(null==(t=y.find(e=>e.id===T.testItemId))?void 0:t.name)||"",equipmentCount:T.equipmentIds.length,reagentCount:T.reagentIds.length,analysisItemCount:T.analysisItemIds.length};l.push(e)}localStorage.setItem("testItemRelations",JSON.stringify(l)),C.success(p?"编辑成功":"新增成功"),a("/detection/test-item-relation")},children:"保存"})]})]}),e.jsx(st,{title:"基本信息",defaultExpanded:!0,children:e.jsxs(d,{layout:"horizontal",children:[e.jsxs(S,{gutter:24,style:{marginBottom:16},children:[e.jsx(w,{span:8,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",height:"32px"},children:[e.jsx("span",{style:{width:"33.33%",color:"#666",fontSize:"14px"},children:"检测项目编码："}),e.jsx("span",{style:{flex:1,fontSize:"14px"},children:T.testItemId&&(null==(s=y.find(e=>e.id===T.testItemId))?void 0:s.code)||"-"})]})}),e.jsx(w,{span:8,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",height:"32px"},children:[e.jsx("span",{style:{width:"33.33%",color:"#666",fontSize:"14px"},children:"检测项目名称："}),e.jsx("span",{style:{flex:1,fontSize:"14px"},children:T.testItemId&&(null==(n=y.find(e=>e.id===T.testItemId))?void 0:n.name)||"-"})]})}),e.jsx(w,{span:8,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",height:"32px"},children:[e.jsx("span",{style:{width:"33.33%",color:"#666",fontSize:"14px"},children:"英文名称："}),e.jsx("span",{style:{flex:1,fontSize:"14px"},children:T.testItemId&&(null==(r=y.find(e=>e.id===T.testItemId))?void 0:r.englishName)||"-"})]})})]}),e.jsxs(S,{gutter:24,children:[e.jsx(w,{span:8,children:e.jsx(d.Item,{label:"方法学",labelCol:{span:6},wrapperCol:{span:18},children:e.jsx(j,{placeholder:"请选择方法学",style:{width:"100%"},value:T.methodology,onChange:e=>R(t=>({...t,methodology:e})),children:["NGS","PCR","qPCR","Sanger测序","宏基因组测序"].map(t=>e.jsx(lt,{value:t,children:t},t))})})}),e.jsx(w,{span:16,children:e.jsx(d.Item,{label:"样本类型",labelCol:{span:3},wrapperCol:{span:21},children:e.jsx(j,{mode:"multiple",placeholder:"请选择样本类型",style:{width:"100%"},value:T.sampleType,onChange:e=>R(t=>({...t,sampleType:e})),children:["血液","组织","唾液","尿液","粪便","土壤","水样"].map(t=>e.jsx(lt,{value:t,children:t},t))})})})]}),!p&&e.jsx(S,{gutter:24,style:{marginTop:16},children:e.jsx(w,{span:24,children:e.jsx(d.Item,{label:"选择检测项目",labelCol:{span:3},wrapperCol:{span:21},children:e.jsx(j,{placeholder:"请选择检测项目",style:{width:"100%"},value:T.testItemId,onChange:e=>R(t=>({...t,testItemId:e})),children:y.map(t=>e.jsxs(lt,{value:t.id,children:[t.name,"（",t.code,"）"]},t.id))})})})})]})}),e.jsxs(st,{title:"设备信息",defaultExpanded:!0,children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:16},children:e.jsx(h,{type:"primary",onClick:()=>{z([]),A(!0)},children:"新增设备"})}),e.jsx(x,{size:"small",rowKey:e=>e,columns:[{title:"设备编码",dataIndex:"code",key:"code",render:(e,t)=>{var i;return(null==(i=I.find(e=>e.id===t))?void 0:i.code)||"-"}},{title:"设备名称",dataIndex:"name",key:"name",render:(e,t)=>{var i;return(null==(i=I.find(e=>e.id===t))?void 0:i.name)||"-"}},{title:"SOP配置编码",dataIndex:"sopConfigCode",key:"sopConfigCode",render:(e,t)=>{var i;return(null==(i=I.find(e=>e.id===t))?void 0:i.sopConfigCode)||"-"}},{title:"操作",key:"action",render:(t,i)=>e.jsx(v,{title:"确认删除该设备？",onConfirm:()=>R(e=>({...e,equipmentIds:e.equipmentIds.filter(e=>e!==i)})),children:e.jsx(h,{type:"link",danger:!0,size:"small",children:"删除"})})}],dataSource:T.equipmentIds,pagination:!1,locale:{emptyText:"暂无设备，请点击新增按钮添加"}})]}),e.jsxs(st,{title:"试剂信息",defaultExpanded:!0,children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:16},children:e.jsx(h,{type:"primary",onClick:()=>{F([]),O(!0)},children:"新增试剂"})}),e.jsx(x,{size:"small",rowKey:e=>e,columns:[{title:"试剂编码",dataIndex:"code",key:"code",render:(e,t)=>{var i;return(null==(i=b.find(e=>e.id===t))?void 0:i.code)||"-"}},{title:"试剂名称",dataIndex:"name",key:"name",render:(e,t)=>{var i;return(null==(i=b.find(e=>e.id===t))?void 0:i.name)||"-"}},{title:"SOP配置编码",dataIndex:"sopConfigCode",key:"sopConfigCode",render:(e,t)=>{var i;return(null==(i=b.find(e=>e.id===t))?void 0:i.sopConfigCode)||"-"}},{title:"操作",key:"action",render:(t,i)=>e.jsx(v,{title:"确认删除该试剂？",onConfirm:()=>R(e=>({...e,reagentIds:e.reagentIds.filter(e=>e!==i)})),children:e.jsx(h,{type:"link",danger:!0,size:"small",children:"删除"})})}],dataSource:T.reagentIds,pagination:!1,locale:{emptyText:"暂无试剂，请点击新增按钮添加"}})]}),e.jsxs(st,{title:"关联分析项目",defaultExpanded:!0,children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:16},children:e.jsx(h,{type:"primary",onClick:()=>{G([]),B(!0)},children:"新增分析项目"})}),e.jsx(x,{size:"small",rowKey:e=>e,columns:[{title:"编码",dataIndex:"code",key:"code",render:(e,t)=>{var i;return(null==(i=k.find(e=>e.id===t))?void 0:i.code)||"-"}},{title:"分析项目名称",dataIndex:"name",key:"name",render:(e,t)=>{var i;return(null==(i=k.find(e=>e.id===t))?void 0:i.name)||"-"}},{title:"操作",key:"action",render:(t,i)=>e.jsx(v,{title:"确认删除该分析项目？",onConfirm:()=>R(e=>({...e,analysisItemIds:e.analysisItemIds.filter(e=>e!==i)})),children:e.jsx(h,{type:"link",danger:!0,size:"small",children:"删除"})})}],dataSource:T.analysisItemIds,pagination:!1,locale:{emptyText:"暂无分析项目，请点击新增按钮添加"}})]}),e.jsxs(st,{title:"SOP配置",defaultExpanded:!0,children:[e.jsx(d,{layout:"horizontal",children:e.jsxs(S,{gutter:24,children:[e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"模式",labelCol:{span:6},wrapperCol:{span:18},children:e.jsxs(j,{style:{width:"100%"},value:T.sop.mode,onChange:e=>R(t=>({...t,sop:{...t.sop,mode:e}})),children:[e.jsx(lt,{value:"document",children:"文档"}),e.jsx(lt,{value:"structured",children:"结构化"})]})})}),e.jsx(w,{span:12,children:e.jsx(d.Item,{label:"模板ID",labelCol:{span:6},wrapperCol:{span:18},children:e.jsx(g,{color:"geekblue",style:{width:"100%",textAlign:"center"},children:T.sop.templateId||"暂无"})})})]})}),e.jsx(x,{size:"small",rowKey:e=>e.templateId,columns:[{title:"模板ID",dataIndex:"templateId"},{title:"来源试剂",dataIndex:"reagentName"}],dataSource:Array.from(new Set(T.reagentIds.map(e=>{var t;return null==(t=b.find(t=>t.id===e))?void 0:t.recommendedSOPTemplateId}).filter(Boolean))).map(e=>{var t;return{templateId:e,reagentName:(null==(t=b.find(t=>t.recommendedSOPTemplateId===e))?void 0:t.name)||"-"}}),locale:{emptyText:"暂无模板推荐"},pagination:!1})]}),e.jsx(u,{title:"选择设备",open:q,onCancel:()=>{A(!1)},onOk:()=>{const e=V.filter(e=>!T.equipmentIds.includes(e));0!==e.length?(R(t=>({...t,equipmentIds:[...t.equipmentIds,...e]})),A(!1),C.success(`已添加 ${e.length} 个设备`)):C.warning("请选择新的设备")},okText:"确定",cancelText:"取消",destroyOnClose:!0,children:e.jsx(x,{size:"small",rowKey:"id",columns:[{title:"设备编码",dataIndex:"code"},{title:"设备名称",dataIndex:"name"}],dataSource:I,rowSelection:{selectedRowKeys:V,onChange:e=>z(e)},pagination:!1})}),e.jsx(u,{title:"选择试剂",open:P,onCancel:()=>{O(!1)},onOk:()=>{const e=E.filter(e=>!T.reagentIds.includes(e));if(0===e.length)return void C.warning("请选择新的试剂");const t=e.map(e=>{var t;return null==(t=b.find(t=>t.id===e))?void 0:t.recommendedSOPTemplateId}).find(Boolean);R(i=>({...i,reagentIds:[...i.reagentIds,...e],sop:{...i.sop,templateId:t||i.sop.templateId}})),O(!1),C.success(`已添加 ${e.length} 个试剂`)},okText:"确定",cancelText:"取消",destroyOnClose:!0,children:e.jsx(x,{size:"small",rowKey:"id",columns:[{title:"试剂编码",dataIndex:"code"},{title:"试剂名称",dataIndex:"name"}],dataSource:b,rowSelection:{selectedRowKeys:E,onChange:e=>F(e)},pagination:!1})}),e.jsx(u,{title:"选择分析项目",open:N,onCancel:()=>{B(!1)},onOk:()=>{const e=L.filter(e=>!T.analysisItemIds.includes(e));0!==e.length?(R(t=>({...t,analysisItemIds:[...t.analysisItemIds,...e]})),B(!1),C.success(`已添加 ${e.length} 个分析项目`)):C.warning("请选择新的分析项目")},okText:"确定",cancelText:"取消",destroyOnClose:!0,children:e.jsx(x,{size:"small",rowKey:"id",columns:[{title:"编码",dataIndex:"code"},{title:"分析项目名称",dataIndex:"name"}],dataSource:k,rowSelection:{selectedRowKeys:L,onChange:e=>G(e)},pagination:!1})})]})})},rt=()=>e.jsxs("div",{children:[e.jsxs(ae,{style:{margin:"16px 0"},children:[e.jsx(ae.Item,{children:"首页"}),e.jsx(ae.Item,{children:"检测项目"})]}),e.jsxs(n,{children:[e.jsx(r,{index:!0,element:e.jsx(a,{to:"test-item",replace:!0})}),e.jsx(r,{path:"test-item",element:e.jsx(xe,{})}),e.jsx(r,{path:"test-item/add",element:e.jsx(ge,{})}),e.jsx(r,{path:"test-item-relation",element:e.jsx(tt,{})}),e.jsx(r,{path:"test-item-relation/new",element:e.jsx(nt,{})}),e.jsx(r,{path:"test-item-relation/edit/:id",element:e.jsx(nt,{})}),e.jsx(r,{path:"test-item-group",element:e.jsx(Xe,{})}),e.jsx(r,{path:"analysis-item",element:e.jsx(Ce,{})}),e.jsx(r,{path:"analysis-item/add",element:e.jsx(Te,{})}),e.jsx(r,{path:"methodology",element:e.jsx(Ve,{})}),e.jsx(r,{path:"sop-config",element:e.jsx(Fe,{})}),e.jsx(r,{path:"sop-template/:templateId",element:e.jsx(Qe,{})}),e.jsx(r,{path:"sop-step/:stepId",element:e.jsx($e,{})}),e.jsx(r,{path:"sop-quality-control/:stepId",element:e.jsx(Ke,{})}),e.jsx(r,{path:"sop-version/:templateId",element:e.jsx(We,{})})]})]});export{rt as default};
