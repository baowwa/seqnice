import{j as e}from"./index-B3ZSLooO.js";import{r as i,u as l,j as t,k as s,h as r,i as n,N as a}from"./react-vendor-BSBC8BLg.js";import{$ as d,T as c,a as o,B as h,a1 as m,V as x,D as u,ao as p,X as j,bf as g,az as v,ad as y,S as I,I as b,a5 as f,a3 as C,a4 as q,at as R,l as S,aa as w,a2 as k,k as A,s as P,ag as T,ah as O,ai as B,ak as D,al as F,aP as N,U as z,Z as V,aA as L,c as M,d as G,aB as E,an as _,aI as K,G as U,n as Q,bg as $,a7 as W,bh as H,aq as J,w as Z,bd as X,bi as Y,bj as ee,a_ as ie,ap as le,bk as te,bl as se,ay as re,Y as ne,ac as ae,av as de,bm as ce,u as oe}from"./antd-vendor-BuqAAsAf.js";const{Title:he}=c,{Option:me}=q,{TextArea:xe}=C,ue=()=>{const[l,t]=i.useState([]),[s,r]=i.useState(!1),[n,a]=i.useState(!1),[c,L]=i.useState(null),[M,G]=i.useState(!1),[E,_]=i.useState(null),[K,U]=i.useState([]),[Q]=d.useForm(),$=[{id:"1",name:"EGFR基因突变检测",code:"EGFR_MUT",category:"基因突变"},{id:"2",name:"KRAS基因突变检测",code:"KRAS_MUT",category:"基因突变"},{id:"3",name:"TP53基因突变检测",code:"TP53_MUT",category:"基因突变"},{id:"4",name:"ALK融合基因检测",code:"ALK_FUSION",category:"基因融合"},{id:"5",name:"ROS1融合基因检测",code:"ROS1_FUSION",category:"基因融合"}],W=[{id:"1",name:"肺癌基因检测",englishName:"Lung Cancer Gene Detection",code:"TP001",category:"肿瘤基因",description:"肺癌相关基因突变检测，包括EGFR、KRAS、BRAF等关键基因",price:5e3,duration:7,sampleTypes:["组织","血液","胸腔积液"],methodology:"NGS (下一代测序)",primaryMethodology:"NGS (下一代测序)",backupMethodologies:["PCR","Sanger测序"],department:"分子病理科",responsible:"张三",isActive:!0,status:"active",clinicalApplication:"用于肺癌患者的基因突变检测，指导靶向治疗药物选择",reportTemplate:"肺癌基因检测报告模板v2.1",associatedAnalysisItems:[{id:"1",name:"EGFR基因突变检测",code:"EGFR_MUT",reportOrder:1,isRequired:!0,isActive:!0},{id:"2",name:"KRAS基因突变检测",code:"KRAS_MUT",reportOrder:2,isRequired:!0,isActive:!0},{id:"3",name:"BRAF基因突变检测",code:"BRAF_MUT",reportOrder:3,isRequired:!1,isActive:!0},{id:"4",name:"肿瘤突变负荷分析",code:"TMB",reportOrder:4,isRequired:!1,isActive:!0},{id:"5",name:"微卫星不稳定性分析",code:"MSI",reportOrder:5,isRequired:!1,isActive:!0}],sopDocuments:[{id:"sop1",name:"SOP-MOL-001-NGS建库标准操作程序",version:"v2.1",type:"procedure",uploadDate:"2024-01-15",fileUrl:"/sop/ngs_library_v2.1.pdf",approver:"张主任",status:"approved"}],sopConfiguration:{mode:"document",executionMode:"strict",templateId:"illumina_nextera_xt"},qualityRequirements:"DNA浓度≥10ng/μL，A260/A280比值1.8-2.0，无蛋白质污染",createdAt:"2024-01-15",updatedAt:"2024-01-20"},{id:"2",name:"结直肠癌基因检测",englishName:"Colorectal Cancer Gene Detection",code:"TP002",category:"肿瘤基因",description:"结直肠癌相关基因检测",price:4500,duration:7,sampleTypes:["组织","血液"],methodology:"NGS (下一代测序)",primaryMethodology:"NGS (下一代测序)",backupMethodologies:["PCR"],department:"分子病理科",responsible:"李四",isActive:!0,status:"active",clinicalApplication:"用于结直肠癌患者的基因检测，指导治疗方案选择",reportTemplate:"结直肠癌基因检测报告模板v1.8",associatedAnalysisItems:[{id:"2",name:"KRAS基因突变检测",code:"KRAS_MUT",reportOrder:1,isRequired:!0,isActive:!0},{id:"3",name:"BRAF基因突变检测",code:"BRAF_MUT",reportOrder:2,isRequired:!0,isActive:!0},{id:"5",name:"微卫星不稳定性分析",code:"MSI",reportOrder:3,isRequired:!1,isActive:!0}],sopDocuments:[{id:"sop3",name:"结直肠癌基因检测SOP",version:"v1.8",type:"procedure",uploadDate:"2024-01-16",fileUrl:"/sop/colorectal_procedure_v1.8.pdf",approver:"王主任",status:"approved"}],sopConfiguration:{mode:"structured",executionMode:"guided",structuredSteps:[{id:"1",name:"样本质量检测",description:"检测DNA浓度和纯度",duration:30,order:1,isRequired:!0},{id:"2",name:"核酸片段化",description:"将DNA片段化至适当大小",duration:45,order:2,isRequired:!0},{id:"3",name:"末端修复",description:"修复DNA片段末端",duration:30,order:3,isRequired:!0},{id:"4",name:"接头连接",description:"连接测序接头",duration:60,order:4,isRequired:!0},{id:"5",name:"片段筛选",description:"筛选合适大小的片段",duration:45,order:5,isRequired:!0},{id:"6",name:"PCR扩增",description:"扩增文库",duration:90,order:6,isRequired:!0},{id:"7",name:"文库质检",description:"检测文库质量",duration:60,order:7,isRequired:!0}]},qualityRequirements:"DNA浓度≥5ng/μL，无RNA和蛋白质污染",createdAt:"2024-01-16",updatedAt:"2024-01-21"},{id:"3",name:"乳腺癌基因检测",englishName:"Breast Cancer Gene Detection",code:"TP003",category:"肿瘤基因",description:"乳腺癌易感基因检测",price:6e3,duration:10,sampleTypes:["血液","组织"],methodology:"NGS (下一代测序)",primaryMethodology:"NGS (下一代测序)",backupMethodologies:["Sanger测序"],department:"分子病理科",responsible:"王五",isActive:!1,status:"pending",clinicalApplication:"用于乳腺癌易感性评估和家族遗传咨询",reportTemplate:"乳腺癌基因检测报告模板v3.0",associatedAnalysisItems:[{id:"6",name:"BRCA1基因检测",code:"BRCA1",reportOrder:1,isRequired:!0,isActive:!0},{id:"7",name:"BRCA2基因检测",code:"BRCA2",reportOrder:2,isRequired:!0,isActive:!0}],sopDocuments:[{id:"sop4",name:"乳腺癌基因检测流程",version:"v3.0",type:"procedure",uploadDate:"2024-01-20",fileUrl:"/sop/breast_cancer_procedure_v3.0.pdf",approver:"陈主任",status:"draft"}],sopConfiguration:{mode:"document",executionMode:"reference"},qualityRequirements:"DNA浓度≥20ng/μL，总量≥1μg，片段长度>10kb",createdAt:"2024-01-20",updatedAt:"2024-01-20"}],H=[{title:"项目名称",dataIndex:"name",key:"name",width:150,render:(i,l)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:l.code})]})},{title:"分类",dataIndex:"category",key:"category",width:120,render:i=>e.jsx(j,{color:"blue",children:i})},{title:"价格(元)",dataIndex:"price",key:"price",width:100,render:e=>`¥${e}`},{title:"周期(天)",dataIndex:"duration",key:"duration",width:80,align:"center"},{title:"适用样本",dataIndex:"sampleTypes",key:"sampleTypes",width:150,render:i=>e.jsxs("div",{children:[i.slice(0,2).map(i=>e.jsx(j,{style:{marginBottom:2},children:i},i)),i.length>2&&e.jsx(T,{title:i.slice(2).join(", "),children:e.jsxs(j,{color:"default",children:["+",i.length-2]})})]})},{title:"项目状态",dataIndex:"status",key:"status",width:100,align:"center",render:i=>{const l={active:{color:"green",icon:e.jsx(V,{}),text:"有效"},pending:{color:"orange",icon:e.jsx(z,{}),text:"待审"},inactive:{color:"red",icon:e.jsx(N,{}),text:"停用"}}[i];return e.jsx(j,{color:l.color,icon:l.icon,children:l.text})}},{title:"关联分析项目",dataIndex:"associatedAnalysisItems",key:"associatedAnalysisItems",width:120,align:"center",render:i=>e.jsx(y,{count:(null==i?void 0:i.length)||0,showZero:!0,color:"#1890ff"})},{title:"SOP文档",dataIndex:"sopDocuments",key:"sopDocuments",width:100,align:"center",render:i=>i&&i.length>0?e.jsx(T,{title:`${i.length}个文档`,children:e.jsx(y,{count:i.length,showZero:!0,children:e.jsx(b,{style:{color:"#1890ff",fontSize:"16px"}})})}):e.jsx("span",{style:{color:"#ccc"},children:"-"})},{title:"启用状态",dataIndex:"isActive",key:"isActive",width:80,align:"center",render:i=>e.jsx(j,{color:i?"green":"red",children:i?"启用":"禁用"})},{title:"操作",key:"action",width:160,fixed:"right",render:(i,l)=>e.jsxs(I,{size:"small",children:[e.jsx(h,{type:"link",size:"small",icon:e.jsx(O,{}),onClick:()=>J(l),children:"详情"}),e.jsx(h,{type:"link",size:"small",icon:e.jsx(B,{}),onClick:()=>{return L(e=l),Q.setFieldsValue(e),void a(!0);var e},children:"编辑"}),e.jsx(D,{title:"确定要删除这个检测项目吗？",onConfirm:()=>(async e=>{try{t(i=>i.filter(i=>i.id!==e)),P.success("删除成功")}catch(i){P.error("删除失败")}})(l.id),okText:"确定",cancelText:"取消",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(F,{}),children:"删除"})})]})}],J=e=>{_(e),G(!0)},Z=e=>({procedure:"操作程序",quality:"质量控制",safety:"安全规范",maintenance:"维护保养"}[e]||e);return i.useEffect(()=>{(async()=>{r(!0);try{await new Promise(e=>setTimeout(e,500)),t(W)}catch(e){P.error("获取检测项目列表失败")}finally{r(!1)}})()},[]),e.jsxs("div",{children:[e.jsx(he,{level:3,style:{marginBottom:24},children:"检测项目管理"}),e.jsxs(o,{className:"content-card",children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{window.open("/detection/test-item/add","_blank")},children:"新增检测项目"})}),e.jsx(x,{columns:H,dataSource:l,rowKey:"id",loading:s,pagination:{total:l.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`},scroll:{x:1400}})]}),e.jsx(u,{title:"检测项目详情",placement:"right",width:800,open:M,onClose:()=>G(!1),children:E&&e.jsxs("div",{children:[e.jsxs(p,{title:"基本信息",bordered:!0,column:2,size:"small",style:{marginBottom:24},children:[e.jsx(p.Item,{label:"项目名称",span:2,children:e.jsx("strong",{style:{fontSize:"16px"},children:E.name})}),e.jsx(p.Item,{label:"英文名称",span:2,children:E.englishName||"-"}),e.jsx(p.Item,{label:"项目编码",children:e.jsx(j,{color:"blue",children:E.code})}),e.jsx(p.Item,{label:"分类",children:e.jsx(j,{color:"green",children:E.category})}),e.jsx(p.Item,{label:"所属科室",children:E.department||"-"}),e.jsx(p.Item,{label:"负责人",children:E.responsible||"-"}),e.jsx(p.Item,{label:"项目状态",children:(()=>{const i={active:{color:"green",icon:e.jsx(V,{}),text:"有效"},pending:{color:"orange",icon:e.jsx(z,{}),text:"待审"},inactive:{color:"red",icon:e.jsx(N,{}),text:"停用"}}[E.status];return e.jsx(j,{color:i.color,icon:i.icon,children:i.text})})()}),e.jsx(p.Item,{label:"启用状态",children:e.jsx(j,{color:E.isActive?"green":"red",children:E.isActive?"启用":"禁用"})}),e.jsx(p.Item,{label:"项目描述",span:2,children:E.description||"-"})]}),e.jsxs(p,{title:"技术信息",bordered:!0,column:2,size:"small",style:{marginBottom:24},children:[e.jsx(p.Item,{label:"价格",children:e.jsxs("span",{style:{color:"#f50",fontWeight:"bold"},children:["¥",E.price]})}),e.jsxs(p.Item,{label:"报告周期",children:[E.duration,"个工作日"]}),e.jsx(p.Item,{label:"主要方法学",children:e.jsx(j,{color:"purple",children:E.primaryMethodology||E.methodology})}),e.jsx(p.Item,{label:"备用方法学",children:E.backupMethodologies&&E.backupMethodologies.length>0?E.backupMethodologies.map(i=>e.jsx(j,{color:"default",style:{marginRight:4},children:i},i)):"-"}),e.jsx(p.Item,{label:"适用样本",span:2,children:E.sampleTypes.map(i=>e.jsx(j,{color:"cyan",style:{marginRight:4},children:i},i))})]}),e.jsxs(p,{title:"临床信息",bordered:!0,column:1,size:"small",style:{marginBottom:24},children:[e.jsx(p.Item,{label:"临床应用",children:E.clinicalApplication||"-"}),e.jsx(p.Item,{label:"质量要求",children:E.qualityRequirements||"-"}),e.jsx(p.Item,{label:"报告模板",children:E.reportTemplate||"-"})]}),E.sopConfiguration&&e.jsxs(p,{title:"SOP配置",bordered:!0,column:2,size:"small",style:{marginBottom:24},children:[e.jsx(p.Item,{label:"配置模式",children:e.jsx(j,{color:"document"===E.sopConfiguration.mode?"blue":"orange",children:"document"===E.sopConfiguration.mode?"文档模式":"结构化模式"})}),e.jsx(p.Item,{label:"执行模式",children:e.jsx(j,{color:"strict"===E.sopConfiguration.executionMode?"red":"guided"===E.sopConfiguration.executionMode?"orange":"green",children:"strict"===E.sopConfiguration.executionMode?"严格模式":"guided"===E.sopConfiguration.executionMode?"引导模式":"参考模式"})}),E.sopConfiguration.templateId&&e.jsx(p.Item,{label:"标准模板",span:2,children:E.sopConfiguration.templateId})]}),e.jsxs("div",{style:{marginBottom:24},children:[e.jsxs(he,{level:5,style:{marginBottom:16},children:[e.jsx(g,{style:{marginRight:8}}),"关联分析项目"]}),E.associatedAnalysisItems&&E.associatedAnalysisItems.length>0?e.jsx(v,{size:"small",bordered:!0,dataSource:E.associatedAnalysisItems.sort((e,i)=>e.reportOrder-i.reportOrder),renderItem:(i,l)=>e.jsx(v.Item,{children:e.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(y,{count:i.reportOrder,style:{backgroundColor:"#52c41a",marginRight:8}}),e.jsx("span",{style:{fontWeight:"bold"},children:i.name}),e.jsxs("span",{style:{color:"#666",marginLeft:8},children:["(",i.code,")"]})]}),e.jsxs(I,{children:[e.jsx(j,{color:i.isRequired?"red":"default",children:i.isRequired?"必需":"可选"}),e.jsx(j,{color:i.isActive?"green":"default",children:i.isActive?"启用":"停用"})]})]})})}):e.jsx("div",{style:{textAlign:"center",color:"#999",fontStyle:"italic",padding:"20px",border:"1px dashed #d9d9d9",borderRadius:"6px"},children:"暂无关联分析项目"})]}),e.jsxs("div",{children:[e.jsxs(he,{level:5,style:{marginBottom:16},children:[e.jsx(b,{style:{marginRight:8}}),"SOP文档"]}),E.sopDocuments&&E.sopDocuments.length>0?e.jsx(v,{size:"small",bordered:!0,dataSource:E.sopDocuments,renderItem:i=>{return e.jsx(v.Item,{actions:[e.jsx(h,{type:"link",size:"small",icon:e.jsx(b,{}),onClick:()=>window.open(i.fileUrl,"_blank"),children:"查看"})],children:e.jsx(v.Item.Meta,{avatar:e.jsx(b,{style:{fontSize:"20px",color:"#1890ff"}}),title:e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:i.name}),e.jsxs("div",{style:{marginTop:4},children:[e.jsx(j,{color:(l=i.type,{procedure:"blue",quality:"green",safety:"orange",maintenance:"purple"}[l]||"default"),style:{marginRight:8},children:Z(i.type)}),e.jsx(j,{color:"approved"===i.status?"green":"draft"===i.status?"orange":"red",children:"approved"===i.status?"已审批":"draft"===i.status?"草稿":"已过期"})]})]}),description:e.jsxs("div",{style:{color:"#666"},children:[e.jsxs("div",{children:["版本: ",i.version," | 审批人: ",i.approver]}),e.jsxs("div",{children:["上传时间: ",i.uploadDate]})]})})});var l}}):e.jsx("div",{style:{textAlign:"center",color:"#999",fontStyle:"italic",padding:"20px",border:"1px dashed #d9d9d9",borderRadius:"6px"},children:"暂无SOP文档"})]})]})}),e.jsx(f,{title:c?"编辑检测项目":"新增检测项目",open:n,onCancel:()=>{a(!1),L(null),Q.resetFields()},footer:null,width:900,children:e.jsxs(d,{form:Q,layout:"vertical",onFinish:async e=>{try{if(c){const i={...c,...e,updatedAt:(new Date).toISOString().split("T")[0]};t(e=>e.map(e=>e.id===c.id?i:e)),P.success("检测项目更新成功")}else{const i={id:Date.now().toString(),...e,createdAt:(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};t(e=>[...e,i]),P.success("检测项目创建成功")}a(!1),L(null),Q.resetFields()}catch(i){P.error("保存失败")}},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"name",label:"项目名称",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(C,{placeholder:"请输入项目名称"})}),e.jsx(d.Item,{name:"englishName",label:"英文名称",rules:[{required:!0,message:"请输入英文名称"}],children:e.jsx(C,{placeholder:"请输入英文名称"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"code",label:"项目编码",rules:[{required:!0,message:"请输入项目编码"}],children:e.jsx(C,{placeholder:"请输入项目编码"})}),e.jsx(d.Item,{name:"department",label:"所属科室",rules:[{required:!0,message:"请选择所属科室"}],children:e.jsxs(q,{placeholder:"请选择所属科室",children:[e.jsx(me,{value:"检验科",children:"检验科"}),e.jsx(me,{value:"病理科",children:"病理科"}),e.jsx(me,{value:"分子诊断科",children:"分子诊断科"}),e.jsx(me,{value:"微生物科",children:"微生物科"}),e.jsx(me,{value:"免疫科",children:"免疫科"}),e.jsx(me,{value:"生化科",children:"生化科"}),e.jsx(me,{value:"其他",children:"其他"})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"responsible",label:"负责人",rules:[{required:!0,message:"请输入负责人"}],children:e.jsx(C,{placeholder:"请输入负责人姓名"})}),e.jsx(d.Item,{name:"category",label:"分类",rules:[{required:!0,message:"请选择分类"}],children:e.jsxs(q,{placeholder:"请选择分类",children:[e.jsx(me,{value:"微生物多样性",children:"微生物多样性"}),e.jsx(me,{value:"功能基因组",children:"功能基因组"}),e.jsx(me,{value:"代谢分析",children:"代谢分析"}),e.jsx(me,{value:"蛋白质组",children:"蛋白质组"}),e.jsx(me,{value:"基因检测",children:"基因检测"}),e.jsx(me,{value:"其他",children:"其他"})]})})]}),e.jsx(d.Item,{name:"status",label:"项目状态",rules:[{required:!0,message:"请选择项目状态"}],children:e.jsxs(q,{placeholder:"请选择项目状态",children:[e.jsx(me,{value:"active",children:"有效"}),e.jsx(me,{value:"pending",children:"待审"}),e.jsx(me,{value:"inactive",children:"停用"})]})}),e.jsx(d.Item,{name:"description",label:"项目描述",children:e.jsx(xe,{placeholder:"请输入项目描述",rows:3})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"price",label:"价格(元)",rules:[{required:!0,message:"请输入价格"}],children:e.jsx(R,{placeholder:"请输入价格",min:0,style:{width:"100%"}})}),e.jsx(d.Item,{name:"duration",label:"报告周期(工作日)",rules:[{required:!0,message:"请输入报告周期"}],children:e.jsx(R,{placeholder:"请输入报告周期",min:1,style:{width:"100%"}})}),e.jsx(d.Item,{name:"methodology",label:"检测方法",rules:[{required:!0,message:"请输入检测方法"}],children:e.jsx(C,{placeholder:"请输入检测方法"})})]}),e.jsx(S,{orientation:"left",children:"方法学配置"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"primaryMethodology",label:"主要方法学",rules:[{required:!0,message:"请选择主要方法学"}],children:e.jsxs(q,{placeholder:"请选择主要方法学",children:[e.jsx(me,{value:"PCR",children:"PCR"}),e.jsx(me,{value:"qPCR",children:"qPCR"}),e.jsx(me,{value:"NGS",children:"NGS"}),e.jsx(me,{value:"Sanger测序",children:"Sanger测序"}),e.jsx(me,{value:"ELISA",children:"ELISA"}),e.jsx(me,{value:"Western Blot",children:"Western Blot"}),e.jsx(me,{value:"免疫荧光",children:"免疫荧光"}),e.jsx(me,{value:"流式细胞术",children:"流式细胞术"}),e.jsx(me,{value:"质谱",children:"质谱"}),e.jsx(me,{value:"色谱",children:"色谱"}),e.jsx(me,{value:"其他",children:"其他"})]})}),e.jsx(d.Item,{name:"backupMethodologies",label:"备用方法学",children:e.jsxs(q,{mode:"multiple",placeholder:"请选择备用方法学",allowClear:!0,children:[e.jsx(me,{value:"PCR",children:"PCR"}),e.jsx(me,{value:"qPCR",children:"qPCR"}),e.jsx(me,{value:"NGS",children:"NGS"}),e.jsx(me,{value:"Sanger测序",children:"Sanger测序"}),e.jsx(me,{value:"ELISA",children:"ELISA"}),e.jsx(me,{value:"Western Blot",children:"Western Blot"}),e.jsx(me,{value:"免疫荧光",children:"免疫荧光"}),e.jsx(me,{value:"流式细胞术",children:"流式细胞术"}),e.jsx(me,{value:"质谱",children:"质谱"}),e.jsx(me,{value:"色谱",children:"色谱"}),e.jsx(me,{value:"其他",children:"其他"})]})})]}),e.jsx(d.Item,{name:"sampleTypes",label:"适用样本类型",rules:[{required:!0,message:"请选择适用样本类型"}],children:e.jsxs(q,{mode:"multiple",placeholder:"请选择适用样本类型",allowClear:!0,children:[e.jsx(me,{value:"血液",children:"血液"}),e.jsx(me,{value:"唾液",children:"唾液"}),e.jsx(me,{value:"粪便",children:"粪便"}),e.jsx(me,{value:"土壤",children:"土壤"}),e.jsx(me,{value:"尿液",children:"尿液"}),e.jsx(me,{value:"组织",children:"组织"}),e.jsx(me,{value:"其他",children:"其他"})]})}),e.jsx(d.Item,{name:"clinicalApplication",label:"临床应用",children:e.jsx(xe,{placeholder:"请描述临床应用场景和意义",rows:2})}),e.jsx(d.Item,{name:"qualityRequirements",label:"质量要求",children:e.jsx(xe,{placeholder:"请描述样本质量要求和技术指标",rows:2})}),e.jsx(d.Item,{name:"reportTemplate",label:"报告模板",children:e.jsx(C,{placeholder:"请输入报告模板名称或版本"})}),e.jsx(S,{orientation:"left",children:"SOP配置"}),e.jsx(d.Item,{name:["sopConfiguration","mode"],label:"配置模式",rules:[{required:!0,message:"请选择配置模式"}],children:e.jsxs(q,{placeholder:"请选择配置模式",children:[e.jsx(me,{value:"document",children:"文档模式"}),e.jsx(me,{value:"structured",children:"结构化模式"})]})}),e.jsx(d.Item,{name:["sopConfiguration","executionMode"],label:"执行模式",rules:[{required:!0,message:"请选择执行模式"}],children:e.jsxs(q,{placeholder:"请选择执行模式",children:[e.jsx(me,{value:"strict",children:"严格模式"}),e.jsx(me,{value:"guided",children:"引导模式"}),e.jsx(me,{value:"reference",children:"参考模式"})]})}),e.jsx(d.Item,{name:"sopDocuments",label:"SOP文档",children:e.jsx(w,{multiple:!0,beforeUpload:()=>!1,fileList:[],children:e.jsx(h,{icon:e.jsx(k,{}),children:"上传SOP文档"})})}),e.jsx(d.Item,{name:["sopConfiguration","templateId"],label:"标准模板",children:e.jsxs(q,{placeholder:"请选择标准模板",allowClear:!0,children:[e.jsx(me,{value:"template_pcr",children:"PCR标准模板"}),e.jsx(me,{value:"template_ngs",children:"NGS标准模板"}),e.jsx(me,{value:"template_elisa",children:"ELISA标准模板"}),e.jsx(me,{value:"template_wb",children:"Western Blot标准模板"}),e.jsx(me,{value:"template_custom",children:"自定义模板"})]})}),e.jsx(d.Item,{name:"associatedAnalysisItems",label:"关联分析项目",children:e.jsxs("div",{children:[e.jsxs(h,{type:"dashed",onClick:()=>{const e={id:"",name:"",code:"",reportOrder:K.length+1,isRequired:!1,isActive:!0};U([...K,e])},style:{width:"100%",marginBottom:16},children:[e.jsx(m,{})," 添加分析项目"]}),K.map((i,l)=>e.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:6,padding:16,marginBottom:16,backgroundColor:"#fafafa"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",gap:"16px",marginBottom:16},children:[e.jsx(q,{placeholder:"请选择分析项目",value:i.id||void 0,onChange:e=>{const t=$.find(i=>i.id===e);if(t){const e=[...K];e[l]={...i,id:t.id,name:t.name,code:t.code},U(e)}},children:$.map(i=>e.jsxs(me,{value:i.id,children:[i.name," (",i.code,")"]},i.id))}),e.jsx(R,{placeholder:"报告顺序",value:i.reportOrder,min:1,onChange:e=>{const t=[...K];t[l]={...i,reportOrder:e||1},U(t)}}),e.jsx(h,{danger:!0,onClick:()=>{const e=K.filter((e,i)=>i!==l);U(e)},children:"删除"})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:i.isRequired,onChange:e=>{const t=[...K];t[l]={...i,isRequired:e.target.checked},U(t)}}),e.jsx("span",{style:{marginLeft:8},children:"必需项目"})]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:i.isActive,onChange:e=>{const t=[...K];t[l]={...i,isActive:e.target.checked},U(t)}}),e.jsx("span",{style:{marginLeft:8},children:"启用状态"})]})]})]},l))]})}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:e.jsx(d.Item,{name:"isActive",label:"启用状态",valuePropName:"checked",initialValue:!0,children:e.jsx(A,{checkedChildren:"启用",unCheckedChildren:"禁用"})})}),e.jsx(d.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(I,{children:[e.jsx(h,{onClick:()=>{a(!1),L(null),Q.resetFields()},children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",children:c?"更新":"创建"})]})})]})})]})},{Title:pe}=c,{Option:je}=q,{TextArea:ge}=C,ve=()=>{const t=l(),[s]=d.useForm(),[r,n]=i.useState(!1),[a,c]=i.useState([]),x=[{id:"1",name:"BRCA1基因检测",code:"BRCA1",category:"遗传学检测"},{id:"2",name:"BRCA2基因检测",code:"BRCA2",category:"遗传学检测"},{id:"3",name:"TP53基因检测",code:"TP53",category:"肿瘤标志物"},{id:"4",name:"EGFR基因检测",code:"EGFR",category:"肿瘤标志物"},{id:"5",name:"KRAS基因检测",code:"KRAS",category:"肿瘤标志物"}],u=(e,i,l)=>{const t=[...a];if("analysisItemId"===i){const i=x.find(e=>e.id===l);i&&(t[e]={...t[e],id:i.id,name:i.name,code:i.code})}else t[e]={...t[e],[i]:l};c(t)};return e.jsx("div",{style:{padding:"24px",minHeight:"100vh",backgroundColor:"#f5f5f5"},children:e.jsxs(o,{children:[e.jsx("div",{style:{marginBottom:24},children:e.jsxs(I,{children:[e.jsx(h,{icon:e.jsx(L,{}),onClick:()=>t("/detection/test-item"),children:"返回列表"}),e.jsx(pe,{level:3,style:{margin:0},children:"新增检测项目"})]})}),e.jsxs(d,{form:s,layout:"vertical",onFinish:async e=>{try{n(!0);e.mode,e.executionMode,e.templateId,(new Date).toISOString(),(new Date).toISOString();await new Promise(e=>setTimeout(e,1e3)),P.success("检测项目创建成功！"),t("/detection/test-item")}catch(i){P.error("创建失败，请重试")}finally{n(!1)}},initialValues:{isActive:!0,status:"active",duration:5,price:0,mode:"document",executionMode:"reference"},children:[e.jsxs(o,{title:"基本信息",style:{marginBottom:16},children:[e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"项目名称",name:"name",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(C,{placeholder:"请输入项目名称"})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"英文名称",name:"englishName",children:e.jsx(C,{placeholder:"请输入英文名称"})})})]}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"项目编码",name:"code",rules:[{required:!0,message:"请输入项目编码"}],children:e.jsx(C,{placeholder:"请输入项目编码"})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"项目分类",name:"category",rules:[{required:!0,message:"请选择项目分类"}],children:e.jsxs(q,{placeholder:"请选择项目分类",children:[e.jsx(je,{value:"遗传学检测",children:"遗传学检测"}),e.jsx(je,{value:"肿瘤标志物",children:"肿瘤标志物"}),e.jsx(je,{value:"病原体检测",children:"病原体检测"}),e.jsx(je,{value:"药物基因组学",children:"药物基因组学"})]})})})]}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"所属科室",name:"department",children:e.jsxs(q,{placeholder:"请选择所属科室",children:[e.jsx(je,{value:"分子诊断科",children:"分子诊断科"}),e.jsx(je,{value:"病理科",children:"病理科"}),e.jsx(je,{value:"检验科",children:"检验科"}),e.jsx(je,{value:"肿瘤科",children:"肿瘤科"})]})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"负责人",name:"responsible",children:e.jsx(C,{placeholder:"请输入负责人"})})})]}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"项目价格",name:"price",rules:[{required:!0,message:"请输入项目价格"}],children:e.jsx(R,{style:{width:"100%"},placeholder:"请输入项目价格",min:0,precision:2,addonAfter:"元"})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"报告周期(工作日)",name:"duration",rules:[{required:!0,message:"请输入报告周期"}],children:e.jsx(R,{style:{width:"100%"},placeholder:"请输入报告周期",min:1,addonAfter:"天"})})})]}),e.jsx(d.Item,{label:"项目描述",name:"description",children:e.jsx(ge,{rows:3,placeholder:"请输入项目描述"})})]}),e.jsxs(o,{title:"技术信息",style:{marginBottom:16},children:[e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"主方法学",name:"primaryMethodology",rules:[{required:!0,message:"请选择主方法学"}],children:e.jsxs(q,{placeholder:"请选择主方法学",children:[e.jsx(je,{value:"PCR",children:"PCR"}),e.jsx(je,{value:"qPCR",children:"qPCR"}),e.jsx(je,{value:"NGS",children:"NGS"}),e.jsx(je,{value:"Sanger测序",children:"Sanger测序"}),e.jsx(je,{value:"FISH",children:"FISH"}),e.jsx(je,{value:"免疫组化",children:"免疫组化"})]})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"备用方法学",name:"backupMethodologies",children:e.jsxs(q,{mode:"multiple",placeholder:"请选择备用方法学",children:[e.jsx(je,{value:"PCR",children:"PCR"}),e.jsx(je,{value:"qPCR",children:"qPCR"}),e.jsx(je,{value:"NGS",children:"NGS"}),e.jsx(je,{value:"Sanger测序",children:"Sanger测序"}),e.jsx(je,{value:"FISH",children:"FISH"}),e.jsx(je,{value:"免疫组化",children:"免疫组化"})]})})})]}),e.jsx(d.Item,{label:"样本类型",name:"sampleTypes",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsxs(q,{mode:"multiple",placeholder:"请选择样本类型",children:[e.jsx(je,{value:"全血",children:"全血"}),e.jsx(je,{value:"血浆",children:"血浆"}),e.jsx(je,{value:"血清",children:"血清"}),e.jsx(je,{value:"唾液",children:"唾液"}),e.jsx(je,{value:"组织",children:"组织"}),e.jsx(je,{value:"石蜡切片",children:"石蜡切片"}),e.jsx(je,{value:"尿液",children:"尿液"})]})})]}),e.jsxs(o,{title:"临床信息",style:{marginBottom:16},children:[e.jsx(d.Item,{label:"临床应用",name:"clinicalApplication",children:e.jsx(ge,{rows:3,placeholder:"请输入临床应用描述"})}),e.jsx(d.Item,{label:"质量要求",name:"qualityRequirements",children:e.jsx(ge,{rows:3,placeholder:"请输入质量要求"})}),e.jsx(d.Item,{label:"报告模板",name:"reportTemplate",children:e.jsxs(q,{placeholder:"请选择报告模板",children:[e.jsx(je,{value:"标准模板",children:"标准模板"}),e.jsx(je,{value:"简化模板",children:"简化模板"}),e.jsx(je,{value:"详细模板",children:"详细模板"}),e.jsx(je,{value:"自定义模板",children:"自定义模板"})]})})]}),e.jsxs(o,{title:"SOP配置",style:{marginBottom:16},children:[e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"配置模式",name:"mode",rules:[{required:!0,message:"请选择配置模式"}],children:e.jsxs(q,{placeholder:"请选择配置模式",children:[e.jsx(je,{value:"document",children:"文档模式"}),e.jsx(je,{value:"structured",children:"结构化模式"})]})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"执行模式",name:"executionMode",rules:[{required:!0,message:"请选择执行模式"}],children:e.jsxs(q,{placeholder:"请选择执行模式",children:[e.jsx(je,{value:"strict",children:"严格模式"}),e.jsx(je,{value:"guided",children:"引导模式"}),e.jsx(je,{value:"reference",children:"参考模式"})]})})})]}),e.jsx(d.Item,{label:"SOP文档",name:"sopDocuments",children:e.jsx(w,{multiple:!0,beforeUpload:()=>!1,showUploadList:{showRemoveIcon:!0},children:e.jsx(h,{icon:e.jsx(k,{}),children:"上传SOP文档"})})}),e.jsx(d.Item,{label:"标准模板",name:"templateId",children:e.jsxs(q,{placeholder:"请选择标准模板",children:[e.jsx(je,{value:"template1",children:"PCR标准模板"}),e.jsx(je,{value:"template2",children:"NGS标准模板"}),e.jsx(je,{value:"template3",children:"免疫组化标准模板"}),e.jsx(je,{value:"template4",children:"FISH标准模板"})]})})]}),e.jsxs(o,{title:"关联分析项目",style:{marginBottom:16},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(h,{type:"dashed",icon:e.jsx(m,{}),onClick:()=>{const e={id:"",name:"",code:"",reportOrder:a.length+1,isRequired:!1,isActive:!0};c([...a,e])},block:!0,children:"添加关联分析项目"})}),a.map((i,l)=>e.jsx(o,{size:"small",style:{marginBottom:8},extra:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(F,{}),onClick:()=>(e=>{const i=a.filter((i,l)=>l!==e);c(i)})(l)}),children:e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:8,children:e.jsx(d.Item,{label:"分析项目",style:{marginBottom:0},children:e.jsx(q,{placeholder:"请选择分析项目",value:i.id,onChange:e=>u(l,"analysisItemId",e),children:x.map(i=>e.jsxs(je,{value:i.id,children:[i.name," (",i.code,")"]},i.id))})})}),e.jsx(G,{span:4,children:e.jsx(d.Item,{label:"报告顺序",style:{marginBottom:0},children:e.jsx(R,{min:1,value:i.reportOrder,onChange:e=>u(l,"reportOrder",e)})})}),e.jsx(G,{span:6,children:e.jsx(d.Item,{label:"是否必需",style:{marginBottom:0},children:e.jsx(A,{checked:i.isRequired,onChange:e=>u(l,"isRequired",e)})})}),e.jsx(G,{span:6,children:e.jsx(d.Item,{label:"是否启用",style:{marginBottom:0},children:e.jsx(A,{checked:i.isActive,onChange:e=>u(l,"isActive",e)})})})]})},l))]}),e.jsx(o,{title:"状态设置",style:{marginBottom:24},children:e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"项目状态",name:"status",rules:[{required:!0,message:"请选择项目状态"}],children:e.jsxs(q,{placeholder:"请选择项目状态",children:[e.jsx(je,{value:"active",children:"启用"}),e.jsx(je,{value:"inactive",children:"停用"}),e.jsx(je,{value:"pending",children:"待审核"})]})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{label:"是否激活",name:"isActive",valuePropName:"checked",children:e.jsx(A,{})})})]})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsxs(I,{size:"large",children:[e.jsx(h,{onClick:()=>t("/detection/test-item"),children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",loading:r,icon:e.jsx(E,{}),children:"保存"})]})})]})]})})},{Option:ye}=q,{TextArea:Ie}=C,{Text:be}=c,fe=()=>{var l;const[t,s]=i.useState([{id:"1",name:"EGFR基因突变检测",code:"EGFR_MUT",testItemId:"1",testItemName:"肺癌基因检测",category:"基因突变",type:"qualitative",referenceRange:"野生型",normalValue:"未检出突变",abnormalCriteria:"检出突变",clinicalSignificance:"用于指导靶向治疗药物选择，EGFR突变阳性患者可使用吉非替尼、厄洛替尼等靶向药物",methodologyId:"1",methodologyName:"NGS测序",sampleType:["血液","组织"],reportOrder:1,isActive:!0,isRequired:!0,description:"EGFR基因19、21外显子突变检测",status:"active",reportConfiguration:{template:"EGFR突变检测报告模板v2.1",format:"pdf",includeGraphs:!0,includeInterpretation:!0},qualityControl:{cvRequirement:15,accuracyRequirement:95,precisionRequirement:90},associatedDiseases:["非小细胞肺癌","肺腺癌"],interpretationRules:[{condition:"检出19外显子缺失突变",interpretation:"EGFR敏感突变阳性",recommendation:"建议使用EGFR-TKI靶向治疗"},{condition:"检出21外显子L858R突变",interpretation:"EGFR敏感突变阳性",recommendation:"建议使用EGFR-TKI靶向治疗"}],createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"2",name:"KRAS基因突变检测",code:"KRAS_MUT",testItemId:"1",testItemName:"肺癌基因检测",category:"基因突变",type:"qualitative",referenceRange:"野生型",normalValue:"未检出突变",abnormalCriteria:"检出突变",clinicalSignificance:"用于预测治疗反应性，KRAS突变患者对EGFR-TKI治疗耐药",methodologyId:"1",methodologyName:"NGS测序",sampleType:["血液","组织"],reportOrder:2,isActive:!0,isRequired:!1,description:"KRAS基因2、3、4外显子突变检测",status:"active",reportConfiguration:{template:"KRAS突变检测报告模板v1.3",format:"pdf",includeGraphs:!1,includeInterpretation:!0},qualityControl:{cvRequirement:20,accuracyRequirement:92,precisionRequirement:88},associatedDiseases:["非小细胞肺癌","结直肠癌"],interpretationRules:[{condition:"检出KRAS突变",interpretation:"KRAS突变阳性",recommendation:"不建议使用EGFR-TKI治疗，考虑化疗或免疫治疗"}],createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"3",name:"HER2基因扩增检测",code:"HER2_AMP",testItemId:"2",testItemName:"乳腺癌基因检测",category:"基因扩增",type:"quantitative",unit:"拷贝数",referenceRange:"<2.0",normalValue:"<2.0",abnormalCriteria:"≥2.0",clinicalSignificance:"用于HER2靶向治疗指导，HER2扩增阳性患者可使用曲妥珠单抗等靶向药物",methodologyId:"2",methodologyName:"qPCR",sampleType:["组织"],reportOrder:1,isActive:!0,isRequired:!0,description:"HER2基因拷贝数检测",status:"active",reportConfiguration:{template:"HER2扩增检测报告模板v1.8",format:"pdf",includeGraphs:!0,includeInterpretation:!0},qualityControl:{cvRequirement:10,accuracyRequirement:98,precisionRequirement:95},associatedDiseases:["乳腺癌","胃癌"],interpretationRules:[{condition:"HER2拷贝数≥2.0",interpretation:"HER2扩增阳性",recommendation:"建议使用HER2靶向治疗药物"}],createdAt:"2024-01-16",updatedAt:"2024-01-16"},{id:"4",name:"MSI微卫星不稳定性",code:"MSI_STATUS",testItemId:"3",testItemName:"结直肠癌基因检测",category:"微卫星",type:"qualitative",referenceRange:"MSS",normalValue:"MSS（微卫星稳定）",abnormalCriteria:"MSI-H（高度不稳定）",clinicalSignificance:"用于免疫治疗疗效预测，MSI-H患者对PD-1/PD-L1抑制剂治疗敏感",methodologyId:"1",methodologyName:"NGS测序",sampleType:["组织"],reportOrder:1,isActive:!0,isRequired:!0,description:"5个微卫星位点不稳定性检测",status:"active",reportConfiguration:{template:"MSI检测报告模板v2.0",format:"pdf",includeGraphs:!0,includeInterpretation:!0},qualityControl:{cvRequirement:5,accuracyRequirement:99,precisionRequirement:98},associatedDiseases:["结直肠癌","子宫内膜癌","胃癌"],interpretationRules:[{condition:"MSI-H",interpretation:"微卫星高度不稳定",recommendation:"建议使用PD-1/PD-L1抑制剂免疫治疗"}],createdAt:"2024-01-17",updatedAt:"2024-01-17"}]),[r,n]=i.useState(!1),[a,c]=i.useState(null),[g]=d.useForm(),[b,w]=i.useState(""),[k,N]=i.useState(!1),[z,V]=i.useState(null),L=e=>{c(e||null),e?g.setFieldsValue(e):g.resetFields(),n(!0)},M=e=>({active:{text:"有效",color:"green"},pending:{text:"待审",color:"orange"},inactive:{text:"停用",color:"red"}}[e]||{text:e,color:"default"}),G=t.filter(e=>e.name.toLowerCase().includes(b.toLowerCase())||e.code.toLowerCase().includes(b.toLowerCase())||e.testItemName.toLowerCase().includes(b.toLowerCase())),E=[{title:"项目名称",dataIndex:"name",key:"name",width:200,render:(i,l)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:l.code})]})},{title:"所属检测项目",dataIndex:"testItemName",key:"testItemName",width:150},{title:"类别",dataIndex:"category",key:"category",width:100},{title:"类型",dataIndex:"type",key:"type",width:100,render:i=>{const l={quantitative:{text:"定量",color:"blue"},qualitative:{text:"定性",color:"green"},"semi-quantitative":{text:"半定量",color:"orange"}}[i];return e.jsx(j,{color:l.color,children:l.text})}},{title:"参考范围",dataIndex:"referenceRange",key:"referenceRange",width:120,render:(i,l)=>e.jsxs("div",{children:[e.jsx("div",{children:i}),l.unit&&e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["单位: ",l.unit]})]})},{title:"关联疾病",key:"associatedDiseases",width:120,render:i=>{var l,t;return e.jsx(T,{title:(null==(l=i.associatedDiseases)?void 0:l.join("、"))||"无",children:e.jsx(be,{ellipsis:!0,style:{maxWidth:100},children:(t=i.associatedDiseases,t&&0!==t.length?t.slice(0,2).join("、")+(t.length>2?"等":""):"无")})})}},{title:"方法学",dataIndex:"methodologyName",key:"methodologyName",width:100},{title:"样本类型",dataIndex:"sampleType",key:"sampleType",width:120,render:i=>e.jsxs("div",{children:[i.slice(0,2).map(i=>e.jsx(j,{children:i},i)),i.length>2&&e.jsxs(j,{children:["+",i.length-2]})]})},{title:"报告顺序",dataIndex:"reportOrder",key:"reportOrder",width:80,align:"center"},{title:"项目状态",key:"status",width:100,render:i=>{const l=M(i.status);return e.jsxs("div",{children:[e.jsx(j,{color:l.color,children:l.text}),i.isRequired&&e.jsx(y,{status:"processing",text:"必需"})]})}},{title:"操作",key:"action",width:150,render:i=>e.jsxs(I,{size:"small",children:[e.jsx(T,{title:"查看详情",children:e.jsx(h,{type:"text",icon:e.jsx(O,{}),onClick:()=>(V(i),void N(!0))})}),e.jsx(T,{title:"编辑",children:e.jsx(h,{type:"text",icon:e.jsx(B,{}),onClick:()=>L(i)})}),e.jsx(D,{title:"确定要删除这个分析项目吗？",onConfirm:()=>{return e=i.id,s(i=>i.filter(i=>i.id!==e)),void P.success("分析项目删除成功");var e},okText:"确定",cancelText:"取消",children:e.jsx(T,{title:"删除",children:e.jsx(h,{type:"text",danger:!0,icon:e.jsx(F,{})})})})]})},{title:"临床意义",dataIndex:"clinicalSignificance",key:"clinicalSignificance",width:200,ellipsis:{showTitle:!1},render:i=>e.jsx(T,{placement:"topLeft",title:i,children:i})}];return e.jsxs(o,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx(I,{children:e.jsx(C,{placeholder:"搜索分析项目名称、编码或所属检测项目",prefix:e.jsx(_,{}),value:b,onChange:e=>w(e.target.value),style:{width:300}})}),e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>L(),children:"添加分析项目"})]}),e.jsx(x,{columns:E,dataSource:G,rowKey:"id",pagination:{total:G.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`},scroll:{x:1600}}),e.jsx(u,{title:"分析项目详情",placement:"right",width:800,open:k,onClose:()=>{N(!1),V(null)},children:z&&e.jsxs("div",{children:[e.jsxs(p,{title:"基本信息",bordered:!0,column:2,size:"small",children:[e.jsx(p.Item,{label:"项目名称",children:z.name}),e.jsx(p.Item,{label:"项目编码",children:z.code}),e.jsx(p.Item,{label:"所属检测项目",children:z.testItemName}),e.jsx(p.Item,{label:"项目类别",children:z.category}),e.jsx(p.Item,{label:"检测类型",children:e.jsx(j,{color:"quantitative"===z.type?"blue":"qualitative"===z.type?"green":"orange",children:"quantitative"===z.type?"定量":"qualitative"===z.type?"定性":"半定量"})}),e.jsxs(p.Item,{label:"项目状态",children:[e.jsx(j,{color:M(z.status).color,children:M(z.status).text}),z.isRequired&&e.jsx(y,{status:"processing",text:"必需"})]})]}),e.jsx(S,{}),e.jsxs(p,{title:"检测参数",bordered:!0,column:2,size:"small",children:[e.jsx(p.Item,{label:"参考范围",children:z.referenceRange}),e.jsx(p.Item,{label:"单位",children:z.unit||"无"}),e.jsx(p.Item,{label:"正常值",children:z.normalValue}),e.jsx(p.Item,{label:"异常判断标准",children:z.abnormalCriteria}),e.jsx(p.Item,{label:"检测方法学",children:z.methodologyName}),e.jsx(p.Item,{label:"报告顺序",children:z.reportOrder}),e.jsx(p.Item,{label:"样本类型",span:2,children:z.sampleType.map(i=>e.jsx(j,{children:i},i))})]}),e.jsx(S,{}),e.jsxs(p,{title:"临床信息",bordered:!0,column:1,size:"small",children:[e.jsx(p.Item,{label:"临床意义",children:z.clinicalSignificance}),e.jsx(p.Item,{label:"关联疾病",children:(null==(l=z.associatedDiseases)?void 0:l.map(i=>e.jsx(j,{color:"blue",children:i},i)))||"无"}),e.jsx(p.Item,{label:"项目描述",children:z.description||"无"})]}),z.qualityControl&&e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsxs(p,{title:"质量控制要求",bordered:!0,column:2,size:"small",children:[e.jsxs(p.Item,{label:"CV要求",children:["≤",z.qualityControl.cvRequirement,"%"]}),e.jsxs(p.Item,{label:"准确度要求",children:["≥",z.qualityControl.accuracyRequirement,"%"]}),e.jsxs(p.Item,{label:"精密度要求",span:2,children:["≥",z.qualityControl.precisionRequirement,"%"]})]})]}),z.reportConfiguration&&e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsxs(p,{title:"报告配置",bordered:!0,column:2,size:"small",children:[e.jsx(p.Item,{label:"报告模板",children:z.reportConfiguration.template}),e.jsx(p.Item,{label:"报告格式",children:e.jsx(j,{color:"blue",children:z.reportConfiguration.format.toUpperCase()})}),e.jsx(p.Item,{label:"包含图表",children:e.jsx(y,{status:z.reportConfiguration.includeGraphs?"success":"default",text:z.reportConfiguration.includeGraphs?"是":"否"})}),e.jsx(p.Item,{label:"包含解读",children:e.jsx(y,{status:z.reportConfiguration.includeInterpretation?"success":"default",text:z.reportConfiguration.includeInterpretation?"是":"否"})})]})]}),z.interpretationRules&&z.interpretationRules.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(S,{}),e.jsxs("div",{children:[e.jsx(be,{strong:!0,children:"解读规则"}),e.jsx(v,{size:"small",bordered:!0,dataSource:z.interpretationRules,renderItem:(i,l)=>e.jsx(v.Item,{children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsxs(be,{strong:!0,children:["条件 ",l+1,":"]})," ",i.condition]}),e.jsxs("div",{children:[e.jsx(be,{strong:!0,children:"解读:"})," ",i.interpretation]}),e.jsxs("div",{children:[e.jsx(be,{strong:!0,children:"建议:"})," ",i.recommendation]})]})})})]})]}),e.jsx(S,{}),e.jsxs(p,{title:"系统信息",bordered:!0,column:2,size:"small",children:[e.jsx(p.Item,{label:"创建时间",children:z.createdAt}),e.jsx(p.Item,{label:"更新时间",children:z.updatedAt})]})]})}),e.jsx(f,{title:a?"编辑分析项目":"添加分析项目",open:r,onCancel:()=>n(!1),footer:null,width:1e3,children:e.jsxs(d,{form:g,layout:"vertical",onFinish:e=>{if(a)s(i=>i.map(i=>i.id===a.id?{...i,...e,updatedAt:(new Date).toISOString().split("T")[0]}:i)),P.success("分析项目更新成功");else{const i={...e,id:Date.now().toString(),createdAt:(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};s(e=>[...e,i]),P.success("分析项目添加成功")}n(!1),g.resetFields()},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"name",label:"项目名称",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(C,{placeholder:"请输入项目名称"})}),e.jsx(d.Item,{name:"code",label:"项目编码",rules:[{required:!0,message:"请输入项目编码"}],children:e.jsx(C,{placeholder:"请输入项目编码"})}),e.jsx(d.Item,{name:"testItemId",label:"所属检测项目",rules:[{required:!0,message:"请选择所属检测项目"}],children:e.jsxs(q,{placeholder:"请选择所属检测项目",children:[e.jsx(ye,{value:"1",children:"肺癌基因检测"}),e.jsx(ye,{value:"2",children:"乳腺癌基因检测"}),e.jsx(ye,{value:"3",children:"结直肠癌基因检测"})]})}),e.jsx(d.Item,{name:"category",label:"项目类别",rules:[{required:!0,message:"请输入项目类别"}],children:e.jsx(C,{placeholder:"如：基因突变、基因扩增等"})}),e.jsx(d.Item,{name:"type",label:"检测类型",rules:[{required:!0,message:"请选择检测类型"}],children:e.jsxs(q,{placeholder:"请选择检测类型",children:[e.jsx(ye,{value:"quantitative",children:"定量"}),e.jsx(ye,{value:"qualitative",children:"定性"}),e.jsx(ye,{value:"semi-quantitative",children:"半定量"})]})}),e.jsx(d.Item,{name:"status",label:"项目状态",rules:[{required:!0,message:"请选择项目状态"}],children:e.jsxs(q,{placeholder:"请选择项目状态",children:[e.jsx(ye,{value:"active",children:"启用"}),e.jsx(ye,{value:"pending",children:"待审核"}),e.jsx(ye,{value:"inactive",children:"停用"})]})}),e.jsx(d.Item,{name:"unit",label:"单位",children:e.jsx(C,{placeholder:"如：拷贝数、ng/ml等"})}),e.jsx(d.Item,{name:"referenceRange",label:"参考范围",rules:[{required:!0,message:"请输入参考范围"}],children:e.jsx(C,{placeholder:"请输入参考范围"})}),e.jsx(d.Item,{name:"normalValue",label:"正常值",children:e.jsx(C,{placeholder:"请输入正常值描述"})}),e.jsx(d.Item,{name:"abnormalCriteria",label:"异常判断标准",children:e.jsx(C,{placeholder:"请输入异常判断标准"})}),e.jsx(d.Item,{name:"methodologyId",label:"检测方法学",rules:[{required:!0,message:"请选择检测方法学"}],children:e.jsxs(q,{placeholder:"请选择检测方法学",children:[e.jsx(ye,{value:"1",children:"NGS测序"}),e.jsx(ye,{value:"2",children:"qPCR"}),e.jsx(ye,{value:"3",children:"Sanger测序"}),e.jsx(ye,{value:"4",children:"FISH"})]})}),e.jsx(d.Item,{name:"sampleType",label:"适用样本类型",rules:[{required:!0,message:"请选择适用样本类型"}],children:e.jsxs(q,{mode:"multiple",placeholder:"请选择适用样本类型",children:[e.jsx(ye,{value:"血液",children:"血液"}),e.jsx(ye,{value:"组织",children:"组织"}),e.jsx(ye,{value:"唾液",children:"唾液"}),e.jsx(ye,{value:"尿液",children:"尿液"})]})}),e.jsx(d.Item,{name:"reportOrder",label:"报告顺序",rules:[{required:!0,message:"请输入报告顺序"}],children:e.jsx(R,{min:1,placeholder:"报告中的显示顺序",style:{width:"100%"}})}),e.jsx(d.Item,{name:"associatedDiseases",label:"关联疾病",children:e.jsxs(q,{mode:"tags",placeholder:"请输入关联疾病，支持多个",children:[e.jsx(ye,{value:"肺癌",children:"肺癌"}),e.jsx(ye,{value:"乳腺癌",children:"乳腺癌"}),e.jsx(ye,{value:"结直肠癌",children:"结直肠癌"}),e.jsx(ye,{value:"胃癌",children:"胃癌"}),e.jsx(ye,{value:"肝癌",children:"肝癌"})]})}),e.jsx(d.Item,{name:"isActive",label:"启用状态",valuePropName:"checked",initialValue:!0,children:e.jsx(A,{checkedChildren:"启用",unCheckedChildren:"禁用"})}),e.jsx(d.Item,{name:"isRequired",label:"是否必检",valuePropName:"checked",initialValue:!1,children:e.jsx(A,{checkedChildren:"必检",unCheckedChildren:"可选"})})]}),e.jsx(d.Item,{name:"clinicalSignificance",label:"临床意义",rules:[{required:!0,message:"请输入临床意义"}],children:e.jsx(Ie,{rows:3,placeholder:"请描述该分析项目的临床意义"})}),e.jsx(d.Item,{name:"description",label:"项目描述",children:e.jsx(Ie,{rows:2,placeholder:"请输入项目详细描述"})}),e.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",padding:"16px",marginBottom:"16px"},children:[e.jsx("h4",{style:{marginBottom:"16px",color:"#1890ff"},children:"质量控制要求"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:["qualityControl","cvRequirement"],label:"CV要求 (%)",children:e.jsx(R,{min:0,max:100,placeholder:"变异系数要求",style:{width:"100%"}})}),e.jsx(d.Item,{name:["qualityControl","accuracyRequirement"],label:"准确度要求 (%)",children:e.jsx(R,{min:0,max:100,placeholder:"准确度要求",style:{width:"100%"}})}),e.jsx(d.Item,{name:["qualityControl","precisionRequirement"],label:"精密度要求 (%)",children:e.jsx(R,{min:0,max:100,placeholder:"精密度要求",style:{width:"100%"}})})]})]}),e.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",padding:"16px",marginBottom:"16px"},children:[e.jsx("h4",{style:{marginBottom:"16px",color:"#1890ff"},children:"报告配置"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:["reportConfiguration","template"],label:"报告模板",children:e.jsx(C,{placeholder:"报告模板名称"})}),e.jsx(d.Item,{name:["reportConfiguration","format"],label:"报告格式",children:e.jsxs(q,{placeholder:"请选择报告格式",children:[e.jsx(ye,{value:"pdf",children:"PDF"}),e.jsx(ye,{value:"word",children:"Word"}),e.jsx(ye,{value:"html",children:"HTML"})]})}),e.jsx(d.Item,{name:["reportConfiguration","includeGraphs"],label:"包含图表",valuePropName:"checked",children:e.jsx(A,{checkedChildren:"是",unCheckedChildren:"否"})}),e.jsx(d.Item,{name:["reportConfiguration","includeInterpretation"],label:"包含解读",valuePropName:"checked",children:e.jsx(A,{checkedChildren:"是",unCheckedChildren:"否"})})]})]}),e.jsx(d.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(I,{children:[e.jsx(h,{onClick:()=>n(!1),children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",children:a?"更新":"添加"})]})})]})})]})},{Option:Ce}=q,{TextArea:qe}=C,{Text:Re}=c,{Panel:Se}=K,{Step:we}=W,ke=()=>{const[l,t]=i.useState([{id:"1",name:"二代测序技术（NGS）",code:"NGS_V2.1",category:"基因测序",status:"active",principle:"基于合成测序技术，通过DNA聚合酶在模板链上合成互补链，同时检测每个碱基的加入",technicalParameters:{throughput:"20Gb/run",sensitivity:"≥99%",specificity:"≥99.5%",precision:"CV≤5%",accuracy:"≥99%",linearRange:"10ng-1μg",detectionLimit:"5% VAF",reportableRange:"1%-100% VAF",cvRequirement:5,biasRequirement:10},instrumentRequirements:{mainInstruments:["Illumina NovaSeq 6000","Agilent 2100生物分析仪"],auxiliaryInstruments:["离心机","移液器","PCR仪","涡旋混合器"],calibrationRequirements:"每月校准一次，使用标准品验证",maintenanceSchedule:"每周清洁，每月维护，每季度深度保养",environmentalConditions:{temperature:"18-25°C",humidity:"30-70%",ventilation:"每小时换气15次以上"}},sampleRequirements:{sampleTypes:["血液","组织","FFPE","胸腹水"],minimumVolume:"血液≥2ml，组织≥10mg",qualityRequirements:"DNA浓度≥10ng/μL，总量≥100ng，A260/A280比值1.8-2.0",storageConditions:"-80°C长期保存，-20°C短期保存",transportRequirements:"干冰运输，避免反复冻融",pretreatmentSteps:["DNA提取","质量检测","浓度标准化"]},associatedDetectionItems:["肺癌基因检测","乳腺癌基因检测"],procedureSteps:["DNA质量检测","文库构建","文库质控","上机测序","数据分析","结果解读"],qualityControl:"每批次包含阳性对照、阴性对照和质控样本",resultInterpretation:"根据变异频率和数据库注释进行临床意义评估",limitations:"无法检测大片段重排、重复序列区域检测能力有限",references:["PMID: 12345678","ISO 15189:2012","CAP分子病理学指南"],sopDocuments:[{id:"sop1",name:"NGS操作手册",version:"V2.1",type:"procedure",uploadDate:"2024-01-01",fileUrl:"/files/ngs-manual.pdf",approver:"张主任",status:"approved"},{id:"sop2",name:"质量控制SOP",version:"V1.0",type:"quality",uploadDate:"2024-01-01",fileUrl:"/files/qc-sop.pdf",approver:"张主任",status:"approved"}],version:"V2.1",effectiveDate:"2024-01-01",reviewDate:"2024-12-31",approver:"张主任",isActive:!0,createdAt:"2024-01-01",updatedAt:"2024-01-15"},{id:"2",name:"实时荧光定量PCR（qPCR）",code:"qPCR_V1.3",category:"基因扩增",status:"active",principle:"基于PCR扩增原理，通过荧光信号实时监测DNA扩增过程",technicalParameters:{throughput:"96样本/run",sensitivity:"10拷贝/反应",specificity:"≥99%",precision:"CV≤3%",accuracy:"±0.2 Ct值",linearRange:"10^2-10^8拷贝数",detectionLimit:"10拷贝/反应",reportableRange:"10-10^9拷贝数",cvRequirement:3,biasRequirement:5},instrumentRequirements:{mainInstruments:["ABI 7500实时PCR仪"],auxiliaryInstruments:["离心机","移液器","涡旋混合器","冰盒"],calibrationRequirements:"每月使用标准品校准",maintenanceSchedule:"每周清洁光学系统，每月更换滤光片",environmentalConditions:{temperature:"20-25°C",humidity:"40-60%",ventilation:"避免震动和强光"}},sampleRequirements:{sampleTypes:["血液","组织","唾液"],minimumVolume:"血液≥1ml，组织≥5mg",qualityRequirements:"DNA浓度1-100ng/μL，无蛋白质和RNA污染",storageConditions:"-20°C保存，避免反复冻融",transportRequirements:"冰袋运输，24小时内处理",pretreatmentSteps:["DNA提取","浓度测定","稀释至工作浓度"]},associatedDetectionItems:["病毒载量检测","基因拷贝数检测"],procedureSteps:["样本预处理","反应体系配制","PCR程序设置","扩增检测","结果分析"],qualityControl:"每次实验包含标准品、阳性对照、阴性对照",resultInterpretation:"根据Ct值和标准曲线计算拷贝数",limitations:"只能检测已知序列，扩增片段长度有限",references:["PMID: 87654321","MIQE指南","FDA qPCR指导原则"],sopDocuments:[{id:"sop3",name:"qPCR标准操作程序",version:"V1.3",type:"procedure",uploadDate:"2023-06-01",fileUrl:"/files/qpcr-sop.pdf",approver:"李博士",status:"approved"}],version:"V1.3",effectiveDate:"2023-06-01",reviewDate:"2024-06-01",approver:"李博士",isActive:!0,createdAt:"2023-06-01",updatedAt:"2024-01-10"},{id:"3",name:"Sanger测序",code:"SANGER_V1.0",category:"基因测序",status:"pending",principle:"基于链终止法的DNA测序技术，使用荧光标记的双脱氧核苷酸",technicalParameters:{throughput:"96样本/天",sensitivity:"≥95%",specificity:"≥99%",precision:"Phred质量值≥20",accuracy:"≥99%",detectionLimit:"20% 杂合突变",reportableRange:"100-800bp序列",cvRequirement:10,biasRequirement:15},instrumentRequirements:{mainInstruments:["ABI 3730xl测序仪"],auxiliaryInstruments:["PCR仪","离心机","电泳仪","纯化柱"],calibrationRequirements:"每周校准，使用标准DNA验证",maintenanceSchedule:"每日清洁毛细管，每周更换缓冲液",environmentalConditions:{temperature:"22-25°C",humidity:"45-65%",ventilation:"无尘环境，避免震动"}},sampleRequirements:{sampleTypes:["PCR产物","DNA"],minimumVolume:"PCR产物≥20μl",qualityRequirements:"PCR产物浓度10-50ng/μL，长度100-800bp",storageConditions:"4°C短期保存，-20°C长期保存",transportRequirements:"常温运输，避免污染",pretreatmentSteps:["PCR扩增","产物纯化","浓度检测"]},associatedDetectionItems:["单基因突变检测"],procedureSteps:["PCR扩增","产物纯化","测序反应","产物纯化","毛细管电泳","序列分析"],qualityControl:"每批次包含已知序列对照",resultInterpretation:"通过序列比对识别变异位点",limitations:"通量低，成本高，无法检测大片段缺失",references:["PMID: 11111111","Sanger测序标准","ACMG指南"],version:"V1.0",effectiveDate:"2023-01-01",reviewDate:"2024-01-01",approver:"王教授",isActive:!0,createdAt:"2023-01-01",updatedAt:"2023-12-01"}]),[s,r]=i.useState(!1),[n,a]=i.useState(null),[c]=d.useForm(),[g,N]=i.useState(""),[z,V]=i.useState(!1),[L,M]=i.useState(null),G=e=>({active:{text:"启用",color:"success"},pending:{text:"待审",color:"warning"},inactive:{text:"停用",color:"default"}}[e]||{text:e,color:"default"}),E=e=>({procedure:"操作程序",quality:"质量控制",safety:"安全规范",maintenance:"维护保养"}[e]||e),Z=e=>{a(e||null),e?c.setFieldsValue({...e,procedureSteps:e.procedureSteps.join("\n"),references:e.references.join("\n")}):c.resetFields(),r(!0)},X=l.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())||e.code.toLowerCase().includes(g.toLowerCase())||e.category.toLowerCase().includes(g.toLowerCase())),Y=[{title:"方法学名称",dataIndex:"name",key:"name",width:200,render:(i,l)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:l.code})]})},{title:"类别",dataIndex:"category",key:"category",width:120,render:i=>e.jsx(j,{color:"blue",children:i})},{title:"状态",dataIndex:"status",key:"status",width:100,align:"center",render:i=>{const l=G(i);return e.jsx(y,{status:l.color,text:l.text})}},{title:"版本",dataIndex:"version",key:"version",width:80,align:"center"},{title:"技术参数",key:"technicalParameters",width:200,render:i=>e.jsxs("div",{children:[e.jsxs("div",{children:["灵敏度: ",i.technicalParameters.sensitivity]}),e.jsxs("div",{children:["特异性: ",i.technicalParameters.specificity]}),i.technicalParameters.detectionLimit&&e.jsxs("div",{children:["检测限: ",i.technicalParameters.detectionLimit]})]})},{title:"关联检测项目",dataIndex:"associatedDetectionItems",key:"associatedDetectionItems",width:150,render:i=>i&&0!==i.length?i.length<=2?i.map(i=>e.jsx(j,{color:"geekblue",children:i},i)):e.jsx(T,{title:i.join("、"),children:e.jsxs("div",{children:[i.slice(0,2).map(i=>e.jsx(j,{color:"geekblue",children:i},i)),e.jsxs(j,{color:"default",children:["+",i.length-2]})]})}):"-"},{title:"SOP文档",dataIndex:"sopDocuments",key:"sopDocuments",width:120,align:"center",render:i=>i&&0!==i.length?e.jsx(T,{title:`共${i.length}个文档`,children:e.jsx(y,{count:i.length,showZero:!0,children:e.jsx(H,{style:{color:"#1890ff",fontSize:"16px"}})})}):"-"},{title:"生效日期",dataIndex:"effectiveDate",key:"effectiveDate",width:100,align:"center"},{title:"复审日期",dataIndex:"reviewDate",key:"reviewDate",width:100,align:"center"},{title:"审批人",dataIndex:"approver",key:"approver",width:100,align:"center"},{title:"启用状态",dataIndex:"isActive",key:"isActive",width:80,align:"center",render:i=>e.jsx(j,{color:i?"green":"red",children:i?"有效":"失效"})},{title:"操作",key:"action",width:150,fixed:"right",render:i=>e.jsxs(I,{children:[e.jsx(T,{title:"查看详情",children:e.jsx(h,{type:"link",icon:e.jsx(O,{}),onClick:()=>(M(i),void V(!0)),size:"small"})}),e.jsx(T,{title:"编辑",children:e.jsx(h,{type:"link",icon:e.jsx(B,{}),onClick:()=>Z(i),size:"small"})}),e.jsx(D,{title:"确定删除这个方法学吗？",onConfirm:()=>{return e=i.id,t(i=>i.filter(i=>i.id!==e)),void P.success("方法学删除成功");var e},okText:"确定",cancelText:"取消",icon:e.jsx(J,{style:{color:"red"}}),children:e.jsx(T,{title:"删除",children:e.jsx(h,{type:"link",danger:!0,icon:e.jsx(F,{}),size:"small"})})})]})}];return e.jsxs(o,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx(I,{children:e.jsx(C,{placeholder:"搜索方法学名称、编码或类别",prefix:e.jsx(_,{}),value:g,onChange:e=>N(e.target.value),style:{width:300}})}),e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>Z(),children:"添加方法学"})]}),e.jsx(x,{columns:Y,dataSource:X,rowKey:"id",pagination:{total:X.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`},scroll:{x:1800}}),e.jsx(u,{title:"方法学详情",placement:"right",onClose:()=>V(!1),open:z,width:800,children:L&&e.jsxs("div",{children:[e.jsxs(p,{title:"基本信息",bordered:!0,column:2,style:{marginBottom:24},children:[e.jsx(p.Item,{label:"方法学名称",children:L.name}),e.jsx(p.Item,{label:"方法学编码",children:L.code}),e.jsx(p.Item,{label:"类别",children:e.jsx(j,{color:"blue",children:L.category})}),e.jsx(p.Item,{label:"状态",children:(()=>{const i=G(L.status);return e.jsx(y,{status:i.color,text:i.text})})()}),e.jsx(p.Item,{label:"版本号",children:L.version}),e.jsx(p.Item,{label:"生效日期",children:L.effectiveDate}),e.jsx(p.Item,{label:"复审日期",children:L.reviewDate}),e.jsx(p.Item,{label:"审批人",children:L.approver}),e.jsx(p.Item,{label:"启用状态",span:2,children:e.jsx(j,{color:L.isActive?"green":"red",children:L.isActive?"有效":"失效"})})]}),e.jsx(p,{title:"检测原理",bordered:!0,style:{marginBottom:24},children:e.jsx(p.Item,{label:"原理描述",span:3,children:L.principle})}),e.jsxs(K,{defaultActiveKey:["1"],style:{marginBottom:24},children:[e.jsx(Se,{header:e.jsxs(e.Fragment,{children:[e.jsx(U,{})," 技术参数"]}),children:e.jsxs(p,{bordered:!0,column:2,children:[L.technicalParameters.throughput&&e.jsx(p.Item,{label:"通量",children:L.technicalParameters.throughput}),e.jsx(p.Item,{label:"灵敏度",children:L.technicalParameters.sensitivity}),e.jsx(p.Item,{label:"特异性",children:L.technicalParameters.specificity}),e.jsx(p.Item,{label:"精密度",children:L.technicalParameters.precision}),e.jsx(p.Item,{label:"准确度",children:L.technicalParameters.accuracy}),L.technicalParameters.linearRange&&e.jsx(p.Item,{label:"线性范围",children:L.technicalParameters.linearRange}),L.technicalParameters.detectionLimit&&e.jsx(p.Item,{label:"检测限",children:L.technicalParameters.detectionLimit}),L.technicalParameters.reportableRange&&e.jsx(p.Item,{label:"报告范围",children:L.technicalParameters.reportableRange}),L.technicalParameters.cvRequirement&&e.jsxs(p.Item,{label:"CV要求",children:["≤",L.technicalParameters.cvRequirement,"%"]}),L.technicalParameters.biasRequirement&&e.jsxs(p.Item,{label:"偏倚要求",children:["≤",L.technicalParameters.biasRequirement,"%"]})]})},"1"),e.jsx(Se,{header:e.jsxs(e.Fragment,{children:[e.jsx(Q,{})," 仪器要求"]}),children:e.jsxs(p,{bordered:!0,column:1,children:[e.jsx(p.Item,{label:"主要仪器",children:L.instrumentRequirements.mainInstruments.map(i=>e.jsx(j,{color:"blue",style:{margin:"2px"},children:i},i))}),e.jsx(p.Item,{label:"辅助仪器",children:L.instrumentRequirements.auxiliaryInstruments.map(i=>e.jsx(j,{color:"geekblue",style:{margin:"2px"},children:i},i))}),e.jsx(p.Item,{label:"校准要求",children:L.instrumentRequirements.calibrationRequirements}),e.jsx(p.Item,{label:"维护计划",children:L.instrumentRequirements.maintenanceSchedule}),e.jsx(p.Item,{label:"环境条件",children:e.jsxs("div",{children:[e.jsxs("div",{children:["温度: ",L.instrumentRequirements.environmentalConditions.temperature]}),e.jsxs("div",{children:["湿度: ",L.instrumentRequirements.environmentalConditions.humidity]}),e.jsxs("div",{children:["通风: ",L.instrumentRequirements.environmentalConditions.ventilation]})]})})]})},"2"),e.jsx(Se,{header:e.jsxs(e.Fragment,{children:[e.jsx($,{})," 样本要求"]}),children:e.jsxs(p,{bordered:!0,column:1,children:[e.jsx(p.Item,{label:"样本类型",children:L.sampleRequirements.sampleTypes.map(i=>e.jsx(j,{color:"green",style:{margin:"2px"},children:i},i))}),e.jsx(p.Item,{label:"最小体积",children:L.sampleRequirements.minimumVolume}),e.jsx(p.Item,{label:"质量要求",children:L.sampleRequirements.qualityRequirements}),e.jsx(p.Item,{label:"保存条件",children:L.sampleRequirements.storageConditions}),e.jsx(p.Item,{label:"运输要求",children:L.sampleRequirements.transportRequirements}),L.sampleRequirements.pretreatmentSteps&&e.jsx(p.Item,{label:"预处理步骤",children:e.jsx(v,{size:"small",dataSource:L.sampleRequirements.pretreatmentSteps,renderItem:(i,l)=>e.jsx(v.Item,{children:e.jsxs(Re,{children:[l+1,". ",i]})})})})]})},"3")]}),L.associatedDetectionItems&&L.associatedDetectionItems.length>0&&e.jsx(p,{title:"关联检测项目",bordered:!0,style:{marginBottom:24},children:e.jsx(p.Item,{label:"检测项目",span:3,children:L.associatedDetectionItems.map(i=>e.jsx(j,{color:"geekblue",style:{margin:"2px"},children:i},i))})}),e.jsx(p,{title:"操作步骤",bordered:!0,style:{marginBottom:24},children:e.jsx(p.Item,{label:"步骤详情",span:3,children:e.jsx(W,{direction:"vertical",size:"small",children:L.procedureSteps.map((i,l)=>e.jsx(we,{title:`步骤 ${l+1}`,description:i},l))})})}),e.jsxs(p,{title:"质量控制与结果解读",bordered:!0,style:{marginBottom:24},children:[e.jsx(p.Item,{label:"质量控制",span:3,children:L.qualityControl}),e.jsx(p.Item,{label:"结果解读",span:3,children:L.resultInterpretation}),e.jsx(p.Item,{label:"方法局限性",span:3,children:L.limitations})]}),L.sopDocuments&&L.sopDocuments.length>0&&e.jsx(p,{title:"SOP文档",bordered:!0,style:{marginBottom:24},children:e.jsx(p.Item,{label:"文档列表",span:3,children:e.jsx(v,{dataSource:L.sopDocuments,renderItem:i=>{return e.jsx(v.Item,{actions:[e.jsx(h,{type:"link",size:"small",icon:e.jsx(b,{}),children:"查看"})],children:e.jsx(v.Item.Meta,{avatar:e.jsx(H,{style:{fontSize:"20px",color:"#1890ff"}}),title:e.jsxs("div",{children:[i.name,e.jsx(j,{color:(l=i.type,{procedure:"blue",quality:"green",safety:"red",maintenance:"orange"}[l]||"default"),style:{marginLeft:8},children:E(i.type)}),e.jsx(j,{color:"approved"===i.status?"green":"draft"===i.status?"orange":"red",children:"approved"===i.status?"已批准":"draft"===i.status?"草稿":"已过期"})]}),description:e.jsxs("div",{children:[e.jsxs("div",{children:["版本: ",i.version," | 审批人: ",i.approver]}),e.jsxs("div",{children:["上传日期: ",i.uploadDate]})]})})});var l}})})}),e.jsx(p,{title:"参考文献",bordered:!0,style:{marginBottom:24},children:e.jsx(p.Item,{label:"文献列表",span:3,children:e.jsx(v,{size:"small",dataSource:L.references,renderItem:(i,l)=>e.jsx(v.Item,{children:e.jsxs(Re,{children:[l+1,". ",i]})})})})}),e.jsxs(p,{title:"版本信息",bordered:!0,children:[e.jsx(p.Item,{label:"创建时间",children:L.createdAt}),e.jsx(p.Item,{label:"更新时间",children:L.updatedAt})]})]})}),e.jsx(f,{title:n?"编辑方法学":"添加方法学",open:s,onCancel:()=>r(!1),footer:null,width:1e3,children:e.jsxs(d,{form:c,layout:"vertical",onFinish:e=>{const i={...e,procedureSteps:e.procedureSteps.split("\n").filter(e=>e.trim()),references:e.references.split("\n").filter(e=>e.trim())};if(n)t(e=>e.map(e=>e.id===n.id?{...e,...i,updatedAt:(new Date).toISOString().split("T")[0]}:e)),P.success("方法学更新成功");else{const e={...i,id:Date.now().toString(),createdAt:(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};t(i=>[...i,e]),P.success("方法学添加成功")}r(!1),c.resetFields()},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"name",label:"方法学名称",rules:[{required:!0,message:"请输入方法学名称"}],children:e.jsx(C,{placeholder:"请输入方法学名称"})}),e.jsx(d.Item,{name:"code",label:"方法学编码",rules:[{required:!0,message:"请输入方法学编码"}],children:e.jsx(C,{placeholder:"请输入方法学编码"})}),e.jsx(d.Item,{name:"category",label:"方法学类别",rules:[{required:!0,message:"请选择方法学类别"}],children:e.jsxs(q,{placeholder:"请选择方法学类别",children:[e.jsx(Ce,{value:"基因测序",children:"基因测序"}),e.jsx(Ce,{value:"基因扩增",children:"基因扩增"}),e.jsx(Ce,{value:"细胞遗传学",children:"细胞遗传学"}),e.jsx(Ce,{value:"免疫学",children:"免疫学"}),e.jsx(Ce,{value:"生化检测",children:"生化检测"}),e.jsx(Ce,{value:"病理学",children:"病理学"})]})}),e.jsx(d.Item,{name:"version",label:"版本号",rules:[{required:!0,message:"请输入版本号"}],children:e.jsx(C,{placeholder:"如：V1.0"})}),e.jsx(d.Item,{name:"effectiveDate",label:"生效日期",rules:[{required:!0,message:"请选择生效日期"}],children:e.jsx(C,{type:"date"})}),e.jsx(d.Item,{name:"reviewDate",label:"复审日期",rules:[{required:!0,message:"请选择复审日期"}],children:e.jsx(C,{type:"date"})}),e.jsx(d.Item,{name:"approver",label:"审批人",rules:[{required:!0,message:"请输入审批人"}],children:e.jsx(C,{placeholder:"请输入审批人姓名"})}),e.jsx(d.Item,{name:"isActive",label:"状态",valuePropName:"checked",initialValue:!0,children:e.jsx(A,{checkedChildren:"有效",unCheckedChildren:"失效"})})]}),e.jsx(d.Item,{name:"principle",label:"检测原理",rules:[{required:!0,message:"请输入检测原理"}],children:e.jsx(qe,{rows:3,placeholder:"请详细描述检测原理"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"equipment",label:"所需设备",rules:[{required:!0,message:"请选择所需设备"}],children:e.jsxs(q,{mode:"tags",placeholder:"请输入或选择所需设备",children:[e.jsx(Ce,{value:"Illumina NovaSeq 6000",children:"Illumina NovaSeq 6000"}),e.jsx(Ce,{value:"ABI 7500实时PCR仪",children:"ABI 7500实时PCR仪"}),e.jsx(Ce,{value:"ABI 3730xl测序仪",children:"ABI 3730xl测序仪"}),e.jsx(Ce,{value:"荧光显微镜",children:"荧光显微镜"})]})}),e.jsx(d.Item,{name:"reagents",label:"所需试剂",rules:[{required:!0,message:"请选择所需试剂"}],children:e.jsx(q,{mode:"tags",placeholder:"请输入或选择所需试剂"})})]}),e.jsx(d.Item,{name:"sampleRequirement",label:"样本要求",rules:[{required:!0,message:"请输入样本要求"}],children:e.jsx(qe,{rows:2,placeholder:"请描述样本的质量和数量要求"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"detectionRange",label:"检测范围",rules:[{required:!0,message:"请输入检测范围"}],children:e.jsx(C,{placeholder:"请输入检测范围"})}),e.jsx(d.Item,{name:"sensitivity",label:"灵敏度",rules:[{required:!0,message:"请输入灵敏度"}],children:e.jsx(C,{placeholder:"如：≥99%"})}),e.jsx(d.Item,{name:"specificity",label:"特异性",rules:[{required:!0,message:"请输入特异性"}],children:e.jsx(C,{placeholder:"如：≥99.5%"})}),e.jsx(d.Item,{name:"precision",label:"精密度",rules:[{required:!0,message:"请输入精密度"}],children:e.jsx(C,{placeholder:"如：CV≤5%"})}),e.jsx(d.Item,{name:"accuracy",label:"准确度",rules:[{required:!0,message:"请输入准确度"}],children:e.jsx(C,{placeholder:"如：≥99%"})}),e.jsx(d.Item,{name:"detectionLimit",label:"检测限",children:e.jsx(C,{placeholder:"如：5% VAF"})})]}),e.jsx(d.Item,{name:"linearRange",label:"线性范围",children:e.jsx(C,{placeholder:"如：10ng-1μg"})}),e.jsx(d.Item,{name:"throughput",label:"通量",children:e.jsx(C,{placeholder:"如：96样本/批次"})}),e.jsx(d.Item,{name:"reportableRange",label:"报告范围",children:e.jsx(C,{placeholder:"如：0.1%-100% VAF"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"cvRequirement",label:"CV要求(%)",children:e.jsx(R,{min:0,max:100,precision:1,placeholder:"如：5.0",style:{width:"100%"}})}),e.jsx(d.Item,{name:"biasRequirement",label:"偏倚要求(%)",children:e.jsx(R,{min:0,max:100,precision:1,placeholder:"如：10.0",style:{width:"100%"}})})]}),e.jsx(S,{orientation:"left",children:"仪器要求"}),e.jsx(d.Item,{name:"mainInstruments",label:"主要仪器",rules:[{required:!0,message:"请选择主要仪器"}],children:e.jsxs(q,{mode:"tags",placeholder:"请输入或选择主要仪器",children:[e.jsx(Ce,{value:"Illumina NovaSeq 6000",children:"Illumina NovaSeq 6000"}),e.jsx(Ce,{value:"ABI 7500实时PCR仪",children:"ABI 7500实时PCR仪"}),e.jsx(Ce,{value:"ABI 3730xl测序仪",children:"ABI 3730xl测序仪"}),e.jsx(Ce,{value:"荧光显微镜",children:"荧光显微镜"}),e.jsx(Ce,{value:"离心机",children:"离心机"}),e.jsx(Ce,{value:"移液器",children:"移液器"})]})}),e.jsx(d.Item,{name:"auxiliaryInstruments",label:"辅助仪器",children:e.jsxs(q,{mode:"tags",placeholder:"请输入或选择辅助仪器",children:[e.jsx(Ce,{value:"涡旋混合器",children:"涡旋混合器"}),e.jsx(Ce,{value:"恒温水浴",children:"恒温水浴"}),e.jsx(Ce,{value:"电泳仪",children:"电泳仪"}),e.jsx(Ce,{value:"紫外分光光度计",children:"紫外分光光度计"})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"calibrationRequirements",label:"校准要求",rules:[{required:!0,message:"请输入校准要求"}],children:e.jsx(qe,{rows:2,placeholder:"请描述仪器校准的频率和标准"})}),e.jsx(d.Item,{name:"maintenanceSchedule",label:"维护计划",rules:[{required:!0,message:"请输入维护计划"}],children:e.jsx(qe,{rows:2,placeholder:"请描述仪器维护的计划和要求"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"temperature",label:"温度要求",rules:[{required:!0,message:"请输入温度要求"}],children:e.jsx(C,{placeholder:"如：18-25℃"})}),e.jsx(d.Item,{name:"humidity",label:"湿度要求",rules:[{required:!0,message:"请输入湿度要求"}],children:e.jsx(C,{placeholder:"如：30-70%"})}),e.jsx(d.Item,{name:"ventilation",label:"通风要求",rules:[{required:!0,message:"请输入通风要求"}],children:e.jsx(C,{placeholder:"如：每小时换气6次"})})]}),e.jsx(S,{orientation:"left",children:"样本要求"}),e.jsx(d.Item,{name:"sampleTypes",label:"样本类型",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsxs(q,{mode:"tags",placeholder:"请选择或输入样本类型",children:[e.jsx(Ce,{value:"全血",children:"全血"}),e.jsx(Ce,{value:"血浆",children:"血浆"}),e.jsx(Ce,{value:"血清",children:"血清"}),e.jsx(Ce,{value:"唾液",children:"唾液"}),e.jsx(Ce,{value:"尿液",children:"尿液"}),e.jsx(Ce,{value:"组织",children:"组织"}),e.jsx(Ce,{value:"细胞",children:"细胞"}),e.jsx(Ce,{value:"DNA",children:"DNA"}),e.jsx(Ce,{value:"RNA",children:"RNA"})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"minimumVolume",label:"最小体积",rules:[{required:!0,message:"请输入最小体积"}],children:e.jsx(C,{placeholder:"如：2mL"})}),e.jsx(d.Item,{name:"qualityRequirements",label:"质量要求",rules:[{required:!0,message:"请输入质量要求"}],children:e.jsx(C,{placeholder:"如：OD260/280≥1.8"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"storageConditions",label:"保存条件",rules:[{required:!0,message:"请输入保存条件"}],children:e.jsx(C,{placeholder:"如：-80℃长期保存"})}),e.jsx(d.Item,{name:"transportRequirements",label:"运输要求",rules:[{required:!0,message:"请输入运输要求"}],children:e.jsx(C,{placeholder:"如：干冰运输，24小时内到达"})})]}),e.jsx(d.Item,{name:"pretreatmentSteps",label:"预处理步骤",children:e.jsx(qe,{rows:3,placeholder:"请输入预处理步骤，每行一个步骤"})}),e.jsx(S,{orientation:"left",children:"关联信息"}),e.jsx(d.Item,{name:"associatedDetectionItems",label:"关联检测项目",children:e.jsxs(q,{mode:"tags",placeholder:"请选择关联的检测项目",children:[e.jsx(Ce,{value:"肿瘤基因检测",children:"肿瘤基因检测"}),e.jsx(Ce,{value:"遗传病筛查",children:"遗传病筛查"}),e.jsx(Ce,{value:"药物基因组学",children:"药物基因组学"}),e.jsx(Ce,{value:"病原体检测",children:"病原体检测"})]})}),e.jsx(d.Item,{name:"status",label:"方法学状态",rules:[{required:!0,message:"请选择方法学状态"}],initialValue:"active",children:e.jsxs(q,{placeholder:"请选择方法学状态",children:[e.jsx(Ce,{value:"active",children:"有效"}),e.jsx(Ce,{value:"pending",children:"待审核"}),e.jsx(Ce,{value:"inactive",children:"无效"})]})}),e.jsx(S,{orientation:"left",children:"操作流程"}),e.jsx(d.Item,{name:"procedureSteps",label:"操作步骤",rules:[{required:!0,message:"请输入操作步骤"}],children:e.jsx(qe,{rows:4,placeholder:"请输入操作步骤，每行一个步骤"})}),e.jsx(d.Item,{name:"qualityControl",label:"质量控制",rules:[{required:!0,message:"请输入质量控制要求"}],children:e.jsx(qe,{rows:2,placeholder:"请描述质量控制要求和标准"})}),e.jsx(d.Item,{name:"resultInterpretation",label:"结果解读",rules:[{required:!0,message:"请输入结果解读标准"}],children:e.jsx(qe,{rows:2,placeholder:"请描述结果解读的标准和方法"})}),e.jsx(d.Item,{name:"limitations",label:"方法局限性",rules:[{required:!0,message:"请输入方法局限性"}],children:e.jsx(qe,{rows:2,placeholder:"请描述该方法的局限性和注意事项"})}),e.jsx(S,{orientation:"left",children:"SOP文档"}),e.jsxs(d.Item,{name:"sopDocuments",label:"SOP文档上传",children:[e.jsx(w,{multiple:!0,beforeUpload:()=>!1,onChange:e=>{},children:e.jsx(h,{icon:e.jsx(k,{}),children:"上传SOP文档"})}),e.jsx("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:"支持上传PDF、DOC、DOCX格式文件，单个文件不超过10MB"})]}),e.jsx(d.Item,{name:"references",label:"参考文献",rules:[{required:!0,message:"请输入参考文献"}],children:e.jsx(qe,{rows:3,placeholder:"请输入参考文献，每行一个文献"})}),e.jsx(d.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(I,{children:[e.jsx(h,{onClick:()=>r(!1),children:"取消"}),e.jsx(h,{type:"primary",htmlType:"submit",children:n?"更新":"添加"})]})})]})})]})},{Search:Ae}=C,{Option:Pe}=q,Te=()=>{const t=l(),[s,r]=i.useState(!1),[n,a]=i.useState([]),[c,u]=i.useState([]),[p,g]=i.useState(""),[v,b]=i.useState("all"),[R,S]=i.useState(!1),[w]=d.useForm();i.useEffect(()=>{k()},[]);const k=async()=>{r(!0);try{a([{id:"1",name:"肿瘤基因检测",version:"v2.1",status:"active",applicableProjects:["肿瘤测序项目A","肿瘤测序项目B"],description:"用于肿瘤相关基因突变的检测流程",creator:"张三",createTime:"2024-03-15",lastUpdater:"李四",updateTime:"2024-05-20",stepCount:6,fieldCount:25,qcRuleCount:8},{id:"2",name:"病原微生物检测",version:"v1.5",status:"active",applicableProjects:["病原检测项目"],description:"病原微生物基因检测标准流程",creator:"王五",createTime:"2024-02-10",lastUpdater:"赵六",updateTime:"2024-04-15",stepCount:5,fieldCount:18,qcRuleCount:6},{id:"3",name:"遗传病筛查",version:"v3.0",status:"active",applicableProjects:["遗传病筛查项目A","遗传病筛查项目B","新生儿筛查"],description:"遗传性疾病基因筛查检测流程",creator:"钱七",createTime:"2024-01-20",lastUpdater:"孙八",updateTime:"2024-05-10",stepCount:7,fieldCount:32,qcRuleCount:12},{id:"4",name:"药物基因组学",version:"v1.2",status:"inactive",applicableProjects:["药物基因组学项目"],description:"个体化用药基因检测流程",creator:"周九",createTime:"2023-12-05",lastUpdater:"吴十",updateTime:"2024-03-01",stepCount:4,fieldCount:15,qcRuleCount:4},{id:"5",name:"新冠核酸检测",version:"v4.0",status:"active",applicableProjects:["新冠检测项目"],description:"SARS-CoV-2核酸检测标准流程",creator:"郑十一",createTime:"2023-11-15",lastUpdater:"王十二",updateTime:"2024-05-25",stepCount:3,fieldCount:12,qcRuleCount:5}])}catch(e){P.error("加载SOP模板失败")}finally{r(!1)}},A=n.filter(e=>{const i=!p||e.name.toLowerCase().includes(p.toLowerCase())||e.applicableProjects.some(e=>e.toLowerCase().includes(p.toLowerCase())),l="all"===v||e.status===v;return i&&l}),D=e=>{if(0!==c.length)switch(e){case"enable":f.confirm({title:"批量启用",content:`确定要启用选中的${c.length}个SOP模板吗？`,onOk:()=>{P.success("批量启用成功"),u([]),k()}});break;case"disable":f.confirm({title:"批量停用",content:`确定要停用选中的${c.length}个SOP模板吗？`,onOk:()=>{P.success("批量停用成功"),u([]),k()}});break;case"delete":f.confirm({title:"批量删除",content:`确定要删除选中的${c.length}个SOP模板吗？此操作不可恢复。`,okType:"danger",onOk:()=>{P.success("批量删除成功"),u([]),k()}})}else P.warning("请先选择要操作的SOP模板")},N=[{title:"SOP名称",dataIndex:"name",key:"name",width:200,render:(i,l)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:[l.applicableProjects.slice(0,2).join(", "),l.applicableProjects.length>2&&"..."]})]})},{title:"版本",dataIndex:"version",key:"version",width:100,render:i=>e.jsx(j,{color:"blue",children:i})},{title:"状态",dataIndex:"status",key:"status",width:100,render:i=>e.jsx(y,{status:"active"===i?"success":"default",text:"active"===i?"启用":"停用"})},{title:"配置统计",key:"stats",width:120,render:(i,l)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["步骤: ",l.stepCount]}),e.jsxs("div",{children:["字段: ",l.fieldCount]}),e.jsxs("div",{children:["质检: ",l.qcRuleCount]})]})},{title:"更新信息",key:"updateInfo",width:150,render:(i,l)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{children:l.lastUpdater}),e.jsx("div",{style:{color:"#666"},children:l.updateTime})]})},{title:"操作",key:"action",width:200,render:(i,l)=>e.jsxs(I,{size:"small",children:[e.jsx(T,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(B,{}),onClick:()=>(e=>{t(`/detection/sop-template/${e.id}`)})(l)})}),e.jsx(T,{title:"查看",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(O,{}),onClick:()=>(e=>{t(`/detection/sop-template/${e.id}?mode=view`)})(l)})}),e.jsx(Z,{menu:{items:[{key:"copy",label:"复制模板",icon:e.jsx(ie,{}),onClick:()=>(e=>{f.confirm({title:"复制SOP模板",content:`确定要复制SOP模板"${e.name}"吗？`,onOk:async()=>{try{P.success("SOP模板复制成功"),k()}catch(e){P.error("复制失败")}}})})(l)},{key:"version",label:"版本管理",icon:e.jsx(le,{}),onClick:()=>(e=>{t(`/detection/sop-version/${e.id}`)})(l)},{type:"divider"},{key:"delete",label:"删除",icon:e.jsx(F,{}),danger:!0,onClick:()=>(async()=>{try{P.success("SOP模板删除成功"),k()}catch(e){P.error("删除失败")}})()}]},trigger:["click"],children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(ee,{})})})]})}],z=[{key:"enable",label:"批量启用",onClick:()=>D("enable")},{key:"disable",label:"批量停用",onClick:()=>D("disable")},{type:"divider"},{key:"delete",label:"批量删除",danger:!0,onClick:()=>D("delete")}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(o,{children:[e.jsxs(M,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[e.jsx(G,{children:e.jsx("h2",{style:{margin:0},children:"SOP配置管理"})}),e.jsx(G,{children:e.jsx(I,{children:e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{S(!0)},children:"新建SOP模板"})})})]}),e.jsxs(M,{gutter:16,style:{marginBottom:16},children:[e.jsx(G,{span:8,children:e.jsx(Ae,{placeholder:"搜索SOP名称或项目...",allowClear:!0,onSearch:e=>{g(e)},style:{width:"100%"}})}),e.jsx(G,{span:4,children:e.jsxs(q,{placeholder:"状态筛选",allowClear:!0,style:{width:"100%"},value:v,onChange:e=>{b(e)},children:[e.jsx(Pe,{value:"all",children:"全部状态"}),e.jsx(Pe,{value:"active",children:"启用"}),e.jsx(Pe,{value:"inactive",children:"停用"})]})})]}),e.jsx(M,{justify:"space-between",align:"middle",style:{marginBottom:16},children:e.jsx(G,{children:e.jsxs(I,{children:[e.jsx(Z,{menu:{items:z},disabled:0===c.length,children:e.jsxs(h,{children:["批量操作 ",c.length>0&&`(${c.length})`]})}),e.jsx(h,{icon:e.jsx(X,{}),onClick:()=>{P.success("SOP列表导出成功")},children:"导出SOP列表"}),e.jsx(h,{icon:e.jsx(Y,{}),onClick:()=>{P.info("导入功能开发中")},children:"导入SOP模板"})]})})}),e.jsx(x,{columns:N,dataSource:A,rowKey:"id",loading:s,pagination:{total:A.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,i)=>`第 ${i[0]}-${i[1]} 条/共 ${e} 条`},rowSelection:{selectedRowKeys:c,onChange:u,preserveSelectedRowKeys:!0},scroll:{x:1e3}})]}),e.jsx(f,{title:"新建SOP模板",open:R,onCancel:()=>{S(!1),w.resetFields()},onOk:()=>w.submit(),width:600,children:e.jsxs(d,{form:w,layout:"vertical",onFinish:async e=>{try{P.success("SOP模板创建成功"),S(!1),w.resetFields(),k()}catch(i){P.error("创建失败")}},children:[e.jsx(d.Item,{name:"name",label:"模板名称",rules:[{required:!0,message:"请输入模板名称"}],children:e.jsx(C,{placeholder:"请输入SOP模板名称"})}),e.jsx(d.Item,{name:"description",label:"模板描述",rules:[{required:!0,message:"请输入模板描述"}],children:e.jsx(C.TextArea,{rows:3,placeholder:"请输入SOP模板描述"})}),e.jsx(d.Item,{name:"applicableProjects",label:"适用项目",rules:[{required:!0,message:"请选择适用项目"}],children:e.jsx(q,{mode:"multiple",placeholder:"请选择适用的检测项目",options:[{label:"肿瘤测序项目A",value:"肿瘤测序项目A"},{label:"肿瘤测序项目B",value:"肿瘤测序项目B"},{label:"病原检测项目",value:"病原检测项目"},{label:"遗传病筛查项目A",value:"遗传病筛查项目A"},{label:"遗传病筛查项目B",value:"遗传病筛查项目B"},{label:"新生儿筛查",value:"新生儿筛查"},{label:"药物基因组学项目",value:"药物基因组学项目"},{label:"新冠检测项目",value:"新冠检测项目"}]})})]})})]})},{Option:Oe}=q,{TextArea:Be}=C,De=()=>{const{templateId:r}=t(),n=l(),[a]=s(),c="view"===a.get("mode"),[u,p]=i.useState(!1),[g,v]=i.useState(!1),[R,S]=i.useState(null),[w,O]=i.useState(!1),[D,N]=i.useState(null),[z]=d.useForm(),[_]=d.useForm();i.useEffect(()=>{r&&K(r)},[r]);const K=async e=>{p(!0);try{const i={id:e,name:"肿瘤基因检测",version:"v2.1",status:"active",applicableProjects:["肿瘤测序项目A","肿瘤测序项目B"],description:"用于肿瘤相关基因突变的检测流程，包含从样本接收到报告生成的完整流程",creator:"张三",createTime:"2024-03-15",lastUpdater:"李四",updateTime:"2024-05-20",steps:[{id:"1",name:"样本接收",type:"info_record",description:"接收并登记样本信息，检查样本质量",isRequired:!0,estimatedTime:30,sortOrder:1,hasQualityControl:!0,fieldCount:8,qcRuleCount:3},{id:"2",name:"核酸提取",type:"experiment",description:"从样本中提取高质量的核酸",isRequired:!0,estimatedTime:90,sortOrder:2,hasQualityControl:!0,fieldCount:12,qcRuleCount:5},{id:"3",name:"文库构建",type:"experiment",description:"构建测序文库，进行PCR扩增",isRequired:!0,estimatedTime:180,sortOrder:3,hasQualityControl:!0,fieldCount:15,qcRuleCount:4},{id:"4",name:"测序",type:"instrument",description:"使用测序仪进行高通量测序",isRequired:!0,estimatedTime:1440,sortOrder:4,hasQualityControl:!0,fieldCount:6,qcRuleCount:2},{id:"5",name:"数据分析",type:"data_analysis",description:"对测序数据进行质控、比对、变异检测等分析",isRequired:!0,estimatedTime:240,sortOrder:5,hasQualityControl:!0,fieldCount:10,qcRuleCount:6},{id:"6",name:"报告生成",type:"report",description:"根据分析结果生成检测报告",isRequired:!0,estimatedTime:60,sortOrder:6,hasQualityControl:!1,fieldCount:5,qcRuleCount:0}]};S(i),z.setFieldsValue({name:i.name,status:i.status,applicableProjects:i.applicableProjects,description:i.description})}catch(i){P.error("加载SOP模板详情失败")}finally{p(!1)}},U=(e,i)=>{if(!R)return;const l=[...R.steps],t=l.findIndex(i=>i.id===e.id);"up"===i&&t>0?[l[t],l[t-1]]=[l[t-1],l[t]]:"down"===i&&t<l.length-1&&([l[t],l[t+1]]=[l[t+1],l[t]]),l.forEach((e,i)=>{e.sortOrder=i+1}),S({...R,steps:l})},$=[{label:"信息记录",value:"info_record"},{label:"实验操作",value:"experiment"},{label:"仪器操作",value:"instrument"},{label:"数据分析",value:"data_analysis"},{label:"报告输出",value:"report"}],W={info_record:"blue",experiment:"green",instrument:"orange",data_analysis:"purple",report:"red"},H=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(i,l,t)=>e.jsxs(I,{children:[e.jsx("span",{children:t+1}),!c&&e.jsxs(I,{direction:"vertical",size:0,children:[e.jsx(h,{type:"text",size:"small",icon:e.jsx(te,{}),disabled:0===t,onClick:()=>U(l,"up")}),e.jsx(h,{type:"text",size:"small",icon:e.jsx(se,{}),disabled:t===((null==R?void 0:R.steps.length)||0)-1,onClick:()=>U(l,"down")})]})]})},{title:"步骤名称",dataIndex:"name",key:"name",width:150,render:(i,l)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["预计 ",l.estimatedTime," 分钟"]})]})},{title:"步骤类型",dataIndex:"type",key:"type",width:100,render:i=>{const l=$.find(e=>e.value===i);return e.jsx(j,{color:W[i],children:(null==l?void 0:l.label)||i})}},{title:"必填",dataIndex:"isRequired",key:"isRequired",width:80,render:i=>e.jsx(y,{status:i?"success":"default",text:i?"是":"否"})},{title:"配置统计",key:"stats",width:100,render:(i,l)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["字段: ",l.fieldCount]}),e.jsxs("div",{children:["质检: ",l.qcRuleCount]})]})},{title:"质量控制",dataIndex:"hasQualityControl",key:"hasQualityControl",width:100,render:i=>e.jsx(y,{status:i?"processing":"default",text:i?"启用":"关闭"})},{title:"操作",key:"action",width:150,render:(i,l)=>e.jsxs(I,{size:"small",children:[e.jsx(T,{title:"配置字段",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(Q,{}),onClick:()=>n(`../sop-step/${l.id}`)})}),e.jsx(T,{title:"质量控制",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(V,{}),onClick:()=>n(`../sop-quality-control/${l.id}`)})}),!c&&e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(B,{}),onClick:()=>{return N(e=l),_.setFieldsValue(e),void O(!0);var e}})}),e.jsx(T,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(F,{}),onClick:()=>{return e=l,void f.confirm({title:"删除步骤",content:`确定要删除步骤"${e.name}"吗？`,onOk:()=>{if(R){const i=R.steps.filter(i=>i.id!==e.id);S({...R,steps:i}),P.success("步骤删除成功")}}});var e}})})]})]})}];return u?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):R?e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(M,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(G,{children:e.jsxs(I,{children:[e.jsx(h,{icon:e.jsx(L,{}),onClick:()=>{n("../sop-config")},children:"返回列表"}),e.jsxs("h2",{style:{margin:0},children:["SOP模板: ",R.name," ",R.version]})]})}),e.jsx(G,{children:e.jsxs(I,{children:[!c&&e.jsx(h,{type:"primary",icon:e.jsx(E,{}),loading:g,onClick:()=>z.submit(),children:"保存"}),e.jsx(Z,{menu:{items:[{key:"version",label:"版本管理",icon:e.jsx(b,{})},{key:"export",label:"导出模板",icon:e.jsx(k,{})}]},children:e.jsx(h,{icon:e.jsx(ee,{}),children:"更多"})})]})})]}),e.jsx(o,{title:"模板基本信息",style:{marginBottom:24},children:e.jsxs(d,{form:z,layout:"vertical",onFinish:async e=>{v(!0);try{P.success("SOP模板保存成功"),R&&S({...R,...e,updateTime:(new Date).toISOString().split("T")[0],lastUpdater:"当前用户"})}catch(i){P.error("保存失败")}finally{v(!1)}},disabled:c,children:[e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"name",label:"模板名称",rules:[{required:!0,message:"请输入模板名称"}],children:e.jsx(C,{placeholder:"请输入SOP模板名称"})})}),e.jsx(G,{span:4,children:e.jsx(d.Item,{label:"版本号",children:e.jsx(C,{value:R.version,disabled:!0})})}),e.jsx(G,{span:4,children:e.jsx(d.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请选择状态"}],children:e.jsxs(q,{children:[e.jsx(Oe,{value:"active",children:"启用"}),e.jsx(Oe,{value:"inactive",children:"停用"})]})})})]}),e.jsx(M,{gutter:16,children:e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"applicableProjects",label:"适用项目",rules:[{required:!0,message:"请选择适用项目"}],children:e.jsx(q,{mode:"multiple",placeholder:"请选择适用的检测项目",options:[{label:"肿瘤测序项目A",value:"肿瘤测序项目A"},{label:"肿瘤测序项目B",value:"肿瘤测序项目B"},{label:"病原检测项目",value:"病原检测项目"},{label:"遗传病筛查项目A",value:"遗传病筛查项目A"},{label:"遗传病筛查项目B",value:"遗传病筛查项目B"},{label:"新生儿筛查",value:"新生儿筛查"},{label:"药物基因组学项目",value:"药物基因组学项目"},{label:"新冠检测项目",value:"新冠检测项目"}]})})})}),e.jsx(M,{gutter:16,children:e.jsx(G,{span:16,children:e.jsx(d.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入模板描述"}],children:e.jsx(Be,{rows:3,placeholder:"请输入SOP模板描述"})})})}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:6,children:e.jsx(d.Item,{label:"创建人",children:e.jsx(C,{value:R.creator,disabled:!0})})}),e.jsx(G,{span:6,children:e.jsx(d.Item,{label:"创建时间",children:e.jsx(C,{value:R.createTime,disabled:!0})})}),e.jsx(G,{span:6,children:e.jsx(d.Item,{label:"最后更新",children:e.jsx(C,{value:R.lastUpdater,disabled:!0})})}),e.jsx(G,{span:6,children:e.jsx(d.Item,{label:"更新时间",children:e.jsx(C,{value:R.updateTime,disabled:!0})})})]})]})}),e.jsx(o,{title:"实验步骤配置",extra:!c&&e.jsxs(I,{children:[e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{N(null),_.resetFields(),O(!0)},children:"添加步骤"}),e.jsx(h,{icon:e.jsx(Y,{}),onClick:()=>{P.info("导入步骤模板功能开发中")},children:"导入步骤模板"})]}),children:e.jsx(x,{columns:H,dataSource:R.steps,rowKey:"id",pagination:!1,scroll:{x:800}})}),e.jsx(f,{title:D?"编辑步骤":"添加步骤",open:w,onCancel:()=>{O(!1),_.resetFields()},onOk:()=>_.submit(),width:600,children:e.jsxs(d,{form:_,layout:"vertical",onFinish:async e=>{try{if(D){if(R){const i=R.steps.map(i=>i.id===D.id?{...i,...e}:i);S({...R,steps:i})}P.success("步骤更新成功")}else{const i={id:Date.now().toString(),...e,sortOrder:R?R.steps.length+1:1,fieldCount:0,qcRuleCount:0};R&&S({...R,steps:[...R.steps,i]}),P.success("步骤添加成功")}O(!1),_.resetFields()}catch(i){P.error("操作失败")}},children:[e.jsx(d.Item,{name:"name",label:"步骤名称",rules:[{required:!0,message:"请输入步骤名称"}],children:e.jsx(C,{placeholder:"请输入步骤名称"})}),e.jsx(d.Item,{name:"type",label:"步骤类型",rules:[{required:!0,message:"请选择步骤类型"}],children:e.jsx(q,{placeholder:"请选择步骤类型",options:$})}),e.jsx(d.Item,{name:"description",label:"步骤描述",rules:[{required:!0,message:"请输入步骤描述"}],children:e.jsx(Be,{rows:3,placeholder:"请输入步骤描述"})}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"estimatedTime",label:"预计耗时（分钟）",rules:[{required:!0,message:"请输入预计耗时"}],children:e.jsx(C,{type:"number",placeholder:"请输入预计耗时"})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"isRequired",label:"是否必填",valuePropName:"checked",children:e.jsx(A,{})})})]}),e.jsx(d.Item,{name:"hasQualityControl",label:"启用质量控制",valuePropName:"checked",children:e.jsx(A,{})})]})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"SOP模板不存在"})},{Option:Fe}=q,{TextArea:Ne}=C,ze=()=>{const{stepId:s}=t(),r=l(),[n,a]=i.useState(!1),[c,u]=i.useState(!1),[p,g]=i.useState(null),[v,y]=i.useState(!1),[O,D]=i.useState(null),[N]=d.useForm(),[z]=d.useForm();i.useEffect(()=>{s&&V(s)},[s]);const V=async e=>{a(!0);try{const i={id:e,name:"核酸提取",description:"从样本中提取高质量的核酸，确保后续实验的成功进行",estimatedTime:90,sortOrder:2,hasQualityControl:!0,sopDocument:"SOP-DNA-001.pdf",fields:[{id:"1",name:"操作人员",identifier:"operator",type:"text",isRequired:!0,placeholder:"请输入操作人员姓名",sortOrder:1,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!1,generateReport:!0},{id:"2",name:"提取方法",identifier:"extraction_method",type:"select",isRequired:!0,defaultValue:"磁珠法",options:["磁珠法","酚氯仿法","柱式法","其他"],placeholder:"请选择核酸提取方法",helpText:"根据样本类型和下游应用选择合适的提取方法",sortOrder:2,showInQuickPanel:!0,allowBatchEdit:!0,participateValidation:!0,generateReport:!0},{id:"3",name:"试剂盒",identifier:"reagent_kit",type:"select",isRequired:!0,options:["QIAamp DNA Mini Kit","DNeasy Blood & Tissue Kit","MagMAX DNA Multi-Sample Kit"],placeholder:"请选择使用的试剂盒",sortOrder:3,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!0,generateReport:!0},{id:"4",name:"样本浓度",identifier:"concentration",type:"number",isRequired:!0,unit:"ng/μl",placeholder:"请输入样本浓度",validationRule:">0",sortOrder:4,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!0,generateReport:!0},{id:"5",name:"260/280",identifier:"ratio_260_280",type:"number",isRequired:!0,placeholder:"请输入260/280比值",validationRule:"1.8-2.2",sortOrder:5,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!0,generateReport:!0},{id:"6",name:"体积",identifier:"volume",type:"number",isRequired:!0,defaultValue:"50",unit:"μl",placeholder:"请输入体积",sortOrder:6,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!1,generateReport:!0},{id:"7",name:"裂解时间",identifier:"lysis_time",type:"number",isRequired:!0,defaultValue:"30",unit:"分钟",placeholder:"请输入裂解时间",sortOrder:7,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!1,generateReport:!1},{id:"8",name:"温度",identifier:"temperature",type:"number",isRequired:!0,defaultValue:"56",unit:"°C",placeholder:"请输入温度",sortOrder:8,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!1,generateReport:!1},{id:"9",name:"电泳图",identifier:"electrophoresis_image",type:"file",isRequired:!1,placeholder:"请上传电泳图",helpText:"支持JPG、PNG、PDF格式",sortOrder:9,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!0},{id:"10",name:"备注",identifier:"remarks",type:"textarea",isRequired:!1,placeholder:"请输入备注信息",sortOrder:10,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!0}]};g(i),N.setFieldsValue({name:i.name,description:i.description,estimatedTime:i.estimatedTime,sortOrder:i.sortOrder,hasQualityControl:i.hasQualityControl})}catch(i){P.error("加载步骤详情失败")}finally{a(!1)}},_=[{label:"文本",value:"text"},{label:"数字",value:"number"},{label:"日期",value:"date"},{label:"文件",value:"file"},{label:"下拉选择",value:"select"},{label:"文本域",value:"textarea"},{label:"复选框",value:"checkbox"}],K=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,i,l)=>l+1},{title:"字段名称",dataIndex:"name",key:"name",width:150,render:(i,l)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:l.identifier})]})},{title:"类型",dataIndex:"type",key:"type",width:100,render:i=>{const l=_.find(e=>e.value===i);return e.jsx(j,{children:(null==l?void 0:l.label)||i})}},{title:"必填",dataIndex:"isRequired",key:"isRequired",width:80,render:i=>e.jsx(j,{color:i?"success":"default",children:i?"是":"否"})},{title:"默认值",dataIndex:"defaultValue",key:"defaultValue",width:120,render:(i,l)=>e.jsxs("div",{style:{fontSize:"12px"},children:[i&&e.jsx("div",{children:i}),l.unit&&e.jsxs("div",{style:{color:"#666"},children:["单位: ",l.unit]})]})},{title:"高级选项",key:"advanced",width:120,render:(i,l)=>e.jsxs("div",{style:{fontSize:"12px"},children:[l.showInQuickPanel&&e.jsx(j,{size:"small",children:"快速面板"}),l.allowBatchEdit&&e.jsx(j,{size:"small",children:"批量编辑"}),l.participateValidation&&e.jsx(j,{size:"small",children:"数据验证"}),l.generateReport&&e.jsx(j,{size:"small",children:"统计报表"})]})},{title:"操作",key:"action",width:120,render:(i,l)=>e.jsxs(I,{size:"small",children:[e.jsx(T,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(B,{}),onClick:()=>{return D(e=l),z.setFieldsValue(e),void y(!0);var e}})}),e.jsx(T,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(F,{}),onClick:()=>{return e=l,void f.confirm({title:"删除字段",content:`确定要删除字段"${e.name}"吗？`,onOk:()=>{if(p){const i=p.fields.filter(i=>i.id!==e.id);g({...p,fields:i}),P.success("字段删除成功")}}});var e}})})]})}];return n?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):p?e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(M,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(G,{children:e.jsxs(I,{children:[e.jsx(h,{icon:e.jsx(L,{}),onClick:()=>{r(-1)},children:"返回"}),e.jsxs("h2",{style:{margin:0},children:["步骤字段配置 - ",p.name]})]})}),e.jsx(G,{children:e.jsx(I,{children:e.jsx(h,{type:"primary",icon:e.jsx(E,{}),loading:c,onClick:()=>N.submit(),children:"保存"})})})]}),e.jsx(o,{title:"步骤基本信息",style:{marginBottom:24},children:e.jsxs(d,{form:N,layout:"vertical",onFinish:async e=>{u(!0);try{P.success("步骤配置保存成功"),p&&g({...p,...e})}catch(i){P.error("保存失败")}finally{u(!1)}},children:[e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"name",label:"步骤名称",rules:[{required:!0,message:"请输入步骤名称"}],children:e.jsx(C,{placeholder:"请输入步骤名称"})})}),e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"estimatedTime",label:"预计耗时（分钟）",rules:[{required:!0,message:"请输入预计耗时"}],children:e.jsx(R,{min:1,style:{width:"100%"},placeholder:"请输入预计耗时"})})}),e.jsx(G,{span:4,children:e.jsx(d.Item,{name:"sortOrder",label:"排序",rules:[{required:!0,message:"请输入排序"}],children:e.jsx(R,{min:1,style:{width:"100%"},placeholder:"排序"})})}),e.jsx(G,{span:4,children:e.jsx(d.Item,{name:"hasQualityControl",label:"质量控制点",valuePropName:"checked",children:e.jsx(A,{})})})]}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:16,children:e.jsx(d.Item,{name:"description",label:"步骤描述",rules:[{required:!0,message:"请输入步骤描述"}],children:e.jsx(Ne,{rows:3,placeholder:"请输入步骤描述"})})}),e.jsx(G,{span:8,children:e.jsxs(d.Item,{label:"SOP参考文档",children:[e.jsx(w,{children:e.jsx(h,{icon:e.jsx(k,{}),children:"选择文件"})}),p.sopDocument&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(b,{})," ",p.sopDocument]})]})})]})]})}),e.jsx(o,{title:"字段配置",extra:e.jsxs(I,{children:[e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{D(null),z.resetFields(),y(!0)},children:"添加字段"}),e.jsx(h,{onClick:()=>{P.info("批量编辑功能开发中")},children:"批量编辑"}),e.jsx(h,{onClick:()=>{P.success("配置验证通过")},children:"验证配置"})]}),children:e.jsx(x,{columns:K,dataSource:p.fields,rowKey:"id",pagination:!1,scroll:{x:1e3}})}),e.jsx(f,{title:O?"编辑字段":"添加字段",open:v,onCancel:()=>{y(!1),z.resetFields()},onOk:()=>z.submit(),width:800,children:e.jsxs(d,{form:z,layout:"vertical",onFinish:async e=>{try{if(O){if(p){const i=p.fields.map(i=>i.id===O.id?{...i,...e}:i);g({...p,fields:i})}P.success("字段更新成功")}else{const i={id:Date.now().toString(),...e,sortOrder:p?p.fields.length+1:1,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!1};p&&g({...p,fields:[...p.fields,i]}),P.success("字段添加成功")}y(!1),z.resetFields()}catch(i){P.error("操作失败")}},children:[e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"name",label:"字段名称",rules:[{required:!0,message:"请输入字段名称"}],children:e.jsx(C,{placeholder:"请输入字段名称"})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"identifier",label:"字段标识",rules:[{required:!0,message:"请输入字段标识"}],children:e.jsx(C,{placeholder:"请输入字段标识（英文）"})})})]}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"type",label:"字段类型",rules:[{required:!0,message:"请选择字段类型"}],children:e.jsx(q,{placeholder:"请选择字段类型",options:_})})}),e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"isRequired",label:"是否必填",valuePropName:"checked",children:e.jsx(A,{})})}),e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"显示顺序",children:e.jsx(R,{min:1,style:{width:"100%"}})})})]}),e.jsx(S,{children:"字段属性配置"}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"defaultValue",label:"默认值",children:e.jsx(C,{placeholder:"请输入默认值"})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"unit",label:"单位",children:e.jsx(C,{placeholder:"请输入单位"})})})]}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"placeholder",label:"提示文本",children:e.jsx(C,{placeholder:"请输入提示文本"})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"validationRule",label:"验证规则",children:e.jsx(C,{placeholder:"如：>0, 1.8-2.2"})})})]}),e.jsx(d.Item,{name:"helpText",label:"帮助文本",children:e.jsx(Ne,{rows:2,placeholder:"请输入帮助文本"})}),e.jsx(d.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.type!==i.type,children:({getFieldValue:i})=>"select"===i("type")?e.jsx(d.Item,{name:"options",label:"下拉选项",rules:[{required:!0,message:"请输入下拉选项"}],children:e.jsx(q,{mode:"tags",placeholder:"请输入选项，按回车添加",style:{width:"100%"}})}):null}),e.jsx(S,{children:"高级选项"}),e.jsxs(M,{gutter:16,children:[e.jsxs(G,{span:12,children:[e.jsx(d.Item,{name:"showInQuickPanel",label:"在快速记录面板显示",valuePropName:"checked",children:e.jsx(re,{})}),e.jsx(d.Item,{name:"allowBatchEdit",label:"允许批量编辑",valuePropName:"checked",children:e.jsx(re,{})})]}),e.jsxs(G,{span:12,children:[e.jsx(d.Item,{name:"participateValidation",label:"参与数据验证",valuePropName:"checked",children:e.jsx(re,{})}),e.jsx(d.Item,{name:"generateReport",label:"生成统计报表",valuePropName:"checked",children:e.jsx(re,{})})]})]})]})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"步骤不存在"})},{Option:Ve}=q,{TextArea:Le}=C,Me=()=>{const{stepId:s}=t(),r=l(),[n,a]=i.useState(!1),[c,u]=i.useState(!1),[p,g]=i.useState(null),[v,y]=i.useState(!1),[b,w]=i.useState(null),[k]=d.useForm(),[O]=d.useForm();i.useEffect(()=>{s&&D(s)},[s]);const D=async e=>{a(!0);try{g({stepId:e,stepName:"核酸提取",description:"核酸提取步骤的质量控制配置",overallPassRate:95.8,lastUpdateTime:"2024-01-15 14:30:00",qualityControlPoints:[{id:"1",name:"浓度检查",type:"automatic",checkType:"range",description:"检查核酸浓度是否在合理范围内",isRequired:!0,triggerCondition:"提取完成后",checkRule:"浓度 >= 10 ng/μl",warningThreshold:20,errorThreshold:10,autoCorrection:!1,notificationLevel:"error",relatedFields:["concentration"],sortOrder:1,isActive:!0},{id:"2",name:"纯度检查",type:"automatic",checkType:"range",description:"检查核酸纯度（260/280比值）",isRequired:!0,triggerCondition:"浓度检查通过后",checkRule:"1.8 <= 260/280 <= 2.2",warningThreshold:1.7,errorThreshold:1.5,autoCorrection:!1,notificationLevel:"warning",relatedFields:["ratio_260_280"],sortOrder:2,isActive:!0},{id:"3",name:"体积确认",type:"manual",checkType:"visual",description:"目视确认提取后的核酸体积",isRequired:!0,triggerCondition:"提取完成后",checkRule:"体积 >= 预期体积的80%",autoCorrection:!1,notificationLevel:"warning",relatedFields:["volume"],sortOrder:3,isActive:!0},{id:"4",name:"电泳质量检查",type:"semi-automatic",checkType:"file",description:"通过电泳图检查核酸完整性",isRequired:!1,triggerCondition:"需要时",checkRule:"主带清晰，无明显降解",autoCorrection:!1,notificationLevel:"info",relatedFields:["electrophoresis_image"],sortOrder:4,isActive:!0},{id:"5",name:"试剂有效期检查",type:"automatic",checkType:"formula",description:"检查使用的试剂是否在有效期内",isRequired:!0,triggerCondition:"实验开始前",checkRule:"当前日期 <= 试剂有效期",autoCorrection:!1,notificationLevel:"error",relatedFields:["reagent_kit"],sortOrder:5,isActive:!0}]})}catch(i){P.error("加载质量控制配置失败")}finally{a(!1)}},N=e=>{if(p){const i=p.qualityControlPoints.map(i=>({...i,isActive:e}));g({...p,qualityControlPoints:i}),P.success(`已${e?"启用":"禁用"}所有质量控制点`)}},z=[{label:"手动检查",value:"manual"},{label:"自动检查",value:"automatic"},{label:"半自动检查",value:"semi-automatic"}],V=[{label:"数值范围",value:"range"},{label:"枚举值",value:"enum"},{label:"公式计算",value:"formula"},{label:"文件检查",value:"file"},{label:"目视检查",value:"visual"}],_=[{label:"信息",value:"info"},{label:"警告",value:"warning"},{label:"错误",value:"error"}],K=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,i,l)=>l+1},{title:"控制点名称",dataIndex:"name",key:"name",width:150,render:(i,l)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:l.description})]})},{title:"类型",dataIndex:"type",key:"type",width:120,render:(i,l)=>{var t,s;return e.jsxs("div",{children:[e.jsx(j,{color:"automatic"===i?"blue":"manual"===i?"green":"orange",children:null==(t=z.find(e=>e.value===i))?void 0:t.label}),e.jsx("div",{style:{fontSize:"12px",marginTop:4},children:e.jsx(j,{size:"small",children:null==(s=V.find(e=>e.value===l.checkType))?void 0:s.label})})]})}},{title:"检查规则",dataIndex:"checkRule",key:"checkRule",width:200,render:(i,l)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{children:i}),l.triggerCondition&&e.jsxs("div",{style:{color:"#666",marginTop:4},children:["触发条件: ",l.triggerCondition]})]})},{title:"阈值设置",key:"threshold",width:120,render:(i,l)=>e.jsxs("div",{style:{fontSize:"12px"},children:[l.warningThreshold&&e.jsxs("div",{style:{color:"#faad14"},children:[e.jsx(de,{})," 警告: ",l.warningThreshold]}),l.errorThreshold&&e.jsxs("div",{style:{color:"#ff4d4f"},children:[e.jsx(J,{})," 错误: ",l.errorThreshold]})]})},{title:"状态",key:"status",width:100,render:(i,l)=>e.jsxs("div",{children:[e.jsx(j,{color:l.isActive?"success":"default",children:l.isActive?"启用":"禁用"}),l.isRequired&&e.jsx(j,{size:"small",color:"red",children:"必需"})]})},{title:"通知级别",dataIndex:"notificationLevel",key:"notificationLevel",width:100,render:i=>{var l;return e.jsx(j,{color:{info:"blue",warning:"orange",error:"red"}[i],children:null==(l=_.find(e=>e.value===i))?void 0:l.label})}},{title:"操作",key:"action",width:150,render:(i,l)=>e.jsxs(I,{size:"small",children:[e.jsx(T,{title:"编辑",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(B,{}),onClick:()=>{return w(e=l),O.setFieldsValue(e),void y(!0);var e}})}),e.jsx(T,{title:l.isActive?"禁用":"启用",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(Q,{}),onClick:()=>(e=>{if(p){const i=p.qualityControlPoints.map(i=>i.id===e.id?{...i,isActive:!i.isActive}:i);g({...p,qualityControlPoints:i}),P.success("质量控制点已"+(e.isActive?"禁用":"启用"))}})(l)})}),e.jsx(T,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(F,{}),onClick:()=>{return e=l,void f.confirm({title:"删除质量控制点",content:`确定要删除质量控制点"${e.name}"吗？`,onOk:()=>{if(p){const i=p.qualityControlPoints.filter(i=>i.id!==e.id);g({...p,qualityControlPoints:i}),P.success("质量控制点删除成功")}}});var e}})})]})}];return n?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):p?e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(M,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(G,{children:e.jsxs(I,{children:[e.jsx(h,{icon:e.jsx(L,{}),onClick:()=>{r(-1)},children:"返回"}),e.jsxs("h2",{style:{margin:0},children:["质量控制点配置 - ",p.stepName]})]})}),e.jsx(G,{children:e.jsxs(I,{children:[e.jsx(h,{onClick:()=>{P.success("质量控制规则测试通过")},children:"测试规则"}),e.jsx(h,{type:"primary",icon:e.jsx(E,{}),loading:c,onClick:async()=>{u(!0);try{P.success("质量控制配置保存成功")}catch(e){P.error("保存失败")}finally{u(!1)}},children:"保存配置"})]})})]}),e.jsxs(o,{title:"质量控制概览",style:{marginBottom:24},children:[e.jsxs(M,{gutter:24,children:[e.jsx(G,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:[p.overallPassRate,"%"]}),e.jsx("div",{style:{color:"#666"},children:"整体通过率"}),e.jsx(ne,{percent:p.overallPassRate,showInfo:!1,strokeColor:"#52c41a",style:{marginTop:8}})]})}),e.jsx(G,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:p.qualityControlPoints.filter(e=>e.isActive).length}),e.jsx("div",{style:{color:"#666"},children:"启用的控制点"})]})}),e.jsx(G,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#faad14"},children:p.qualityControlPoints.filter(e=>e.isRequired).length}),e.jsx("div",{style:{color:"#666"},children:"必需控制点"})]})})]}),e.jsx(S,{}),e.jsx(ae,{message:"质量控制配置说明",description:`最后更新时间: ${p.lastUpdateTime}。质量控制点按照设定的规则自动或手动检查实验数据，确保实验质量符合标准。`,type:"info",showIcon:!0})]}),e.jsx(o,{title:"质量控制点配置",extra:e.jsxs(I,{children:[e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{w(null),O.resetFields(),y(!0)},children:"添加控制点"}),e.jsx(h,{onClick:()=>N(!0),children:"批量启用"}),e.jsx(h,{onClick:()=>N(!1),children:"批量禁用"})]}),children:e.jsx(x,{columns:K,dataSource:p.qualityControlPoints,rowKey:"id",pagination:!1,scroll:{x:1200}})}),e.jsx(f,{title:b?"编辑质量控制点":"添加质量控制点",open:v,onCancel:()=>{y(!1),O.resetFields()},onOk:()=>O.submit(),width:900,children:e.jsxs(d,{form:O,layout:"vertical",onFinish:async e=>{try{if(b){if(p){const i=p.qualityControlPoints.map(i=>i.id===b.id?{...i,...e}:i);g({...p,qualityControlPoints:i})}P.success("质量控制点更新成功")}else{const i={id:Date.now().toString(),...e,sortOrder:p?p.qualityControlPoints.length+1:1,isActive:!0,relatedFields:e.relatedFields||[]};p&&g({...p,qualityControlPoints:[...p.qualityControlPoints,i]}),P.success("质量控制点添加成功")}y(!1),O.resetFields()}catch(i){P.error("操作失败")}},children:[e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"name",label:"控制点名称",rules:[{required:!0,message:"请输入控制点名称"}],children:e.jsx(C,{placeholder:"请输入控制点名称"})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"type",label:"检查类型",rules:[{required:!0,message:"请选择检查类型"}],children:e.jsx(q,{placeholder:"请选择检查类型",options:z})})})]}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"checkType",label:"检查方式",rules:[{required:!0,message:"请选择检查方式"}],children:e.jsx(q,{placeholder:"请选择检查方式",options:V})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"notificationLevel",label:"通知级别",rules:[{required:!0,message:"请选择通知级别"}],children:e.jsx(q,{placeholder:"请选择通知级别",options:_})})})]}),e.jsx(d.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入描述"}],children:e.jsx(Le,{rows:2,placeholder:"请输入控制点描述"})}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"triggerCondition",label:"触发条件",rules:[{required:!0,message:"请输入触发条件"}],children:e.jsx(C,{placeholder:"如：提取完成后"})})}),e.jsx(G,{span:12,children:e.jsx(d.Item,{name:"checkRule",label:"检查规则",rules:[{required:!0,message:"请输入检查规则"}],children:e.jsx(C,{placeholder:"如：浓度 >= 10 ng/μl"})})})]}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"warningThreshold",label:"警告阈值",children:e.jsx(R,{style:{width:"100%"},placeholder:"警告阈值"})})}),e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"errorThreshold",label:"错误阈值",children:e.jsx(R,{style:{width:"100%"},placeholder:"错误阈值"})})}),e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"排序",children:e.jsx(R,{min:1,style:{width:"100%"},placeholder:"排序"})})})]}),e.jsxs(M,{gutter:16,children:[e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"isRequired",label:"是否必需",valuePropName:"checked",children:e.jsx(A,{})})}),e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"autoCorrection",label:"自动纠正",valuePropName:"checked",children:e.jsx(A,{})})}),e.jsx(G,{span:8,children:e.jsx(d.Item,{name:"isActive",label:"启用状态",valuePropName:"checked",initialValue:!0,children:e.jsx(A,{})})})]}),e.jsx(d.Item,{name:"relatedFields",label:"关联字段",children:e.jsx(q,{mode:"tags",placeholder:"请选择关联的字段",style:{width:"100%"}})})]})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"步骤不存在"})},{Option:Ge}=q,{TextArea:Ee}=C,_e=()=>{const{templateId:s}=t(),r=l(),[n,a]=i.useState(!1),[c,u]=i.useState([]),[g,v]=i.useState(null),[b,R]=i.useState(!1),[S,w]=i.useState(!1),[k,A]=i.useState([]),[B,N]=i.useState([]),[z]=d.useForm();i.useEffect(()=>{s&&E(s)},[s]);const E=async e=>{a(!0);try{const i=[{id:"1",version:"v2.1.0",templateId:e,templateName:"核酸提取SOP模板",status:"active",description:"优化了质量控制点配置，增加了自动化检查功能",changeLog:"1. 新增自动浓度检查\n2. 优化纯度检查规则\n3. 增加试剂有效期验证",createdBy:"张三",createdTime:"2024-01-15 10:30:00",reviewedBy:"李四",reviewedTime:"2024-01-16 14:20:00",approvedBy:"王五",approvedTime:"2024-01-17 09:15:00",activatedTime:"2024-01-17 10:00:00",isCurrentVersion:!0,stepCount:8,fieldCount:25,qcPointCount:5},{id:"2",version:"v2.0.1",templateId:e,templateName:"核酸提取SOP模板",status:"archived",description:"修复了字段验证规则的问题",changeLog:"1. 修复浓度字段验证规则\n2. 更新帮助文档",createdBy:"张三",createdTime:"2024-01-10 16:45:00",reviewedBy:"李四",reviewedTime:"2024-01-11 10:30:00",approvedBy:"王五",approvedTime:"2024-01-11 15:20:00",activatedTime:"2024-01-12 09:00:00",isCurrentVersion:!1,stepCount:8,fieldCount:23,qcPointCount:4},{id:"3",version:"v2.0.0",templateId:e,templateName:"核酸提取SOP模板",status:"archived",description:"重大版本更新，重构了整个流程结构",changeLog:"1. 重构实验步骤\n2. 新增质量控制模块\n3. 优化用户界面",createdBy:"赵六",createdTime:"2024-01-01 09:00:00",reviewedBy:"李四",reviewedTime:"2024-01-02 14:30:00",approvedBy:"王五",approvedTime:"2024-01-03 11:15:00",activatedTime:"2024-01-05 08:30:00",isCurrentVersion:!1,stepCount:7,fieldCount:20,qcPointCount:3},{id:"4",version:"v1.2.0",templateId:e,templateName:"核酸提取SOP模板",status:"deprecated",description:"增加了电泳检查步骤",changeLog:"1. 新增电泳检查步骤\n2. 更新操作说明",createdBy:"张三",createdTime:"2023-12-15 14:20:00",reviewedBy:"李四",reviewedTime:"2023-12-16 10:45:00",approvedBy:"王五",approvedTime:"2023-12-17 16:30:00",activatedTime:"2023-12-18 09:00:00",isCurrentVersion:!1,stepCount:6,fieldCount:18,qcPointCount:2},{id:"5",version:"v2.2.0-beta",templateId:e,templateName:"核酸提取SOP模板",status:"draft",description:"测试版本，增加AI辅助质量控制功能",changeLog:"1. 集成AI质量控制\n2. 智能异常检测\n3. 自动报告生成",createdBy:"张三",createdTime:"2024-01-20 11:15:00",isCurrentVersion:!1,stepCount:9,fieldCount:28,qcPointCount:7}];v({id:e,name:"核酸提取SOP模板",description:"标准核酸提取操作流程模板",currentVersion:"v2.1.0"}),u(i)}catch(i){P.error("加载版本数据失败")}finally{a(!1)}},_={draft:{color:"default",text:"草稿"},review:{color:"processing",text:"审核中"},approved:{color:"success",text:"已批准"},active:{color:"success",text:"活跃"},archived:{color:"warning",text:"已归档"},deprecated:{color:"error",text:"已废弃"}},K=[{title:"版本号",dataIndex:"version",key:"version",width:120,render:(i,l)=>e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:500},children:[i,l.isCurrentVersion&&e.jsx(y,{status:"success",style:{marginLeft:8}})]}),l.isCurrentVersion&&e.jsx(j,{size:"small",color:"green",children:"当前版本"})]})},{title:"状态",dataIndex:"status",key:"status",width:100,render:i=>{const l=_[i];return e.jsx(j,{color:l.color,children:l.text})}},{title:"描述",dataIndex:"description",key:"description",width:200,ellipsis:!0},{title:"统计信息",key:"stats",width:150,render:(i,l)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["步骤: ",l.stepCount]}),e.jsxs("div",{children:["字段: ",l.fieldCount]}),e.jsxs("div",{children:["质控点: ",l.qcPointCount]})]})},{title:"创建信息",key:"createInfo",width:150,render:(i,l)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["创建人: ",l.createdBy]}),e.jsxs("div",{children:["创建时间: ",l.createdTime.split(" ")[0]]})]})},{title:"审批信息",key:"approvalInfo",width:150,render:(i,l)=>{var t;return e.jsxs("div",{style:{fontSize:"12px"},children:[l.approvedBy&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["批准人: ",l.approvedBy]}),e.jsxs("div",{children:["批准时间: ",null==(t=l.approvedTime)?void 0:t.split(" ")[0]]})]}),l.activatedTime&&e.jsxs("div",{style:{color:"#52c41a"},children:["激活时间: ",l.activatedTime.split(" ")[0]]})]})}},{title:"操作",key:"action",width:200,render:(i,l)=>e.jsxs(I,{size:"small",children:[e.jsx(T,{title:"查看",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(O,{}),onClick:()=>{var e;r(`/detection/sop-template/${(e=l).templateId}?version=${e.version}`)}})}),e.jsx(T,{title:"复制",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(ie,{}),onClick:()=>{return e=l,void f.confirm({title:"复制版本",content:`确定要基于版本 ${e.version} 创建新版本吗？`,onOk:()=>{P.success("版本复制成功，请编辑新版本信息"),R(!0)}});var e}})}),!l.isCurrentVersion&&"approved"===l.status&&e.jsx(T,{title:"激活",children:e.jsx(h,{type:"link",size:"small",icon:e.jsx(V,{}),onClick:()=>{return e=l,void f.confirm({title:"激活版本",content:`确定要激活版本 ${e.version} 吗？当前活跃版本将被归档。`,onOk:()=>{const i=c.map(i=>({...i,status:i.id===e.id?"active":"active"===i.status?"archived":i.status,isCurrentVersion:i.id===e.id,activatedTime:i.id===e.id?(new Date).toLocaleString():i.activatedTime}));u(i),P.success("版本激活成功")}});var e}})}),!l.isCurrentVersion&&e.jsx(D,{title:"确定要删除这个版本吗？",onConfirm:()=>(e=>{if(e.isCurrentVersion)return void P.error("不能删除当前活跃版本");const i=c.filter(i=>i.id!==e.id);u(i),P.success("版本删除成功")})(l),children:e.jsx(T,{title:"删除",children:e.jsx(h,{type:"link",size:"small",danger:!0,icon:e.jsx(F,{})})})})]})}],U=[{title:"字段",dataIndex:"field",key:"field",width:150},{title:"变更类型",dataIndex:"changeType",key:"changeType",width:100,render:i=>e.jsx(j,{color:{added:"success",modified:"warning",deleted:"error"}[i],children:{added:"新增",modified:"修改",deleted:"删除"}[i]})},{title:"旧值",dataIndex:"oldValue",key:"oldValue",width:200,render:e=>e||"-"},{title:"新值",dataIndex:"newValue",key:"newValue",width:200,render:e=>e||"-"}];return n?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(M,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(G,{children:e.jsxs(I,{children:[e.jsx(h,{icon:e.jsx(L,{}),onClick:()=>{r(-1)},children:"返回"}),e.jsxs("h2",{style:{margin:0},children:[e.jsx(ce,{})," SOP版本管理 - ",null==g?void 0:g.name]})]})}),e.jsx(G,{children:e.jsxs(I,{children:[e.jsx(h,{onClick:()=>{if(2!==k.length)return void P.warning("请选择两个版本进行比较");N([{field:"步骤数量",oldValue:"8",newValue:"9",changeType:"modified"},{field:"字段数量",oldValue:"25",newValue:"28",changeType:"modified"},{field:"质量控制点",oldValue:"5",newValue:"7",changeType:"modified"},{field:"AI质量控制",oldValue:"",newValue:"已启用",changeType:"added"},{field:"智能异常检测",oldValue:"",newValue:"已启用",changeType:"added"}]),w(!0)},disabled:2!==k.length,children:"版本比较"}),e.jsx(h,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{z.resetFields(),R(!0)},children:"创建版本"})]})})]}),e.jsx(o,{title:"模板信息",style:{marginBottom:24},children:e.jsxs(p,{column:3,children:[e.jsx(p.Item,{label:"模板名称",children:null==g?void 0:g.name}),e.jsx(p.Item,{label:"当前版本",children:e.jsx(j,{color:"success",children:null==g?void 0:g.currentVersion})}),e.jsx(p.Item,{label:"版本总数",children:c.length}),e.jsx(p.Item,{label:"模板描述",span:3,children:null==g?void 0:g.description})]})}),e.jsxs(o,{title:e.jsxs(I,{children:[e.jsx(le,{}),"版本历史"]}),children:[e.jsx(ae,{message:"版本管理说明",description:"版本管理遵循语义化版本控制规范。主版本号.次版本号.修订号，如 v2.1.0。只有已批准的版本才能激活使用。",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(x,{columns:K,dataSource:c,rowKey:"id",rowSelection:{selectedRowKeys:k,onChange:e=>A(e),getCheckboxProps:e=>({disabled:"draft"===e.status})},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 个版本`},scroll:{x:1200}})]}),e.jsx(f,{title:"创建新版本",open:b,onCancel:()=>{R(!1),z.resetFields()},onOk:()=>z.submit(),width:600,children:e.jsxs(d,{form:z,layout:"vertical",onFinish:async e=>{try{const i={id:Date.now().toString(),templateId:s,templateName:(null==g?void 0:g.name)||"",isCurrentVersion:!1,stepCount:0,fieldCount:0,qcPointCount:0,createdBy:"当前用户",createdTime:(new Date).toLocaleString(),...e};u([i,...c]),R(!1),z.resetFields(),P.success("版本创建成功")}catch(i){P.error("创建失败")}},children:[e.jsx(d.Item,{name:"version",label:"版本号",rules:[{required:!0,message:"请输入版本号"},{pattern:/^v\d+\.\d+\.\d+(-\w+)?$/,message:"版本号格式不正确，如：v2.1.0 或 v2.1.0-beta"}],children:e.jsx(C,{placeholder:"如：v2.1.0 或 v2.1.0-beta"})}),e.jsx(d.Item,{name:"status",label:"初始状态",rules:[{required:!0,message:"请选择初始状态"}],initialValue:"draft",children:e.jsxs(q,{children:[e.jsx(Ge,{value:"draft",children:"草稿"}),e.jsx(Ge,{value:"review",children:"提交审核"})]})}),e.jsx(d.Item,{name:"description",label:"版本描述",rules:[{required:!0,message:"请输入版本描述"}],children:e.jsx(C,{placeholder:"请简要描述此版本的主要变更"})}),e.jsx(d.Item,{name:"changeLog",label:"变更日志",rules:[{required:!0,message:"请输入变更日志"}],children:e.jsx(Ee,{rows:4,placeholder:"请详细描述此版本的变更内容，每行一个变更点"})})]})}),e.jsxs(f,{title:"版本比较",open:S,onCancel:()=>w(!1),footer:[e.jsx(h,{onClick:()=>w(!1),children:"关闭"},"close")],width:800,children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(ae,{message:`正在比较版本: ${k.join(" vs ")}`,type:"info",showIcon:!0})}),e.jsx(x,{columns:U,dataSource:B,rowKey:"field",pagination:!1,size:"small"})]})]})},Ke=()=>e.jsxs("div",{children:[e.jsxs(oe,{style:{margin:"16px 0"},children:[e.jsx(oe.Item,{children:"首页"}),e.jsx(oe.Item,{children:"检测项目"})]}),e.jsxs(r,{children:[e.jsx(n,{index:!0,element:e.jsx(a,{to:"test-item",replace:!0})}),e.jsx(n,{path:"test-item",element:e.jsx(ue,{})}),e.jsx(n,{path:"test-item/add",element:e.jsx(ve,{})}),e.jsx(n,{path:"analysis-item",element:e.jsx(fe,{})}),e.jsx(n,{path:"methodology",element:e.jsx(ke,{})}),e.jsx(n,{path:"sop-config",element:e.jsx(Te,{})}),e.jsx(n,{path:"sop-template/:templateId",element:e.jsx(De,{})}),e.jsx(n,{path:"sop-step/:stepId",element:e.jsx(ze,{})}),e.jsx(n,{path:"sop-quality-control/:stepId",element:e.jsx(Me,{})}),e.jsx(n,{path:"sop-version/:templateId",element:e.jsx(_e,{})})]})]});export{Ke as default};
