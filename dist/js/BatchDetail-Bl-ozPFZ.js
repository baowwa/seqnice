import{j as e}from"./index-C66Fo541.js";import{u as s,j as t,r as a}from"./react-vendor-BSBC8BLg.js";import{$ as l,ar as i,aq as r,B as n,a as d,c,d as o,S as p,aA as x,l as m,T as h,G as j,X as u,af as y,a9 as g,n as f,Q as v,aE as T,aN as b,x as I,a7 as w,O as q,am as C,ao as S,V as k,W as _,a1 as z,a8 as N,a4 as R,az as D,A as M,Z as A,aQ as B,D as F,m as H,a5 as P,a3 as E,U as O,ah as V,ai as K,s as L,aI as Q}from"./antd-vendor-Cz4lwG7B.js";const{Title:$,Text:J,Paragraph:X}=h,{Option:G}=R,{TextArea:U}=E,{TabPane:W}=C,{Panel:Y}=Q,{Step:Z}=w,ee=()=>{const h=s(),{batchId:Q}=t(),[X,Y]=a.useState(!1),[ee,se]=a.useState(null),[te,ae]=a.useState("overview"),[le,ie]=a.useState(null),[re,ne]=a.useState(!1),[de,ce]=a.useState(!1),[oe,pe]=a.useState(null),[xe,me]=a.useState(!1),[he]=l.useForm(),[je]=l.useForm(),ue={id:"batch_001",batchCode:"EXP001",batchName:"微生物基因组测序实验-批次001",status:"in_progress",sampleCount:24,samples:[{id:"sample_001",sampleCode:"S001",sampleName:"土壤样本-1",sampleType:"DNA",status:"processing",receivedDate:"2024-01-15",position:"A1",volume:50,concentration:125.6,purity:1.85},{id:"sample_002",sampleCode:"S002",sampleName:"水样-1",sampleType:"DNA",status:"processing",receivedDate:"2024-01-15",position:"A2",volume:45,concentration:98.3,purity:1.92}],operator:"张实验员",project:"环境微生物多样性研究",plannedStartDate:"2024-01-15",plannedEndDate:"2024-01-20",actualStartDate:"2024-01-15",priority:"high",notes:"高优先级项目，需要严格质控",createdBy:"李主管",createdTime:"2024-01-14 16:30:00",updatedTime:"2024-01-16 10:15:00",progress:45,currentStep:"核酸提取",steps:[{id:"step_001",stepType:"sample_prep",stepName:"样本预处理",status:"completed",operator:"张实验员",startTime:"2024-01-15 09:00:00",endTime:"2024-01-15 11:30:00",duration:150,notes:"样本预处理完成，质量良好",dataRecords:[],attachments:[],qualityControl:[]},{id:"step_002",stepType:"nucleic_extraction",stepName:"核酸提取",status:"in_progress",operator:"张实验员",startTime:"2024-01-16 09:00:00",notes:"正在进行核酸提取",dataRecords:[{id:"record_001",sampleId:"sample_001",sampleCode:"S001",recordType:"sample_level",data:{extractionMethod:"磁珠法",extractionVolume:200,elutionVolume:50,concentration:125.6,purity260280:1.85,purity260230:2.1,totalYield:6.28},recordTime:"2024-01-16 10:30:00",operator:"张实验员",verified:!0}],attachments:[],qualityControl:[{id:"qc_001",qcType:"浓度检测",qcResult:"pass",qcValue:125.6,qcRange:"50-500 ng/μL",qcTime:"2024-01-16 10:30:00",qcOperator:"张实验员"}]},{id:"step_003",stepType:"pcr",stepName:"PCR扩增",status:"pending",operator:"张实验员",notes:"等待核酸提取完成",dataRecords:[],attachments:[],qualityControl:[]},{id:"step_004",stepType:"library_prep",stepName:"文库构建",status:"pending",operator:"张实验员",notes:"等待PCR扩增完成",dataRecords:[],attachments:[],qualityControl:[]},{id:"step_005",stepType:"quantification",stepName:"文库定量",status:"pending",operator:"张实验员",notes:"等待文库构建完成",dataRecords:[],attachments:[],qualityControl:[]},{id:"step_006",stepType:"qc",stepName:"质量检测",status:"pending",operator:"张实验员",notes:"最终质量检测",dataRecords:[],attachments:[],qualityControl:[]}]};a.useEffect(()=>{Y(!0),setTimeout(()=>{se(ue),Y(!1)},1e3)},[Q]);const ye=e=>({draft:"default",ready:"blue",in_progress:"processing",paused:"warning",completed:"success",failed:"error",cancelled:"default",pending:"default"}[e]||"default"),ge=e=>({draft:"草稿",ready:"就绪",in_progress:"进行中",paused:"暂停",completed:"已完成",failed:"失败",cancelled:"已取消",pending:"待开始"}[e]||e),fe=s=>{switch(s){case"completed":return e.jsx(A,{style:{color:"#52c41a"}});case"in_progress":return e.jsx(i,{spin:!0,style:{color:"#1890ff"}});case"failed":return e.jsx(B,{style:{color:"#ff4d4f"}});default:return e.jsx(O,{style:{color:"#d9d9d9"}})}},ve=e=>{pe(e||null),me(!!e),e?he.setFieldsValue(e.data):he.resetFields()},Te=[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:100},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:150},{title:"位置",dataIndex:"position",key:"position",width:80},{title:"体积(μL)",dataIndex:"volume",key:"volume",width:100},{title:"浓度(ng/μL)",dataIndex:"concentration",key:"concentration",width:120},{title:"纯度(260/280)",dataIndex:"purity",key:"purity",width:120},{title:"状态",dataIndex:"status",key:"status",width:100,render:s=>e.jsx(u,{color:ye(s),children:ge(s)})}],be=[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:100},{title:"记录类型",dataIndex:"recordType",key:"recordType",width:100,render:s=>e.jsx(u,{children:{basic:"基本信息",sample_level:"样本级别",batch_level:"批次级别",qc:"质量控制"}[s]||s})},{title:"记录时间",dataIndex:"recordTime",key:"recordTime",width:150},{title:"操作员",dataIndex:"operator",key:"operator",width:100},{title:"验证状态",dataIndex:"verified",key:"verified",width:100,render:s=>e.jsx(u,{color:s?"success":"warning",children:s?"已验证":"待验证"})},{title:"操作",key:"action",width:120,render:(s,t)=>e.jsxs(p,{children:[e.jsx(n,{type:"link",size:"small",icon:e.jsx(V,{}),onClick:()=>ve(t),children:"查看"}),e.jsx(n,{type:"link",size:"small",icon:e.jsx(K,{}),onClick:()=>ve(t),children:"编辑"})]})}];return X&&!ee?e.jsxs("div",{style:{padding:"24px",textAlign:"center"},children:[e.jsx(i,{spin:!0,style:{fontSize:"24px"}}),e.jsx("div",{style:{marginTop:"16px"},children:"加载批次详情中..."})]}):ee?e.jsxs("div",{style:{padding:"24px"},children:[e.jsx(d,{style:{marginBottom:24},children:e.jsxs(c,{gutter:16,align:"middle",children:[e.jsx(o,{span:18,children:e.jsxs(p,{children:[e.jsx(n,{type:"text",icon:e.jsx(x,{}),onClick:()=>h("/experiment/task-center"),children:"返回"}),e.jsx(m,{type:"vertical"}),e.jsxs($,{level:3,style:{margin:0},children:[e.jsx(j,{style:{marginRight:8}}),ee.batchName]}),e.jsx(u,{color:ye(ee.status),children:ge(ee.status)})]})}),e.jsx(o,{span:6,style:{textAlign:"right"},children:e.jsxs(p,{children:[e.jsx(n,{icon:e.jsx(y,{}),children:"打印"}),e.jsx(n,{icon:e.jsx(g,{}),children:"导出"}),e.jsx(n,{type:"primary",icon:e.jsx(f,{}),children:"设置"})]})})]})}),e.jsxs(c,{gutter:16,style:{marginBottom:24},children:[e.jsx(o,{span:6,children:e.jsx(d,{children:e.jsx(v,{title:"批次进度",value:ee.progress,suffix:"%",valueStyle:{color:"#1890ff"},prefix:e.jsx(j,{})})})}),e.jsx(o,{span:6,children:e.jsx(d,{children:e.jsx(v,{title:"样本数量",value:ee.sampleCount,suffix:"个",valueStyle:{color:"#52c41a"},prefix:e.jsx(T,{})})})}),e.jsx(o,{span:6,children:e.jsx(d,{children:e.jsx(v,{title:"当前步骤",value:ee.currentStep,valueStyle:{color:"#722ed1",fontSize:"16px"},prefix:e.jsx(b,{})})})}),e.jsx(o,{span:6,children:e.jsx(d,{children:e.jsx(v,{title:"执行人员",value:ee.operator,valueStyle:{color:"#fa8c16",fontSize:"16px"},prefix:e.jsx(I,{})})})})]}),e.jsx(d,{title:"实验步骤跟踪",style:{marginBottom:24},children:e.jsx(w,{current:ee.steps.findIndex(e=>"in_progress"===e.status),status:"failed"===ee.status?"error":"process",children:ee.steps.map((s,t)=>e.jsx(Z,{title:s.stepName,description:e.jsxs("div",{children:[e.jsxs("div",{children:["操作员: ",s.operator]}),s.startTime&&e.jsxs("div",{children:["开始: ",q(s.startTime).format("MM-DD HH:mm")]}),s.endTime&&e.jsxs("div",{children:["完成: ",q(s.endTime).format("MM-DD HH:mm")]})]}),status:"completed"===s.status?"finish":"in_progress"===s.status?"process":"failed"===s.status?"error":"wait",icon:fe(s.status),onClick:()=>(e=>{ie(e),ne(!0)})(s),style:{cursor:"pointer"}},s.id))})}),e.jsx(d,{children:e.jsxs(C,{activeKey:te,onChange:ae,children:[e.jsx(W,{tab:"批次概览",children:e.jsxs(c,{gutter:16,children:[e.jsxs(o,{span:16,children:[e.jsx(d,{title:"批次信息",size:"small",style:{marginBottom:16},children:e.jsxs(S,{column:2,size:"small",children:[e.jsx(S.Item,{label:"批次编号",children:ee.batchCode}),e.jsx(S.Item,{label:"项目名称",children:ee.project}),e.jsx(S.Item,{label:"优先级",children:e.jsx(u,{color:"high"===ee.priority?"red":"medium"===ee.priority?"orange":"blue",children:"high"===ee.priority?"高":"medium"===ee.priority?"中":"低"})}),e.jsx(S.Item,{label:"创建人",children:ee.createdBy}),e.jsx(S.Item,{label:"计划开始",children:ee.plannedStartDate}),e.jsx(S.Item,{label:"计划结束",children:ee.plannedEndDate}),e.jsx(S.Item,{label:"实际开始",children:ee.actualStartDate||"未开始"}),e.jsx(S.Item,{label:"实际结束",children:ee.actualEndDate||"未完成"}),e.jsx(S.Item,{label:"备注",span:2,children:ee.notes})]})}),e.jsx(d,{title:"样本列表",size:"small",children:e.jsx(k,{size:"small",dataSource:ee.samples,columns:Te,rowKey:"id",pagination:!1,scroll:{y:300}})})]}),e.jsx(o,{span:8,children:e.jsx(d,{title:"进度时间线",size:"small",children:e.jsx(_,{children:ee.steps.map(s=>e.jsx(_.Item,{dot:fe(s.status),color:"completed"===s.status?"green":"in_progress"===s.status?"blue":"gray",children:e.jsxs("div",{children:[e.jsx(J,{strong:!0,children:s.stepName}),e.jsx("br",{}),e.jsxs(J,{type:"secondary",children:["操作员: ",s.operator]}),e.jsx("br",{}),s.startTime&&e.jsxs(J,{type:"secondary",children:["开始: ",q(s.startTime).format("MM-DD HH:mm")]}),s.endTime&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsxs(J,{type:"secondary",children:["完成: ",q(s.endTime).format("MM-DD HH:mm")]})]}),s.notes&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(J,{type:"secondary",children:s.notes})]})]})},s.id))})})})]})},"overview"),e.jsx(W,{tab:"数据记录",children:e.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(c,{gutter:16,children:[e.jsx(o,{span:18,children:e.jsxs(p,{children:[e.jsx(n,{type:"primary",icon:e.jsx(z,{}),onClick:()=>ve(),children:"新增记录"}),e.jsx(n,{icon:e.jsx(i,{}),onClick:()=>ce(!0),children:"快速记录"}),e.jsx(n,{icon:e.jsx(N,{}),children:"导入数据"}),e.jsx(n,{icon:e.jsx(g,{}),children:"导出数据"})]})}),e.jsx(o,{span:6,style:{textAlign:"right"},children:e.jsx(R,{placeholder:"筛选步骤",style:{width:150},allowClear:!0,children:ee.steps.map(s=>e.jsx(G,{value:s.id,children:s.stepName},s.id))})})]}),e.jsx(k,{size:"small",dataSource:ee.steps.flatMap(e=>e.dataRecords),columns:be,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})]})},"records"),e.jsxs(W,{tab:"质量控制",children:[e.jsxs(c,{gutter:16,children:[e.jsx(o,{span:12,children:e.jsx(d,{title:"质控统计",size:"small",children:e.jsxs(c,{gutter:16,children:[e.jsx(o,{span:8,children:e.jsx(v,{title:"通过率",value:95.8,suffix:"%",valueStyle:{color:"#52c41a"}})}),e.jsx(o,{span:8,children:e.jsx(v,{title:"警告项",value:2,valueStyle:{color:"#faad14"}})}),e.jsx(o,{span:8,children:e.jsx(v,{title:"失败项",value:1,valueStyle:{color:"#ff4d4f"}})})]})})}),e.jsx(o,{span:12,children:e.jsx(d,{title:"质控趋势",size:"small",children:e.jsx("div",{style:{height:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(J,{type:"secondary",children:"质控趋势图表"})})})})]}),e.jsx(d,{title:"质控记录",size:"small",style:{marginTop:16},children:e.jsx(D,{size:"small",dataSource:ee.steps.flatMap(e=>e.qualityControl),renderItem:s=>e.jsxs(D.Item,{children:[e.jsx(D.Item.Meta,{avatar:e.jsx(M,{icon:"pass"===s.qcResult?e.jsx(A,{}):"warning"===s.qcResult?e.jsx(r,{}):e.jsx(B,{}),style:{backgroundColor:"pass"===s.qcResult?"#52c41a":"warning"===s.qcResult?"#faad14":"#ff4d4f"}}),title:s.qcType,description:e.jsxs("div",{children:[e.jsxs("div",{children:["结果: ",s.qcValue," (",s.qcRange,")"]}),e.jsxs("div",{children:["时间: ",s.qcTime," | 操作员: ",s.qcOperator]}),s.qcNotes&&e.jsxs("div",{children:["备注: ",s.qcNotes]})]})}),e.jsx(u,{color:"pass"===s.qcResult?"success":"warning"===s.qcResult?"warning":"error",children:"pass"===s.qcResult?"通过":"warning"===s.qcResult?"警告":"失败"})]})})})]},"qc")]})}),e.jsx(F,{title:e.jsxs("div",{children:[e.jsx(n,{type:"text",icon:e.jsx(x,{}),onClick:()=>ne(!1),style:{marginRight:8}}),null==le?void 0:le.stepName," - 数据记录"]}),placement:"right",width:800,open:re,onClose:()=>ne(!1),children:le&&e.jsxs("div",{children:[e.jsx(d,{title:"步骤信息",size:"small",style:{marginBottom:16},children:e.jsxs(S,{column:2,size:"small",children:[e.jsx(S.Item,{label:"步骤名称",children:le.stepName}),e.jsx(S.Item,{label:"状态",children:e.jsx(u,{color:ye(le.status),children:ge(le.status)})}),e.jsx(S.Item,{label:"操作员",children:le.operator}),e.jsx(S.Item,{label:"开始时间",children:le.startTime}),e.jsx(S.Item,{label:"结束时间",children:le.endTime||"进行中"}),e.jsx(S.Item,{label:"耗时",children:le.duration?`${le.duration}分钟`:"计算中"}),e.jsx(S.Item,{label:"备注",span:2,children:le.notes})]})}),e.jsx(d,{title:"数据记录",size:"small",extra:e.jsxs(p,{children:[e.jsx(n,{type:"primary",size:"small",icon:e.jsx(z,{}),onClick:()=>ve(),children:"新增记录"}),e.jsx(n,{size:"small",icon:e.jsx(H,{}),children:"刷新"})]}),children:e.jsx(k,{size:"small",dataSource:le.dataRecords,columns:be,rowKey:"id",pagination:!1})})]})}),e.jsx(P,{title:"快速记录",open:de,onCancel:()=>ce(!1),onOk:()=>je.submit(),confirmLoading:X,width:600,children:e.jsxs(l,{form:je,layout:"vertical",onFinish:async e=>{try{Y(!0),await new Promise(e=>setTimeout(e,500)),L.success("快速记录成功"),ce(!1),je.resetFields()}catch(s){L.error("记录失败，请重试")}finally{Y(!1)}},children:[e.jsx(l.Item,{name:"stepId",label:"实验步骤",rules:[{required:!0,message:"请选择实验步骤"}],children:e.jsx(R,{placeholder:"请选择实验步骤",children:ee.steps.map(s=>e.jsx(G,{value:s.id,children:s.stepName},s.id))})}),e.jsx(l.Item,{name:"sampleCode",label:"样本编号",rules:[{required:!0,message:"请输入样本编号"}],children:e.jsx(E,{placeholder:"请输入样本编号"})}),e.jsx(l.Item,{name:"recordData",label:"记录数据",rules:[{required:!0,message:"请输入记录数据"}],children:e.jsx(U,{rows:4,placeholder:"请输入记录数据，支持JSON格式"})}),e.jsx(l.Item,{name:"notes",label:"备注",children:e.jsx(U,{rows:2,placeholder:"请输入备注信息"})})]})})]}):e.jsxs("div",{style:{padding:"24px",textAlign:"center"},children:[e.jsx(r,{style:{fontSize:"48px",color:"#faad14"}}),e.jsx("div",{style:{marginTop:"16px"},children:"批次不存在或已被删除"}),e.jsx(n,{type:"primary",onClick:()=>h("/experiment/task-center"),children:"返回任务中心"})]})};export{ee as default};
