import{j as e}from"./index-bgfNE6VX.js";import{r as s}from"./react-vendor-By8n_QN6.js";import{_ as t,c as r,d as a,a as i,P as l,$ as n,U as d,N as c,S as o,a0 as h,a1 as x,B as p,a2 as j,a3 as m,a4 as u,W as g,X as y,l as v,a5 as D,a6 as f,s as w,a7 as I,a8 as S,a9 as C,aa as A,ab as b,ac as T,Y as q,ad as Y,ae as N}from"./antd-vendor-Cii6xr0v.js";const{Option:L}=x,{TextArea:k}=h,{Step:P}=N,M=()=>{const[N,P]=s.useState([]),[M,z]=s.useState([]),[B,F]=s.useState([]),[Z,$]=s.useState(!1),[_,O]=s.useState(!1),[Q,E]=s.useState(!1),[H,J]=s.useState(!1),[R,V]=s.useState(null),[W,K]=s.useState(null),[U]=t.useForm(),[X,G]=s.useState(""),[ee,se]=s.useState(""),[te,re]=s.useState("");s.useEffect(()=>{(async()=>{$(!0);try{await new Promise(e=>setTimeout(e,500)),P([{id:"1",code:"S001",barcode:"BC001234567890",name:"肠道菌群样本-患者001",projectId:"1",projectName:"肠道菌群多样性分析项目",sampleTypeId:"1",sampleTypeName:"粪便样本",status:"received",priority:"high",receivedDate:"2024-01-15",expectedDate:"2024-01-20",volume:5,concentration:120.5,purity:1.85,qualityScore:95,storageLocation:"A1-01-001",temperature:-80,receiverId:"1",receiverName:"张三",notes:"样本状态良好，无异常",qcPassed:!0,createdAt:"2024-01-15T09:00:00Z",updatedAt:"2024-01-15T10:30:00Z"},{id:"2",code:"S002",barcode:"BC001234567891",name:"土壤微生物样本-地点A",projectId:"2",projectName:"土壤微生物群落结构研究",sampleTypeId:"2",sampleTypeName:"土壤样本",status:"processing",priority:"medium",receivedDate:"2024-02-01",expectedDate:"2024-02-05",volume:10,concentration:85.2,purity:1.65,qualityScore:88,storageLocation:"B2-02-015",temperature:-20,receiverId:"2",receiverName:"李四",notes:"需要进一步纯化处理",qcPassed:!1,createdAt:"2024-02-01T14:00:00Z",updatedAt:"2024-02-02T11:15:00Z"},{id:"3",code:"S003",barcode:"BC001234567892",name:"海水微生物样本-深海001",projectId:"3",projectName:"海洋微生物基因组测序",sampleTypeId:"3",sampleTypeName:"水体样本",status:"completed",priority:"high",receivedDate:"2023-10-15",expectedDate:"2023-10-20",volume:50,concentration:200.8,purity:1.95,qualityScore:98,storageLocation:"C3-01-008",temperature:-80,receiverId:"1",receiverName:"张三",notes:"优质样本，测序结果优异",qcPassed:!0,createdAt:"2023-10-15T08:30:00Z",updatedAt:"2023-12-31T16:45:00Z"}])}catch(e){w.error("获取样本列表失败")}finally{$(!1)}})(),(async()=>{z([{id:"1",name:"肠道菌群多样性分析项目",code:"PRJ001",customerId:"1",customerName:"北京大学医学院",description:"",status:"in_progress",priority:"high",startDate:"2024-01-15",endDate:"2024-03-15",estimatedDays:60,actualDays:45,progress:75,managerId:"1",managerName:"张三",createdAt:"",updatedAt:""},{id:"2",name:"土壤微生物群落结构研究",code:"PRJ002",customerId:"2",customerName:"中科院生态环境研究中心",description:"",status:"planning",priority:"medium",startDate:"2024-03-01",endDate:"2024-05-01",estimatedDays:60,actualDays:0,progress:10,managerId:"2",managerName:"李四",createdAt:"",updatedAt:""},{id:"3",name:"海洋微生物基因组测序",code:"PRJ003",customerId:"3",customerName:"青岛海洋大学",description:"",status:"completed",priority:"high",startDate:"2023-10-01",endDate:"2023-12-31",estimatedDays:90,actualDays:85,progress:100,managerId:"1",managerName:"张三",createdAt:"",updatedAt:""}])})(),(async()=>{F([{id:"1",name:"粪便样本",code:"FECES",category:"biological",description:"人体或动物粪便样本",storageCondition:"-80°C冷冻保存",processingTime:24,isActive:!0,createdAt:"",updatedAt:""},{id:"2",name:"土壤样本",code:"SOIL",category:"environmental",description:"各类土壤环境样本",storageCondition:"-20°C冷冻保存",processingTime:48,isActive:!0,createdAt:"",updatedAt:""},{id:"3",name:"水体样本",code:"WATER",category:"environmental",description:"海水、淡水等水体样本",storageCondition:"-80°C冷冻保存",processingTime:12,isActive:!0,createdAt:"",updatedAt:""}])})()},[]);const ae=e=>({received:"blue",processing:"orange",completed:"green",failed:"red",on_hold:"gray"}[e]),ie=e=>({received:"已接收",processing:"处理中",completed:"已完成",failed:"失败",on_hold:"暂停"}[e]),le=e=>({high:"red",medium:"orange",low:"green"}[e]),ne=e=>({high:"高",medium:"中",low:"低"}[e]),de=s=>s?e.jsx(q,{style:{color:"#52c41a"}}):e.jsx(Y,{style:{color:"#f5222d"}}),ce=[{title:"样本编号",dataIndex:"code",key:"code",width:120,fixed:"left"},{title:"条码",dataIndex:"barcode",key:"barcode",width:150,render:(s,t)=>e.jsxs(o,{children:[e.jsx("span",{children:s}),e.jsx(I,{title:"查看条码",children:e.jsx(p,{type:"text",size:"small",icon:e.jsx(S,{}),onClick:()=>xe(t)})})]})},{title:"样本名称",dataIndex:"name",key:"name",width:200,ellipsis:{showTitle:!1},render:s=>e.jsx(I,{placement:"topLeft",title:s,children:s})},{title:"项目",dataIndex:"projectName",key:"projectName",width:180,ellipsis:!0},{title:"样本类型",dataIndex:"sampleTypeName",key:"sampleTypeName",width:120},{title:"状态",dataIndex:"status",key:"status",width:100,render:s=>e.jsx(g,{color:ae(s),children:ie(s)})},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:s=>e.jsx(g,{color:le(s),children:ne(s)})},{title:"质检",dataIndex:"qcPassed",key:"qcPassed",width:60,render:s=>e.jsx(I,{title:s?"质检通过":"质检未通过",children:de(s)})},{title:"质量评分",dataIndex:"qualityScore",key:"qualityScore",width:100,render:s=>e.jsx(y,{percent:s,size:"small",status:s>=90?"success":s>=70?"active":"exception",format:e=>`${e}`})},{title:"存储位置",dataIndex:"storageLocation",key:"storageLocation",width:120},{title:"接收日期",dataIndex:"receivedDate",key:"receivedDate",width:110,render:e=>c(e).format("YYYY-MM-DD")},{title:"接收人",dataIndex:"receiverName",key:"receiverName",width:100},{title:"操作",key:"action",width:150,fixed:"right",render:(s,t)=>e.jsxs(o,{size:"small",children:[e.jsx(I,{title:"查看详情",children:e.jsx(p,{type:"text",icon:e.jsx(C,{}),onClick:()=>he(t)})}),e.jsx(I,{title:"编辑",children:e.jsx(p,{type:"text",icon:e.jsx(A,{}),onClick:()=>oe(t)})}),e.jsx(I,{title:"打印条码",children:e.jsx(p,{type:"text",icon:e.jsx(f,{}),onClick:()=>pe(t)})}),e.jsx(b,{title:"确定要删除这个样本吗？",onConfirm:()=>je(t.id),okText:"确定",cancelText:"取消",children:e.jsx(I,{title:"删除",children:e.jsx(p,{type:"text",danger:!0,icon:e.jsx(T,{})})})})]})}],oe=e=>{V(e),U.setFieldsValue({...e,receivedDate:c(e.receivedDate),expectedDate:e.expectedDate?c(e.expectedDate):null}),O(!0)},he=e=>{K(e),E(!0)},xe=e=>{K(e),J(!0)},pe=e=>{w.success(`正在打印样本 ${e.code} 的条码...`)},je=async e=>{try{await new Promise(e=>setTimeout(e,500)),P(N.filter(s=>s.id!==e)),w.success("样本删除成功")}catch(s){w.error("删除样本失败")}},me=N.filter(e=>{const s=!X||e.name.toLowerCase().includes(X.toLowerCase())||e.code.toLowerCase().includes(X.toLowerCase())||e.barcode.toLowerCase().includes(X.toLowerCase())||e.projectName.toLowerCase().includes(X.toLowerCase()),t=!ee||e.status===ee,r=!te||e.projectId===te;return s&&t&&r}),ue={total:N.length,received:N.filter(e=>"received"===e.status).length,processing:N.filter(e=>"processing"===e.status).length,completed:N.filter(e=>"completed"===e.status).length,qcPassed:N.filter(e=>e.qcPassed).length,avgQuality:N.length>0?N.reduce((e,s)=>e+(s.qualityScore||0),0)/N.length:0};return e.jsxs("div",{children:[e.jsxs(r,{gutter:16,style:{marginBottom:16},children:[e.jsx(a,{span:6,children:e.jsx(i,{children:e.jsx(l,{title:"样本总数",value:ue.total,prefix:e.jsx(n,{})})})}),e.jsx(a,{span:6,children:e.jsx(i,{children:e.jsx(l,{title:"处理中",value:ue.processing,valueStyle:{color:"#1890ff"}})})}),e.jsx(a,{span:6,children:e.jsx(i,{children:e.jsx(l,{title:"质检通过率",value:ue.total>0?ue.qcPassed/ue.total*100:0,precision:1,suffix:"%",valueStyle:{color:ue.qcPassed/ue.total>.8?"#52c41a":"#f5222d"}})})}),e.jsx(a,{span:6,children:e.jsx(i,{children:e.jsx(l,{title:"平均质量评分",value:ue.avgQuality,precision:1,valueStyle:{color:ue.avgQuality>=90?"#52c41a":ue.avgQuality>=70?"#1890ff":"#f5222d"}})})})]}),e.jsx(i,{title:"样本接收管理",extra:e.jsxs(o,{children:[e.jsx(h.Search,{placeholder:"搜索样本名称、编号或条码",value:X,onChange:e=>G(e.target.value),style:{width:250}}),e.jsxs(x,{placeholder:"筛选状态",value:ee,onChange:se,style:{width:120},allowClear:!0,children:[e.jsx(L,{value:"received",children:"已接收"}),e.jsx(L,{value:"processing",children:"处理中"}),e.jsx(L,{value:"completed",children:"已完成"}),e.jsx(L,{value:"failed",children:"失败"}),e.jsx(L,{value:"on_hold",children:"暂停"})]}),e.jsx(x,{placeholder:"筛选项目",value:te,onChange:re,style:{width:200},allowClear:!0,children:M.map(s=>e.jsx(L,{value:s.id,children:s.name},s.id))}),e.jsx(p,{type:"primary",icon:e.jsx(j,{}),onClick:()=>{V(null),U.resetFields();const e=`BC${Date.now()}`;U.setFieldsValue({barcode:e}),O(!0)},children:"样本登记"})]}),children:e.jsx(d,{columns:ce,dataSource:me,rowKey:"id",loading:Z,scroll:{x:1800},pagination:{total:me.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}),e.jsx(m,{title:R?"编辑样本":"样本登记",open:_,onCancel:()=>{O(!1),U.resetFields()},footer:null,width:800,children:e.jsxs(t,{form:U,layout:"vertical",onFinish:async e=>{var s,t;try{$(!0),await new Promise(e=>setTimeout(e,1e3));const r={...e,receivedDate:e.receivedDate.format("YYYY-MM-DD"),expectedDate:e.expectedDate?e.expectedDate.format("YYYY-MM-DD"):null,projectName:null==(s=M.find(s=>s.id===e.projectId))?void 0:s.name,sampleTypeName:null==(t=B.find(s=>s.id===e.sampleTypeId))?void 0:t.name,qualityScore:e.qualityScore||0,qcPassed:(e.qualityScore||0)>=70};if(R){const e={...R,...r,updatedAt:(new Date).toISOString()};P(N.map(s=>s.id===R.id?e:s)),w.success("样本更新成功")}else{const e={id:Date.now().toString(),code:`S${String(N.length+1).padStart(3,"0")}`,...r,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};P([...N,e]),w.success("样本登记成功")}O(!1),U.resetFields()}catch(r){w.error("操作失败")}finally{$(!1)}},children:[e.jsxs(r,{gutter:16,children:[e.jsx(a,{span:12,children:e.jsx(t.Item,{name:"name",label:"样本名称",rules:[{required:!0,message:"请输入样本名称"}],children:e.jsx(h,{placeholder:"请输入样本名称"})})}),e.jsx(a,{span:12,children:e.jsx(t.Item,{name:"barcode",label:"样本条码",rules:[{required:!0,message:"请输入样本条码"}],children:e.jsx(h,{placeholder:"自动生成或手动输入"})})})]}),e.jsxs(r,{gutter:16,children:[e.jsx(a,{span:12,children:e.jsx(t.Item,{name:"projectId",label:"所属项目",rules:[{required:!0,message:"请选择所属项目"}],children:e.jsx(x,{placeholder:"请选择所属项目",children:M.map(s=>e.jsx(L,{value:s.id,children:s.name},s.id))})})}),e.jsx(a,{span:12,children:e.jsx(t.Item,{name:"sampleTypeId",label:"样本类型",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsx(x,{placeholder:"请选择样本类型",children:B.map(s=>e.jsx(L,{value:s.id,children:s.name},s.id))})})})]}),e.jsxs(r,{gutter:16,children:[e.jsx(a,{span:8,children:e.jsx(t.Item,{name:"priority",label:"优先级",rules:[{required:!0,message:"请选择优先级"}],children:e.jsxs(x,{placeholder:"请选择优先级",children:[e.jsx(L,{value:"high",children:"高"}),e.jsx(L,{value:"medium",children:"中"}),e.jsx(L,{value:"low",children:"低"})]})})}),e.jsx(a,{span:8,children:e.jsx(t.Item,{name:"receivedDate",label:"接收日期",rules:[{required:!0,message:"请选择接收日期"}],children:e.jsx(u,{style:{width:"100%"}})})}),e.jsx(a,{span:8,children:e.jsx(t.Item,{name:"expectedDate",label:"预期完成日期",children:e.jsx(u,{style:{width:"100%"}})})})]}),e.jsxs(r,{gutter:16,children:[e.jsx(a,{span:8,children:e.jsx(t.Item,{name:"volume",label:"样本体积 (mL)",children:e.jsx(h,{type:"number",placeholder:"请输入样本体积"})})}),e.jsx(a,{span:8,children:e.jsx(t.Item,{name:"concentration",label:"浓度 (ng/μL)",children:e.jsx(h,{type:"number",placeholder:"请输入浓度"})})}),e.jsx(a,{span:8,children:e.jsx(t.Item,{name:"purity",label:"纯度 (A260/A280)",children:e.jsx(h,{type:"number",placeholder:"请输入纯度"})})})]}),e.jsxs(r,{gutter:16,children:[e.jsx(a,{span:12,children:e.jsx(t.Item,{name:"storageLocation",label:"存储位置",rules:[{required:!0,message:"请输入存储位置"}],children:e.jsx(h,{placeholder:"如：A1-01-001"})})}),e.jsx(a,{span:12,children:e.jsx(t.Item,{name:"temperature",label:"存储温度 (°C)",children:e.jsxs(x,{placeholder:"请选择存储温度",children:[e.jsx(L,{value:-80,children:"-80°C"}),e.jsx(L,{value:-20,children:"-20°C"}),e.jsx(L,{value:4,children:"4°C"}),e.jsx(L,{value:25,children:"室温"})]})})})]}),e.jsxs(r,{gutter:16,children:[e.jsx(a,{span:12,children:e.jsx(t.Item,{name:"qualityScore",label:"质量评分",children:e.jsx(h,{type:"number",min:0,max:100,placeholder:"0-100分"})})}),e.jsx(a,{span:12,children:e.jsx(t.Item,{name:"status",label:"样本状态",rules:[{required:!0,message:"请选择样本状态"}],children:e.jsxs(x,{placeholder:"请选择样本状态",children:[e.jsx(L,{value:"received",children:"已接收"}),e.jsx(L,{value:"processing",children:"处理中"}),e.jsx(L,{value:"completed",children:"已完成"}),e.jsx(L,{value:"failed",children:"失败"}),e.jsx(L,{value:"on_hold",children:"暂停"})]})})})]}),e.jsx(t.Item,{name:"notes",label:"备注",children:e.jsx(k,{rows:3,placeholder:"请输入备注信息"})}),e.jsx(t.Item,{style:{textAlign:"right",marginBottom:0},children:e.jsxs(o,{children:[e.jsx(p,{onClick:()=>O(!1),children:"取消"}),e.jsx(p,{type:"primary",htmlType:"submit",loading:Z,children:R?"更新":"登记"})]})})]})}),e.jsx(m,{title:"样本详情",open:Q,onCancel:()=>E(!1),footer:[e.jsx(p,{onClick:()=>E(!1),children:"关闭"},"close")],width:800,children:W&&e.jsxs("div",{children:[e.jsxs(r,{gutter:16,children:[e.jsx(a,{span:12,children:e.jsxs(i,{size:"small",title:"基本信息",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"样本编号："}),W.code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"样本名称："}),W.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"条码："}),W.barcode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"所属项目："}),W.projectName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"样本类型："}),W.sampleTypeName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"状态："}),e.jsx(g,{color:ae(W.status),style:{marginLeft:8},children:ie(W.status)})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"优先级："}),e.jsx(g,{color:le(W.priority),style:{marginLeft:8},children:ne(W.priority)})]})]})}),e.jsx(a,{span:12,children:e.jsxs(i,{size:"small",title:"质量信息",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"质量评分："}),e.jsx(y,{percent:W.qualityScore,size:"small",style:{marginLeft:8,width:100}})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"质检状态："}),de(W.qcPassed||!1),e.jsx("span",{style:{marginLeft:8},children:W.qcPassed?"通过":"未通过"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"样本体积："}),W.volume," mL"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"浓度："}),W.concentration," ng/μL"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"纯度："}),W.purity]})]})})]}),e.jsx(v,{}),e.jsxs(r,{gutter:16,children:[e.jsx(a,{span:12,children:e.jsxs(i,{size:"small",title:"存储信息",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"存储位置："}),W.storageLocation]}),e.jsxs("p",{children:[e.jsx("strong",{children:"存储温度："}),W.temperature,"°C"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"接收日期："}),c(W.receivedDate).format("YYYY-MM-DD")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"预期完成："}),W.expectedDate?c(W.expectedDate).format("YYYY-MM-DD"):"未设置"]})]})}),e.jsx(a,{span:12,children:e.jsxs(i,{size:"small",title:"处理信息",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"接收人："}),W.receiverName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"创建时间："}),c(W.createdAt).format("YYYY-MM-DD HH:mm")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"更新时间："}),c(W.updatedAt).format("YYYY-MM-DD HH:mm")]})]})})]}),e.jsx(v,{}),e.jsx(i,{size:"small",title:"备注信息",children:e.jsx("p",{children:W.notes||"无备注"})})]})}),e.jsx(m,{title:"样本条码",open:H,onCancel:()=>J(!1),footer:[e.jsx(p,{type:"primary",icon:e.jsx(f,{}),onClick:()=>pe(W),children:"打印条码"},"print"),e.jsx(p,{onClick:()=>J(!1),children:"关闭"},"close")],width:400,children:W&&e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(D,{value:W.barcode,size:200}),e.jsxs("div",{style:{marginTop:16},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"样本编号："}),W.code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"条码："}),W.barcode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"样本名称："}),W.name]})]})]})})]})};export{M as default};
