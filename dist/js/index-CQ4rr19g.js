import{j as e}from"./index-q4y2ftL-.js";import{r as i,u as t,j as l,k as s,h as r,i as n,N as a}from"./react-vendor-BSBC8BLg.js";import{$ as d,a as c,S as o,B as m,a1 as h,V as u,a5 as x,a3 as p,a4 as j,X as g,ai as y,ak as v,al as I,s as f,aA as b,T as C,c as k,e as q,at as S,aa as w,a2 as R,l as P,aB as T,an as A,D as O,ao as F,ad as B,m as z,az as V,ag as N,ah as D,aI as E,G,o as L,bg as K,a7 as Q,bj as $,I as M,aq as _,w as U,bd as H,bk as W,bl as J,a_ as X,ap as Z,ay as Y,bm as ee,bn as ie,Z as te,Y as le,ac as se,av as re,bo as ne,u as ae}from"./antd-vendor-inL-Hoh7.js";const{Option:de}=j,ce=()=>{const[t,l]=i.useState([{id:"T-001",code:"TP001",name:"肺癌基因检测",shortName:"肺癌检测",englishName:"Lung Cancer Gene Test",description:"用于后续关系绑定",status:"active",groupId:"G-001"},{id:"T-002",code:"TP002",name:"结直肠癌基因检测",shortName:"结直肠检测",englishName:"Colorectal Cancer Gene Test",description:"用于后续关系绑定",status:"active",groupId:"G-002"},{id:"T-003",code:"TP003",name:"乳腺癌基因检测",shortName:"乳腺检测",englishName:"Breast Cancer Gene Test",description:"用于后续关系绑定",status:"inactive",groupId:"G-003"}]),[s,r]=i.useState([]),[n,a]=i.useState(!1),[b,C]=i.useState(null),[k]=d.useForm();i.useEffect(()=>{try{const e=localStorage.getItem("testItemGroups");if(e){const i=JSON.parse(e),t=Array.isArray(i)?i.map(e=>({id:String(e.id),name:String(e.name),status:"inactive"===e.status?"inactive":"active"})):[];r(t)}}catch(e){}},[]);const q=(e=null)=>{C(e),a(!0),e?k.setFieldsValue(e):k.resetFields()},S=[{title:"检测项目编码",dataIndex:"code",key:"code"},{title:"检测项目名称",dataIndex:"name",key:"name"},{title:"简称",dataIndex:"shortName",key:"shortName"},{title:"英文名称",dataIndex:"englishName",key:"englishName"},{title:"分组",dataIndex:"groupId",key:"groupId",render:e=>{const i=s.find(i=>i.id===e);return i?i.name:"-"}},{title:"描述",dataIndex:"description",key:"description"},{title:"状态",dataIndex:"status",key:"status",render:i=>e.jsx(g,{color:"active"===i?"green":"red",children:"active"===i?"启用":"停用"})},{title:"操作",key:"action",render:(i,s)=>e.jsxs(o,{children:[e.jsx(m,{size:"small",type:"link",icon:e.jsx(y,{}),onClick:()=>q(s),children:"编辑"}),e.jsx(m,{size:"small",type:"link",onClick:()=>(e=>{const i=t.map(i=>i.id===e?{...i,status:"active"===i.status?"inactive":"active"}:i);l(i)})(s.id),children:"active"===s.status?"停用":"启用"}),e.jsx(v,{title:"确认删除该项目？",onConfirm:()=>{return e=s.id,l(t.filter(i=>i.id!==e)),void f.success("检测项目已删除");var e},children:e.jsx(m,{size:"small",danger:!0,type:"link",icon:e.jsx(I,{}),children:"删除"})})]})}];return e.jsxs("div",{children:[e.jsxs(c,{title:"检测项目",children:[e.jsx(o,{style:{marginBottom:16},children:e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>q(null),children:"新增检测项目"})}),e.jsx(u,{rowKey:"id",columns:S,dataSource:t,pagination:{pageSize:8}})]}),e.jsx(x,{title:b?"编辑检测项目":"新增检测项目",open:n,onCancel:()=>a(!1),onOk:()=>k.submit(),destroyOnClose:!0,children:e.jsxs(d,{form:k,layout:"vertical",onFinish:e=>{if(b){const i=t.map(i=>i.id===b.id?{...b,...e}:i);l(i),f.success("检测项目更新成功")}else{const i={id:`T-${Math.random().toString(36).slice(2,8)}`,...e};l([i,...t]),f.success("检测项目创建成功")}a(!1),C(null),k.resetFields()},initialValues:{status:"active"},children:[e.jsx(d.Item,{label:"检测项目编码",name:"code",rules:[{required:!0,message:"请输入编码"}],children:e.jsx(p,{placeholder:"例如：TP001"})}),e.jsx(d.Item,{label:"检测项目名称",name:"name",rules:[{required:!0,message:"请输入名称"}],children:e.jsx(p,{placeholder:"例如：肺癌基因检测"})}),e.jsx(d.Item,{label:"检测项目简称",name:"shortName",rules:[{required:!0,message:"请输入检测项目简称"}],children:e.jsx(p,{placeholder:"例如：肺癌检测"})}),e.jsx(d.Item,{label:"英文名称",name:"englishName",rules:[{required:!0,message:"请输入英文名称"}],children:e.jsx(p,{placeholder:"例如：Lung Cancer Gene Test"})}),e.jsx(d.Item,{label:"所属分组",name:"groupId",rules:[{required:!0,message:"请选择分组"}],children:e.jsx(j,{placeholder:"请选择分组",children:s.filter(e=>"active"===e.status).map(i=>e.jsx(de,{value:i.id,children:i.name},i.id))})}),e.jsx(d.Item,{label:"描述",name:"description",children:e.jsx(p.TextArea,{rows:3,placeholder:"项目用途或说明"})}),e.jsx(d.Item,{label:"状态",name:"status",rules:[{required:!0}],children:e.jsxs(j,{children:[e.jsx(de,{value:"active",children:"启用"}),e.jsx(de,{value:"inactive",children:"停用"})]})})]})})]})},{Title:oe}=C,{Option:me}=j,{TextArea:he}=p,ue=()=>{const l=t(),[s]=d.useForm(),[r,n]=i.useState(!1),[a,u]=i.useState([]),x=[{id:"1",name:"BRCA1基因检测",code:"BRCA1",category:"遗传学检测"},{id:"2",name:"BRCA2基因检测",code:"BRCA2",category:"遗传学检测"},{id:"3",name:"TP53基因检测",code:"TP53",category:"肿瘤标志物"},{id:"4",name:"EGFR基因检测",code:"EGFR",category:"肿瘤标志物"},{id:"5",name:"KRAS基因检测",code:"KRAS",category:"肿瘤标志物"}],g=(e,i,t)=>{const l=[...a];if("analysisItemId"===i){const i=x.find(e=>e.id===t);i&&(l[e]={...l[e],id:i.id,name:i.name,code:i.code})}else l[e]={...l[e],[i]:t};u(l)};return e.jsx("div",{style:{padding:"24px",minHeight:"100vh",backgroundColor:"#f5f5f5"},children:e.jsxs(c,{children:[e.jsx("div",{style:{marginBottom:24},children:e.jsxs(o,{children:[e.jsx(m,{icon:e.jsx(b,{}),onClick:()=>l("/detection/test-item"),children:"返回列表"}),e.jsx(oe,{level:3,style:{margin:0},children:"新增检测项目"})]})}),e.jsxs(d,{form:s,layout:"vertical",onFinish:async e=>{try{n(!0);e.mode,e.executionMode,e.templateId,(new Date).toISOString(),(new Date).toISOString();await new Promise(e=>setTimeout(e,1e3)),f.success("检测项目创建成功！"),l("/detection/test-item")}catch(i){f.error("创建失败，请重试")}finally{n(!1)}},initialValues:{isActive:!0,status:"active",duration:5,price:0,mode:"document",executionMode:"reference"},children:[e.jsxs(c,{title:"基本信息",style:{marginBottom:16},children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"项目名称",name:"name",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(p,{placeholder:"请输入项目名称"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"英文名称",name:"englishName",children:e.jsx(p,{placeholder:"请输入英文名称"})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"项目编码",name:"code",rules:[{required:!0,message:"请输入项目编码"}],children:e.jsx(p,{placeholder:"请输入项目编码"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"项目分类",name:"category",rules:[{required:!0,message:"请选择项目分类"}],children:e.jsxs(j,{placeholder:"请选择项目分类",children:[e.jsx(me,{value:"遗传学检测",children:"遗传学检测"}),e.jsx(me,{value:"肿瘤标志物",children:"肿瘤标志物"}),e.jsx(me,{value:"病原体检测",children:"病原体检测"}),e.jsx(me,{value:"药物基因组学",children:"药物基因组学"})]})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"所属科室",name:"department",children:e.jsxs(j,{placeholder:"请选择所属科室",children:[e.jsx(me,{value:"分子诊断科",children:"分子诊断科"}),e.jsx(me,{value:"病理科",children:"病理科"}),e.jsx(me,{value:"检验科",children:"检验科"}),e.jsx(me,{value:"肿瘤科",children:"肿瘤科"})]})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"负责人",name:"responsible",children:e.jsx(p,{placeholder:"请输入负责人"})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"项目价格",name:"price",rules:[{required:!0,message:"请输入项目价格"}],children:e.jsx(S,{style:{width:"100%"},placeholder:"请输入项目价格",min:0,precision:2,addonAfter:"元"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"报告周期(工作日)",name:"duration",rules:[{required:!0,message:"请输入报告周期"}],children:e.jsx(S,{style:{width:"100%"},placeholder:"请输入报告周期",min:1,addonAfter:"天"})})})]}),e.jsx(d.Item,{label:"项目描述",name:"description",children:e.jsx(he,{rows:3,placeholder:"请输入项目描述"})})]}),e.jsxs(c,{title:"技术信息",style:{marginBottom:16},children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"主方法学",name:"primaryMethodology",rules:[{required:!0,message:"请选择主方法学"}],children:e.jsxs(j,{placeholder:"请选择主方法学",children:[e.jsx(me,{value:"PCR",children:"PCR"}),e.jsx(me,{value:"qPCR",children:"qPCR"}),e.jsx(me,{value:"NGS",children:"NGS"}),e.jsx(me,{value:"Sanger测序",children:"Sanger测序"}),e.jsx(me,{value:"FISH",children:"FISH"}),e.jsx(me,{value:"免疫组化",children:"免疫组化"})]})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"备用方法学",name:"backupMethodologies",children:e.jsxs(j,{mode:"multiple",placeholder:"请选择备用方法学",children:[e.jsx(me,{value:"PCR",children:"PCR"}),e.jsx(me,{value:"qPCR",children:"qPCR"}),e.jsx(me,{value:"NGS",children:"NGS"}),e.jsx(me,{value:"Sanger测序",children:"Sanger测序"}),e.jsx(me,{value:"FISH",children:"FISH"}),e.jsx(me,{value:"免疫组化",children:"免疫组化"})]})})})]}),e.jsx(d.Item,{label:"样本类型",name:"sampleTypes",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsxs(j,{mode:"multiple",placeholder:"请选择样本类型",children:[e.jsx(me,{value:"全血",children:"全血"}),e.jsx(me,{value:"血浆",children:"血浆"}),e.jsx(me,{value:"血清",children:"血清"}),e.jsx(me,{value:"唾液",children:"唾液"}),e.jsx(me,{value:"组织",children:"组织"}),e.jsx(me,{value:"石蜡切片",children:"石蜡切片"}),e.jsx(me,{value:"尿液",children:"尿液"})]})})]}),e.jsxs(c,{title:"临床信息",style:{marginBottom:16},children:[e.jsx(d.Item,{label:"临床应用",name:"clinicalApplication",children:e.jsx(he,{rows:3,placeholder:"请输入临床应用描述"})}),e.jsx(d.Item,{label:"质量要求",name:"qualityRequirements",children:e.jsx(he,{rows:3,placeholder:"请输入质量要求"})}),e.jsx(d.Item,{label:"报告模板",name:"reportTemplate",children:e.jsxs(j,{placeholder:"请选择报告模板",children:[e.jsx(me,{value:"标准模板",children:"标准模板"}),e.jsx(me,{value:"简化模板",children:"简化模板"}),e.jsx(me,{value:"详细模板",children:"详细模板"}),e.jsx(me,{value:"自定义模板",children:"自定义模板"})]})})]}),e.jsxs(c,{title:"SOP配置",style:{marginBottom:16},children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"配置模式",name:"mode",rules:[{required:!0,message:"请选择配置模式"}],children:e.jsxs(j,{placeholder:"请选择配置模式",children:[e.jsx(me,{value:"document",children:"文档模式"}),e.jsx(me,{value:"structured",children:"结构化模式"})]})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"执行模式",name:"executionMode",rules:[{required:!0,message:"请选择执行模式"}],children:e.jsxs(j,{placeholder:"请选择执行模式",children:[e.jsx(me,{value:"strict",children:"严格模式"}),e.jsx(me,{value:"guided",children:"引导模式"}),e.jsx(me,{value:"reference",children:"参考模式"})]})})})]}),e.jsx(d.Item,{label:"SOP文档",name:"sopDocuments",children:e.jsx(w,{multiple:!0,beforeUpload:()=>!1,showUploadList:{showRemoveIcon:!0},children:e.jsx(m,{icon:e.jsx(R,{}),children:"上传SOP文档"})})}),e.jsx(d.Item,{label:"标准模板",name:"templateId",children:e.jsxs(j,{placeholder:"请选择标准模板",children:[e.jsx(me,{value:"template1",children:"PCR标准模板"}),e.jsx(me,{value:"template2",children:"NGS标准模板"}),e.jsx(me,{value:"template3",children:"免疫组化标准模板"}),e.jsx(me,{value:"template4",children:"FISH标准模板"})]})})]}),e.jsxs(c,{title:"关联分析项目",style:{marginBottom:16},children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(m,{type:"dashed",icon:e.jsx(h,{}),onClick:()=>{const e={id:"",name:"",code:"",reportOrder:a.length+1,isRequired:!1,isActive:!0};u([...a,e])},block:!0,children:"添加关联分析项目"})}),a.map((i,t)=>e.jsx(c,{size:"small",style:{marginBottom:8},extra:e.jsx(m,{type:"text",danger:!0,icon:e.jsx(I,{}),onClick:()=>(e=>{const i=a.filter((i,t)=>t!==e);u(i)})(t)}),children:e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(d.Item,{label:"分析项目",style:{marginBottom:0},children:e.jsx(j,{placeholder:"请选择分析项目",value:i.id,onChange:e=>g(t,"analysisItemId",e),children:x.map(i=>e.jsxs(me,{value:i.id,children:[i.name," (",i.code,")"]},i.id))})})}),e.jsx(q,{span:4,children:e.jsx(d.Item,{label:"报告顺序",style:{marginBottom:0},children:e.jsx(S,{min:1,value:i.reportOrder,onChange:e=>g(t,"reportOrder",e)})})}),e.jsx(q,{span:6,children:e.jsx(d.Item,{label:"是否必需",style:{marginBottom:0},children:e.jsx(P,{checked:i.isRequired,onChange:e=>g(t,"isRequired",e)})})}),e.jsx(q,{span:6,children:e.jsx(d.Item,{label:"是否启用",style:{marginBottom:0},children:e.jsx(P,{checked:i.isActive,onChange:e=>g(t,"isActive",e)})})})]})},t))]}),e.jsx(c,{title:"状态设置",style:{marginBottom:24},children:e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"项目状态",name:"status",rules:[{required:!0,message:"请选择项目状态"}],children:e.jsxs(j,{placeholder:"请选择项目状态",children:[e.jsx(me,{value:"active",children:"启用"}),e.jsx(me,{value:"inactive",children:"停用"}),e.jsx(me,{value:"pending",children:"待审核"})]})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{label:"是否激活",name:"isActive",valuePropName:"checked",children:e.jsx(P,{})})})]})}),e.jsx("div",{style:{textAlign:"center"},children:e.jsxs(o,{size:"large",children:[e.jsx(m,{onClick:()=>l("/detection/test-item"),children:"取消"}),e.jsx(m,{type:"primary",htmlType:"submit",loading:r,icon:e.jsx(T,{}),children:"保存"})]})})]})]})})},{Option:xe}=j,{TextArea:pe}=p,{Text:je}=C,ge=()=>{var t;const[l,s]=i.useState([{id:"1",name:"EGFR基因突变检测",code:"EGFR_MUT",testItemId:"1",testItemName:"肺癌基因检测",category:"基因突变",type:"qualitative",referenceRange:"野生型",normalValue:"未检出突变",abnormalCriteria:"检出突变",clinicalSignificance:"用于指导靶向治疗药物选择，EGFR突变阳性患者可使用吉非替尼、厄洛替尼等靶向药物",methodologyId:"1",methodologyName:"NGS测序",sampleType:["血液","组织"],reportOrder:1,isActive:!0,isRequired:!0,description:"EGFR基因19、21外显子突变检测",status:"active",reportConfiguration:{template:"EGFR突变检测报告模板v2.1",format:"pdf",includeGraphs:!0,includeInterpretation:!0},qualityControl:{cvRequirement:15,accuracyRequirement:95,precisionRequirement:90},associatedDiseases:["非小细胞肺癌","肺腺癌"],interpretationRules:[{condition:"检出19外显子缺失突变",interpretation:"EGFR敏感突变阳性",recommendation:"建议使用EGFR-TKI靶向治疗"},{condition:"检出21外显子L858R突变",interpretation:"EGFR敏感突变阳性",recommendation:"建议使用EGFR-TKI靶向治疗"}],createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"2",name:"KRAS基因突变检测",code:"KRAS_MUT",testItemId:"1",testItemName:"肺癌基因检测",category:"基因突变",type:"qualitative",referenceRange:"野生型",normalValue:"未检出突变",abnormalCriteria:"检出突变",clinicalSignificance:"用于预测治疗反应性，KRAS突变患者对EGFR-TKI治疗耐药",methodologyId:"1",methodologyName:"NGS测序",sampleType:["血液","组织"],reportOrder:2,isActive:!0,isRequired:!1,description:"KRAS基因2、3、4外显子突变检测",status:"active",reportConfiguration:{template:"KRAS突变检测报告模板v1.3",format:"pdf",includeGraphs:!1,includeInterpretation:!0},qualityControl:{cvRequirement:20,accuracyRequirement:92,precisionRequirement:88},associatedDiseases:["非小细胞肺癌","结直肠癌"],interpretationRules:[{condition:"检出KRAS突变",interpretation:"KRAS突变阳性",recommendation:"不建议使用EGFR-TKI治疗，考虑化疗或免疫治疗"}],createdAt:"2024-01-15",updatedAt:"2024-01-15"},{id:"3",name:"HER2基因扩增检测",code:"HER2_AMP",testItemId:"2",testItemName:"乳腺癌基因检测",category:"基因扩增",type:"quantitative",unit:"拷贝数",referenceRange:"<2.0",normalValue:"<2.0",abnormalCriteria:"≥2.0",clinicalSignificance:"用于HER2靶向治疗指导，HER2扩增阳性患者可使用曲妥珠单抗等靶向药物",methodologyId:"2",methodologyName:"qPCR",sampleType:["组织"],reportOrder:1,isActive:!0,isRequired:!0,description:"HER2基因拷贝数检测",status:"active",reportConfiguration:{template:"HER2扩增检测报告模板v1.8",format:"pdf",includeGraphs:!0,includeInterpretation:!0},qualityControl:{cvRequirement:10,accuracyRequirement:98,precisionRequirement:95},associatedDiseases:["乳腺癌","胃癌"],interpretationRules:[{condition:"HER2拷贝数≥2.0",interpretation:"HER2扩增阳性",recommendation:"建议使用HER2靶向治疗药物"}],createdAt:"2024-01-16",updatedAt:"2024-01-16"},{id:"4",name:"MSI微卫星不稳定性",code:"MSI_STATUS",testItemId:"3",testItemName:"结直肠癌基因检测",category:"微卫星",type:"qualitative",referenceRange:"MSS",normalValue:"MSS（微卫星稳定）",abnormalCriteria:"MSI-H（高度不稳定）",clinicalSignificance:"用于免疫治疗疗效预测，MSI-H患者对PD-1/PD-L1抑制剂治疗敏感",methodologyId:"1",methodologyName:"NGS测序",sampleType:["组织"],reportOrder:1,isActive:!0,isRequired:!0,description:"5个微卫星位点不稳定性检测",status:"active",reportConfiguration:{template:"MSI检测报告模板v2.0",format:"pdf",includeGraphs:!0,includeInterpretation:!0},qualityControl:{cvRequirement:5,accuracyRequirement:99,precisionRequirement:98},associatedDiseases:["结直肠癌","子宫内膜癌","胃癌"],interpretationRules:[{condition:"MSI-H",interpretation:"微卫星高度不稳定",recommendation:"建议使用PD-1/PD-L1抑制剂免疫治疗"}],createdAt:"2024-01-17",updatedAt:"2024-01-17"}]),[r,n]=i.useState(!1),[a,b]=i.useState(null),[C]=d.useForm(),[k,q]=i.useState(""),[w,R]=i.useState(!1),[T,E]=i.useState(null),G=e=>{b(e||null),e?C.setFieldsValue(e):C.resetFields(),n(!0)},L=e=>({active:{text:"有效",color:"green"},pending:{text:"待审",color:"orange"},inactive:{text:"停用",color:"red"}}[e]||{text:e,color:"default"}),K=l.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())||e.code.toLowerCase().includes(k.toLowerCase())||e.testItemName.toLowerCase().includes(k.toLowerCase())),Q=[{title:"项目名称",dataIndex:"name",key:"name",width:200,render:(i,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.code})]})},{title:"所属检测项目",dataIndex:"testItemName",key:"testItemName",width:150},{title:"类别",dataIndex:"category",key:"category",width:100},{title:"类型",dataIndex:"type",key:"type",width:100,render:i=>{const t={quantitative:{text:"定量",color:"blue"},qualitative:{text:"定性",color:"green"},"semi-quantitative":{text:"半定量",color:"orange"}}[i];return e.jsx(g,{color:t.color,children:t.text})}},{title:"参考范围",dataIndex:"referenceRange",key:"referenceRange",width:120,render:(i,t)=>e.jsxs("div",{children:[e.jsx("div",{children:i}),t.unit&&e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["单位: ",t.unit]})]})},{title:"关联疾病",key:"associatedDiseases",width:120,render:i=>{var t,l;return e.jsx(N,{title:(null==(t=i.associatedDiseases)?void 0:t.join("、"))||"无",children:e.jsx(je,{ellipsis:!0,style:{maxWidth:100},children:(l=i.associatedDiseases,l&&0!==l.length?l.slice(0,2).join("、")+(l.length>2?"等":""):"无")})})}},{title:"方法学",dataIndex:"methodologyName",key:"methodologyName",width:100},{title:"样本类型",dataIndex:"sampleType",key:"sampleType",width:120,render:i=>e.jsxs("div",{children:[i.slice(0,2).map(i=>e.jsx(g,{children:i},i)),i.length>2&&e.jsxs(g,{children:["+",i.length-2]})]})},{title:"报告顺序",dataIndex:"reportOrder",key:"reportOrder",width:80,align:"center"},{title:"项目状态",key:"status",width:100,render:i=>{const t=L(i.status);return e.jsxs("div",{children:[e.jsx(g,{color:t.color,children:t.text}),i.isRequired&&e.jsx(B,{status:"processing",text:"必需"})]})}},{title:"操作",key:"action",width:150,render:i=>e.jsxs(o,{size:"small",children:[e.jsx(N,{title:"查看详情",children:e.jsx(m,{type:"text",icon:e.jsx(D,{}),onClick:()=>(E(i),void R(!0))})}),e.jsx(N,{title:"编辑",children:e.jsx(m,{type:"text",icon:e.jsx(y,{}),onClick:()=>G(i)})}),e.jsx(v,{title:"确定要删除这个分析项目吗？",onConfirm:()=>{return e=i.id,s(i=>i.filter(i=>i.id!==e)),void f.success("分析项目删除成功");var e},okText:"确定",cancelText:"取消",children:e.jsx(N,{title:"删除",children:e.jsx(m,{type:"text",danger:!0,icon:e.jsx(I,{})})})})]})},{title:"临床意义",dataIndex:"clinicalSignificance",key:"clinicalSignificance",width:200,ellipsis:{showTitle:!1},render:i=>e.jsx(N,{placement:"topLeft",title:i,children:i})}];return e.jsxs(c,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{children:e.jsx(p,{placeholder:"搜索分析项目名称、编码或所属检测项目",prefix:e.jsx(A,{}),value:k,onChange:e=>q(e.target.value),style:{width:300}})}),e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>G(),children:"添加分析项目"})]}),e.jsx(u,{columns:Q,dataSource:K,rowKey:"id",pagination:{total:K.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`},scroll:{x:1600}}),e.jsx(O,{title:"分析项目详情",placement:"right",width:800,open:w,onClose:()=>{R(!1),E(null)},children:T&&e.jsxs("div",{children:[e.jsxs(F,{title:"基本信息",bordered:!0,column:2,size:"small",children:[e.jsx(F.Item,{label:"项目名称",children:T.name}),e.jsx(F.Item,{label:"项目编码",children:T.code}),e.jsx(F.Item,{label:"所属检测项目",children:T.testItemName}),e.jsx(F.Item,{label:"项目类别",children:T.category}),e.jsx(F.Item,{label:"检测类型",children:e.jsx(g,{color:"quantitative"===T.type?"blue":"qualitative"===T.type?"green":"orange",children:"quantitative"===T.type?"定量":"qualitative"===T.type?"定性":"半定量"})}),e.jsxs(F.Item,{label:"项目状态",children:[e.jsx(g,{color:L(T.status).color,children:L(T.status).text}),T.isRequired&&e.jsx(B,{status:"processing",text:"必需"})]})]}),e.jsx(z,{}),e.jsxs(F,{title:"检测参数",bordered:!0,column:2,size:"small",children:[e.jsx(F.Item,{label:"参考范围",children:T.referenceRange}),e.jsx(F.Item,{label:"单位",children:T.unit||"无"}),e.jsx(F.Item,{label:"正常值",children:T.normalValue}),e.jsx(F.Item,{label:"异常判断标准",children:T.abnormalCriteria}),e.jsx(F.Item,{label:"检测方法学",children:T.methodologyName}),e.jsx(F.Item,{label:"报告顺序",children:T.reportOrder}),e.jsx(F.Item,{label:"样本类型",span:2,children:T.sampleType.map(i=>e.jsx(g,{children:i},i))})]}),e.jsx(z,{}),e.jsxs(F,{title:"临床信息",bordered:!0,column:1,size:"small",children:[e.jsx(F.Item,{label:"临床意义",children:T.clinicalSignificance}),e.jsx(F.Item,{label:"关联疾病",children:(null==(t=T.associatedDiseases)?void 0:t.map(i=>e.jsx(g,{color:"blue",children:i},i)))||"无"}),e.jsx(F.Item,{label:"项目描述",children:T.description||"无"})]}),T.qualityControl&&e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsxs(F,{title:"质量控制要求",bordered:!0,column:2,size:"small",children:[e.jsxs(F.Item,{label:"CV要求",children:["≤",T.qualityControl.cvRequirement,"%"]}),e.jsxs(F.Item,{label:"准确度要求",children:["≥",T.qualityControl.accuracyRequirement,"%"]}),e.jsxs(F.Item,{label:"精密度要求",span:2,children:["≥",T.qualityControl.precisionRequirement,"%"]})]})]}),T.reportConfiguration&&e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsxs(F,{title:"报告配置",bordered:!0,column:2,size:"small",children:[e.jsx(F.Item,{label:"报告模板",children:T.reportConfiguration.template}),e.jsx(F.Item,{label:"报告格式",children:e.jsx(g,{color:"blue",children:T.reportConfiguration.format.toUpperCase()})}),e.jsx(F.Item,{label:"包含图表",children:e.jsx(B,{status:T.reportConfiguration.includeGraphs?"success":"default",text:T.reportConfiguration.includeGraphs?"是":"否"})}),e.jsx(F.Item,{label:"包含解读",children:e.jsx(B,{status:T.reportConfiguration.includeInterpretation?"success":"default",text:T.reportConfiguration.includeInterpretation?"是":"否"})})]})]}),T.interpretationRules&&T.interpretationRules.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsxs("div",{children:[e.jsx(je,{strong:!0,children:"解读规则"}),e.jsx(V,{size:"small",bordered:!0,dataSource:T.interpretationRules,renderItem:(i,t)=>e.jsx(V.Item,{children:e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsxs(je,{strong:!0,children:["条件 ",t+1,":"]})," ",i.condition]}),e.jsxs("div",{children:[e.jsx(je,{strong:!0,children:"解读:"})," ",i.interpretation]}),e.jsxs("div",{children:[e.jsx(je,{strong:!0,children:"建议:"})," ",i.recommendation]})]})})})]})]}),e.jsx(z,{}),e.jsxs(F,{title:"系统信息",bordered:!0,column:2,size:"small",children:[e.jsx(F.Item,{label:"创建时间",children:T.createdAt}),e.jsx(F.Item,{label:"更新时间",children:T.updatedAt})]})]})}),e.jsx(x,{title:a?"编辑分析项目":"添加分析项目",open:r,onCancel:()=>n(!1),footer:null,width:1e3,children:e.jsxs(d,{form:C,layout:"vertical",onFinish:e=>{if(a)s(i=>i.map(i=>i.id===a.id?{...i,...e,updatedAt:(new Date).toISOString().split("T")[0]}:i)),f.success("分析项目更新成功");else{const i={...e,id:Date.now().toString(),createdAt:(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};s(e=>[...e,i]),f.success("分析项目添加成功")}n(!1),C.resetFields()},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"name",label:"项目名称",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(p,{placeholder:"请输入项目名称"})}),e.jsx(d.Item,{name:"code",label:"项目编码",rules:[{required:!0,message:"请输入项目编码"}],children:e.jsx(p,{placeholder:"请输入项目编码"})}),e.jsx(d.Item,{name:"testItemId",label:"所属检测项目",rules:[{required:!0,message:"请选择所属检测项目"}],children:e.jsxs(j,{placeholder:"请选择所属检测项目",children:[e.jsx(xe,{value:"1",children:"肺癌基因检测"}),e.jsx(xe,{value:"2",children:"乳腺癌基因检测"}),e.jsx(xe,{value:"3",children:"结直肠癌基因检测"})]})}),e.jsx(d.Item,{name:"category",label:"项目类别",rules:[{required:!0,message:"请输入项目类别"}],children:e.jsx(p,{placeholder:"如：基因突变、基因扩增等"})}),e.jsx(d.Item,{name:"type",label:"检测类型",rules:[{required:!0,message:"请选择检测类型"}],children:e.jsxs(j,{placeholder:"请选择检测类型",children:[e.jsx(xe,{value:"quantitative",children:"定量"}),e.jsx(xe,{value:"qualitative",children:"定性"}),e.jsx(xe,{value:"semi-quantitative",children:"半定量"})]})}),e.jsx(d.Item,{name:"status",label:"项目状态",rules:[{required:!0,message:"请选择项目状态"}],children:e.jsxs(j,{placeholder:"请选择项目状态",children:[e.jsx(xe,{value:"active",children:"启用"}),e.jsx(xe,{value:"pending",children:"待审核"}),e.jsx(xe,{value:"inactive",children:"停用"})]})}),e.jsx(d.Item,{name:"unit",label:"单位",children:e.jsx(p,{placeholder:"如：拷贝数、ng/ml等"})}),e.jsx(d.Item,{name:"referenceRange",label:"参考范围",rules:[{required:!0,message:"请输入参考范围"}],children:e.jsx(p,{placeholder:"请输入参考范围"})}),e.jsx(d.Item,{name:"normalValue",label:"正常值",children:e.jsx(p,{placeholder:"请输入正常值描述"})}),e.jsx(d.Item,{name:"abnormalCriteria",label:"异常判断标准",children:e.jsx(p,{placeholder:"请输入异常判断标准"})}),e.jsx(d.Item,{name:"methodologyId",label:"检测方法学",rules:[{required:!0,message:"请选择检测方法学"}],children:e.jsxs(j,{placeholder:"请选择检测方法学",children:[e.jsx(xe,{value:"1",children:"NGS测序"}),e.jsx(xe,{value:"2",children:"qPCR"}),e.jsx(xe,{value:"3",children:"Sanger测序"}),e.jsx(xe,{value:"4",children:"FISH"})]})}),e.jsx(d.Item,{name:"sampleType",label:"适用样本类型",rules:[{required:!0,message:"请选择适用样本类型"}],children:e.jsxs(j,{mode:"multiple",placeholder:"请选择适用样本类型",children:[e.jsx(xe,{value:"血液",children:"血液"}),e.jsx(xe,{value:"组织",children:"组织"}),e.jsx(xe,{value:"唾液",children:"唾液"}),e.jsx(xe,{value:"尿液",children:"尿液"})]})}),e.jsx(d.Item,{name:"reportOrder",label:"报告顺序",rules:[{required:!0,message:"请输入报告顺序"}],children:e.jsx(S,{min:1,placeholder:"报告中的显示顺序",style:{width:"100%"}})}),e.jsx(d.Item,{name:"associatedDiseases",label:"关联疾病",children:e.jsxs(j,{mode:"tags",placeholder:"请输入关联疾病，支持多个",children:[e.jsx(xe,{value:"肺癌",children:"肺癌"}),e.jsx(xe,{value:"乳腺癌",children:"乳腺癌"}),e.jsx(xe,{value:"结直肠癌",children:"结直肠癌"}),e.jsx(xe,{value:"胃癌",children:"胃癌"}),e.jsx(xe,{value:"肝癌",children:"肝癌"})]})}),e.jsx(d.Item,{name:"isActive",label:"启用状态",valuePropName:"checked",initialValue:!0,children:e.jsx(P,{checkedChildren:"启用",unCheckedChildren:"禁用"})}),e.jsx(d.Item,{name:"isRequired",label:"是否必检",valuePropName:"checked",initialValue:!1,children:e.jsx(P,{checkedChildren:"必检",unCheckedChildren:"可选"})})]}),e.jsx(d.Item,{name:"clinicalSignificance",label:"临床意义",rules:[{required:!0,message:"请输入临床意义"}],children:e.jsx(pe,{rows:3,placeholder:"请描述该分析项目的临床意义"})}),e.jsx(d.Item,{name:"description",label:"项目描述",children:e.jsx(pe,{rows:2,placeholder:"请输入项目详细描述"})}),e.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",padding:"16px",marginBottom:"16px"},children:[e.jsx("h4",{style:{marginBottom:"16px",color:"#1890ff"},children:"质量控制要求"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:["qualityControl","cvRequirement"],label:"CV要求 (%)",children:e.jsx(S,{min:0,max:100,placeholder:"变异系数要求",style:{width:"100%"}})}),e.jsx(d.Item,{name:["qualityControl","accuracyRequirement"],label:"准确度要求 (%)",children:e.jsx(S,{min:0,max:100,placeholder:"准确度要求",style:{width:"100%"}})}),e.jsx(d.Item,{name:["qualityControl","precisionRequirement"],label:"精密度要求 (%)",children:e.jsx(S,{min:0,max:100,placeholder:"精密度要求",style:{width:"100%"}})})]})]}),e.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",padding:"16px",marginBottom:"16px"},children:[e.jsx("h4",{style:{marginBottom:"16px",color:"#1890ff"},children:"报告配置"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:["reportConfiguration","template"],label:"报告模板",children:e.jsx(p,{placeholder:"报告模板名称"})}),e.jsx(d.Item,{name:["reportConfiguration","format"],label:"报告格式",children:e.jsxs(j,{placeholder:"请选择报告格式",children:[e.jsx(xe,{value:"pdf",children:"PDF"}),e.jsx(xe,{value:"word",children:"Word"}),e.jsx(xe,{value:"html",children:"HTML"})]})}),e.jsx(d.Item,{name:["reportConfiguration","includeGraphs"],label:"包含图表",valuePropName:"checked",children:e.jsx(P,{checkedChildren:"是",unCheckedChildren:"否"})}),e.jsx(d.Item,{name:["reportConfiguration","includeInterpretation"],label:"包含解读",valuePropName:"checked",children:e.jsx(P,{checkedChildren:"是",unCheckedChildren:"否"})})]})]}),e.jsx(d.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(o,{children:[e.jsx(m,{onClick:()=>n(!1),children:"取消"}),e.jsx(m,{type:"primary",htmlType:"submit",children:a?"更新":"添加"})]})})]})})]})},{Option:ye}=j,{TextArea:ve}=p,{Text:Ie}=C,{Panel:fe}=E,{Step:be}=Q,Ce=()=>{const[t,l]=i.useState([{id:"1",name:"二代测序技术（NGS）",code:"NGS_V2.1",category:"基因测序",status:"active",principle:"基于合成测序技术，通过DNA聚合酶在模板链上合成互补链，同时检测每个碱基的加入",technicalParameters:{throughput:"20Gb/run",sensitivity:"≥99%",specificity:"≥99.5%",precision:"CV≤5%",accuracy:"≥99%",linearRange:"10ng-1μg",detectionLimit:"5% VAF",reportableRange:"1%-100% VAF",cvRequirement:5,biasRequirement:10},instrumentRequirements:{mainInstruments:["Illumina NovaSeq 6000","Agilent 2100生物分析仪"],auxiliaryInstruments:["离心机","移液器","PCR仪","涡旋混合器"],calibrationRequirements:"每月校准一次，使用标准品验证",maintenanceSchedule:"每周清洁，每月维护，每季度深度保养",environmentalConditions:{temperature:"18-25°C",humidity:"30-70%",ventilation:"每小时换气15次以上"}},sampleRequirements:{sampleTypes:["血液","组织","FFPE","胸腹水"],minimumVolume:"血液≥2ml，组织≥10mg",qualityRequirements:"DNA浓度≥10ng/μL，总量≥100ng，A260/A280比值1.8-2.0",storageConditions:"-80°C长期保存，-20°C短期保存",transportRequirements:"干冰运输，避免反复冻融",pretreatmentSteps:["DNA提取","质量检测","浓度标准化"]},associatedDetectionItems:["肺癌基因检测","乳腺癌基因检测"],procedureSteps:["DNA质量检测","文库构建","文库质控","上机测序","数据分析","结果解读"],qualityControl:"每批次包含阳性对照、阴性对照和质控样本",resultInterpretation:"根据变异频率和数据库注释进行临床意义评估",limitations:"无法检测大片段重排、重复序列区域检测能力有限",references:["PMID: 12345678","ISO 15189:2012","CAP分子病理学指南"],sopDocuments:[{id:"sop1",name:"NGS操作手册",version:"V2.1",type:"procedure",uploadDate:"2024-01-01",fileUrl:"/files/ngs-manual.pdf",approver:"张主任",status:"approved"},{id:"sop2",name:"质量控制SOP",version:"V1.0",type:"quality",uploadDate:"2024-01-01",fileUrl:"/files/qc-sop.pdf",approver:"张主任",status:"approved"}],version:"V2.1",effectiveDate:"2024-01-01",reviewDate:"2024-12-31",approver:"张主任",isActive:!0,createdAt:"2024-01-01",updatedAt:"2024-01-15"},{id:"2",name:"实时荧光定量PCR（qPCR）",code:"qPCR_V1.3",category:"基因扩增",status:"active",principle:"基于PCR扩增原理，通过荧光信号实时监测DNA扩增过程",technicalParameters:{throughput:"96样本/run",sensitivity:"10拷贝/反应",specificity:"≥99%",precision:"CV≤3%",accuracy:"±0.2 Ct值",linearRange:"10^2-10^8拷贝数",detectionLimit:"10拷贝/反应",reportableRange:"10-10^9拷贝数",cvRequirement:3,biasRequirement:5},instrumentRequirements:{mainInstruments:["ABI 7500实时PCR仪"],auxiliaryInstruments:["离心机","移液器","涡旋混合器","冰盒"],calibrationRequirements:"每月使用标准品校准",maintenanceSchedule:"每周清洁光学系统，每月更换滤光片",environmentalConditions:{temperature:"20-25°C",humidity:"40-60%",ventilation:"避免震动和强光"}},sampleRequirements:{sampleTypes:["血液","组织","唾液"],minimumVolume:"血液≥1ml，组织≥5mg",qualityRequirements:"DNA浓度1-100ng/μL，无蛋白质和RNA污染",storageConditions:"-20°C保存，避免反复冻融",transportRequirements:"冰袋运输，24小时内处理",pretreatmentSteps:["DNA提取","浓度测定","稀释至工作浓度"]},associatedDetectionItems:["病毒载量检测","基因拷贝数检测"],procedureSteps:["样本预处理","反应体系配制","PCR程序设置","扩增检测","结果分析"],qualityControl:"每次实验包含标准品、阳性对照、阴性对照",resultInterpretation:"根据Ct值和标准曲线计算拷贝数",limitations:"只能检测已知序列，扩增片段长度有限",references:["PMID: 87654321","MIQE指南","FDA qPCR指导原则"],sopDocuments:[{id:"sop3",name:"qPCR标准操作程序",version:"V1.3",type:"procedure",uploadDate:"2023-06-01",fileUrl:"/files/qpcr-sop.pdf",approver:"李博士",status:"approved"}],version:"V1.3",effectiveDate:"2023-06-01",reviewDate:"2024-06-01",approver:"李博士",isActive:!0,createdAt:"2023-06-01",updatedAt:"2024-01-10"},{id:"3",name:"Sanger测序",code:"SANGER_V1.0",category:"基因测序",status:"pending",principle:"基于链终止法的DNA测序技术，使用荧光标记的双脱氧核苷酸",technicalParameters:{throughput:"96样本/天",sensitivity:"≥95%",specificity:"≥99%",precision:"Phred质量值≥20",accuracy:"≥99%",detectionLimit:"20% 杂合突变",reportableRange:"100-800bp序列",cvRequirement:10,biasRequirement:15},instrumentRequirements:{mainInstruments:["ABI 3730xl测序仪"],auxiliaryInstruments:["PCR仪","离心机","电泳仪","纯化柱"],calibrationRequirements:"每周校准，使用标准DNA验证",maintenanceSchedule:"每日清洁毛细管，每周更换缓冲液",environmentalConditions:{temperature:"22-25°C",humidity:"45-65%",ventilation:"无尘环境，避免震动"}},sampleRequirements:{sampleTypes:["PCR产物","DNA"],minimumVolume:"PCR产物≥20μl",qualityRequirements:"PCR产物浓度10-50ng/μL，长度100-800bp",storageConditions:"4°C短期保存，-20°C长期保存",transportRequirements:"常温运输，避免污染",pretreatmentSteps:["PCR扩增","产物纯化","浓度检测"]},associatedDetectionItems:["单基因突变检测"],procedureSteps:["PCR扩增","产物纯化","测序反应","产物纯化","毛细管电泳","序列分析"],qualityControl:"每批次包含已知序列对照",resultInterpretation:"通过序列比对识别变异位点",limitations:"通量低，成本高，无法检测大片段缺失",references:["PMID: 11111111","Sanger测序标准","ACMG指南"],version:"V1.0",effectiveDate:"2023-01-01",reviewDate:"2024-01-01",approver:"王教授",isActive:!0,createdAt:"2023-01-01",updatedAt:"2023-12-01"}]),[s,r]=i.useState(!1),[n,a]=i.useState(null),[b]=d.useForm(),[C,k]=i.useState(""),[q,T]=i.useState(!1),[U,H]=i.useState(null),W=e=>({active:{text:"启用",color:"success"},pending:{text:"待审",color:"warning"},inactive:{text:"停用",color:"default"}}[e]||{text:e,color:"default"}),J=e=>({procedure:"操作程序",quality:"质量控制",safety:"安全规范",maintenance:"维护保养"}[e]||e),X=e=>{a(e||null),e?b.setFieldsValue({...e,procedureSteps:e.procedureSteps.join("\n"),references:e.references.join("\n")}):b.resetFields(),r(!0)},Z=t.filter(e=>e.name.toLowerCase().includes(C.toLowerCase())||e.code.toLowerCase().includes(C.toLowerCase())||e.category.toLowerCase().includes(C.toLowerCase())),Y=[{title:"方法学名称",dataIndex:"name",key:"name",width:200,render:(i,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.code})]})},{title:"类别",dataIndex:"category",key:"category",width:120,render:i=>e.jsx(g,{color:"blue",children:i})},{title:"状态",dataIndex:"status",key:"status",width:100,align:"center",render:i=>{const t=W(i);return e.jsx(B,{status:t.color,text:t.text})}},{title:"版本",dataIndex:"version",key:"version",width:80,align:"center"},{title:"技术参数",key:"technicalParameters",width:200,render:i=>e.jsxs("div",{children:[e.jsxs("div",{children:["灵敏度: ",i.technicalParameters.sensitivity]}),e.jsxs("div",{children:["特异性: ",i.technicalParameters.specificity]}),i.technicalParameters.detectionLimit&&e.jsxs("div",{children:["检测限: ",i.technicalParameters.detectionLimit]})]})},{title:"关联检测项目",dataIndex:"associatedDetectionItems",key:"associatedDetectionItems",width:150,render:i=>i&&0!==i.length?i.length<=2?i.map(i=>e.jsx(g,{color:"geekblue",children:i},i)):e.jsx(N,{title:i.join("、"),children:e.jsxs("div",{children:[i.slice(0,2).map(i=>e.jsx(g,{color:"geekblue",children:i},i)),e.jsxs(g,{color:"default",children:["+",i.length-2]})]})}):"-"},{title:"SOP文档",dataIndex:"sopDocuments",key:"sopDocuments",width:120,align:"center",render:i=>i&&0!==i.length?e.jsx(N,{title:`共${i.length}个文档`,children:e.jsx(B,{count:i.length,showZero:!0,children:e.jsx($,{style:{color:"#1890ff",fontSize:"16px"}})})}):"-"},{title:"生效日期",dataIndex:"effectiveDate",key:"effectiveDate",width:100,align:"center"},{title:"复审日期",dataIndex:"reviewDate",key:"reviewDate",width:100,align:"center"},{title:"审批人",dataIndex:"approver",key:"approver",width:100,align:"center"},{title:"启用状态",dataIndex:"isActive",key:"isActive",width:80,align:"center",render:i=>e.jsx(g,{color:i?"green":"red",children:i?"有效":"失效"})},{title:"操作",key:"action",width:150,fixed:"right",render:i=>e.jsxs(o,{children:[e.jsx(N,{title:"查看详情",children:e.jsx(m,{type:"link",icon:e.jsx(D,{}),onClick:()=>(H(i),void T(!0)),size:"small"})}),e.jsx(N,{title:"编辑",children:e.jsx(m,{type:"link",icon:e.jsx(y,{}),onClick:()=>X(i),size:"small"})}),e.jsx(v,{title:"确定删除这个方法学吗？",onConfirm:()=>{return e=i.id,l(i=>i.filter(i=>i.id!==e)),void f.success("方法学删除成功");var e},okText:"确定",cancelText:"取消",icon:e.jsx(_,{style:{color:"red"}}),children:e.jsx(N,{title:"删除",children:e.jsx(m,{type:"link",danger:!0,icon:e.jsx(I,{}),size:"small"})})})]})}];return e.jsxs(c,{children:[e.jsxs("div",{style:{marginBottom:16,display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{children:e.jsx(p,{placeholder:"搜索方法学名称、编码或类别",prefix:e.jsx(A,{}),value:C,onChange:e=>k(e.target.value),style:{width:300}})}),e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>X(),children:"添加方法学"})]}),e.jsx(u,{columns:Y,dataSource:Z,rowKey:"id",pagination:{total:Z.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`},scroll:{x:1800}}),e.jsx(O,{title:"方法学详情",placement:"right",onClose:()=>T(!1),open:q,width:800,children:U&&e.jsxs("div",{children:[e.jsxs(F,{title:"基本信息",bordered:!0,column:2,style:{marginBottom:24},children:[e.jsx(F.Item,{label:"方法学名称",children:U.name}),e.jsx(F.Item,{label:"方法学编码",children:U.code}),e.jsx(F.Item,{label:"类别",children:e.jsx(g,{color:"blue",children:U.category})}),e.jsx(F.Item,{label:"状态",children:(()=>{const i=W(U.status);return e.jsx(B,{status:i.color,text:i.text})})()}),e.jsx(F.Item,{label:"版本号",children:U.version}),e.jsx(F.Item,{label:"生效日期",children:U.effectiveDate}),e.jsx(F.Item,{label:"复审日期",children:U.reviewDate}),e.jsx(F.Item,{label:"审批人",children:U.approver}),e.jsx(F.Item,{label:"启用状态",span:2,children:e.jsx(g,{color:U.isActive?"green":"red",children:U.isActive?"有效":"失效"})})]}),e.jsx(F,{title:"检测原理",bordered:!0,style:{marginBottom:24},children:e.jsx(F.Item,{label:"原理描述",span:3,children:U.principle})}),e.jsxs(E,{defaultActiveKey:["1"],style:{marginBottom:24},children:[e.jsx(fe,{header:e.jsxs(e.Fragment,{children:[e.jsx(G,{})," 技术参数"]}),children:e.jsxs(F,{bordered:!0,column:2,children:[U.technicalParameters.throughput&&e.jsx(F.Item,{label:"通量",children:U.technicalParameters.throughput}),e.jsx(F.Item,{label:"灵敏度",children:U.technicalParameters.sensitivity}),e.jsx(F.Item,{label:"特异性",children:U.technicalParameters.specificity}),e.jsx(F.Item,{label:"精密度",children:U.technicalParameters.precision}),e.jsx(F.Item,{label:"准确度",children:U.technicalParameters.accuracy}),U.technicalParameters.linearRange&&e.jsx(F.Item,{label:"线性范围",children:U.technicalParameters.linearRange}),U.technicalParameters.detectionLimit&&e.jsx(F.Item,{label:"检测限",children:U.technicalParameters.detectionLimit}),U.technicalParameters.reportableRange&&e.jsx(F.Item,{label:"报告范围",children:U.technicalParameters.reportableRange}),U.technicalParameters.cvRequirement&&e.jsxs(F.Item,{label:"CV要求",children:["≤",U.technicalParameters.cvRequirement,"%"]}),U.technicalParameters.biasRequirement&&e.jsxs(F.Item,{label:"偏倚要求",children:["≤",U.technicalParameters.biasRequirement,"%"]})]})},"1"),e.jsx(fe,{header:e.jsxs(e.Fragment,{children:[e.jsx(L,{})," 仪器要求"]}),children:e.jsxs(F,{bordered:!0,column:1,children:[e.jsx(F.Item,{label:"主要仪器",children:U.instrumentRequirements.mainInstruments.map(i=>e.jsx(g,{color:"blue",style:{margin:"2px"},children:i},i))}),e.jsx(F.Item,{label:"辅助仪器",children:U.instrumentRequirements.auxiliaryInstruments.map(i=>e.jsx(g,{color:"geekblue",style:{margin:"2px"},children:i},i))}),e.jsx(F.Item,{label:"校准要求",children:U.instrumentRequirements.calibrationRequirements}),e.jsx(F.Item,{label:"维护计划",children:U.instrumentRequirements.maintenanceSchedule}),e.jsx(F.Item,{label:"环境条件",children:e.jsxs("div",{children:[e.jsxs("div",{children:["温度: ",U.instrumentRequirements.environmentalConditions.temperature]}),e.jsxs("div",{children:["湿度: ",U.instrumentRequirements.environmentalConditions.humidity]}),e.jsxs("div",{children:["通风: ",U.instrumentRequirements.environmentalConditions.ventilation]})]})})]})},"2"),e.jsx(fe,{header:e.jsxs(e.Fragment,{children:[e.jsx(K,{})," 样本要求"]}),children:e.jsxs(F,{bordered:!0,column:1,children:[e.jsx(F.Item,{label:"样本类型",children:U.sampleRequirements.sampleTypes.map(i=>e.jsx(g,{color:"green",style:{margin:"2px"},children:i},i))}),e.jsx(F.Item,{label:"最小体积",children:U.sampleRequirements.minimumVolume}),e.jsx(F.Item,{label:"质量要求",children:U.sampleRequirements.qualityRequirements}),e.jsx(F.Item,{label:"保存条件",children:U.sampleRequirements.storageConditions}),e.jsx(F.Item,{label:"运输要求",children:U.sampleRequirements.transportRequirements}),U.sampleRequirements.pretreatmentSteps&&e.jsx(F.Item,{label:"预处理步骤",children:e.jsx(V,{size:"small",dataSource:U.sampleRequirements.pretreatmentSteps,renderItem:(i,t)=>e.jsx(V.Item,{children:e.jsxs(Ie,{children:[t+1,". ",i]})})})})]})},"3")]}),U.associatedDetectionItems&&U.associatedDetectionItems.length>0&&e.jsx(F,{title:"关联检测项目",bordered:!0,style:{marginBottom:24},children:e.jsx(F.Item,{label:"检测项目",span:3,children:U.associatedDetectionItems.map(i=>e.jsx(g,{color:"geekblue",style:{margin:"2px"},children:i},i))})}),e.jsx(F,{title:"操作步骤",bordered:!0,style:{marginBottom:24},children:e.jsx(F.Item,{label:"步骤详情",span:3,children:e.jsx(Q,{direction:"vertical",size:"small",children:U.procedureSteps.map((i,t)=>e.jsx(be,{title:`步骤 ${t+1}`,description:i},t))})})}),e.jsxs(F,{title:"质量控制与结果解读",bordered:!0,style:{marginBottom:24},children:[e.jsx(F.Item,{label:"质量控制",span:3,children:U.qualityControl}),e.jsx(F.Item,{label:"结果解读",span:3,children:U.resultInterpretation}),e.jsx(F.Item,{label:"方法局限性",span:3,children:U.limitations})]}),U.sopDocuments&&U.sopDocuments.length>0&&e.jsx(F,{title:"SOP文档",bordered:!0,style:{marginBottom:24},children:e.jsx(F.Item,{label:"文档列表",span:3,children:e.jsx(V,{dataSource:U.sopDocuments,renderItem:i=>{return e.jsx(V.Item,{actions:[e.jsx(m,{type:"link",size:"small",icon:e.jsx(M,{}),children:"查看"})],children:e.jsx(V.Item.Meta,{avatar:e.jsx($,{style:{fontSize:"20px",color:"#1890ff"}}),title:e.jsxs("div",{children:[i.name,e.jsx(g,{color:(t=i.type,{procedure:"blue",quality:"green",safety:"red",maintenance:"orange"}[t]||"default"),style:{marginLeft:8},children:J(i.type)}),e.jsx(g,{color:"approved"===i.status?"green":"draft"===i.status?"orange":"red",children:"approved"===i.status?"已批准":"draft"===i.status?"草稿":"已过期"})]}),description:e.jsxs("div",{children:[e.jsxs("div",{children:["版本: ",i.version," | 审批人: ",i.approver]}),e.jsxs("div",{children:["上传日期: ",i.uploadDate]})]})})});var t}})})}),e.jsx(F,{title:"参考文献",bordered:!0,style:{marginBottom:24},children:e.jsx(F.Item,{label:"文献列表",span:3,children:e.jsx(V,{size:"small",dataSource:U.references,renderItem:(i,t)=>e.jsx(V.Item,{children:e.jsxs(Ie,{children:[t+1,". ",i]})})})})}),e.jsxs(F,{title:"版本信息",bordered:!0,children:[e.jsx(F.Item,{label:"创建时间",children:U.createdAt}),e.jsx(F.Item,{label:"更新时间",children:U.updatedAt})]})]})}),e.jsx(x,{title:n?"编辑方法学":"添加方法学",open:s,onCancel:()=>r(!1),footer:null,width:1e3,children:e.jsxs(d,{form:b,layout:"vertical",onFinish:e=>{const i={...e,procedureSteps:e.procedureSteps.split("\n").filter(e=>e.trim()),references:e.references.split("\n").filter(e=>e.trim())};if(n)l(e=>e.map(e=>e.id===n.id?{...e,...i,updatedAt:(new Date).toISOString().split("T")[0]}:e)),f.success("方法学更新成功");else{const e={...i,id:Date.now().toString(),createdAt:(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};l(i=>[...i,e]),f.success("方法学添加成功")}r(!1),b.resetFields()},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"name",label:"方法学名称",rules:[{required:!0,message:"请输入方法学名称"}],children:e.jsx(p,{placeholder:"请输入方法学名称"})}),e.jsx(d.Item,{name:"code",label:"方法学编码",rules:[{required:!0,message:"请输入方法学编码"}],children:e.jsx(p,{placeholder:"请输入方法学编码"})}),e.jsx(d.Item,{name:"category",label:"方法学类别",rules:[{required:!0,message:"请选择方法学类别"}],children:e.jsxs(j,{placeholder:"请选择方法学类别",children:[e.jsx(ye,{value:"基因测序",children:"基因测序"}),e.jsx(ye,{value:"基因扩增",children:"基因扩增"}),e.jsx(ye,{value:"细胞遗传学",children:"细胞遗传学"}),e.jsx(ye,{value:"免疫学",children:"免疫学"}),e.jsx(ye,{value:"生化检测",children:"生化检测"}),e.jsx(ye,{value:"病理学",children:"病理学"})]})}),e.jsx(d.Item,{name:"version",label:"版本号",rules:[{required:!0,message:"请输入版本号"}],children:e.jsx(p,{placeholder:"如：V1.0"})}),e.jsx(d.Item,{name:"effectiveDate",label:"生效日期",rules:[{required:!0,message:"请选择生效日期"}],children:e.jsx(p,{type:"date"})}),e.jsx(d.Item,{name:"reviewDate",label:"复审日期",rules:[{required:!0,message:"请选择复审日期"}],children:e.jsx(p,{type:"date"})}),e.jsx(d.Item,{name:"approver",label:"审批人",rules:[{required:!0,message:"请输入审批人"}],children:e.jsx(p,{placeholder:"请输入审批人姓名"})}),e.jsx(d.Item,{name:"isActive",label:"状态",valuePropName:"checked",initialValue:!0,children:e.jsx(P,{checkedChildren:"有效",unCheckedChildren:"失效"})})]}),e.jsx(d.Item,{name:"principle",label:"检测原理",rules:[{required:!0,message:"请输入检测原理"}],children:e.jsx(ve,{rows:3,placeholder:"请详细描述检测原理"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"equipment",label:"所需设备",rules:[{required:!0,message:"请选择所需设备"}],children:e.jsxs(j,{mode:"tags",placeholder:"请输入或选择所需设备",children:[e.jsx(ye,{value:"Illumina NovaSeq 6000",children:"Illumina NovaSeq 6000"}),e.jsx(ye,{value:"ABI 7500实时PCR仪",children:"ABI 7500实时PCR仪"}),e.jsx(ye,{value:"ABI 3730xl测序仪",children:"ABI 3730xl测序仪"}),e.jsx(ye,{value:"荧光显微镜",children:"荧光显微镜"})]})}),e.jsx(d.Item,{name:"reagents",label:"所需试剂",rules:[{required:!0,message:"请选择所需试剂"}],children:e.jsx(j,{mode:"tags",placeholder:"请输入或选择所需试剂"})})]}),e.jsx(d.Item,{name:"sampleRequirement",label:"样本要求",rules:[{required:!0,message:"请输入样本要求"}],children:e.jsx(ve,{rows:2,placeholder:"请描述样本的质量和数量要求"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"detectionRange",label:"检测范围",rules:[{required:!0,message:"请输入检测范围"}],children:e.jsx(p,{placeholder:"请输入检测范围"})}),e.jsx(d.Item,{name:"sensitivity",label:"灵敏度",rules:[{required:!0,message:"请输入灵敏度"}],children:e.jsx(p,{placeholder:"如：≥99%"})}),e.jsx(d.Item,{name:"specificity",label:"特异性",rules:[{required:!0,message:"请输入特异性"}],children:e.jsx(p,{placeholder:"如：≥99.5%"})}),e.jsx(d.Item,{name:"precision",label:"精密度",rules:[{required:!0,message:"请输入精密度"}],children:e.jsx(p,{placeholder:"如：CV≤5%"})}),e.jsx(d.Item,{name:"accuracy",label:"准确度",rules:[{required:!0,message:"请输入准确度"}],children:e.jsx(p,{placeholder:"如：≥99%"})}),e.jsx(d.Item,{name:"detectionLimit",label:"检测限",children:e.jsx(p,{placeholder:"如：5% VAF"})})]}),e.jsx(d.Item,{name:"linearRange",label:"线性范围",children:e.jsx(p,{placeholder:"如：10ng-1μg"})}),e.jsx(d.Item,{name:"throughput",label:"通量",children:e.jsx(p,{placeholder:"如：96样本/批次"})}),e.jsx(d.Item,{name:"reportableRange",label:"报告范围",children:e.jsx(p,{placeholder:"如：0.1%-100% VAF"})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"cvRequirement",label:"CV要求(%)",children:e.jsx(S,{min:0,max:100,precision:1,placeholder:"如：5.0",style:{width:"100%"}})}),e.jsx(d.Item,{name:"biasRequirement",label:"偏倚要求(%)",children:e.jsx(S,{min:0,max:100,precision:1,placeholder:"如：10.0",style:{width:"100%"}})})]}),e.jsx(z,{orientation:"left",children:"仪器要求"}),e.jsx(d.Item,{name:"mainInstruments",label:"主要仪器",rules:[{required:!0,message:"请选择主要仪器"}],children:e.jsxs(j,{mode:"tags",placeholder:"请输入或选择主要仪器",children:[e.jsx(ye,{value:"Illumina NovaSeq 6000",children:"Illumina NovaSeq 6000"}),e.jsx(ye,{value:"ABI 7500实时PCR仪",children:"ABI 7500实时PCR仪"}),e.jsx(ye,{value:"ABI 3730xl测序仪",children:"ABI 3730xl测序仪"}),e.jsx(ye,{value:"荧光显微镜",children:"荧光显微镜"}),e.jsx(ye,{value:"离心机",children:"离心机"}),e.jsx(ye,{value:"移液器",children:"移液器"})]})}),e.jsx(d.Item,{name:"auxiliaryInstruments",label:"辅助仪器",children:e.jsxs(j,{mode:"tags",placeholder:"请输入或选择辅助仪器",children:[e.jsx(ye,{value:"涡旋混合器",children:"涡旋混合器"}),e.jsx(ye,{value:"恒温水浴",children:"恒温水浴"}),e.jsx(ye,{value:"电泳仪",children:"电泳仪"}),e.jsx(ye,{value:"紫外分光光度计",children:"紫外分光光度计"})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"calibrationRequirements",label:"校准要求",rules:[{required:!0,message:"请输入校准要求"}],children:e.jsx(ve,{rows:2,placeholder:"请描述仪器校准的频率和标准"})}),e.jsx(d.Item,{name:"maintenanceSchedule",label:"维护计划",rules:[{required:!0,message:"请输入维护计划"}],children:e.jsx(ve,{rows:2,placeholder:"请描述仪器维护的计划和要求"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"temperature",label:"温度要求",rules:[{required:!0,message:"请输入温度要求"}],children:e.jsx(p,{placeholder:"如：18-25℃"})}),e.jsx(d.Item,{name:"humidity",label:"湿度要求",rules:[{required:!0,message:"请输入湿度要求"}],children:e.jsx(p,{placeholder:"如：30-70%"})}),e.jsx(d.Item,{name:"ventilation",label:"通风要求",rules:[{required:!0,message:"请输入通风要求"}],children:e.jsx(p,{placeholder:"如：每小时换气6次"})})]}),e.jsx(z,{orientation:"left",children:"样本要求"}),e.jsx(d.Item,{name:"sampleTypes",label:"样本类型",rules:[{required:!0,message:"请选择样本类型"}],children:e.jsxs(j,{mode:"tags",placeholder:"请选择或输入样本类型",children:[e.jsx(ye,{value:"全血",children:"全血"}),e.jsx(ye,{value:"血浆",children:"血浆"}),e.jsx(ye,{value:"血清",children:"血清"}),e.jsx(ye,{value:"唾液",children:"唾液"}),e.jsx(ye,{value:"尿液",children:"尿液"}),e.jsx(ye,{value:"组织",children:"组织"}),e.jsx(ye,{value:"细胞",children:"细胞"}),e.jsx(ye,{value:"DNA",children:"DNA"}),e.jsx(ye,{value:"RNA",children:"RNA"})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"minimumVolume",label:"最小体积",rules:[{required:!0,message:"请输入最小体积"}],children:e.jsx(p,{placeholder:"如：2mL"})}),e.jsx(d.Item,{name:"qualityRequirements",label:"质量要求",rules:[{required:!0,message:"请输入质量要求"}],children:e.jsx(p,{placeholder:"如：OD260/280≥1.8"})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsx(d.Item,{name:"storageConditions",label:"保存条件",rules:[{required:!0,message:"请输入保存条件"}],children:e.jsx(p,{placeholder:"如：-80℃长期保存"})}),e.jsx(d.Item,{name:"transportRequirements",label:"运输要求",rules:[{required:!0,message:"请输入运输要求"}],children:e.jsx(p,{placeholder:"如：干冰运输，24小时内到达"})})]}),e.jsx(d.Item,{name:"pretreatmentSteps",label:"预处理步骤",children:e.jsx(ve,{rows:3,placeholder:"请输入预处理步骤，每行一个步骤"})}),e.jsx(z,{orientation:"left",children:"关联信息"}),e.jsx(d.Item,{name:"associatedDetectionItems",label:"关联检测项目",children:e.jsxs(j,{mode:"tags",placeholder:"请选择关联的检测项目",children:[e.jsx(ye,{value:"肿瘤基因检测",children:"肿瘤基因检测"}),e.jsx(ye,{value:"遗传病筛查",children:"遗传病筛查"}),e.jsx(ye,{value:"药物基因组学",children:"药物基因组学"}),e.jsx(ye,{value:"病原体检测",children:"病原体检测"})]})}),e.jsx(d.Item,{name:"status",label:"方法学状态",rules:[{required:!0,message:"请选择方法学状态"}],initialValue:"active",children:e.jsxs(j,{placeholder:"请选择方法学状态",children:[e.jsx(ye,{value:"active",children:"有效"}),e.jsx(ye,{value:"pending",children:"待审核"}),e.jsx(ye,{value:"inactive",children:"无效"})]})}),e.jsx(z,{orientation:"left",children:"操作流程"}),e.jsx(d.Item,{name:"procedureSteps",label:"操作步骤",rules:[{required:!0,message:"请输入操作步骤"}],children:e.jsx(ve,{rows:4,placeholder:"请输入操作步骤，每行一个步骤"})}),e.jsx(d.Item,{name:"qualityControl",label:"质量控制",rules:[{required:!0,message:"请输入质量控制要求"}],children:e.jsx(ve,{rows:2,placeholder:"请描述质量控制要求和标准"})}),e.jsx(d.Item,{name:"resultInterpretation",label:"结果解读",rules:[{required:!0,message:"请输入结果解读标准"}],children:e.jsx(ve,{rows:2,placeholder:"请描述结果解读的标准和方法"})}),e.jsx(d.Item,{name:"limitations",label:"方法局限性",rules:[{required:!0,message:"请输入方法局限性"}],children:e.jsx(ve,{rows:2,placeholder:"请描述该方法的局限性和注意事项"})}),e.jsx(z,{orientation:"left",children:"SOP文档"}),e.jsxs(d.Item,{name:"sopDocuments",label:"SOP文档上传",children:[e.jsx(w,{multiple:!0,beforeUpload:()=>!1,onChange:e=>{},children:e.jsx(m,{icon:e.jsx(R,{}),children:"上传SOP文档"})}),e.jsx("div",{style:{marginTop:8,color:"#666",fontSize:"12px"},children:"支持上传PDF、DOC、DOCX格式文件，单个文件不超过10MB"})]}),e.jsx(d.Item,{name:"references",label:"参考文献",rules:[{required:!0,message:"请输入参考文献"}],children:e.jsx(ve,{rows:3,placeholder:"请输入参考文献，每行一个文献"})}),e.jsx(d.Item,{style:{marginBottom:0,textAlign:"right"},children:e.jsxs(o,{children:[e.jsx(m,{onClick:()=>r(!1),children:"取消"}),e.jsx(m,{type:"primary",htmlType:"submit",children:n?"更新":"添加"})]})})]})})]})},{Search:ke}=p,{Option:qe}=j,Se=()=>{const l=t(),[s,r]=i.useState(!1),[n,a]=i.useState([]),[v,b]=i.useState([]),[C,S]=i.useState(""),[w,R]=i.useState("all"),[P,T]=i.useState(!1),[A]=d.useForm();i.useEffect(()=>{O()},[]);const O=async()=>{r(!0);try{a([{id:"1",name:"肿瘤基因检测",version:"v2.1",status:"active",applicableProjects:["肿瘤测序项目A","肿瘤测序项目B"],description:"用于肿瘤相关基因突变的检测流程",creator:"张三",createTime:"2024-03-15",lastUpdater:"李四",updateTime:"2024-05-20",stepCount:6,fieldCount:25,qcRuleCount:8},{id:"2",name:"病原微生物检测",version:"v1.5",status:"active",applicableProjects:["病原检测项目"],description:"病原微生物基因检测标准流程",creator:"王五",createTime:"2024-02-10",lastUpdater:"赵六",updateTime:"2024-04-15",stepCount:5,fieldCount:18,qcRuleCount:6},{id:"3",name:"遗传病筛查",version:"v3.0",status:"active",applicableProjects:["遗传病筛查项目A","遗传病筛查项目B","新生儿筛查"],description:"遗传性疾病基因筛查检测流程",creator:"钱七",createTime:"2024-01-20",lastUpdater:"孙八",updateTime:"2024-05-10",stepCount:7,fieldCount:32,qcRuleCount:12},{id:"4",name:"药物基因组学",version:"v1.2",status:"inactive",applicableProjects:["药物基因组学项目"],description:"个体化用药基因检测流程",creator:"周九",createTime:"2023-12-05",lastUpdater:"吴十",updateTime:"2024-03-01",stepCount:4,fieldCount:15,qcRuleCount:4},{id:"5",name:"新冠核酸检测",version:"v4.0",status:"active",applicableProjects:["新冠检测项目"],description:"SARS-CoV-2核酸检测标准流程",creator:"郑十一",createTime:"2023-11-15",lastUpdater:"王十二",updateTime:"2024-05-25",stepCount:3,fieldCount:12,qcRuleCount:5}])}catch(e){f.error("加载SOP模板失败")}finally{r(!1)}},F=n.filter(e=>{const i=!C||e.name.toLowerCase().includes(C.toLowerCase())||e.applicableProjects.some(e=>e.toLowerCase().includes(C.toLowerCase())),t="all"===w||e.status===w;return i&&t}),z=e=>{if(0!==v.length)switch(e){case"enable":x.confirm({title:"批量启用",content:`确定要启用选中的${v.length}个SOP模板吗？`,onOk:()=>{f.success("批量启用成功"),b([]),O()}});break;case"disable":x.confirm({title:"批量停用",content:`确定要停用选中的${v.length}个SOP模板吗？`,onOk:()=>{f.success("批量停用成功"),b([]),O()}});break;case"delete":x.confirm({title:"批量删除",content:`确定要删除选中的${v.length}个SOP模板吗？此操作不可恢复。`,okType:"danger",onOk:()=>{f.success("批量删除成功"),b([]),O()}})}else f.warning("请先选择要操作的SOP模板")},V=[{title:"SOP名称",dataIndex:"name",key:"name",width:200,render:(i,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:[t.applicableProjects.slice(0,2).join(", "),t.applicableProjects.length>2&&"..."]})]})},{title:"版本",dataIndex:"version",key:"version",width:100,render:i=>e.jsx(g,{color:"blue",children:i})},{title:"状态",dataIndex:"status",key:"status",width:100,render:i=>e.jsx(B,{status:"active"===i?"success":"default",text:"active"===i?"启用":"停用"})},{title:"配置统计",key:"stats",width:120,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["步骤: ",t.stepCount]}),e.jsxs("div",{children:["字段: ",t.fieldCount]}),e.jsxs("div",{children:["质检: ",t.qcRuleCount]})]})},{title:"更新信息",key:"updateInfo",width:150,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{children:t.lastUpdater}),e.jsx("div",{style:{color:"#666"},children:t.updateTime})]})},{title:"操作",key:"action",width:200,render:(i,t)=>e.jsxs(o,{size:"small",children:[e.jsx(N,{title:"编辑",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>(e=>{l(`/detection/sop-template/${e.id}`)})(t)})}),e.jsx(N,{title:"查看",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(D,{}),onClick:()=>(e=>{l(`/detection/sop-template/${e.id}?mode=view`)})(t)})}),e.jsx(U,{menu:{items:[{key:"copy",label:"复制模板",icon:e.jsx(X,{}),onClick:()=>(e=>{x.confirm({title:"复制SOP模板",content:`确定要复制SOP模板"${e.name}"吗？`,onOk:async()=>{try{f.success("SOP模板复制成功"),O()}catch(e){f.error("复制失败")}}})})(t)},{key:"version",label:"版本管理",icon:e.jsx(Z,{}),onClick:()=>(e=>{l(`/detection/sop-version/${e.id}`)})(t)},{type:"divider"},{key:"delete",label:"删除",icon:e.jsx(I,{}),danger:!0,onClick:()=>(async()=>{try{f.success("SOP模板删除成功"),O()}catch(e){f.error("删除失败")}})()}]},trigger:["click"],children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(J,{})})})]})}],E=[{key:"enable",label:"批量启用",onClick:()=>z("enable")},{key:"disable",label:"批量停用",onClick:()=>z("disable")},{type:"divider"},{key:"delete",label:"批量删除",danger:!0,onClick:()=>z("delete")}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(c,{children:[e.jsxs(k,{justify:"space-between",align:"middle",style:{marginBottom:16},children:[e.jsx(q,{children:e.jsx("h2",{style:{margin:0},children:"SOP配置管理"})}),e.jsx(q,{children:e.jsx(o,{children:e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>{T(!0)},children:"新建SOP模板"})})})]}),e.jsxs(k,{gutter:16,style:{marginBottom:16},children:[e.jsx(q,{span:8,children:e.jsx(ke,{placeholder:"搜索SOP名称或项目...",allowClear:!0,onSearch:e=>{S(e)},style:{width:"100%"}})}),e.jsx(q,{span:4,children:e.jsxs(j,{placeholder:"状态筛选",allowClear:!0,style:{width:"100%"},value:w,onChange:e=>{R(e)},children:[e.jsx(qe,{value:"all",children:"全部状态"}),e.jsx(qe,{value:"active",children:"启用"}),e.jsx(qe,{value:"inactive",children:"停用"})]})})]}),e.jsx(k,{justify:"space-between",align:"middle",style:{marginBottom:16},children:e.jsx(q,{children:e.jsxs(o,{children:[e.jsx(U,{menu:{items:E},disabled:0===v.length,children:e.jsxs(m,{children:["批量操作 ",v.length>0&&`(${v.length})`]})}),e.jsx(m,{icon:e.jsx(H,{}),onClick:()=>{f.success("SOP列表导出成功")},children:"导出SOP列表"}),e.jsx(m,{icon:e.jsx(W,{}),onClick:()=>{f.info("导入功能开发中")},children:"导入SOP模板"})]})})}),e.jsx(u,{columns:V,dataSource:F,rowKey:"id",loading:s,pagination:{total:F.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,i)=>`第 ${i[0]}-${i[1]} 条/共 ${e} 条`},rowSelection:{selectedRowKeys:v,onChange:b,preserveSelectedRowKeys:!0},scroll:{x:1e3}})]}),e.jsx(x,{title:"新建SOP模板",open:P,onCancel:()=>{T(!1),A.resetFields()},onOk:()=>A.submit(),width:600,children:e.jsxs(d,{form:A,layout:"vertical",onFinish:async e=>{try{f.success("SOP模板创建成功"),T(!1),A.resetFields(),O()}catch(i){f.error("创建失败")}},children:[e.jsx(d.Item,{name:"name",label:"模板名称",rules:[{required:!0,message:"请输入模板名称"}],children:e.jsx(p,{placeholder:"请输入SOP模板名称"})}),e.jsx(d.Item,{name:"description",label:"模板描述",rules:[{required:!0,message:"请输入模板描述"}],children:e.jsx(p.TextArea,{rows:3,placeholder:"请输入SOP模板描述"})}),e.jsx(d.Item,{name:"applicableProjects",label:"适用项目",rules:[{required:!0,message:"请选择适用项目"}],children:e.jsx(j,{mode:"multiple",placeholder:"请选择适用的检测项目",options:[{label:"肿瘤测序项目A",value:"肿瘤测序项目A"},{label:"肿瘤测序项目B",value:"肿瘤测序项目B"},{label:"病原检测项目",value:"病原检测项目"},{label:"遗传病筛查项目A",value:"遗传病筛查项目A"},{label:"遗传病筛查项目B",value:"遗传病筛查项目B"},{label:"新生儿筛查",value:"新生儿筛查"},{label:"药物基因组学项目",value:"药物基因组学项目"},{label:"新冠检测项目",value:"新冠检测项目"}]})})]})})]})},{Option:we}=j,{TextArea:Re}=p,Pe=()=>{const{templateId:r}=l(),n=t(),[a]=s(),v="view"===a.get("mode"),[C,w]=i.useState(!1),[A,F]=i.useState(!1),[V,D]=i.useState(null),[E,G]=i.useState(!1),[K,Q]=i.useState(null),[$,H]=i.useState(!1),[X,Z]=i.useState(!1),[le,se]=i.useState(null),[re,ne]=i.useState(!1),[ae,de]=i.useState(null),[ce]=d.useForm(),[oe,me]=i.useState(!1),[he,ue]=i.useState(null),[xe]=d.useForm(),[pe]=d.useForm(),[je]=d.useForm();i.useEffect(()=>{r&&ge(r)},[r]);const ge=async e=>{w(!0);try{const i={id:e,name:"肿瘤基因检测",version:"v2.1",status:"active",applicableProjects:["肿瘤测序项目A","肿瘤测序项目B"],description:"用于肿瘤相关基因突变的检测流程，包含从样本接收到报告生成的完整流程",creator:"张三",createTime:"2024-03-15",lastUpdater:"李四",updateTime:"2024-05-20",steps:[{id:"1",name:"样本接收",type:"info_record",description:"接收并登记样本信息，检查样本质量",isRequired:!0,estimatedTime:30,sortOrder:1,hasQualityControl:!0,fieldCount:8,qcRuleCount:3},{id:"2",name:"核酸提取",type:"experiment",description:"从样本中提取高质量的核酸",isRequired:!0,estimatedTime:90,sortOrder:2,hasQualityControl:!0,fieldCount:12,qcRuleCount:5},{id:"3",name:"文库构建",type:"experiment",description:"构建测序文库，进行PCR扩增",isRequired:!0,estimatedTime:180,sortOrder:3,hasQualityControl:!0,fieldCount:15,qcRuleCount:4},{id:"4",name:"测序",type:"instrument",description:"使用测序仪进行高通量测序",isRequired:!0,estimatedTime:1440,sortOrder:4,hasQualityControl:!0,fieldCount:6,qcRuleCount:2},{id:"5",name:"数据分析",type:"data_analysis",description:"对测序数据进行质控、比对、变异检测等分析",isRequired:!0,estimatedTime:240,sortOrder:5,hasQualityControl:!0,fieldCount:10,qcRuleCount:6},{id:"6",name:"报告生成",type:"report",description:"根据分析结果生成检测报告",isRequired:!0,estimatedTime:60,sortOrder:6,hasQualityControl:!1,fieldCount:5,qcRuleCount:0}]};D(i),pe.setFieldsValue({name:i.name,status:i.status,applicableProjects:i.applicableProjects,description:i.description})}catch(i){f.error("加载SOP模板详情失败")}finally{w(!1)}},ye=e=>{if(le){const i=le.qualityControlPoints.map(i=>({...i,isActive:e}));se({...le,qualityControlPoints:i}),f.success(`已${e?"启用":"禁用"}所有质量控制点`)}},ve=(e,i)=>{if(!V)return;const t=[...V.steps],l=t.findIndex(i=>i.id===e.id);"up"===i&&l>0?[t[l],t[l-1]]=[t[l-1],t[l]]:"down"===i&&l<t.length-1&&([t[l],t[l+1]]=[t[l+1],t[l]]),t.forEach((e,i)=>{e.sortOrder=i+1}),D({...V,steps:t})},Ie=[{label:"信息记录",value:"info_record"},{label:"实验操作",value:"experiment"},{label:"仪器操作",value:"instrument"},{label:"数据分析",value:"data_analysis"},{label:"报告输出",value:"report"}],fe={info_record:"blue",experiment:"green",instrument:"orange",data_analysis:"purple",report:"red"},be=[{label:"文本",value:"text"},{label:"数字",value:"number"},{label:"日期",value:"date"},{label:"文件",value:"file"},{label:"下拉选择",value:"select"},{label:"文本域",value:"textarea"},{label:"复选框",value:"checkbox"}],Ce=[{label:"手动检查",value:"manual"},{label:"自动检查",value:"automatic"},{label:"半自动检查",value:"semi-automatic"}],ke=[{label:"数值范围",value:"range"},{label:"枚举值",value:"enum"},{label:"公式计算",value:"formula"},{label:"文件检查",value:"file"},{label:"目视检查",value:"visual"}],qe=[{label:"信息",value:"info"},{label:"警告",value:"warning"},{label:"错误",value:"error"}],Se=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,i,t)=>t+1},{title:"字段名称",dataIndex:"name",key:"name",width:150,render:(i,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.identifier})]})},{title:"类型",dataIndex:"type",key:"type",width:100,render:i=>{const t=be.find(e=>e.value===i);return e.jsx(g,{children:(null==t?void 0:t.label)||i})}},{title:"必填",dataIndex:"isRequired",key:"isRequired",width:80,render:i=>e.jsx(g,{color:i?"success":"default",children:i?"是":"否"})},{title:"默认值",dataIndex:"defaultValue",key:"defaultValue",width:120,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[i&&e.jsx("div",{children:i}),t.unit&&e.jsxs("div",{style:{color:"#666"},children:["单位: ",t.unit]})]})},{title:"高级选项",key:"advanced",width:120,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[t.showInQuickPanel&&e.jsx(g,{size:"small",children:"快速面板"}),t.allowBatchEdit&&e.jsx(g,{size:"small",children:"批量编辑"}),t.participateValidation&&e.jsx(g,{size:"small",children:"数据验证"}),t.generateReport&&e.jsx(g,{size:"small",children:"统计报表"})]})},{title:"操作",key:"action",width:120,render:(i,t)=>e.jsxs(o,{size:"small",children:[e.jsx(N,{title:"编辑",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return de(e=t),ce.setFieldsValue(e),void ne(!0);var e}})}),e.jsx(N,{title:"删除",children:e.jsx(m,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>{return e=t,void x.confirm({title:"删除字段",content:`确定要删除字段"${e.name}"吗？`,onOk:()=>{if(le){const i=le.fields.filter(i=>i.id!==e.id);se({...le,fields:i}),f.success("字段删除成功")}}});var e}})})]})}],Pe=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,i,t)=>t+1},{title:"控制点名称",dataIndex:"name",key:"name",width:150,render:(i,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.description})]})},{title:"类型",dataIndex:"type",key:"type",width:120,render:(i,t)=>{var l,s;return e.jsxs("div",{children:[e.jsx(g,{color:"automatic"===i?"blue":"manual"===i?"green":"orange",children:(null==(l=Ce.find(e=>e.value===i))?void 0:l.label)||i}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:null==(s=ke.find(e=>e.value===t.checkType))?void 0:s.label})]})}},{title:"检查规则",dataIndex:"checkRule",key:"checkRule",width:200,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{children:i}),t.triggerCondition&&e.jsxs("div",{style:{color:"#666",marginTop:4},children:["触发条件: ",t.triggerCondition]})]})},{title:"状态",dataIndex:"isActive",key:"isActive",width:100,render:(i,t)=>e.jsxs("div",{children:[e.jsx(g,{color:i?"success":"default",children:i?"启用":"禁用"}),t.isRequired&&e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:4},children:"必检项"})]})},{title:"通知级别",dataIndex:"notificationLevel",key:"notificationLevel",width:100,render:i=>{var t;return e.jsx(g,{color:{info:"blue",warning:"orange",error:"red"}[i],children:(null==(t=qe.find(e=>e.value===i))?void 0:t.label)||i})}},{title:"操作",key:"action",width:150,render:(i,t)=>e.jsxs(o,{size:"small",children:[e.jsx(N,{title:"编辑",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return ue(e=t),xe.setFieldsValue(e),void me(!0);var e}})}),e.jsx(N,{title:t.isActive?"禁用":"启用",children:e.jsx(m,{type:"link",size:"small",icon:t.isActive?e.jsx(_,{}):e.jsx(te,{}),onClick:()=>(e=>{if(le){const i=le.qualityControlPoints.map(i=>i.id===e.id?{...i,isActive:!i.isActive}:i);se({...le,qualityControlPoints:i}),f.success("质量控制点已"+(e.isActive?"禁用":"启用"))}})(t)})}),e.jsx(N,{title:"删除",children:e.jsx(m,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>{return e=t,void x.confirm({title:"删除质量控制点",content:`确定要删除质量控制点"${e.name}"吗？`,onOk:()=>{if(le){const i=le.qualityControlPoints.filter(i=>i.id!==e.id);se({...le,qualityControlPoints:i}),f.success("质量控制点删除成功")}}});var e}})})]})}],Te=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(i,t,l)=>e.jsxs(o,{children:[e.jsx("span",{children:l+1}),!v&&e.jsxs(o,{direction:"vertical",size:0,children:[e.jsx(m,{type:"text",size:"small",icon:e.jsx(ee,{}),disabled:0===l,onClick:()=>ve(t,"up")}),e.jsx(m,{type:"text",size:"small",icon:e.jsx(ie,{}),disabled:l===((null==V?void 0:V.steps.length)||0)-1,onClick:()=>ve(t,"down")})]})]})},{title:"步骤名称",dataIndex:"name",key:"name",width:150,render:(i,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["预计 ",t.estimatedTime," 分钟"]})]})},{title:"步骤类型",dataIndex:"type",key:"type",width:100,render:i=>{const t=Ie.find(e=>e.value===i);return e.jsx(g,{color:fe[i],children:(null==t?void 0:t.label)||i})}},{title:"必填",dataIndex:"isRequired",key:"isRequired",width:80,render:i=>e.jsx(B,{status:i?"success":"default",text:i?"是":"否"})},{title:"配置统计",key:"stats",width:100,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["字段: ",t.fieldCount]}),e.jsxs("div",{children:["质检: ",t.qcRuleCount]})]})},{title:"质量控制",dataIndex:"hasQualityControl",key:"hasQualityControl",width:100,render:i=>e.jsx(B,{status:i?"processing":"default",text:i?"启用":"关闭"})},{title:"操作",key:"action",width:150,render:(i,t)=>e.jsxs(o,{size:"small",children:[e.jsx(N,{title:"配置字段",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(L,{}),onClick:()=>(e=>{const i={id:e.id,name:e.name,description:e.description,estimatedTime:e.estimatedTime,sortOrder:e.sortOrder,hasQualityControl:e.qcRuleCount>0,fields:[{id:"1",name:"操作人员",identifier:"operator",type:"text",isRequired:!0,placeholder:"请输入操作人员姓名",sortOrder:1,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!1,generateReport:!0},{id:"2",name:"提取方法",identifier:"extraction_method",type:"select",isRequired:!0,defaultValue:"磁珠法",options:["磁珠法","酚氯仿法","柱式法","其他"],placeholder:"请选择核酸提取方法",helpText:"根据样本类型和下游应用选择合适的提取方法",sortOrder:2,showInQuickPanel:!0,allowBatchEdit:!0,participateValidation:!0,generateReport:!0},{id:"3",name:"样本浓度",identifier:"concentration",type:"number",isRequired:!0,unit:"ng/μl",placeholder:"请输入样本浓度",validationRule:">0",sortOrder:3,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!0,generateReport:!0}],qualityControlPoints:[]};se(i),H(!0)})(t)})}),e.jsx(N,{title:"质量控制",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(te,{}),onClick:()=>(e=>{const i={id:e.id,name:e.name,description:e.description,estimatedTime:e.estimatedTime,sortOrder:e.sortOrder,hasQualityControl:e.qcRuleCount>0,fields:[],qualityControlPoints:[{id:"1",name:"浓度检查",type:"automatic",checkType:"range",description:"检查核酸浓度是否在合理范围内",isRequired:!0,triggerCondition:"提取完成后",checkRule:"浓度 >= 10 ng/μl",warningThreshold:20,errorThreshold:10,autoCorrection:!1,notificationLevel:"error",relatedFields:["concentration"],sortOrder:1,isActive:!0},{id:"2",name:"纯度检查",type:"automatic",checkType:"range",description:"检查核酸纯度（260/280比值）",isRequired:!0,triggerCondition:"浓度检查通过后",checkRule:"1.8 <= 260/280 <= 2.2",warningThreshold:1.7,errorThreshold:1.5,autoCorrection:!1,notificationLevel:"warning",relatedFields:["ratio_260_280"],sortOrder:2,isActive:!0}]};se(i),Z(!0)})(t)})}),!v&&e.jsxs(e.Fragment,{children:[e.jsx(N,{title:"编辑",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return Q(e=t),je.setFieldsValue(e),void G(!0);var e}})}),e.jsx(N,{title:"删除",children:e.jsx(m,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>handleDeleteStep(t)})})]})]})}];return C?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):V?e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(k,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(q,{children:e.jsxs(o,{children:[e.jsx(m,{icon:e.jsx(b,{}),onClick:()=>{n("../sop-config")},children:"返回列表"}),e.jsxs("h2",{style:{margin:0},children:["SOP模板: ",V.name," ",V.version]})]})}),e.jsx(q,{children:e.jsxs(o,{children:[!v&&e.jsx(m,{type:"primary",icon:e.jsx(T,{}),loading:A,onClick:()=>pe.submit(),children:"保存"}),e.jsx(U,{menu:{items:[{key:"version",label:"版本管理",icon:e.jsx(M,{})},{key:"export",label:"导出模板",icon:e.jsx(R,{})}]},children:e.jsx(m,{icon:e.jsx(J,{}),children:"更多"})})]})})]}),e.jsx(c,{title:"模板基本信息",style:{marginBottom:24},children:e.jsxs(d,{form:pe,layout:"vertical",onFinish:async e=>{F(!0);try{f.success("SOP模板保存成功"),V&&D({...V,...e,updateTime:(new Date).toISOString().split("T")[0],lastUpdater:"当前用户"})}catch(i){f.error("保存失败")}finally{F(!1)}},disabled:v,children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"name",label:"模板名称",rules:[{required:!0,message:"请输入模板名称"}],children:e.jsx(p,{placeholder:"请输入SOP模板名称"})})}),e.jsx(q,{span:4,children:e.jsx(d.Item,{label:"版本号",children:e.jsx(p,{value:V.version,disabled:!0})})}),e.jsx(q,{span:4,children:e.jsx(d.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请选择状态"}],children:e.jsxs(j,{children:[e.jsx(we,{value:"active",children:"启用"}),e.jsx(we,{value:"inactive",children:"停用"})]})})})]}),e.jsx(k,{gutter:16,children:e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"applicableProjects",label:"适用项目",rules:[{required:!0,message:"请选择适用项目"}],children:e.jsx(j,{mode:"multiple",placeholder:"请选择适用的检测项目",options:[{label:"肿瘤测序项目A",value:"肿瘤测序项目A"},{label:"肿瘤测序项目B",value:"肿瘤测序项目B"},{label:"病原检测项目",value:"病原检测项目"},{label:"遗传病筛查项目A",value:"遗传病筛查项目A"},{label:"遗传病筛查项目B",value:"遗传病筛查项目B"},{label:"新生儿筛查",value:"新生儿筛查"},{label:"药物基因组学项目",value:"药物基因组学项目"},{label:"新冠检测项目",value:"新冠检测项目"}]})})})}),e.jsx(k,{gutter:16,children:e.jsx(q,{span:16,children:e.jsx(d.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入模板描述"}],children:e.jsx(Re,{rows:3,placeholder:"请输入SOP模板描述"})})})}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:6,children:e.jsx(d.Item,{label:"创建人",children:e.jsx(p,{value:V.creator,disabled:!0})})}),e.jsx(q,{span:6,children:e.jsx(d.Item,{label:"创建时间",children:e.jsx(p,{value:V.createTime,disabled:!0})})}),e.jsx(q,{span:6,children:e.jsx(d.Item,{label:"最后更新",children:e.jsx(p,{value:V.lastUpdater,disabled:!0})})}),e.jsx(q,{span:6,children:e.jsx(d.Item,{label:"更新时间",children:e.jsx(p,{value:V.updateTime,disabled:!0})})})]})]})}),e.jsx(c,{title:"实验步骤配置",extra:!v&&e.jsxs(o,{children:[e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>{Q(null),je.resetFields(),G(!0)},children:"添加步骤"}),e.jsx(m,{icon:e.jsx(W,{}),onClick:()=>{f.info("导入步骤模板功能开发中")},children:"导入步骤模板"})]}),children:e.jsx(u,{columns:Te,dataSource:V.steps,rowKey:"id",pagination:!1,scroll:{x:800}})}),e.jsx(x,{title:K?"编辑步骤":"添加步骤",open:E,onCancel:()=>{G(!1),je.resetFields()},onOk:()=>je.submit(),width:600,children:e.jsxs(d,{form:je,layout:"vertical",onFinish:async e=>{try{if(K){if(V){const i=V.steps.map(i=>i.id===K.id?{...i,...e}:i);D({...V,steps:i})}f.success("步骤更新成功")}else{const i={id:Date.now().toString(),...e,sortOrder:V?V.steps.length+1:1,fieldCount:0,qcRuleCount:0};V&&D({...V,steps:[...V.steps,i]}),f.success("步骤添加成功")}G(!1),je.resetFields()}catch(i){f.error("操作失败")}},children:[e.jsx(d.Item,{name:"name",label:"步骤名称",rules:[{required:!0,message:"请输入步骤名称"}],children:e.jsx(p,{placeholder:"请输入步骤名称"})}),e.jsx(d.Item,{name:"type",label:"步骤类型",rules:[{required:!0,message:"请选择步骤类型"}],children:e.jsx(j,{placeholder:"请选择步骤类型",options:Ie})}),e.jsx(d.Item,{name:"description",label:"步骤描述",rules:[{required:!0,message:"请输入步骤描述"}],children:e.jsx(Re,{rows:3,placeholder:"请输入步骤描述"})}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"estimatedTime",label:"预计耗时（分钟）",rules:[{required:!0,message:"请输入预计耗时"}],children:e.jsx(p,{type:"number",placeholder:"请输入预计耗时"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"isRequired",label:"是否必填",valuePropName:"checked",children:e.jsx(P,{})})})]}),e.jsx(d.Item,{name:"hasQualityControl",label:"启用质量控制",valuePropName:"checked",children:e.jsx(P,{})})]})}),e.jsx(O,{title:`配置字段 - ${(null==le?void 0:le.name)||""}`,placement:"right",width:1200,open:$,onClose:()=>H(!1),extra:e.jsxs(o,{children:[e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>{de(null),ce.resetFields(),ne(!0)},children:"添加字段"}),e.jsx(m,{onClick:()=>{f.info("批量编辑功能开发中")},children:"批量编辑"}),e.jsx(m,{onClick:()=>{f.success("配置验证通过")},children:"验证配置"})]}),children:le&&e.jsxs("div",{children:[e.jsxs(c,{title:"步骤基本信息",style:{marginBottom:24},children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsxs("div",{children:[e.jsx("strong",{children:"步骤名称："}),le.name]})}),e.jsx(q,{span:8,children:e.jsxs("div",{children:[e.jsx("strong",{children:"预计耗时："}),le.estimatedTime," 分钟"]})}),e.jsx(q,{span:8,children:e.jsxs("div",{children:[e.jsx("strong",{children:"排序："}),le.sortOrder]})})]}),e.jsx(k,{gutter:16,style:{marginTop:16},children:e.jsx(q,{span:24,children:e.jsxs("div",{children:[e.jsx("strong",{children:"步骤描述："}),le.description]})})})]}),e.jsx(c,{title:"字段配置",children:e.jsx(u,{columns:Se,dataSource:le.fields,rowKey:"id",pagination:!1,scroll:{x:1e3}})})]})}),e.jsx(O,{title:`质量控制 - ${(null==le?void 0:le.name)||""}`,placement:"right",width:1200,open:X,onClose:()=>Z(!1),extra:e.jsxs(o,{children:[e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>{ue(null),xe.resetFields(),me(!0)},children:"添加质量控制点"}),e.jsx(m,{onClick:()=>ye(!0),children:"批量启用"}),e.jsx(m,{onClick:()=>ye(!1),children:"批量禁用"}),e.jsx(m,{onClick:()=>{f.success("质量控制规则测试通过")},children:"测试规则"})]}),children:le&&e.jsxs("div",{children:[e.jsx(c,{title:"质量控制概览",style:{marginBottom:24},children:e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:le.qualityControlPoints.length}),e.jsx("div",{children:"总控制点"})]})}),e.jsx(q,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:le.qualityControlPoints.filter(e=>e.isActive).length}),e.jsx("div",{children:"已启用"})]})}),e.jsx(q,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#faad14"},children:le.qualityControlPoints.filter(e=>e.isRequired).length}),e.jsx("div",{children:"必检项"})]})}),e.jsx(q,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#f5222d"},children:le.qualityControlPoints.filter(e=>"automatic"===e.type).length}),e.jsx("div",{children:"自动检查"})]})})]})}),e.jsx(c,{title:"质量控制点配置",children:e.jsx(u,{columns:Pe,dataSource:le.qualityControlPoints,rowKey:"id",pagination:!1,scroll:{x:1200}})})]})}),e.jsx(x,{title:ae?"编辑字段":"添加字段",open:re,onCancel:()=>{ne(!1),ce.resetFields()},onOk:()=>ce.submit(),width:800,children:e.jsxs(d,{form:ce,layout:"vertical",onFinish:async e=>{try{if(ae){if(le){const i=le.fields.map(i=>i.id===ae.id?{...i,...e}:i);se({...le,fields:i})}f.success("字段更新成功")}else{const i={id:Date.now().toString(),...e,sortOrder:le?le.fields.length+1:1,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!1};le&&se({...le,fields:[...le.fields,i]}),f.success("字段添加成功")}ne(!1),ce.resetFields()}catch(i){f.error("操作失败")}},children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"name",label:"字段名称",rules:[{required:!0,message:"请输入字段名称"}],children:e.jsx(p,{placeholder:"请输入字段名称"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"identifier",label:"字段标识",rules:[{required:!0,message:"请输入字段标识"}],children:e.jsx(p,{placeholder:"请输入字段标识（英文）"})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"type",label:"字段类型",rules:[{required:!0,message:"请选择字段类型"}],children:e.jsx(j,{placeholder:"请选择字段类型",options:be})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"isRequired",label:"是否必填",valuePropName:"checked",children:e.jsx(P,{})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"显示顺序",children:e.jsx(S,{min:1,style:{width:"100%"}})})})]}),e.jsx(z,{children:"字段属性配置"}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"defaultValue",label:"默认值",children:e.jsx(p,{placeholder:"请输入默认值"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"unit",label:"单位",children:e.jsx(p,{placeholder:"请输入单位"})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"placeholder",label:"提示文本",children:e.jsx(p,{placeholder:"请输入提示文本"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"validationRule",label:"验证规则",children:e.jsx(p,{placeholder:"如：>0, 1.8-2.2"})})})]}),e.jsx(d.Item,{name:"helpText",label:"帮助文本",children:e.jsx(Re,{rows:2,placeholder:"请输入帮助文本"})}),e.jsx(d.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.type!==i.type,children:({getFieldValue:i})=>"select"===i("type")?e.jsx(d.Item,{name:"options",label:"下拉选项",rules:[{required:!0,message:"请输入下拉选项"}],children:e.jsx(j,{mode:"tags",placeholder:"请输入选项，按回车添加",style:{width:"100%"}})}):null}),e.jsx(z,{children:"高级选项"}),e.jsxs(k,{gutter:16,children:[e.jsxs(q,{span:12,children:[e.jsx(d.Item,{name:"showInQuickPanel",label:"在快速记录面板显示",valuePropName:"checked",children:e.jsx(Y,{})}),e.jsx(d.Item,{name:"allowBatchEdit",label:"允许批量编辑",valuePropName:"checked",children:e.jsx(Y,{})})]}),e.jsxs(q,{span:12,children:[e.jsx(d.Item,{name:"participateValidation",label:"参与数据验证",valuePropName:"checked",children:e.jsx(Y,{})}),e.jsx(d.Item,{name:"generateReport",label:"生成统计报表",valuePropName:"checked",children:e.jsx(Y,{})})]})]})]})}),e.jsx(x,{title:he?"编辑质量控制点":"添加质量控制点",open:oe,onCancel:()=>{me(!1),xe.resetFields()},onOk:()=>xe.submit(),width:800,children:e.jsxs(d,{form:xe,layout:"vertical",onFinish:async e=>{try{if(he){if(le){const i=le.qualityControlPoints.map(i=>i.id===he.id?{...i,...e}:i);se({...le,qualityControlPoints:i})}f.success("质量控制点更新成功")}else{const i={id:Date.now().toString(),...e,sortOrder:le?le.qualityControlPoints.length+1:1,isActive:!0,relatedFields:e.relatedFields||[]};le&&se({...le,qualityControlPoints:[...le.qualityControlPoints,i]}),f.success("质量控制点添加成功")}me(!1),xe.resetFields()}catch(i){f.error("操作失败")}},children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"name",label:"控制点名称",rules:[{required:!0,message:"请输入控制点名称"}],children:e.jsx(p,{placeholder:"请输入控制点名称"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"type",label:"检查类型",rules:[{required:!0,message:"请选择检查类型"}],children:e.jsx(j,{placeholder:"请选择检查类型",options:Ce})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"checkType",label:"检查方式",rules:[{required:!0,message:"请选择检查方式"}],children:e.jsx(j,{placeholder:"请选择检查方式",options:ke})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"notificationLevel",label:"通知级别",rules:[{required:!0,message:"请选择通知级别"}],children:e.jsx(j,{placeholder:"请选择通知级别",options:qe})})})]}),e.jsx(d.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入描述"}],children:e.jsx(Re,{rows:2,placeholder:"请输入质量控制点描述"})}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"triggerCondition",label:"触发条件",rules:[{required:!0,message:"请输入触发条件"}],children:e.jsx(p,{placeholder:"如：提取完成后"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"checkRule",label:"检查规则",rules:[{required:!0,message:"请输入检查规则"}],children:e.jsx(p,{placeholder:"如：浓度 >= 10 ng/μl"})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"warningThreshold",label:"警告阈值",children:e.jsx(S,{style:{width:"100%"},placeholder:"警告阈值"})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"errorThreshold",label:"错误阈值",children:e.jsx(S,{style:{width:"100%"},placeholder:"错误阈值"})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"显示顺序",children:e.jsx(S,{min:1,style:{width:"100%"}})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"isRequired",label:"是否必检",valuePropName:"checked",children:e.jsx(P,{})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"autoCorrection",label:"自动纠正",valuePropName:"checked",children:e.jsx(P,{})})})]}),e.jsx(d.Item,{name:"relatedFields",label:"关联字段",children:e.jsx(j,{mode:"multiple",placeholder:"请选择关联字段",options:(null==le?void 0:le.fields.map(e=>({label:e.name,value:e.identifier})))||[]})})]})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"SOP模板不存在"})},{Option:Te}=j,{TextArea:Ae}=p,Oe=()=>{const{stepId:s}=l(),r=t(),[n,a]=i.useState(!1),[v,C]=i.useState(!1),[A,O]=i.useState(null),[F,B]=i.useState(!1),[V,D]=i.useState(null),[E]=d.useForm(),[G]=d.useForm();i.useEffect(()=>{s&&L(s)},[s]);const L=async e=>{a(!0);try{const i={id:e,name:"核酸提取",description:"从样本中提取高质量的核酸，确保后续实验的成功进行",estimatedTime:90,sortOrder:2,hasQualityControl:!0,sopDocument:"SOP-DNA-001.pdf",fields:[{id:"1",name:"操作人员",identifier:"operator",type:"text",isRequired:!0,placeholder:"请输入操作人员姓名",sortOrder:1,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!1,generateReport:!0},{id:"2",name:"提取方法",identifier:"extraction_method",type:"select",isRequired:!0,defaultValue:"磁珠法",options:["磁珠法","酚氯仿法","柱式法","其他"],placeholder:"请选择核酸提取方法",helpText:"根据样本类型和下游应用选择合适的提取方法",sortOrder:2,showInQuickPanel:!0,allowBatchEdit:!0,participateValidation:!0,generateReport:!0},{id:"3",name:"试剂盒",identifier:"reagent_kit",type:"select",isRequired:!0,options:["QIAamp DNA Mini Kit","DNeasy Blood & Tissue Kit","MagMAX DNA Multi-Sample Kit"],placeholder:"请选择使用的试剂盒",sortOrder:3,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!0,generateReport:!0},{id:"4",name:"样本浓度",identifier:"concentration",type:"number",isRequired:!0,unit:"ng/μl",placeholder:"请输入样本浓度",validationRule:">0",sortOrder:4,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!0,generateReport:!0},{id:"5",name:"260/280",identifier:"ratio_260_280",type:"number",isRequired:!0,placeholder:"请输入260/280比值",validationRule:"1.8-2.2",sortOrder:5,showInQuickPanel:!0,allowBatchEdit:!1,participateValidation:!0,generateReport:!0},{id:"6",name:"体积",identifier:"volume",type:"number",isRequired:!0,defaultValue:"50",unit:"μl",placeholder:"请输入体积",sortOrder:6,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!1,generateReport:!0},{id:"7",name:"裂解时间",identifier:"lysis_time",type:"number",isRequired:!0,defaultValue:"30",unit:"分钟",placeholder:"请输入裂解时间",sortOrder:7,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!1,generateReport:!1},{id:"8",name:"温度",identifier:"temperature",type:"number",isRequired:!0,defaultValue:"56",unit:"°C",placeholder:"请输入温度",sortOrder:8,showInQuickPanel:!1,allowBatchEdit:!0,participateValidation:!1,generateReport:!1},{id:"9",name:"电泳图",identifier:"electrophoresis_image",type:"file",isRequired:!1,placeholder:"请上传电泳图",helpText:"支持JPG、PNG、PDF格式",sortOrder:9,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!0},{id:"10",name:"备注",identifier:"remarks",type:"textarea",isRequired:!1,placeholder:"请输入备注信息",sortOrder:10,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!0}]};O(i),E.setFieldsValue({name:i.name,description:i.description,estimatedTime:i.estimatedTime,sortOrder:i.sortOrder,hasQualityControl:i.hasQualityControl})}catch(i){f.error("加载步骤详情失败")}finally{a(!1)}},K=[{label:"文本",value:"text"},{label:"数字",value:"number"},{label:"日期",value:"date"},{label:"文件",value:"file"},{label:"下拉选择",value:"select"},{label:"文本域",value:"textarea"},{label:"复选框",value:"checkbox"}],Q=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,i,t)=>t+1},{title:"字段名称",dataIndex:"name",key:"name",width:150,render:(i,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.identifier})]})},{title:"类型",dataIndex:"type",key:"type",width:100,render:i=>{const t=K.find(e=>e.value===i);return e.jsx(g,{children:(null==t?void 0:t.label)||i})}},{title:"必填",dataIndex:"isRequired",key:"isRequired",width:80,render:i=>e.jsx(g,{color:i?"success":"default",children:i?"是":"否"})},{title:"默认值",dataIndex:"defaultValue",key:"defaultValue",width:120,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[i&&e.jsx("div",{children:i}),t.unit&&e.jsxs("div",{style:{color:"#666"},children:["单位: ",t.unit]})]})},{title:"高级选项",key:"advanced",width:120,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[t.showInQuickPanel&&e.jsx(g,{size:"small",children:"快速面板"}),t.allowBatchEdit&&e.jsx(g,{size:"small",children:"批量编辑"}),t.participateValidation&&e.jsx(g,{size:"small",children:"数据验证"}),t.generateReport&&e.jsx(g,{size:"small",children:"统计报表"})]})},{title:"操作",key:"action",width:120,render:(i,t)=>e.jsxs(o,{size:"small",children:[e.jsx(N,{title:"编辑",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return D(e=t),G.setFieldsValue(e),void B(!0);var e}})}),e.jsx(N,{title:"删除",children:e.jsx(m,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>{return e=t,void x.confirm({title:"删除字段",content:`确定要删除字段"${e.name}"吗？`,onOk:()=>{if(A){const i=A.fields.filter(i=>i.id!==e.id);O({...A,fields:i}),f.success("字段删除成功")}}});var e}})})]})}];return n?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):A?e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(k,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(q,{children:e.jsxs(o,{children:[e.jsx(m,{icon:e.jsx(b,{}),onClick:()=>{r(-1)},children:"返回"}),e.jsxs("h2",{style:{margin:0},children:["步骤字段配置 - ",A.name]})]})}),e.jsx(q,{children:e.jsx(o,{children:e.jsx(m,{type:"primary",icon:e.jsx(T,{}),loading:v,onClick:()=>E.submit(),children:"保存"})})})]}),e.jsx(c,{title:"步骤基本信息",style:{marginBottom:24},children:e.jsxs(d,{form:E,layout:"vertical",onFinish:async e=>{C(!0);try{f.success("步骤配置保存成功"),A&&O({...A,...e})}catch(i){f.error("保存失败")}finally{C(!1)}},children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"name",label:"步骤名称",rules:[{required:!0,message:"请输入步骤名称"}],children:e.jsx(p,{placeholder:"请输入步骤名称"})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"estimatedTime",label:"预计耗时（分钟）",rules:[{required:!0,message:"请输入预计耗时"}],children:e.jsx(S,{min:1,style:{width:"100%"},placeholder:"请输入预计耗时"})})}),e.jsx(q,{span:4,children:e.jsx(d.Item,{name:"sortOrder",label:"排序",rules:[{required:!0,message:"请输入排序"}],children:e.jsx(S,{min:1,style:{width:"100%"},placeholder:"排序"})})}),e.jsx(q,{span:4,children:e.jsx(d.Item,{name:"hasQualityControl",label:"质量控制点",valuePropName:"checked",children:e.jsx(P,{})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:16,children:e.jsx(d.Item,{name:"description",label:"步骤描述",rules:[{required:!0,message:"请输入步骤描述"}],children:e.jsx(Ae,{rows:3,placeholder:"请输入步骤描述"})})}),e.jsx(q,{span:8,children:e.jsxs(d.Item,{label:"SOP参考文档",children:[e.jsx(w,{children:e.jsx(m,{icon:e.jsx(R,{}),children:"选择文件"})}),A.sopDocument&&e.jsxs("div",{style:{marginTop:8},children:[e.jsx(M,{})," ",A.sopDocument]})]})})]})]})}),e.jsx(c,{title:"字段配置",extra:e.jsxs(o,{children:[e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>{D(null),G.resetFields(),B(!0)},children:"添加字段"}),e.jsx(m,{onClick:()=>{f.info("批量编辑功能开发中")},children:"批量编辑"}),e.jsx(m,{onClick:()=>{f.success("配置验证通过")},children:"验证配置"})]}),children:e.jsx(u,{columns:Q,dataSource:A.fields,rowKey:"id",pagination:!1,scroll:{x:1e3}})}),e.jsx(x,{title:V?"编辑字段":"添加字段",open:F,onCancel:()=>{B(!1),G.resetFields()},onOk:()=>G.submit(),width:800,children:e.jsxs(d,{form:G,layout:"vertical",onFinish:async e=>{try{if(V){if(A){const i=A.fields.map(i=>i.id===V.id?{...i,...e}:i);O({...A,fields:i})}f.success("字段更新成功")}else{const i={id:Date.now().toString(),...e,sortOrder:A?A.fields.length+1:1,showInQuickPanel:!1,allowBatchEdit:!1,participateValidation:!1,generateReport:!1};A&&O({...A,fields:[...A.fields,i]}),f.success("字段添加成功")}B(!1),G.resetFields()}catch(i){f.error("操作失败")}},children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"name",label:"字段名称",rules:[{required:!0,message:"请输入字段名称"}],children:e.jsx(p,{placeholder:"请输入字段名称"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"identifier",label:"字段标识",rules:[{required:!0,message:"请输入字段标识"}],children:e.jsx(p,{placeholder:"请输入字段标识（英文）"})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"type",label:"字段类型",rules:[{required:!0,message:"请选择字段类型"}],children:e.jsx(j,{placeholder:"请选择字段类型",options:K})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"isRequired",label:"是否必填",valuePropName:"checked",children:e.jsx(P,{})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"显示顺序",children:e.jsx(S,{min:1,style:{width:"100%"}})})})]}),e.jsx(z,{children:"字段属性配置"}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"defaultValue",label:"默认值",children:e.jsx(p,{placeholder:"请输入默认值"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"unit",label:"单位",children:e.jsx(p,{placeholder:"请输入单位"})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"placeholder",label:"提示文本",children:e.jsx(p,{placeholder:"请输入提示文本"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"validationRule",label:"验证规则",children:e.jsx(p,{placeholder:"如：>0, 1.8-2.2"})})})]}),e.jsx(d.Item,{name:"helpText",label:"帮助文本",children:e.jsx(Ae,{rows:2,placeholder:"请输入帮助文本"})}),e.jsx(d.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.type!==i.type,children:({getFieldValue:i})=>"select"===i("type")?e.jsx(d.Item,{name:"options",label:"下拉选项",rules:[{required:!0,message:"请输入下拉选项"}],children:e.jsx(j,{mode:"tags",placeholder:"请输入选项，按回车添加",style:{width:"100%"}})}):null}),e.jsx(z,{children:"高级选项"}),e.jsxs(k,{gutter:16,children:[e.jsxs(q,{span:12,children:[e.jsx(d.Item,{name:"showInQuickPanel",label:"在快速记录面板显示",valuePropName:"checked",children:e.jsx(Y,{})}),e.jsx(d.Item,{name:"allowBatchEdit",label:"允许批量编辑",valuePropName:"checked",children:e.jsx(Y,{})})]}),e.jsxs(q,{span:12,children:[e.jsx(d.Item,{name:"participateValidation",label:"参与数据验证",valuePropName:"checked",children:e.jsx(Y,{})}),e.jsx(d.Item,{name:"generateReport",label:"生成统计报表",valuePropName:"checked",children:e.jsx(Y,{})})]})]})]})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"步骤不存在"})},{Option:Fe}=j,{TextArea:Be}=p,ze=()=>{const{stepId:s}=l(),r=t(),[n,a]=i.useState(!1),[v,C]=i.useState(!1),[w,R]=i.useState(null),[A,O]=i.useState(!1),[F,B]=i.useState(null),[V]=d.useForm(),[D]=d.useForm();i.useEffect(()=>{s&&E(s)},[s]);const E=async e=>{a(!0);try{R({stepId:e,stepName:"核酸提取",description:"核酸提取步骤的质量控制配置",overallPassRate:95.8,lastUpdateTime:"2024-01-15 14:30:00",qualityControlPoints:[{id:"1",name:"浓度检查",type:"automatic",checkType:"range",description:"检查核酸浓度是否在合理范围内",isRequired:!0,triggerCondition:"提取完成后",checkRule:"浓度 >= 10 ng/μl",warningThreshold:20,errorThreshold:10,autoCorrection:!1,notificationLevel:"error",relatedFields:["concentration"],sortOrder:1,isActive:!0},{id:"2",name:"纯度检查",type:"automatic",checkType:"range",description:"检查核酸纯度（260/280比值）",isRequired:!0,triggerCondition:"浓度检查通过后",checkRule:"1.8 <= 260/280 <= 2.2",warningThreshold:1.7,errorThreshold:1.5,autoCorrection:!1,notificationLevel:"warning",relatedFields:["ratio_260_280"],sortOrder:2,isActive:!0},{id:"3",name:"体积确认",type:"manual",checkType:"visual",description:"目视确认提取后的核酸体积",isRequired:!0,triggerCondition:"提取完成后",checkRule:"体积 >= 预期体积的80%",autoCorrection:!1,notificationLevel:"warning",relatedFields:["volume"],sortOrder:3,isActive:!0},{id:"4",name:"电泳质量检查",type:"semi-automatic",checkType:"file",description:"通过电泳图检查核酸完整性",isRequired:!1,triggerCondition:"需要时",checkRule:"主带清晰，无明显降解",autoCorrection:!1,notificationLevel:"info",relatedFields:["electrophoresis_image"],sortOrder:4,isActive:!0},{id:"5",name:"试剂有效期检查",type:"automatic",checkType:"formula",description:"检查使用的试剂是否在有效期内",isRequired:!0,triggerCondition:"实验开始前",checkRule:"当前日期 <= 试剂有效期",autoCorrection:!1,notificationLevel:"error",relatedFields:["reagent_kit"],sortOrder:5,isActive:!0}]})}catch(i){f.error("加载质量控制配置失败")}finally{a(!1)}},G=e=>{if(w){const i=w.qualityControlPoints.map(i=>({...i,isActive:e}));R({...w,qualityControlPoints:i}),f.success(`已${e?"启用":"禁用"}所有质量控制点`)}},K=[{label:"手动检查",value:"manual"},{label:"自动检查",value:"automatic"},{label:"半自动检查",value:"semi-automatic"}],Q=[{label:"数值范围",value:"range"},{label:"枚举值",value:"enum"},{label:"公式计算",value:"formula"},{label:"文件检查",value:"file"},{label:"目视检查",value:"visual"}],$=[{label:"信息",value:"info"},{label:"警告",value:"warning"},{label:"错误",value:"error"}],M=[{title:"排序",dataIndex:"sortOrder",key:"sortOrder",width:80,render:(e,i,t)=>t+1},{title:"控制点名称",dataIndex:"name",key:"name",width:150,render:(i,t)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:i}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:t.description})]})},{title:"类型",dataIndex:"type",key:"type",width:120,render:(i,t)=>{var l,s;return e.jsxs("div",{children:[e.jsx(g,{color:"automatic"===i?"blue":"manual"===i?"green":"orange",children:null==(l=K.find(e=>e.value===i))?void 0:l.label}),e.jsx("div",{style:{fontSize:"12px",marginTop:4},children:e.jsx(g,{size:"small",children:null==(s=Q.find(e=>e.value===t.checkType))?void 0:s.label})})]})}},{title:"检查规则",dataIndex:"checkRule",key:"checkRule",width:200,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsx("div",{children:i}),t.triggerCondition&&e.jsxs("div",{style:{color:"#666",marginTop:4},children:["触发条件: ",t.triggerCondition]})]})},{title:"阈值设置",key:"threshold",width:120,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[t.warningThreshold&&e.jsxs("div",{style:{color:"#faad14"},children:[e.jsx(re,{})," 警告: ",t.warningThreshold]}),t.errorThreshold&&e.jsxs("div",{style:{color:"#ff4d4f"},children:[e.jsx(_,{})," 错误: ",t.errorThreshold]})]})},{title:"状态",key:"status",width:100,render:(i,t)=>e.jsxs("div",{children:[e.jsx(g,{color:t.isActive?"success":"default",children:t.isActive?"启用":"禁用"}),t.isRequired&&e.jsx(g,{size:"small",color:"red",children:"必需"})]})},{title:"通知级别",dataIndex:"notificationLevel",key:"notificationLevel",width:100,render:i=>{var t;return e.jsx(g,{color:{info:"blue",warning:"orange",error:"red"}[i],children:null==(t=$.find(e=>e.value===i))?void 0:t.label})}},{title:"操作",key:"action",width:150,render:(i,t)=>e.jsxs(o,{size:"small",children:[e.jsx(N,{title:"编辑",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(y,{}),onClick:()=>{return B(e=t),D.setFieldsValue(e),void O(!0);var e}})}),e.jsx(N,{title:t.isActive?"禁用":"启用",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(L,{}),onClick:()=>(e=>{if(w){const i=w.qualityControlPoints.map(i=>i.id===e.id?{...i,isActive:!i.isActive}:i);R({...w,qualityControlPoints:i}),f.success("质量控制点已"+(e.isActive?"禁用":"启用"))}})(t)})}),e.jsx(N,{title:"删除",children:e.jsx(m,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{}),onClick:()=>{return e=t,void x.confirm({title:"删除质量控制点",content:`确定要删除质量控制点"${e.name}"吗？`,onOk:()=>{if(w){const i=w.qualityControlPoints.filter(i=>i.id!==e.id);R({...w,qualityControlPoints:i}),f.success("质量控制点删除成功")}}});var e}})})]})}];return n?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):w?e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(k,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(q,{children:e.jsxs(o,{children:[e.jsx(m,{icon:e.jsx(b,{}),onClick:()=>{r(-1)},children:"返回"}),e.jsxs("h2",{style:{margin:0},children:["质量控制点配置 - ",w.stepName]})]})}),e.jsx(q,{children:e.jsxs(o,{children:[e.jsx(m,{onClick:()=>{f.success("质量控制规则测试通过")},children:"测试规则"}),e.jsx(m,{type:"primary",icon:e.jsx(T,{}),loading:v,onClick:async()=>{C(!0);try{f.success("质量控制配置保存成功")}catch(e){f.error("保存失败")}finally{C(!1)}},children:"保存配置"})]})})]}),e.jsxs(c,{title:"质量控制概览",style:{marginBottom:24},children:[e.jsxs(k,{gutter:24,children:[e.jsx(q,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:[w.overallPassRate,"%"]}),e.jsx("div",{style:{color:"#666"},children:"整体通过率"}),e.jsx(le,{percent:w.overallPassRate,showInfo:!1,strokeColor:"#52c41a",style:{marginTop:8}})]})}),e.jsx(q,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:w.qualityControlPoints.filter(e=>e.isActive).length}),e.jsx("div",{style:{color:"#666"},children:"启用的控制点"})]})}),e.jsx(q,{span:8,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#faad14"},children:w.qualityControlPoints.filter(e=>e.isRequired).length}),e.jsx("div",{style:{color:"#666"},children:"必需控制点"})]})})]}),e.jsx(z,{}),e.jsx(se,{message:"质量控制配置说明",description:`最后更新时间: ${w.lastUpdateTime}。质量控制点按照设定的规则自动或手动检查实验数据，确保实验质量符合标准。`,type:"info",showIcon:!0})]}),e.jsx(c,{title:"质量控制点配置",extra:e.jsxs(o,{children:[e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>{B(null),D.resetFields(),O(!0)},children:"添加控制点"}),e.jsx(m,{onClick:()=>G(!0),children:"批量启用"}),e.jsx(m,{onClick:()=>G(!1),children:"批量禁用"})]}),children:e.jsx(u,{columns:M,dataSource:w.qualityControlPoints,rowKey:"id",pagination:!1,scroll:{x:1200}})}),e.jsx(x,{title:F?"编辑质量控制点":"添加质量控制点",open:A,onCancel:()=>{O(!1),D.resetFields()},onOk:()=>D.submit(),width:900,children:e.jsxs(d,{form:D,layout:"vertical",onFinish:async e=>{try{if(F){if(w){const i=w.qualityControlPoints.map(i=>i.id===F.id?{...i,...e}:i);R({...w,qualityControlPoints:i})}f.success("质量控制点更新成功")}else{const i={id:Date.now().toString(),...e,sortOrder:w?w.qualityControlPoints.length+1:1,isActive:!0,relatedFields:e.relatedFields||[]};w&&R({...w,qualityControlPoints:[...w.qualityControlPoints,i]}),f.success("质量控制点添加成功")}O(!1),D.resetFields()}catch(i){f.error("操作失败")}},children:[e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"name",label:"控制点名称",rules:[{required:!0,message:"请输入控制点名称"}],children:e.jsx(p,{placeholder:"请输入控制点名称"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"type",label:"检查类型",rules:[{required:!0,message:"请选择检查类型"}],children:e.jsx(j,{placeholder:"请选择检查类型",options:K})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"checkType",label:"检查方式",rules:[{required:!0,message:"请选择检查方式"}],children:e.jsx(j,{placeholder:"请选择检查方式",options:Q})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"notificationLevel",label:"通知级别",rules:[{required:!0,message:"请选择通知级别"}],children:e.jsx(j,{placeholder:"请选择通知级别",options:$})})})]}),e.jsx(d.Item,{name:"description",label:"描述",rules:[{required:!0,message:"请输入描述"}],children:e.jsx(Be,{rows:2,placeholder:"请输入控制点描述"})}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"triggerCondition",label:"触发条件",rules:[{required:!0,message:"请输入触发条件"}],children:e.jsx(p,{placeholder:"如：提取完成后"})})}),e.jsx(q,{span:12,children:e.jsx(d.Item,{name:"checkRule",label:"检查规则",rules:[{required:!0,message:"请输入检查规则"}],children:e.jsx(p,{placeholder:"如：浓度 >= 10 ng/μl"})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"warningThreshold",label:"警告阈值",children:e.jsx(S,{style:{width:"100%"},placeholder:"警告阈值"})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"errorThreshold",label:"错误阈值",children:e.jsx(S,{style:{width:"100%"},placeholder:"错误阈值"})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"sortOrder",label:"排序",children:e.jsx(S,{min:1,style:{width:"100%"},placeholder:"排序"})})})]}),e.jsxs(k,{gutter:16,children:[e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"isRequired",label:"是否必需",valuePropName:"checked",children:e.jsx(P,{})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"autoCorrection",label:"自动纠正",valuePropName:"checked",children:e.jsx(P,{})})}),e.jsx(q,{span:8,children:e.jsx(d.Item,{name:"isActive",label:"启用状态",valuePropName:"checked",initialValue:!0,children:e.jsx(P,{})})})]}),e.jsx(d.Item,{name:"relatedFields",label:"关联字段",children:e.jsx(j,{mode:"tags",placeholder:"请选择关联的字段",style:{width:"100%"}})})]})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"步骤不存在"})},{Option:Ve}=j,{TextArea:Ne}=p,De=()=>{const{templateId:s}=l(),r=t(),[n,a]=i.useState(!1),[y,C]=i.useState([]),[S,w]=i.useState(null),[R,P]=i.useState(!1),[T,A]=i.useState(!1),[O,z]=i.useState([]),[V,E]=i.useState([]),[G]=d.useForm();i.useEffect(()=>{s&&L(s)},[s]);const L=async e=>{a(!0);try{const i=[{id:"1",version:"v2.1.0",templateId:e,templateName:"核酸提取SOP模板",status:"active",description:"优化了质量控制点配置，增加了自动化检查功能",changeLog:"1. 新增自动浓度检查\n2. 优化纯度检查规则\n3. 增加试剂有效期验证",createdBy:"张三",createdTime:"2024-01-15 10:30:00",reviewedBy:"李四",reviewedTime:"2024-01-16 14:20:00",approvedBy:"王五",approvedTime:"2024-01-17 09:15:00",activatedTime:"2024-01-17 10:00:00",isCurrentVersion:!0,stepCount:8,fieldCount:25,qcPointCount:5},{id:"2",version:"v2.0.1",templateId:e,templateName:"核酸提取SOP模板",status:"archived",description:"修复了字段验证规则的问题",changeLog:"1. 修复浓度字段验证规则\n2. 更新帮助文档",createdBy:"张三",createdTime:"2024-01-10 16:45:00",reviewedBy:"李四",reviewedTime:"2024-01-11 10:30:00",approvedBy:"王五",approvedTime:"2024-01-11 15:20:00",activatedTime:"2024-01-12 09:00:00",isCurrentVersion:!1,stepCount:8,fieldCount:23,qcPointCount:4},{id:"3",version:"v2.0.0",templateId:e,templateName:"核酸提取SOP模板",status:"archived",description:"重大版本更新，重构了整个流程结构",changeLog:"1. 重构实验步骤\n2. 新增质量控制模块\n3. 优化用户界面",createdBy:"赵六",createdTime:"2024-01-01 09:00:00",reviewedBy:"李四",reviewedTime:"2024-01-02 14:30:00",approvedBy:"王五",approvedTime:"2024-01-03 11:15:00",activatedTime:"2024-01-05 08:30:00",isCurrentVersion:!1,stepCount:7,fieldCount:20,qcPointCount:3},{id:"4",version:"v1.2.0",templateId:e,templateName:"核酸提取SOP模板",status:"deprecated",description:"增加了电泳检查步骤",changeLog:"1. 新增电泳检查步骤\n2. 更新操作说明",createdBy:"张三",createdTime:"2023-12-15 14:20:00",reviewedBy:"李四",reviewedTime:"2023-12-16 10:45:00",approvedBy:"王五",approvedTime:"2023-12-17 16:30:00",activatedTime:"2023-12-18 09:00:00",isCurrentVersion:!1,stepCount:6,fieldCount:18,qcPointCount:2},{id:"5",version:"v2.2.0-beta",templateId:e,templateName:"核酸提取SOP模板",status:"draft",description:"测试版本，增加AI辅助质量控制功能",changeLog:"1. 集成AI质量控制\n2. 智能异常检测\n3. 自动报告生成",createdBy:"张三",createdTime:"2024-01-20 11:15:00",isCurrentVersion:!1,stepCount:9,fieldCount:28,qcPointCount:7}];w({id:e,name:"核酸提取SOP模板",description:"标准核酸提取操作流程模板",currentVersion:"v2.1.0"}),C(i)}catch(i){f.error("加载版本数据失败")}finally{a(!1)}},K={draft:{color:"default",text:"草稿"},review:{color:"processing",text:"审核中"},approved:{color:"success",text:"已批准"},active:{color:"success",text:"活跃"},archived:{color:"warning",text:"已归档"},deprecated:{color:"error",text:"已废弃"}},Q=[{title:"版本号",dataIndex:"version",key:"version",width:120,render:(i,t)=>e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:500},children:[i,t.isCurrentVersion&&e.jsx(B,{status:"success",style:{marginLeft:8}})]}),t.isCurrentVersion&&e.jsx(g,{size:"small",color:"green",children:"当前版本"})]})},{title:"状态",dataIndex:"status",key:"status",width:100,render:i=>{const t=K[i];return e.jsx(g,{color:t.color,children:t.text})}},{title:"描述",dataIndex:"description",key:"description",width:200,ellipsis:!0},{title:"统计信息",key:"stats",width:150,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["步骤: ",t.stepCount]}),e.jsxs("div",{children:["字段: ",t.fieldCount]}),e.jsxs("div",{children:["质控点: ",t.qcPointCount]})]})},{title:"创建信息",key:"createInfo",width:150,render:(i,t)=>e.jsxs("div",{style:{fontSize:"12px"},children:[e.jsxs("div",{children:["创建人: ",t.createdBy]}),e.jsxs("div",{children:["创建时间: ",t.createdTime.split(" ")[0]]})]})},{title:"审批信息",key:"approvalInfo",width:150,render:(i,t)=>{var l;return e.jsxs("div",{style:{fontSize:"12px"},children:[t.approvedBy&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["批准人: ",t.approvedBy]}),e.jsxs("div",{children:["批准时间: ",null==(l=t.approvedTime)?void 0:l.split(" ")[0]]})]}),t.activatedTime&&e.jsxs("div",{style:{color:"#52c41a"},children:["激活时间: ",t.activatedTime.split(" ")[0]]})]})}},{title:"操作",key:"action",width:200,render:(i,t)=>e.jsxs(o,{size:"small",children:[e.jsx(N,{title:"查看",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(D,{}),onClick:()=>{var e;r(`/detection/sop-template/${(e=t).templateId}?version=${e.version}`)}})}),e.jsx(N,{title:"复制",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(X,{}),onClick:()=>{return e=t,void x.confirm({title:"复制版本",content:`确定要基于版本 ${e.version} 创建新版本吗？`,onOk:()=>{f.success("版本复制成功，请编辑新版本信息"),P(!0)}});var e}})}),!t.isCurrentVersion&&"approved"===t.status&&e.jsx(N,{title:"激活",children:e.jsx(m,{type:"link",size:"small",icon:e.jsx(te,{}),onClick:()=>{return e=t,void x.confirm({title:"激活版本",content:`确定要激活版本 ${e.version} 吗？当前活跃版本将被归档。`,onOk:()=>{const i=y.map(i=>({...i,status:i.id===e.id?"active":"active"===i.status?"archived":i.status,isCurrentVersion:i.id===e.id,activatedTime:i.id===e.id?(new Date).toLocaleString():i.activatedTime}));C(i),f.success("版本激活成功")}});var e}})}),!t.isCurrentVersion&&e.jsx(v,{title:"确定要删除这个版本吗？",onConfirm:()=>(e=>{if(e.isCurrentVersion)return void f.error("不能删除当前活跃版本");const i=y.filter(i=>i.id!==e.id);C(i),f.success("版本删除成功")})(t),children:e.jsx(N,{title:"删除",children:e.jsx(m,{type:"link",size:"small",danger:!0,icon:e.jsx(I,{})})})})]})}],$=[{title:"字段",dataIndex:"field",key:"field",width:150},{title:"变更类型",dataIndex:"changeType",key:"changeType",width:100,render:i=>e.jsx(g,{color:{added:"success",modified:"warning",deleted:"error"}[i],children:{added:"新增",modified:"修改",deleted:"删除"}[i]})},{title:"旧值",dataIndex:"oldValue",key:"oldValue",width:200,render:e=>e||"-"},{title:"新值",dataIndex:"newValue",key:"newValue",width:200,render:e=>e||"-"}];return n?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(k,{justify:"space-between",align:"middle",style:{marginBottom:24},children:[e.jsx(q,{children:e.jsxs(o,{children:[e.jsx(m,{icon:e.jsx(b,{}),onClick:()=>{r(-1)},children:"返回"}),e.jsxs("h2",{style:{margin:0},children:[e.jsx(ne,{})," SOP版本管理 - ",null==S?void 0:S.name]})]})}),e.jsx(q,{children:e.jsxs(o,{children:[e.jsx(m,{onClick:()=>{if(2!==O.length)return void f.warning("请选择两个版本进行比较");E([{field:"步骤数量",oldValue:"8",newValue:"9",changeType:"modified"},{field:"字段数量",oldValue:"25",newValue:"28",changeType:"modified"},{field:"质量控制点",oldValue:"5",newValue:"7",changeType:"modified"},{field:"AI质量控制",oldValue:"",newValue:"已启用",changeType:"added"},{field:"智能异常检测",oldValue:"",newValue:"已启用",changeType:"added"}]),A(!0)},disabled:2!==O.length,children:"版本比较"}),e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>{G.resetFields(),P(!0)},children:"创建版本"})]})})]}),e.jsx(c,{title:"模板信息",style:{marginBottom:24},children:e.jsxs(F,{column:3,children:[e.jsx(F.Item,{label:"模板名称",children:null==S?void 0:S.name}),e.jsx(F.Item,{label:"当前版本",children:e.jsx(g,{color:"success",children:null==S?void 0:S.currentVersion})}),e.jsx(F.Item,{label:"版本总数",children:y.length}),e.jsx(F.Item,{label:"模板描述",span:3,children:null==S?void 0:S.description})]})}),e.jsxs(c,{title:e.jsxs(o,{children:[e.jsx(Z,{}),"版本历史"]}),children:[e.jsx(se,{message:"版本管理说明",description:"版本管理遵循语义化版本控制规范。主版本号.次版本号.修订号，如 v2.1.0。只有已批准的版本才能激活使用。",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(u,{columns:Q,dataSource:y,rowKey:"id",rowSelection:{selectedRowKeys:O,onChange:e=>z(e),getCheckboxProps:e=>({disabled:"draft"===e.status})},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 个版本`},scroll:{x:1200}})]}),e.jsx(x,{title:"创建新版本",open:R,onCancel:()=>{P(!1),G.resetFields()},onOk:()=>G.submit(),width:600,children:e.jsxs(d,{form:G,layout:"vertical",onFinish:async e=>{try{const i={id:Date.now().toString(),templateId:s,templateName:(null==S?void 0:S.name)||"",isCurrentVersion:!1,stepCount:0,fieldCount:0,qcPointCount:0,createdBy:"当前用户",createdTime:(new Date).toLocaleString(),...e};C([i,...y]),P(!1),G.resetFields(),f.success("版本创建成功")}catch(i){f.error("创建失败")}},children:[e.jsx(d.Item,{name:"version",label:"版本号",rules:[{required:!0,message:"请输入版本号"},{pattern:/^v\d+\.\d+\.\d+(-\w+)?$/,message:"版本号格式不正确，如：v2.1.0 或 v2.1.0-beta"}],children:e.jsx(p,{placeholder:"如：v2.1.0 或 v2.1.0-beta"})}),e.jsx(d.Item,{name:"status",label:"初始状态",rules:[{required:!0,message:"请选择初始状态"}],initialValue:"draft",children:e.jsxs(j,{children:[e.jsx(Ve,{value:"draft",children:"草稿"}),e.jsx(Ve,{value:"review",children:"提交审核"})]})}),e.jsx(d.Item,{name:"description",label:"版本描述",rules:[{required:!0,message:"请输入版本描述"}],children:e.jsx(p,{placeholder:"请简要描述此版本的主要变更"})}),e.jsx(d.Item,{name:"changeLog",label:"变更日志",rules:[{required:!0,message:"请输入变更日志"}],children:e.jsx(Ne,{rows:4,placeholder:"请详细描述此版本的变更内容，每行一个变更点"})})]})}),e.jsxs(x,{title:"版本比较",open:T,onCancel:()=>A(!1),footer:[e.jsx(m,{onClick:()=>A(!1),children:"关闭"},"close")],width:800,children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(se,{message:`正在比较版本: ${O.join(" vs ")}`,type:"info",showIcon:!0})}),e.jsx(u,{columns:$,dataSource:V,rowKey:"field",pagination:!1,size:"small"})]})]})},{Option:Ee}=j,Ge=()=>{const[t,l]=i.useState([{id:"G-001",code:"TP-GRP-01",name:"肿瘤标志物",description:"肿瘤相关标志物检测分组",status:"active"},{id:"G-002",code:"TP-GRP-02",name:"遗传学检测",description:"遗传性疾病相关基因检测分组",status:"active"},{id:"G-003",code:"TP-GRP-03",name:"感染性疾病",description:"病原体检测与鉴定分组",status:"inactive"}]);i.useEffect(()=>{try{const i=localStorage.getItem("testItemGroups");if(i){const t=JSON.parse(i),s=(e=t,Array.isArray(e)?e.map(e=>({id:String(e.id??`G-${Math.random().toString(36).slice(2,8)}`),code:String(e.code??""),name:String(e.name??""),description:String(e.description??""),status:"inactive"===e.status?"inactive":"active"})):[]);s.length>0&&l(s)}}catch(i){}var e},[]),i.useEffect(()=>{try{localStorage.setItem("testItemGroups",JSON.stringify(t))}catch(e){}},[t]);const[s,r]=i.useState(!1),[n,a]=i.useState(null),[b]=d.useForm(),C=(e=null)=>{a(e),r(!0),e?b.setFieldsValue(e):b.resetFields()},k=[{title:"分组编码",dataIndex:"code",key:"code"},{title:"分组名称",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"description",key:"description"},{title:"状态",dataIndex:"status",key:"status",render:i=>e.jsx(g,{color:"active"===i?"green":"red",children:"active"===i?"启用":"停用"})},{title:"操作",key:"action",render:(i,s)=>e.jsxs(o,{children:[e.jsx(m,{size:"small",type:"link",icon:e.jsx(y,{}),onClick:()=>C(s),children:"编辑"}),e.jsx(m,{size:"small",type:"link",onClick:()=>(e=>{const i=t.map(i=>i.id===e?{...i,status:"active"===i.status?"inactive":"active"}:i);l(i)})(s.id),children:"active"===s.status?"停用":"启用"}),e.jsx(v,{title:"确认删除该分组？",onConfirm:()=>{return e=s.id,l(t.filter(i=>i.id!==e)),void f.success("分组已删除");var e},children:e.jsx(m,{size:"small",danger:!0,type:"link",icon:e.jsx(I,{}),children:"删除"})})]})}];return e.jsxs("div",{children:[e.jsxs(c,{title:"检测项目分组",children:[e.jsx(o,{style:{marginBottom:16},children:e.jsx(m,{type:"primary",icon:e.jsx(h,{}),onClick:()=>C(null),children:"新增分组"})}),e.jsx(u,{rowKey:"id",columns:k,dataSource:t,pagination:{pageSize:8}})]}),e.jsx(x,{title:n?"编辑分组":"新增分组",open:s,onCancel:()=>r(!1),onOk:()=>b.submit(),destroyOnClose:!0,children:e.jsxs(d,{form:b,layout:"vertical",onFinish:e=>{if(n){const i=t.map(i=>i.id===n.id?{...n,...e}:i);l(i),f.success("分组更新成功")}else{const i={id:`G-${Math.random().toString(36).slice(2,8)}`,...e};l([i,...t]),f.success("分组创建成功")}r(!1),a(null),b.resetFields()},initialValues:{status:"active"},children:[e.jsx(d.Item,{label:"分组编码",name:"code",rules:[{required:!0,message:"请输入分组编码"}],children:e.jsx(p,{placeholder:"例如：TP-GRP-01"})}),e.jsx(d.Item,{label:"分组名称",name:"name",rules:[{required:!0,message:"请输入分组名称"}],children:e.jsx(p,{placeholder:"例如：肿瘤标志物"})}),e.jsx(d.Item,{label:"描述",name:"description",children:e.jsx(p.TextArea,{rows:3,placeholder:"分组用途或说明"})}),e.jsx(d.Item,{label:"状态",name:"status",rules:[{required:!0}],children:e.jsxs(j,{children:[e.jsx(Ee,{value:"active",children:"启用"}),e.jsx(Ee,{value:"inactive",children:"停用"})]})})]})})]})},{Title:Le}=C,{Option:Ke}=j,Qe=()=>{const t=[{id:"T-001",code:"TP001",name:"肺癌基因检测"},{id:"T-002",code:"TP002",name:"结直肠癌基因检测"},{id:"T-003",code:"TP003",name:"乳腺癌基因检测"}],l=[{id:"E-001",name:"Illumina NextSeq 550"},{id:"E-002",name:"ABI 7500 Real-Time PCR"},{id:"E-003",name:"Thermo Fisher Ion Torrent"}],s=[{id:"R-001",name:"Nextera XT Library Prep Kit",recommendedSOPTemplateId:"illumina_nextera_xt"},{id:"R-002",name:"QIAamp DNA Mini Kit",recommendedSOPTemplateId:"dna_extraction_qiaamp"},{id:"R-003",name:"KAPA HyperPrep Kit",recommendedSOPTemplateId:"kapa_hyperprep"}],r=[{id:"A-001",name:"EGFR基因突变检测",code:"EGFR_MUT"},{id:"A-002",name:"KRAS基因突变检测",code:"KRAS_MUT"},{id:"A-003",name:"BRAF基因突变检测",code:"BRAF_MUT"},{id:"A-004",name:"微卫星不稳定性分析",code:"MSI"},{id:"A-005",name:"肿瘤突变负荷分析",code:"TMB"}],[n,a]=i.useState({testItemId:"",methodology:"",sampleType:"",equipmentIds:[],reagentIds:[],analysisItemIds:[],sop:{mode:"document",templateId:void 0}}),[h,p]=i.useState([]),[y,I]=i.useState(null),[b,C]=i.useState(!1),[k,q]=i.useState(null),[S,w]=i.useState(""),[R,P]=i.useState(null),[T,A]=i.useState(""),[O,F]=i.useState(null),[B,z]=i.useState(""),[V,N]=i.useState([]);i.useEffect(()=>{try{const e=localStorage.getItem("experimentProcessPlans");if(e){const i=JSON.parse(e),t=Array.isArray(i)?i.map(e=>({id:String(e.id),name:String(e.name),applicableTestItemIds:Array.isArray(e.applicableTestItemIds)?e.applicableTestItemIds.map(String):[]})):[];N(t)}else N([{id:"P-001",name:"标准NGS流程方案",applicableTestItemIds:["T-001","T-003"]},{id:"P-002",name:"PCR快速流程方案",applicableTestItemIds:["T-002"]}])}catch{}},[]),i.useEffect(()=>{try{const e=localStorage.getItem("testItemRelations");if(e){const i=JSON.parse(e),t=Array.isArray(i)?i.map(e=>{var i,t;return{id:String(e.id??`R-${Math.random().toString(36).slice(2,8)}`),testItemId:String(e.testItemId??""),methodology:String(e.methodology??""),sampleType:String(e.sampleType??""),equipmentIds:Array.isArray(e.equipmentIds)?e.equipmentIds.map(String):[],reagentIds:Array.isArray(e.reagentIds)?e.reagentIds.map(String):[],analysisItemIds:Array.isArray(e.analysisItemIds)?e.analysisItemIds.map(String):[],sop:{mode:"structured"===(null==(i=null==e?void 0:e.sop)?void 0:i.mode)?"structured":"document",templateId:(null==(t=null==e?void 0:e.sop)?void 0:t.templateId)?String(e.sop.templateId):void 0}}}):[];p(t)}}catch(e){}},[]),i.useEffect(()=>{try{localStorage.setItem("testItemRelations",JSON.stringify(h))}catch{}},[h]);const D=()=>{if(n.testItemId){if(y)p(h.map(e=>e.id===y?{id:y,...n}:e)),f.success("关系配置已更新");else{const e={id:`R-${Math.random().toString(36).slice(2,8)}`,...n};p([e,...h]),f.success("关系配置已保存")}I(null),C(!1)}else f.warning("请先选择一个检测项目")};r.map(e=>({key:e.id,title:`${e.name}（${e.code}）`}));const E=[{title:"检测项目",dataIndex:"testItemId",render:e=>{var i;return(null==(i=t.find(i=>i.id===e))?void 0:i.name)||"-"}},{title:"方法学",dataIndex:"methodology"},{title:"设备数",dataIndex:"equipmentIds",render:e=>e.length},{title:"试剂数",dataIndex:"reagentIds",render:e=>e.length},{title:"分析项目数",dataIndex:"analysisItemIds",render:e=>e.length},{title:"SOP模式",dataIndex:["sop","mode"],render:e=>"structured"===e?"结构化":"文档"},{title:"操作",render:(i,t)=>e.jsxs(o,{children:[e.jsx(m,{size:"small",type:"link",onClick:()=>(e=>{I(e.id),a({testItemId:e.testItemId,methodology:e.methodology,sampleType:e.sampleType??"",equipmentIds:e.equipmentIds,reagentIds:e.reagentIds,analysisItemIds:e.analysisItemIds,sop:e.sop}),C(!0)})(t),children:"编辑"}),e.jsx(v,{title:"确认删除该关系？",onConfirm:()=>{return e=t.id,p(h.filter(i=>i.id!==e)),void f.success("关系已删除");var e},children:e.jsx(m,{size:"small",danger:!0,type:"link",children:"删除"})})]})}];return e.jsx("div",{style:{padding:24},children:e.jsxs(c,{children:[e.jsxs(o,{style:{width:"100%",justifyContent:"space-between",marginBottom:12},children:[e.jsx(Le,{level:4,style:{marginBottom:0},children:"检测项目关系配置列表"}),e.jsx(m,{type:"primary",onClick:()=>{I(null),a({testItemId:"",methodology:"",sampleType:"",equipmentIds:[],reagentIds:[],analysisItemIds:[],sop:{mode:"document",templateId:void 0}}),C(!0)},children:"新增关系配置"})]}),e.jsx(u,{rowKey:"id",columns:E,dataSource:h,pagination:{pageSize:8},style:{marginBottom:24}}),e.jsxs(x,{title:y?"编辑关系配置":"新增关系配置",open:b,width:900,onCancel:()=>C(!1),onOk:D,okText:"保存",cancelText:"取消",destroyOnClose:!0,children:[e.jsx(c,{size:"small",title:"基本信息",style:{marginBottom:16},children:e.jsx(o,{direction:"vertical",style:{width:"100%"},children:e.jsxs(d,{layout:"vertical",children:[e.jsx(d.Item,{label:"选择检测项目",children:e.jsx(j,{placeholder:"请选择检测项目",style:{width:400},value:n.testItemId,onChange:e=>a(i=>({...i,testItemId:e})),children:t.map(i=>e.jsxs(Ke,{value:i.id,children:[i.name,"（",i.code,"）"]},i.id))})}),e.jsx(d.Item,{label:"方法学",children:e.jsx(j,{placeholder:"请选择方法学",style:{width:400},value:n.methodology,onChange:e=>a(i=>({...i,methodology:e})),children:["PCR","qPCR","NGS","Sanger"].map(i=>e.jsx(Ke,{value:i,children:i},i))})}),e.jsx(d.Item,{label:"样本类型",children:e.jsx(j,{placeholder:"请选择样本类型",style:{width:400},value:n.sampleType,onChange:e=>a(i=>({...i,sampleType:e})),children:["血液","组织","唾液","血浆"].map(i=>e.jsx(Ke,{value:i,children:i},i))})})]})})}),e.jsxs(c,{size:"small",title:"设备信息",style:{marginBottom:16},children:[e.jsxs(o,{style:{marginBottom:8},children:[e.jsx(j,{placeholder:"请选择设备",style:{width:400},value:S||void 0,onChange:e=>w(e),children:l.map(i=>e.jsx(Ke,{value:i.id,children:i.name},i.id))}),e.jsx(m,{onClick:()=>{S?n.equipmentIds.includes(S)?f.warning("设备已存在"):(a(e=>({...e,equipmentIds:[...e.equipmentIds,S]})),w("")):f.warning("请选择设备")},children:"新增设备"})]}),e.jsx(u,{size:"small",rowKey:e=>e,columns:[{title:"设备名称",dataIndex:"name",key:"name",render:(e,i)=>{var t;return(null==(t=l.find(e=>e.id===i))?void 0:t.name)||"-"}},{title:"操作",key:"action",render:(i,t,s)=>e.jsx(o,{children:k===s?e.jsxs(e.Fragment,{children:[e.jsx(j,{style:{width:260},value:S||t,onChange:e=>w(e),children:l.map(i=>e.jsx(Ke,{value:i.id,children:i.name},i.id))}),e.jsx(m,{type:"link",onClick:()=>{if(!S)return void f.warning("请选择设备");const e=[...n.equipmentIds];e[s]=S,a(i=>({...i,equipmentIds:e})),q(null),w("")},children:"保存"}),e.jsx(m,{type:"link",onClick:()=>{q(null),w("")},children:"取消"})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{type:"link",onClick:()=>{q(s),w(t)},children:"编辑"}),e.jsx(v,{title:"确认删除该设备？",onConfirm:()=>a(e=>({...e,equipmentIds:e.equipmentIds.filter(e=>e!==t)})),children:e.jsx(m,{type:"link",danger:!0,children:"删除"})})]})})}],dataSource:n.equipmentIds,pagination:!1})]}),e.jsxs(c,{size:"small",title:"试剂信息",style:{marginBottom:16},children:[e.jsxs(o,{style:{marginBottom:8},children:[e.jsx(j,{placeholder:"请选择试剂（将自动推荐SOP模板）",style:{width:400},value:T||void 0,onChange:e=>A(e),children:s.map(i=>e.jsx(Ke,{value:i.id,children:i.name},i.id))}),e.jsx(m,{onClick:()=>{var e;if(!T)return void f.warning("请选择试剂");if(n.reagentIds.includes(T))return void f.warning("试剂已存在");const i=null==(e=s.find(e=>e.id===T))?void 0:e.recommendedSOPTemplateId;a(e=>({...e,reagentIds:[...e.reagentIds,T],sop:{...e.sop,templateId:i||e.sop.templateId}})),A("")},children:"新增试剂"})]}),e.jsx(u,{size:"small",rowKey:e=>e,columns:[{title:"试剂名称",dataIndex:"name",key:"name",render:(e,i)=>{var t;return(null==(t=s.find(e=>e.id===i))?void 0:t.name)||"-"}},{title:"操作",key:"action",render:(i,t,l)=>e.jsx(o,{children:R===l?e.jsxs(e.Fragment,{children:[e.jsx(j,{style:{width:260},value:T||t,onChange:e=>A(e),children:s.map(i=>e.jsx(Ke,{value:i.id,children:i.name},i.id))}),e.jsx(m,{type:"link",onClick:()=>{var e;if(!T)return void f.warning("请选择试剂");const i=[...n.reagentIds];i[l]=T;const t=null==(e=s.find(e=>e.id===T))?void 0:e.recommendedSOPTemplateId;a(e=>({...e,reagentIds:i,sop:{...e.sop,templateId:t||e.sop.templateId}})),P(null),A("")},children:"保存"}),e.jsx(m,{type:"link",onClick:()=>{P(null),A("")},children:"取消"})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{type:"link",onClick:()=>{P(l),A(t)},children:"编辑"}),e.jsx(v,{title:"确认删除该试剂？",onConfirm:()=>a(e=>({...e,reagentIds:e.reagentIds.filter(e=>e!==t)})),children:e.jsx(m,{type:"link",danger:!0,children:"删除"})})]})})}],dataSource:n.reagentIds,pagination:!1})]}),e.jsxs(c,{size:"small",title:"关联分析项目",style:{marginBottom:16},children:[e.jsxs(o,{style:{marginBottom:8},children:[e.jsx(j,{placeholder:"请选择分析项目",style:{width:400},value:B||void 0,onChange:e=>z(e),children:r.map(i=>e.jsxs(Ke,{value:i.id,children:[i.name,"（",i.code,"）"]},i.id))}),e.jsx(m,{onClick:()=>{B?n.analysisItemIds.includes(B)?f.warning("分析项目已存在"):(a(e=>({...e,analysisItemIds:[...e.analysisItemIds,B]})),z("")):f.warning("请选择分析项目")},children:"新增分析项目"})]}),e.jsx(u,{size:"small",rowKey:e=>e,columns:[{title:"分析项目",dataIndex:"name",key:"name",render:(e,i)=>{const t=r.find(e=>e.id===i);return t?`${t.name}（${t.code}）`:"-"}},{title:"操作",key:"action",render:(i,t,l)=>e.jsx(o,{children:O===l?e.jsxs(e.Fragment,{children:[e.jsx(j,{style:{width:260},value:B||t,onChange:e=>z(e),children:r.map(i=>e.jsxs(Ke,{value:i.id,children:[i.name,"（",i.code,"）"]},i.id))}),e.jsx(m,{type:"link",onClick:()=>{if(!B)return void f.warning("请选择分析项目");const e=[...n.analysisItemIds];e[l]=B,a(i=>({...i,analysisItemIds:e})),F(null),z("")},children:"保存"}),e.jsx(m,{type:"link",onClick:()=>{F(null),z("")},children:"取消"})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{type:"link",onClick:()=>{F(l),z(t)},children:"编辑"}),e.jsx(v,{title:"确认删除该分析项目？",onConfirm:()=>a(e=>({...e,analysisItemIds:e.analysisItemIds.filter(e=>e!==t)})),children:e.jsx(m,{type:"link",danger:!0,children:"删除"})})]})})}],dataSource:n.analysisItemIds,pagination:!1})]}),e.jsx(c,{size:"small",title:"SOP配置",style:{marginBottom:16},children:e.jsxs(o,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(o,{children:[e.jsx("span",{children:"模式："}),e.jsxs(j,{style:{width:240},value:n.sop.mode,onChange:e=>a(i=>({...i,sop:{...i.sop,mode:e}})),children:[e.jsx(Ke,{value:"document",children:"文档"}),e.jsx(Ke,{value:"structured",children:"结构化"})]})]}),e.jsxs(o,{children:[e.jsx("span",{children:"模板ID（由试剂推荐）："}),e.jsx(g,{color:"geekblue",children:n.sop.templateId||"-"})]})]})}),e.jsx(c,{size:"small",title:"关联流程方案（只读）",children:e.jsx(u,{size:"small",rowKey:"id",columns:[{title:"流程方案",dataIndex:"name"}],dataSource:V.filter(e=>n.testItemId&&e.applicableTestItemIds.includes(n.testItemId)),locale:{emptyText:"暂无关联流程方案"},pagination:!1})}),e.jsxs(o,{style:{marginTop:8},children:[e.jsx(m,{type:"primary",onClick:D,children:"保存"}),e.jsx(m,{onClick:()=>{I(null),a({testItemId:"",methodology:"",sampleType:"",equipmentIds:[],reagentIds:[],analysisItemIds:[],sop:{mode:"document",templateId:void 0}}),q(null),w(""),P(null),A(""),F(null),z("")},children:"重置"})]})]})]})})},$e=()=>e.jsxs("div",{children:[e.jsxs(ae,{style:{margin:"16px 0"},children:[e.jsx(ae.Item,{children:"首页"}),e.jsx(ae.Item,{children:"检测项目"})]}),e.jsxs(r,{children:[e.jsx(n,{index:!0,element:e.jsx(a,{to:"test-item",replace:!0})}),e.jsx(n,{path:"test-item",element:e.jsx(ce,{})}),e.jsx(n,{path:"test-item/add",element:e.jsx(ue,{})}),e.jsx(n,{path:"test-item-relation",element:e.jsx(Qe,{})}),e.jsx(n,{path:"test-item-group",element:e.jsx(Ge,{})}),e.jsx(n,{path:"analysis-item",element:e.jsx(ge,{})}),e.jsx(n,{path:"methodology",element:e.jsx(Ce,{})}),e.jsx(n,{path:"sop-config",element:e.jsx(Se,{})}),e.jsx(n,{path:"sop-template/:templateId",element:e.jsx(Pe,{})}),e.jsx(n,{path:"sop-step/:stepId",element:e.jsx(Oe,{})}),e.jsx(n,{path:"sop-quality-control/:stepId",element:e.jsx(ze,{})}),e.jsx(n,{path:"sop-version/:templateId",element:e.jsx(De,{})})]})]});export{$e as default};
