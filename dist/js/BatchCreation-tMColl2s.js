import{j as e}from"./index-B0AWbMnF.js";import{r as t}from"./react-vendor-By8n_QN6.js";import{_ as a,s,c as l,e as r,a as i,a0 as n,a1 as d,S as c,B as o,a2 as m,U as x,N as h,a3 as p,ae as u,H as j,av as y,o as g,Y as b,a4 as v,af as I,ay as C,T as D,ap as f,aw as w,az as S,W as T,A as N,F as Y,ah as k,m as q,ao as M,X as A,a7 as E,a9 as L,aa as z,ac as F}from"./antd-vendor-BtuZ_fxs.js";const{Search:$}=n,{Option:B}=d,{TextArea:P}=n,{Step:H}=u,{TabPane:_}=f,{Text:O,Title:V}=D,K=()=>{var D,K;const[R,W]=t.useState(!1),[Q,G]=t.useState([]),[J,U]=t.useState([]),[X,Z]=t.useState([]),[ee,te]=t.useState([]),[ae,se]=t.useState(null),[le,re]=t.useState(!1),[ie,ne]=t.useState(!1),[de,ce]=t.useState(null),[oe,me]=t.useState(0),[xe,he]=t.useState([]),[pe,ue]=t.useState([]),[je,ye]=t.useState([]),[ge,be]=t.useState(""),[ve,Ie]=t.useState(""),[Ce,De]=t.useState(""),[fe]=a.useForm(),we=[{id:"1",sampleCode:"S001",sampleName:"土壤样本A",sampleType:"土壤",projectName:"环境微生物多样性分析",clientName:"环保局",receivedDate:"2024-01-15",status:"received",volume:5,concentration:120.5,quality:"good",notes:"样本状态良好"},{id:"2",sampleCode:"S002",sampleName:"水体样本B",sampleType:"水体",projectName:"水质监测项目",clientName:"水务局",receivedDate:"2024-01-16",status:"received",volume:10,concentration:85.3,quality:"excellent"},{id:"3",sampleCode:"S003",sampleName:"植物样本C",sampleType:"植物",projectName:"植物基因组研究",clientName:"农科院",receivedDate:"2024-01-17",status:"received",volume:3.5,concentration:95.8,quality:"good"}],Se=[{id:"1",name:"DNA提取试剂盒",type:"提取试剂",brand:"QIAGEN",catalogNumber:"69504",lotNumber:"LOT001",expiryDate:"2024-12-31",quantity:50,unit:"次",storageCondition:"4°C",cost:25},{id:"2",name:"PCR扩增试剂",type:"扩增试剂",brand:"Thermo Fisher",catalogNumber:"K0171",lotNumber:"LOT002",expiryDate:"2024-10-15",quantity:100,unit:"反应",storageCondition:"-20°C",cost:15},{id:"3",name:"文库构建试剂盒",type:"文库试剂",brand:"Illumina",catalogNumber:"20020595",lotNumber:"LOT003",expiryDate:"2024-08-30",quantity:24,unit:"样本",storageCondition:"-20°C",cost:120}],Te=[{id:"1",name:"离心机A",model:"Centrifuge 5424R",type:"离心机",status:"available",location:"实验室A",capacity:24,currentLoad:0,nextAvailable:"2024-01-20 09:00:00"},{id:"2",name:"PCR仪B",model:"T100 Thermal Cycler",type:"PCR仪",status:"busy",location:"实验室B",capacity:96,currentLoad:48,nextAvailable:"2024-01-21 14:00:00"},{id:"3",name:"测序仪C",model:"NovaSeq 6000",type:"测序仪",status:"available",location:"测序中心",capacity:4,currentLoad:0,nextAvailable:"2024-01-22 08:00:00"}],Ne=[{id:"1",batchCode:"BATCH001",batchName:"环境样本前处理批次",experimentType:"preprocessing",status:"in_progress",sampleCount:12,samples:we.slice(0,2),reagents:Se.slice(0,1),equipment:Te.slice(0,1),operator:"张三",plannedStartDate:"2024-01-20",plannedEndDate:"2024-01-22",actualStartDate:"2024-01-20",estimatedDuration:48,priority:"high",notes:"紧急项目，需要优先处理",createdBy:"李四",createdTime:"2024-01-19 10:00:00",updatedTime:"2024-01-20 09:30:00",protocol:"DNA提取标准流程v2.1",qualityRequirements:["DNA浓度>50ng/μL","OD260/280比值1.8-2.0"],costEstimate:1250,progress:65}];t.useEffect(()=>{Ye(),ke(),qe(),Me()},[]);const Ye=async()=>{W(!0);try{await new Promise(e=>setTimeout(e,1e3)),G(Ne)}catch(e){s.error("加载批次数据失败")}finally{W(!1)}},ke=async()=>{try{await new Promise(e=>setTimeout(e,500)),U(we)}catch(e){s.error("加载样本数据失败")}},qe=async()=>{try{await new Promise(e=>setTimeout(e,500)),Z(Se)}catch(e){s.error("加载试剂数据失败")}},Me=async()=>{try{await new Promise(e=>setTimeout(e,500)),te(Te)}catch(e){s.error("加载设备数据失败")}},Ae=Q.filter(e=>{const t=!ge||e.batchName.toLowerCase().includes(ge.toLowerCase())||e.batchCode.toLowerCase().includes(ge.toLowerCase())||e.operator.toLowerCase().includes(ge.toLowerCase()),a=!ve||e.status===ve,s=!Ce||e.experimentType===Ce;return t&&a&&s}),Ee=t=>{const a={draft:{color:"default",text:"草稿"},planning:{color:"processing",text:"规划中"},ready:{color:"success",text:"就绪"},in_progress:{color:"processing",text:"进行中"},completed:{color:"success",text:"已完成"},cancelled:{color:"error",text:"已取消"}}[t];return e.jsx(T,{color:a.color,children:a.text})},Le=t=>{const a={preprocessing:{color:"blue",text:"前处理"},library_construction:{color:"green",text:"文库构建"},sequencing:{color:"purple",text:"测序"},analysis:{color:"orange",text:"分析"}}[t];return e.jsx(T,{color:a.color,children:a.text})},ze=t=>{const a={low:{color:"default",text:"低"},medium:{color:"processing",text:"中"},high:{color:"warning",text:"高"},urgent:{color:"error",text:"紧急"}}[t];return e.jsx(T,{color:a.color,children:a.text})},Fe=[{title:"批次编号",dataIndex:"batchCode",key:"batchCode",width:120,render:t=>e.jsx(O,{strong:!0,children:t})},{title:"批次名称",dataIndex:"batchName",key:"batchName",width:200,ellipsis:!0},{title:"实验类型",dataIndex:"experimentType",key:"experimentType",width:100,render:Le},{title:"状态",dataIndex:"status",key:"status",width:100,render:Ee},{title:"样本数量",dataIndex:"sampleCount",key:"sampleCount",width:100,render:t=>e.jsx(M,{count:t,showZero:!0,color:"blue"})},{title:"优先级",dataIndex:"priority",key:"priority",width:80,render:ze},{title:"操作员",dataIndex:"operator",key:"operator",width:100},{title:"计划开始",dataIndex:"plannedStartDate",key:"plannedStartDate",width:120,render:e=>h(e).format("MM-DD")},{title:"进度",dataIndex:"progress",key:"progress",width:120,render:t=>e.jsx(A,{percent:t,size:"small",status:100===t?"success":"active"})},{title:"成本估算",dataIndex:"costEstimate",key:"costEstimate",width:100,render:e=>`¥${e.toFixed(0)}`},{title:"操作",key:"action",width:150,fixed:"right",render:(t,a)=>e.jsxs(c,{size:"small",children:[e.jsx(E,{title:"查看详情",children:e.jsx(o,{type:"text",icon:e.jsx(L,{}),onClick:()=>Be(a)})}),e.jsx(E,{title:"编辑",children:e.jsx(o,{type:"text",icon:e.jsx(z,{}),onClick:()=>$e(a)})}),e.jsx(E,{title:"删除",children:e.jsx(o,{type:"text",danger:!0,icon:e.jsx(F,{}),onClick:()=>Pe(a)})})]})}],$e=e=>{ce(e),he(e.samples.map(e=>e.id)),ue(e.reagents.map(e=>e.id)),ye(e.equipment.map(e=>e.id)),fe.setFieldsValue({batchName:e.batchName,experimentType:e.experimentType,priority:e.priority,operator:e.operator,plannedStartDate:h(e.plannedStartDate),plannedEndDate:h(e.plannedEndDate),protocol:e.protocol,notes:e.notes}),re(!0)},Be=e=>{se(e),ne(!0)},Pe=e=>{p.confirm({title:"确认删除",content:`确定要删除批次 "${e.batchName}" 吗？`,onOk:async()=>{try{await new Promise(e=>setTimeout(e,500)),G(t=>t.filter(t=>t.id!==e.id)),s.success("删除成功")}catch(t){s.error("删除失败")}}})},He=e=>{me(e)},_e=J.map(e=>({key:e.id,title:`${e.sampleCode} - ${e.sampleName}`,description:`${e.sampleType} | ${e.projectName}`,disabled:"received"!==e.status}));return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(l,{gutter:16,style:{marginBottom:16},children:[e.jsx(r,{span:6,children:e.jsx(i,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1890ff"},children:Q.length}),e.jsx("div",{style:{color:"#666",marginTop:4},children:"总批次数"})]})})}),e.jsx(r,{span:6,children:e.jsx(i,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:Q.filter(e=>"in_progress"===e.status).length}),e.jsx("div",{style:{color:"#666",marginTop:4},children:"进行中"})]})})}),e.jsx(r,{span:6,children:e.jsx(i,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#faad14"},children:Q.filter(e=>"ready"===e.status).length}),e.jsx("div",{style:{color:"#666",marginTop:4},children:"待开始"})]})})}),e.jsx(r,{span:6,children:e.jsx(i,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#722ed1"},children:Q.reduce((e,t)=>e+t.sampleCount,0)}),e.jsx("div",{style:{color:"#666",marginTop:4},children:"总样本数"})]})})})]}),e.jsx(i,{size:"small",style:{marginBottom:16},children:e.jsxs(l,{gutter:16,align:"middle",children:[e.jsx(r,{span:6,children:e.jsx($,{placeholder:"搜索批次名称、编号或操作员",value:ge,onChange:e=>be(e.target.value),onSearch:Ye})}),e.jsx(r,{span:3,children:e.jsxs(d,{placeholder:"状态筛选",value:ve,onChange:Ie,allowClear:!0,style:{width:"100%"},children:[e.jsx(B,{value:"draft",children:"草稿"}),e.jsx(B,{value:"planning",children:"规划中"}),e.jsx(B,{value:"ready",children:"就绪"}),e.jsx(B,{value:"in_progress",children:"进行中"}),e.jsx(B,{value:"completed",children:"已完成"}),e.jsx(B,{value:"cancelled",children:"已取消"})]})}),e.jsx(r,{span:3,children:e.jsxs(d,{placeholder:"实验类型",value:Ce,onChange:De,allowClear:!0,style:{width:"100%"},children:[e.jsx(B,{value:"preprocessing",children:"前处理"}),e.jsx(B,{value:"library_construction",children:"文库构建"}),e.jsx(B,{value:"sequencing",children:"测序"}),e.jsx(B,{value:"analysis",children:"分析"})]})}),e.jsx(r,{span:8,children:e.jsxs(c,{children:[e.jsx(o,{type:"primary",icon:e.jsx(m,{}),onClick:()=>{ce(null),me(0),he([]),ue([]),ye([]),fe.resetFields(),re(!0)},children:"创建批次"}),e.jsx(o,{onClick:Ye,loading:R,children:"刷新数据"})]})})]})}),e.jsx(i,{title:"实验批次列表",size:"small",children:e.jsx(x,{columns:Fe,dataSource:Ae,rowKey:"id",loading:R,scroll:{x:1600},pagination:{total:Ae.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}),e.jsxs(p,{title:de?"编辑实验批次":"创建实验批次",open:le,onCancel:()=>re(!1),footer:null,width:1e3,destroyOnClose:!0,children:[e.jsxs(u,{current:oe,style:{marginBottom:24},children:[e.jsx(H,{title:"基本信息",icon:e.jsx(j,{})}),e.jsx(H,{title:"样本选择",icon:e.jsx(y,{})}),e.jsx(H,{title:"资源配置",icon:e.jsx(g,{})}),e.jsx(H,{title:"确认创建",icon:e.jsx(b,{})})]}),e.jsxs(a,{form:fe,layout:"vertical",onFinish:async e=>{try{if(0===xe.length)return void s.error("请至少选择一个样本");await new Promise(e=>setTimeout(e,1e3));const t=J.filter(e=>xe.includes(e.id)),a=X.filter(e=>pe.includes(e.id)),l=ee.filter(e=>je.includes(e.id)),r=a.reduce((e,t)=>e+t.cost,0)*xe.length;if(de){const i={...de,...e,samples:t,reagents:a,equipment:l,sampleCount:xe.length,costEstimate:r,updatedTime:h().format("YYYY-MM-DD HH:mm:ss"),plannedStartDate:e.plannedStartDate.format("YYYY-MM-DD"),plannedEndDate:e.plannedEndDate.format("YYYY-MM-DD")};G(e=>e.map(e=>e.id===de.id?i:e)),s.success("更新成功")}else{const i={id:Date.now().toString(),batchCode:`BATCH${String(Date.now()).slice(-6)}`,...e,samples:t,reagents:a,equipment:l,sampleCount:xe.length,status:"draft",costEstimate:r,progress:0,createdBy:"当前用户",createdTime:h().format("YYYY-MM-DD HH:mm:ss"),updatedTime:h().format("YYYY-MM-DD HH:mm:ss"),plannedStartDate:e.plannedStartDate.format("YYYY-MM-DD"),plannedEndDate:e.plannedEndDate.format("YYYY-MM-DD")};G(e=>[...e,i]),s.success("创建成功")}re(!1),fe.resetFields()}catch(t){s.error("保存失败")}},children:[0===oe&&e.jsxs("div",{children:[e.jsxs(l,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"batchName",label:"批次名称",rules:[{required:!0,message:"请输入批次名称"}],children:e.jsx(n,{placeholder:"请输入批次名称"})})}),e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"experimentType",label:"实验类型",rules:[{required:!0,message:"请选择实验类型"}],children:e.jsxs(d,{placeholder:"请选择实验类型",children:[e.jsx(B,{value:"preprocessing",children:"前处理"}),e.jsx(B,{value:"library_construction",children:"文库构建"}),e.jsx(B,{value:"sequencing",children:"测序"}),e.jsx(B,{value:"analysis",children:"分析"})]})})})]}),e.jsxs(l,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"priority",label:"优先级",rules:[{required:!0,message:"请选择优先级"}],children:e.jsxs(d,{placeholder:"请选择优先级",children:[e.jsx(B,{value:"low",children:"低"}),e.jsx(B,{value:"medium",children:"中"}),e.jsx(B,{value:"high",children:"高"}),e.jsx(B,{value:"urgent",children:"紧急"})]})})}),e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"operator",label:"操作员",rules:[{required:!0,message:"请输入操作员"}],children:e.jsx(n,{placeholder:"请输入操作员姓名"})})})]}),e.jsxs(l,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"plannedStartDate",label:"计划开始日期",rules:[{required:!0,message:"请选择计划开始日期"}],children:e.jsx(v,{style:{width:"100%"}})})}),e.jsx(r,{span:12,children:e.jsx(a.Item,{name:"plannedEndDate",label:"计划结束日期",rules:[{required:!0,message:"请选择计划结束日期"}],children:e.jsx(v,{style:{width:"100%"}})})})]}),e.jsx(a.Item,{name:"protocol",label:"实验协议",children:e.jsx(n,{placeholder:"请输入实验协议名称或版本"})}),e.jsx(a.Item,{name:"notes",label:"备注",children:e.jsx(P,{rows:3,placeholder:"请输入备注信息"})})]}),1===oe&&e.jsxs("div",{children:[e.jsx(I,{message:"样本选择",description:"从已接收的样本中选择需要进行实验的样本。只有状态为'已接收'的样本可以被选择。",type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(C,{dataSource:_e,targetKeys:xe,onChange:he,render:e=>e.title,titles:["可选样本","已选样本"],listStyle:{width:400,height:400},showSearch:!0,searchPlaceholder:"搜索样本"}),e.jsx("div",{style:{marginTop:16},children:e.jsxs(O,{strong:!0,children:["已选择样本数量: ",xe.length]})})]}),2===oe&&e.jsx("div",{children:e.jsxs(f,{defaultActiveKey:"reagents",children:[e.jsx(_,{tab:"试剂配置",children:e.jsx(w,{dataSource:X,renderItem:t=>e.jsx(w.Item,{actions:[e.jsx(S,{checked:pe.includes(t.id),onChange:e=>{e.target.checked?ue([...pe,t.id]):ue(pe.filter(e=>e!==t.id))},children:"选择"})],children:e.jsx(w.Item.Meta,{title:t.name,description:e.jsxs("div",{children:[e.jsxs("div",{children:["品牌: ",t.brand," | 货号: ",t.catalogNumber]}),e.jsxs("div",{children:["批号: ",t.lotNumber," | 有效期: ",t.expiryDate]}),e.jsxs("div",{children:["库存: ",t.quantity," ",t.unit," | 单价: ¥",t.cost]})]})})})})},"reagents"),e.jsx(_,{tab:"设备配置",children:e.jsx(w,{dataSource:ee,renderItem:t=>e.jsx(w.Item,{actions:[e.jsx(S,{checked:je.includes(t.id),onChange:e=>{e.target.checked?ye([...je,t.id]):ye(je.filter(e=>e!==t.id))},disabled:"available"!==t.status,children:"选择"})],children:e.jsx(w.Item.Meta,{avatar:e.jsx(N,{icon:e.jsx(Y,{})}),title:e.jsxs("div",{children:[t.name,e.jsx(T,{color:"available"===t.status?"green":"red",style:{marginLeft:8},children:"available"===t.status?"可用":"忙碌"})]}),description:e.jsxs("div",{children:[e.jsxs("div",{children:["型号: ",t.model," | 位置: ",t.location]}),e.jsxs("div",{children:["容量: ",t.capacity," | 当前负载: ",t.currentLoad]}),e.jsxs("div",{children:["下次可用: ",t.nextAvailable]})]})})})})},"equipment")]})}),3===oe&&e.jsxs("div",{children:[e.jsx(I,{message:"批次信息确认",description:"请确认以下批次信息无误后提交创建。",type:"success",showIcon:!0,style:{marginBottom:16}}),e.jsxs(k,{bordered:!0,column:2,children:[e.jsx(k.Item,{label:"批次名称",children:fe.getFieldValue("batchName")}),e.jsx(k.Item,{label:"实验类型",children:fe.getFieldValue("experimentType")}),e.jsx(k.Item,{label:"优先级",children:fe.getFieldValue("priority")}),e.jsx(k.Item,{label:"操作员",children:fe.getFieldValue("operator")}),e.jsx(k.Item,{label:"计划开始",children:null==(D=fe.getFieldValue("plannedStartDate"))?void 0:D.format("YYYY-MM-DD")}),e.jsx(k.Item,{label:"计划结束",children:null==(K=fe.getFieldValue("plannedEndDate"))?void 0:K.format("YYYY-MM-DD")}),e.jsxs(k.Item,{label:"样本数量",children:[xe.length," 个"]}),e.jsxs(k.Item,{label:"试剂数量",children:[pe.length," 种"]}),e.jsxs(k.Item,{label:"设备数量",children:[je.length," 台"]}),e.jsxs(k.Item,{label:"成本估算",children:["¥",(X.filter(e=>pe.includes(e.id)).reduce((e,t)=>e+t.cost,0)*xe.length).toFixed(2)]})]})]}),e.jsx("div",{style:{marginTop:24,textAlign:"right"},children:e.jsxs(c,{children:[oe>0&&e.jsx(o,{onClick:()=>He(oe-1),children:"上一步"}),oe<3&&e.jsx(o,{type:"primary",onClick:()=>He(oe+1),children:"下一步"}),3===oe&&e.jsx(o,{type:"primary",htmlType:"submit",loading:R,children:de?"更新批次":"创建批次"}),e.jsx(o,{onClick:()=>re(!1),children:"取消"})]})})]})]}),e.jsx(p,{title:"批次详情",open:ie,onCancel:()=>ne(!1),footer:[e.jsx(o,{onClick:()=>ne(!1),children:"关闭"},"close")],width:800,children:ae&&e.jsxs(f,{defaultActiveKey:"basic",children:[e.jsx(_,{tab:"基本信息",children:e.jsxs(k,{bordered:!0,column:2,children:[e.jsx(k.Item,{label:"批次编号",children:ae.batchCode}),e.jsx(k.Item,{label:"批次名称",children:ae.batchName}),e.jsx(k.Item,{label:"实验类型",children:Le(ae.experimentType)}),e.jsx(k.Item,{label:"状态",children:Ee(ae.status)}),e.jsx(k.Item,{label:"优先级",children:ze(ae.priority)}),e.jsx(k.Item,{label:"操作员",children:ae.operator}),e.jsx(k.Item,{label:"样本数量",children:ae.sampleCount}),e.jsxs(k.Item,{label:"进度",children:[ae.progress,"%"]}),e.jsx(k.Item,{label:"计划开始",children:ae.plannedStartDate}),e.jsx(k.Item,{label:"计划结束",children:ae.plannedEndDate}),e.jsxs(k.Item,{label:"成本估算",children:["¥",ae.costEstimate.toFixed(2)]}),e.jsx(k.Item,{label:"创建时间",children:ae.createdTime}),e.jsx(k.Item,{label:"备注",span:2,children:ae.notes||"无"})]})},"basic"),e.jsx(_,{tab:"样本清单",children:e.jsx(x,{dataSource:ae.samples,columns:[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode"},{title:"样本名称",dataIndex:"sampleName",key:"sampleName"},{title:"样本类型",dataIndex:"sampleType",key:"sampleType"},{title:"项目名称",dataIndex:"projectName",key:"projectName"},{title:"体积",dataIndex:"volume",key:"volume",render:e=>`${e} mL`},{title:"浓度",dataIndex:"concentration",key:"concentration",render:e=>e?`${e} ng/μL`:"-"}],rowKey:"id",size:"small",pagination:!1})},"samples"),e.jsx(_,{tab:"资源配置",children:e.jsxs("div",{children:[e.jsx(V,{level:5,children:"试剂清单"}),e.jsx(w,{dataSource:ae.reagents,renderItem:t=>e.jsxs(w.Item,{children:[e.jsx(w.Item.Meta,{title:t.name,description:`${t.brand} | ${t.catalogNumber} | 批号: ${t.lotNumber}`}),e.jsxs("div",{children:["¥",t.cost]})]})}),e.jsx(q,{}),e.jsx(V,{level:5,children:"设备清单"}),e.jsx(w,{dataSource:ae.equipment,renderItem:t=>e.jsxs(w.Item,{children:[e.jsx(w.Item.Meta,{title:t.name,description:`${t.model} | ${t.location}`}),e.jsx(T,{color:"green",children:"可用"})]})})]})},"resources")]})})]})};export{K as default};
