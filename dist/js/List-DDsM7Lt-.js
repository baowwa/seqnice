import{j as e}from"./index-DyvGJ5NW.js";import{u as a,a as t}from"./react-vendor-DKSb2WWV.js";import{S as o,a as s,a1 as i,ad as l,a2 as r,a3 as n,a4 as c,B as d,s as m,W as p}from"./antd-vendor-CqkZOb36.js";const u=()=>{a();const u="sample_list",[h,v]=t.useState([]),[g,y]=t.useState("pending"),[x,j]=t.useState(""),[S,w]=t.useState(void 0),[T,C]=t.useState(void 0),k=()=>{const e=new Date,a=e=>e<10?`0${e}`:`${e}`,t=t=>(e=>`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())} ${a(e.getHours())}:${a(e.getMinutes())}`)(new Date(e.getTime()-3600*t*1e3)),o=[{id:1,sampleBarcode:"SB202411010001",sampleName:"A0001-张三",sampleCode:"A0001",sampleType:"血液",source:"门诊",collectionTime:t(30),receiveTime:t(28),receiver:"王五",projectName:"肿瘤NGS Panel",methodology:"NGS-Panel",receiveStatus:"pending"},{id:2,sampleBarcode:"SB202411010002",sampleName:"A0002-李四",sampleCode:"A0002",sampleType:"组织",source:"住院",collectionTime:t(50),receiveTime:t(45),receiver:"赵六",projectName:"外显子组 WES",methodology:"WES",receiveStatus:"pending"},{id:3,sampleBarcode:"SB202411010003",sampleName:"A0003-王小",sampleCode:"A0003",sampleType:"唾液",source:"外送",collectionTime:t(20),receiveTime:t(18),receiver:"管理员",projectName:"转录组 RNA-Seq",methodology:"RNA-Seq",receiveStatus:"review"},{id:4,sampleBarcode:"SB202411010004",sampleName:"A0004-陈强",sampleCode:"A0004",sampleType:"血液",source:"门诊",collectionTime:t(10),receiveTime:t(8),receiver:"王五",projectName:"遗传病Panel",methodology:"NGS-Panel",receiveStatus:"done"},{id:5,sampleBarcode:"SB202411010005",sampleName:"A0005-刘敏",sampleCode:"A0005",sampleType:"组织",source:"住院",collectionTime:t(60),receiveTime:t(55),receiver:"赵六",projectName:"外显子组 WES",methodology:"WES",receiveStatus:"done"},{id:6,sampleBarcode:"SB202411010006",sampleName:"A0006-周静",sampleCode:"A0006",sampleType:"唾液",source:"外送",collectionTime:t(26),receiveTime:t(24),receiver:"管理员",projectName:"转录组 RNA-Seq",methodology:"RNA-Seq",receiveStatus:"error"}];localStorage.setItem(u,JSON.stringify(o)),v(o),m.success("已载入样本Mock数据")};t.useEffect(()=>{(()=>{try{const e=localStorage.getItem(u),a=e?JSON.parse(e):[];if(Array.isArray(a)&&a.length>0){const e=a.map(e=>{const a=e.receiveStatus||("启用"===e.status?"done":void 0)||(e.receiveTime?"done":"pending");return{...e,receiveStatus:a}});v(e)}else k()}catch(e){m.error("读取本地样本数据失败")}})()},[]);const N=t.useMemo(()=>h.filter(e=>{const a=(e.receiveStatus||"pending")===g,t=!x||[e.sampleBarcode,e.sampleName,e.sampleCode,e.projectName,e.sampleType,e.source].filter(Boolean).some(e=>String(e).toLowerCase().includes(x.toLowerCase())),o=!S||e.sampleType===S,s=!T||(()=>{var a,t;const o=e.receiveTime?new Date(e.receiveTime).getTime():0,s=null==(a=T[0])?void 0:a.toDate().getTime(),i=null==(t=T[1])?void 0:t.toDate().getTime();return o>=s&&o<=i})();return a&&t&&o&&s}),[h,g,x,S,T]),B=t.useMemo(()=>{const e={pending:0,review:0,done:0,error:0};return h.forEach(a=>{const t=a.receiveStatus||"pending";e[t]=(e[t]||0)+1}),e},[h]),A=[{title:"样本条码",dataIndex:"sampleBarcode",key:"sampleBarcode",width:160,fixed:"left"},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:160},{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:120},{title:"样本类型",dataIndex:"sampleType",key:"sampleType",width:100},{title:"样本来源",dataIndex:"source",key:"source",width:100},{title:"采集时间",dataIndex:"collectionTime",key:"collectionTime",width:180,render:e=>e||"—"},{title:"接收时间",dataIndex:"receiveTime",key:"receiveTime",width:180,render:e=>e||"—"},{title:"接收人",dataIndex:"receiver",key:"receiver",width:100},{title:"检验项目",dataIndex:"projectName",key:"projectName",width:180},{title:"方法学",dataIndex:"methodology",key:"methodology",width:120},{title:"操作",key:"action",width:200,fixed:"right",render:(a,t)=>e.jsxs(o,{children:[e.jsx(d,{size:"small",onClick:()=>{const e=`/sample/receiving?mode=single&sampleCode=${encodeURIComponent(t.sampleCode||"")}`;window.open(e,"_blank")},children:"编辑"}),e.jsx(d,{size:"small",danger:!0,children:"停用"})]})}],f=e=>{const a=`/sample/receiving?mode=${e}`;window.open(a,"_blank")};return e.jsx(o,{direction:"vertical",style:{width:"100%"},children:e.jsxs(s,{title:"样本列表",extra:e.jsxs(o,{children:[e.jsx(d,{type:"primary",onClick:()=>f("single"),children:"单个录入"}),e.jsx(d,{onClick:()=>f("scan"),children:"扫码录入"}),e.jsx(d,{onClick:()=>f("table"),children:"批量表格录入"}),e.jsx(d,{onClick:()=>f("batch"),children:"批量导入"})]}),variant:"outlined",children:[e.jsx(i,{activeKey:g,onChange:e=>y(e),items:[{key:"pending",label:e.jsxs("span",{children:["待处理 ",e.jsx(l,{count:B.pending,showZero:!0})]})},{key:"review",label:e.jsxs("span",{children:["待审核 ",e.jsx(l,{count:B.review,showZero:!0})]})},{key:"done",label:e.jsxs("span",{children:["已处理 ",e.jsx(l,{count:B.done,showZero:!0})]})},{key:"error",label:e.jsxs("span",{children:["异常 ",e.jsx(l,{count:B.error,showZero:!0})]})}]}),e.jsxs(o,{wrap:!0,style:{marginBottom:12},children:[e.jsx(r,{placeholder:"搜索：编号/项目/类型/来源",allowClear:!0,style:{width:260},value:x,onChange:e=>j(e.target.value)}),e.jsx(n,{placeholder:"样本类型",allowClear:!0,style:{width:160},value:S,onChange:w,options:[{label:"血液",value:"血液"},{label:"组织",value:"组织"},{label:"唾液",value:"唾液"}]}),e.jsx(c.RangePicker,{value:T,onChange:C}),e.jsx(d,{type:"primary",onClick:()=>{m.success("已按当前筛选条件查询")},children:"查询"}),e.jsx(d,{onClick:()=>{j(""),w(void 0),C(void 0),y("pending"),m.success("已重置查询条件")},children:"重置"}),e.jsx(d,{onClick:k,children:"重置Mock数据"})]}),e.jsx(p,{rowKey:e=>e.id||e.sampleBarcode||e.sampleCode,dataSource:N,columns:A,pagination:{pageSize:10},size:"small",scroll:{x:"max-content",y:420}})]})})};export{u as default};
