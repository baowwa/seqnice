import{j as e}from"./index-B0AWbMnF.js";import{r as s}from"./react-vendor-By8n_QN6.js";import{_ as t,c as l,e as i,a,P as r,F as n,Q as c,Y as o,o as d,af as x,a0 as u,ag as m,a1 as h,B as p,a2 as j,U as g,N as y,a3 as v,al as f,ap as q,ah as w,W as b,av as S,X as I,ae as C,aw as T,A as _,ad as z,S as N,a7 as A,a9 as k,ax as M,ar as P,aa as Y,ab as D,ac as R,s as $}from"./antd-vendor-BtuZ_fxs.js";const{Search:L}=u,{Option:B}=h,{TextArea:G}=u,{TabPane:H}=q,F=()=>{const[F,O]=s.useState(!1),[K,Q]=s.useState([]),[W,E]=s.useState(null),[X,J]=s.useState(!1),[U,V]=s.useState(!1),[Z,ee]=s.useState(!1),[se,te]=s.useState(null),[le,ie]=s.useState(""),[ae,re]=s.useState(""),[ne,ce]=s.useState(""),[oe,de]=s.useState(""),[xe]=t.useForm(),ue=[{id:"1",sampleCode:"S2024001",sampleName:"土壤样本A",libraryType:"dna_seq",platform:"illumina_novaseq",protocol:"TruSeq DNA PCR-Free",status:"in_progress",progress:75,startTime:"2024-01-15 09:00:00",operator:"张三",barcodeIndex:"ATCACG",insertSize:350,concentration:15.8,volume:50,molarity:4.2,qualityScore:88,readLength:150,expectedYield:30,actualYield:28.5,notes:"文库质量良好，符合测序要求"},{id:"2",sampleCode:"S2024002",sampleName:"水体样本B",libraryType:"rna_seq",platform:"illumina_hiseq",protocol:"TruSeq Stranded mRNA",status:"completed",progress:100,startTime:"2024-01-14 08:30:00",endTime:"2024-01-14 18:00:00",operator:"李四",barcodeIndex:"CGATGT",insertSize:200,concentration:22.3,volume:40,molarity:6.8,qualityScore:95,readLength:100,expectedYield:25,actualYield:26.8,notes:"RNA完整性优秀，文库构建成功"},{id:"3",sampleCode:"S2024003",sampleName:"植物样本C",libraryType:"wgs",platform:"nanopore",protocol:"Ligation Sequencing Kit",status:"quality_check",progress:90,startTime:"2024-01-13 10:00:00",operator:"王五",barcodeIndex:"TTAGGC",insertSize:8e3,concentration:8.5,volume:75,molarity:2.1,qualityScore:82,readLength:1e4,expectedYield:15,notes:"长片段文库，正在进行质量检测"}];s.useEffect(()=>{me()},[]);const me=async()=>{O(!0);try{await new Promise(e=>setTimeout(e,1e3)),Q(ue)}catch(e){}finally{O(!1)}},he=e=>({dna_seq:"DNA测序",rna_seq:"RNA测序",chip_seq:"ChIP测序",atac_seq:"ATAC测序",wgs:"全基因组测序",wes:"全外显子测序",amplicon:"扩增子测序"}[e]),pe=e=>({dna_seq:"blue",rna_seq:"green",chip_seq:"orange",atac_seq:"purple",wgs:"cyan",wes:"magenta",amplicon:"gold"}[e]),je=e=>({illumina_novaseq:"Illumina NovaSeq",illumina_hiseq:"Illumina HiSeq",illumina_miseq:"Illumina MiSeq",nanopore:"Oxford Nanopore",pacbio:"PacBio"}[e]),ge=e=>({pending:"default",in_progress:"processing",completed:"success",failed:"error",quality_check:"warning"}[e]),ye=e=>({pending:"待构建",in_progress:"构建中",completed:"已完成",failed:"失败",quality_check:"质检中"}[e]),ve=e=>e>=90?{text:"优秀",color:"success"}:e>=80?{text:"良好",color:"processing"}:e>=70?{text:"合格",color:"warning"}:{text:"不合格",color:"error"},fe=K.filter(e=>{const s=!le||e.sampleCode.toLowerCase().includes(le.toLowerCase())||e.sampleName.toLowerCase().includes(le.toLowerCase())||e.protocol.toLowerCase().includes(le.toLowerCase()),t=!ae||e.status===ae,l=!ne||e.libraryType===ne,i=!oe||e.platform===oe;return s&&t&&l&&i}),qe=[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:120,fixed:"left"},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:150,ellipsis:!0},{title:"文库类型",dataIndex:"libraryType",key:"libraryType",width:120,render:s=>e.jsx(b,{color:pe(s),icon:e.jsx(n,{}),children:he(s)})},{title:"测序平台",dataIndex:"platform",key:"platform",width:140,render:s=>e.jsx(b,{color:"blue",children:je(s)})},{title:"条码索引",dataIndex:"barcodeIndex",key:"barcodeIndex",width:100,render:s=>e.jsx(b,{icon:e.jsx(S,{}),children:s})},{title:"状态",dataIndex:"status",key:"status",width:100,render:s=>e.jsx(b,{color:ge(s),children:ye(s)})},{title:"进度",dataIndex:"progress",key:"progress",width:120,render:(s,t)=>e.jsx(I,{percent:s,size:"small",status:"failed"===t.status?"exception":"active"})},{title:"浓度",dataIndex:"concentration",key:"concentration",width:100,render:e=>`${e} ng/μl`},{title:"质量评分",dataIndex:"qualityScore",key:"qualityScore",width:100,render:s=>{const t=ve(s);return e.jsxs(b,{color:t.color,children:[s,"分 (",t.text,")"]})}},{title:"插入片段",dataIndex:"insertSize",key:"insertSize",width:100,render:e=>`${e} bp`},{title:"操作人",dataIndex:"operator",key:"operator",width:100},{title:"开始时间",dataIndex:"startTime",key:"startTime",width:150,render:e=>y(e).format("MM-DD HH:mm")},{title:"操作",key:"action",width:200,fixed:"right",render:(s,t)=>e.jsxs(N,{size:"small",children:[e.jsx(A,{title:"查看详情",children:e.jsx(p,{type:"text",icon:e.jsx(k,{}),onClick:()=>(e=>{E(e),V(!0)})(t)})}),e.jsx(A,{title:"质量检测",children:e.jsx(p,{type:"text",icon:e.jsx(M,{}),onClick:()=>(e=>{E(e),ee(!0)})(t)})}),"pending"===t.status&&e.jsx(A,{title:"开始构建",children:e.jsx(p,{type:"text",icon:e.jsx(P,{}),onClick:()=>(async e=>{try{await new Promise(e=>setTimeout(e,500)),Q(s=>s.map(s=>s.id===e?{...s,status:"in_progress"}:s)),$.success("开始构建文库")}catch(s){$.error("操作失败")}})(t.id)})}),"in_progress"===t.status&&e.jsx(A,{title:"完成构建",children:e.jsx(p,{type:"text",icon:e.jsx(o,{}),onClick:()=>(async e=>{try{await new Promise(e=>setTimeout(e,500)),Q(s=>s.map(s=>s.id===e?{...s,status:"completed",progress:100,endTime:y().format("YYYY-MM-DD HH:mm:ss")}:s)),$.success("文库构建完成")}catch(s){$.error("操作失败")}})(t.id)})}),e.jsx(A,{title:"编辑",children:e.jsx(p,{type:"text",icon:e.jsx(Y,{}),onClick:()=>(e=>{te(e),xe.setFieldsValue(e),J(!0)})(t)})}),e.jsx(D,{title:"确定要删除这条记录吗？",onConfirm:()=>(async e=>{try{await new Promise(e=>setTimeout(e,500)),Q(s=>s.filter(s=>s.id!==e)),$.success("删除成功")}catch(s){$.error("删除失败")}})(t.id),children:e.jsx(A,{title:"删除",children:e.jsx(p,{type:"text",danger:!0,icon:e.jsx(R,{})})})})]})}];return e.jsxs("div",{children:[e.jsxs(l,{gutter:16,style:{marginBottom:16},children:[e.jsx(i,{span:6,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"总文库数",value:K.length,prefix:e.jsx(n,{})})})}),e.jsx(i,{span:6,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"构建中",value:K.filter(e=>"in_progress"===e.status).length,valueStyle:{color:"#1890ff"},prefix:e.jsx(c,{})})})}),e.jsx(i,{span:6,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"已完成",value:K.filter(e=>"completed"===e.status).length,valueStyle:{color:"#3f8600"},prefix:e.jsx(o,{})})})}),e.jsx(i,{span:6,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"质检中",value:K.filter(e=>"quality_check"===e.status).length,valueStyle:{color:"#faad14"},prefix:e.jsx(d,{})})})})]}),K.some(e=>"failed"===e.status)&&e.jsx(x,{message:"发现构建失败的文库",description:`有 ${K.filter(e=>"failed"===e.status).length} 个文库构建失败，请检查并重新构建`,type:"error",showIcon:!0,closable:!0,style:{marginBottom:16}}),e.jsx(a,{size:"small",style:{marginBottom:16},children:e.jsxs(l,{gutter:16,children:[e.jsx(i,{span:6,children:e.jsx(L,{placeholder:"搜索样本编号、名称或协议",value:le,onChange:e=>ie(e.target.value),onSearch:me,enterButton:e.jsx(m,{})})}),e.jsx(i,{span:3,children:e.jsxs(h,{placeholder:"状态筛选",value:ae,onChange:re,allowClear:!0,style:{width:"100%"},children:[e.jsx(B,{value:"pending",children:"待构建"}),e.jsx(B,{value:"in_progress",children:"构建中"}),e.jsx(B,{value:"completed",children:"已完成"}),e.jsx(B,{value:"failed",children:"失败"}),e.jsx(B,{value:"quality_check",children:"质检中"})]})}),e.jsx(i,{span:3,children:e.jsxs(h,{placeholder:"文库类型",value:ne,onChange:ce,allowClear:!0,style:{width:"100%"},children:[e.jsx(B,{value:"dna_seq",children:"DNA测序"}),e.jsx(B,{value:"rna_seq",children:"RNA测序"}),e.jsx(B,{value:"chip_seq",children:"ChIP测序"}),e.jsx(B,{value:"atac_seq",children:"ATAC测序"}),e.jsx(B,{value:"wgs",children:"全基因组测序"}),e.jsx(B,{value:"wes",children:"全外显子测序"}),e.jsx(B,{value:"amplicon",children:"扩增子测序"})]})}),e.jsx(i,{span:3,children:e.jsxs(h,{placeholder:"测序平台",value:oe,onChange:de,allowClear:!0,style:{width:"100%"},children:[e.jsx(B,{value:"illumina_novaseq",children:"Illumina NovaSeq"}),e.jsx(B,{value:"illumina_hiseq",children:"Illumina HiSeq"}),e.jsx(B,{value:"illumina_miseq",children:"Illumina MiSeq"}),e.jsx(B,{value:"nanopore",children:"Oxford Nanopore"}),e.jsx(B,{value:"pacbio",children:"PacBio"})]})}),e.jsxs(i,{span:5,children:[e.jsx(p,{type:"primary",icon:e.jsx(j,{}),onClick:()=>{te(null),xe.resetFields(),J(!0)},style:{marginRight:8},children:"新增文库"}),e.jsx(p,{onClick:me,loading:F,children:"刷新"})]})]})}),e.jsx(a,{title:"文库构建列表",size:"small",children:e.jsx(g,{columns:qe,dataSource:fe,rowKey:"id",loading:F,scroll:{x:1800},pagination:{total:fe.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}),e.jsx(v,{title:se?"编辑文库构建":"新增文库构建",open:X,onCancel:()=>J(!1),onOk:()=>xe.submit(),width:800,children:e.jsxs(t,{form:xe,layout:"vertical",onFinish:async e=>{try{if(await new Promise(e=>setTimeout(e,500)),se)Q(s=>s.map(s=>s.id===se.id?{...s,...e}:s)),$.success("更新成功");else{const s={id:Date.now().toString(),...e,status:"pending",progress:0,startTime:y().format("YYYY-MM-DD HH:mm:ss"),operator:"当前用户"};Q(e=>[...e,s]),$.success("添加成功")}J(!1),xe.resetFields()}catch(s){$.error("保存失败")}},children:[e.jsxs(l,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"sampleCode",label:"样本编号",rules:[{required:!0,message:"请输入样本编号"}],children:e.jsx(u,{placeholder:"请输入样本编号"})})}),e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"sampleName",label:"样本名称",rules:[{required:!0,message:"请输入样本名称"}],children:e.jsx(u,{placeholder:"请输入样本名称"})})})]}),e.jsxs(l,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"libraryType",label:"文库类型",rules:[{required:!0,message:"请选择文库类型"}],children:e.jsxs(h,{placeholder:"请选择文库类型",children:[e.jsx(B,{value:"dna_seq",children:"DNA测序"}),e.jsx(B,{value:"rna_seq",children:"RNA测序"}),e.jsx(B,{value:"chip_seq",children:"ChIP测序"}),e.jsx(B,{value:"atac_seq",children:"ATAC测序"}),e.jsx(B,{value:"wgs",children:"全基因组测序"}),e.jsx(B,{value:"wes",children:"全外显子测序"}),e.jsx(B,{value:"amplicon",children:"扩增子测序"})]})})}),e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"platform",label:"测序平台",rules:[{required:!0,message:"请选择测序平台"}],children:e.jsxs(h,{placeholder:"请选择测序平台",children:[e.jsx(B,{value:"illumina_novaseq",children:"Illumina NovaSeq"}),e.jsx(B,{value:"illumina_hiseq",children:"Illumina HiSeq"}),e.jsx(B,{value:"illumina_miseq",children:"Illumina MiSeq"}),e.jsx(B,{value:"nanopore",children:"Oxford Nanopore"}),e.jsx(B,{value:"pacbio",children:"PacBio"})]})})})]}),e.jsxs(l,{gutter:16,children:[e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"protocol",label:"构建协议",rules:[{required:!0,message:"请输入构建协议"}],children:e.jsx(u,{placeholder:"请输入构建协议"})})}),e.jsx(i,{span:12,children:e.jsx(t.Item,{name:"barcodeIndex",label:"条码索引",rules:[{required:!0,message:"请输入条码索引"}],children:e.jsx(u,{placeholder:"如：ATCACG"})})})]}),e.jsxs(l,{gutter:16,children:[e.jsx(i,{span:8,children:e.jsx(t.Item,{name:"insertSize",label:"插入片段大小(bp)",rules:[{required:!0,message:"请输入插入片段大小"}],children:e.jsx(f,{min:50,max:5e4,style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{name:"readLength",label:"读长(bp)",rules:[{required:!0,message:"请输入读长"}],children:e.jsx(f,{min:50,max:1e4,style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{name:"expectedYield",label:"预期产量(Gb)",rules:[{required:!0,message:"请输入预期产量"}],children:e.jsx(f,{min:0,step:.1,style:{width:"100%"}})})})]}),e.jsxs(l,{gutter:16,children:[e.jsx(i,{span:8,children:e.jsx(t.Item,{name:"concentration",label:"浓度(ng/μl)",children:e.jsx(f,{min:0,step:.1,style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{name:"volume",label:"体积(μl)",children:e.jsx(f,{min:0,style:{width:"100%"}})})}),e.jsx(i,{span:8,children:e.jsx(t.Item,{name:"molarity",label:"摩尔浓度(nM)",children:e.jsx(f,{min:0,step:.1,style:{width:"100%"}})})})]}),e.jsx(t.Item,{name:"notes",label:"备注",children:e.jsx(G,{rows:3,placeholder:"请输入备注信息"})})]})}),e.jsx(v,{title:"文库构建详情",open:U,onCancel:()=>V(!1),footer:null,width:900,children:W&&e.jsxs(q,{defaultActiveKey:"1",children:[e.jsx(H,{tab:"基本信息",children:e.jsxs(w,{bordered:!0,size:"small",column:2,children:[e.jsx(w.Item,{label:"样本编号",children:W.sampleCode}),e.jsx(w.Item,{label:"样本名称",children:W.sampleName}),e.jsx(w.Item,{label:"文库类型",children:e.jsx(b,{color:pe(W.libraryType),children:he(W.libraryType)})}),e.jsx(w.Item,{label:"测序平台",children:e.jsx(b,{color:"blue",children:je(W.platform)})}),e.jsx(w.Item,{label:"构建协议",span:2,children:W.protocol}),e.jsx(w.Item,{label:"条码索引",children:e.jsx(b,{icon:e.jsx(S,{}),children:W.barcodeIndex})}),e.jsx(w.Item,{label:"状态",children:e.jsx(b,{color:ge(W.status),children:ye(W.status)})}),e.jsx(w.Item,{label:"进度",children:e.jsx(I,{percent:W.progress,size:"small"})}),e.jsx(w.Item,{label:"操作人",children:W.operator}),e.jsx(w.Item,{label:"开始时间",children:W.startTime}),e.jsx(w.Item,{label:"结束时间",children:W.endTime||"-"})]})},"1"),e.jsxs(H,{tab:"质量参数",children:[e.jsxs(l,{gutter:16,children:[e.jsx(i,{span:8,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"浓度",value:W.concentration,suffix:"ng/μl",precision:1})})}),e.jsx(i,{span:8,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"体积",value:W.volume,suffix:"μl"})})}),e.jsx(i,{span:8,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"摩尔浓度",value:W.molarity,suffix:"nM",precision:1})})})]}),e.jsxs(l,{gutter:16,style:{marginTop:16},children:[e.jsx(i,{span:8,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"插入片段大小",value:W.insertSize,suffix:"bp"})})}),e.jsx(i,{span:8,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"读长",value:W.readLength,suffix:"bp"})})}),e.jsx(i,{span:8,children:e.jsx(a,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold"},children:e.jsxs(b,{color:ve(W.qualityScore).color,children:[W.qualityScore,"分"]})}),e.jsx("div",{style:{color:"#666"},children:"质量评分"})]})})})]}),e.jsxs(l,{gutter:16,style:{marginTop:16},children:[e.jsx(i,{span:12,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"预期产量",value:W.expectedYield,suffix:"Gb",precision:1})})}),e.jsx(i,{span:12,children:e.jsx(a,{size:"small",children:e.jsx(r,{title:"实际产量",value:W.actualYield||0,suffix:"Gb",precision:1,valueStyle:{color:W.actualYield&&W.actualYield>=W.expectedYield?"#3f8600":"#cf1322"}})})})]})]},"2"),e.jsx(H,{tab:"构建流程",children:e.jsx(C,{direction:"vertical",size:"small",current:2,items:[{id:"1",stepName:"DNA片段化",description:"使用超声波或酶切方法将DNA片段化至目标大小",duration:45,reagents:["片段化酶","片段化缓冲液"],equipment:"超声波破碎仪",status:"completed",startTime:"2024-01-15 09:00:00",endTime:"2024-01-15 09:45:00",notes:"片段化效果良好",qcMetrics:{concentration:25.6,volume:50}},{id:"2",stepName:"末端修复",description:"修复DNA片段末端，添加A尾",duration:30,temperature:20,reagents:["末端修复酶","dATP","反应缓冲液"],equipment:"PCR仪",status:"completed",startTime:"2024-01-15 10:00:00",endTime:"2024-01-15 10:30:00",notes:"末端修复完成",qcMetrics:{concentration:23.2,volume:52}},{id:"3",stepName:"接头连接",description:"连接测序接头和条码索引",duration:60,temperature:20,reagents:["T4 DNA连接酶","测序接头","连接缓冲液"],equipment:"PCR仪",status:"in_progress",startTime:"2024-01-15 11:00:00",notes:"正在进行接头连接",qcMetrics:{concentration:20.8}},{id:"4",stepName:"PCR扩增",description:"对连接产物进行PCR扩增",duration:90,temperature:98,cycles:8,reagents:["高保真聚合酶","dNTPs","PCR引物"],equipment:"PCR仪",status:"pending",notes:"等待接头连接完成"},{id:"5",stepName:"文库纯化",description:"使用磁珠纯化文库产物",duration:45,reagents:["AMPure XP磁珠","80%乙醇","TE缓冲液"],equipment:"磁力架",status:"pending",notes:"等待PCR扩增完成"}].map(s=>({title:s.stepName,description:e.jsxs("div",{children:[e.jsx("div",{children:s.description}),e.jsxs("div",{style:{fontSize:12,color:"#666",marginTop:4},children:["预计耗时: ",s.duration,"分钟",s.temperature&&` | 温度: ${s.temperature}°C`,s.cycles&&` | 循环数: ${s.cycles}`]}),e.jsxs("div",{style:{fontSize:12,color:"#999",marginTop:2},children:["设备: ",s.equipment," | 试剂: ",s.reagents.join(", ")]}),s.qcMetrics&&e.jsxs("div",{style:{fontSize:12,color:"#1890ff",marginTop:2},children:["QC:",s.qcMetrics.concentration&&` 浓度${s.qcMetrics.concentration}ng/μl`,s.qcMetrics.volume&&` 体积${s.qcMetrics.volume}μl`,s.qcMetrics.purity&&` 纯度${s.qcMetrics.purity}`]})]}),status:"failed"===s.status?"error":"in_progress"===s.status?"process":"completed"===s.status?"finish":"wait"}))})},"3")]})}),e.jsx(v,{title:"文库质量检测",open:Z,onCancel:()=>ee(!1),footer:null,width:700,children:W&&e.jsxs("div",{children:[e.jsx(x,{message:"质量检测结果",description:`文库 ${W.sampleCode} 的质量检测已完成，各项指标如下：`,type:"info",showIcon:!0,style:{marginBottom:16}}),e.jsx(T,{itemLayout:"horizontal",dataSource:[{title:"浓度检测",value:`${W.concentration} ng/μl`,status:W.concentration>10?"success":"warning",description:"推荐浓度 > 10 ng/μl"},{title:"片段大小分布",value:`${W.insertSize} bp`,status:"success",description:"片段大小符合预期"},{title:"文库摩尔浓度",value:`${W.molarity} nM`,status:W.molarity>2?"success":"warning",description:"推荐摩尔浓度 > 2 nM"},{title:"质量评分",value:`${W.qualityScore} 分`,status:ve(W.qualityScore).color,description:ve(W.qualityScore).text}],renderItem:s=>e.jsxs(T.Item,{children:[e.jsx(T.Item.Meta,{avatar:e.jsx(_,{icon:"success"===s.status?e.jsx(o,{}):e.jsx(z,{}),style:{backgroundColor:"success"===s.status?"#52c41a":"warning"===s.status?"#faad14":"#ff4d4f"}}),title:s.title,description:s.description}),e.jsx("div",{style:{fontWeight:"bold",fontSize:16},children:s.value})]})})]})})]})};export{F as default};
