import{j as e}from"./index-BLG7Shib.js";import{r as s}from"./react-vendor-CntIoGE-.js";import{$ as t,m as r,aq as i,a as n,c as a,d as l,A as d,G as c,T as o,X as m,a7 as x,Y as u,S as p,B as h,ah as j,n as g,ax as f,Z as y,aw as v,aQ as b,az as I,ad as T,W as S,D as k,ao as D,l as C,aN as z,U as w,ag as N,O as A,s as B,a4 as Y,a3 as M}from"./antd-vendor-D5rArj2z.js";const{Step:q}=x,{Option:H}=Y,{TextArea:L}=M,{Title:O,Text:E}=o,$=()=>{const[o,Y]=s.useState(null),[M,H]=s.useState(!1),[L,$]=s.useState(!1),[W,F]=s.useState(!1),[_,G]=s.useState(null),[P,R]=s.useState(!1),[Q]=t.useForm();s.useEffect(()=>{U()},[]);const U=()=>{H(!0),setTimeout(()=>{const e={id:"BATCH_20240120_001",batchCode:"BATCH_20240120_001",batchName:"环境样本DNA提取批次",status:"executing",currentStep:1,totalSteps:4,progress:35,operator:"张三",startTime:"2024-01-20 09:00:00",estimatedEndTime:"2024-01-20 17:00:00",steps:[{id:"step1",stepName:"样本加载",stepOrder:1,status:"completed",estimatedDuration:60,actualDuration:55,startTime:"2024-01-20 09:00:00",endTime:"2024-01-20 09:55:00",operator:"张三",notes:"样本加载完成，质量检查通过",requirements:["检查样本标签","确认样本体积","记录样本位置"],parameters:{temperature:4,humidity:45}},{id:"step2",stepName:"细胞裂解",stepOrder:2,status:"running",estimatedDuration:120,actualDuration:45,startTime:"2024-01-20 10:00:00",operator:"张三",requirements:["添加裂解缓冲液","混匀样本","孵育反应"],parameters:{temperature:56,duration:120,speed:1400}},{id:"step3",stepName:"DNA纯化",stepOrder:3,status:"pending",estimatedDuration:90,requirements:["离心分离","洗涤DNA","溶解DNA"],parameters:{centrifugeSpeed:12e3,washVolume:500}},{id:"step4",stepName:"质量检测",stepOrder:4,status:"pending",estimatedDuration:30,requirements:["浓度检测","纯度检测","完整性检测"],parameters:{method:"NanoDrop",dilution:10}}],plateLayout:V(),notes:"批次执行正常，按计划进行",qualityChecks:[{id:"qc1",checkPoint:"样本加载检查",status:"passed",checkTime:"2024-01-20 09:55:00",operator:"张三",result:"所有样本加载正确",notes:"96个样本位置全部确认"},{id:"qc2",checkPoint:"裂解效果检查",status:"pending",checkTime:void 0,operator:void 0,result:void 0,notes:void 0}]};Y(e),H(!1)},1e3)},V=()=>{const e=[],s=["A","B","C","D","E","F","G","H"],t=Array.from({length:12},(e,s)=>s+1);return s.forEach(r=>{t.forEach(t=>{const i=`${r}${t}`,n=12*s.indexOf(r)+(t-1);e.push({row:r,col:t,position:i,sampleId:n<72?`S${String(n+1).padStart(3,"0")}`:void 0,sampleName:n<72?`环境样本${n+1}`:void 0,status:n<72?n<24?"completed":n<48?"processing":"loaded":"empty",volume:n<72?200:void 0,concentration:n<24?Math.round(100*Math.random()+50):void 0,notes:void 0})})}),e},X=e=>{switch(e){case"empty":default:return"#f5f5f5";case"loaded":return"#e6f7ff";case"processing":return"#fff7e6";case"completed":return"#f6ffed";case"failed":return"#fff2f0";case"contaminated":return"#fff0f6"}},Z=e=>{switch(e){case"empty":return"空";case"loaded":return"已加载";case"processing":return"处理中";case"completed":return"完成";case"failed":return"失败";case"contaminated":return"污染";default:return"未知"}},J=s=>{switch(s){case"pending":default:return e.jsx(w,{});case"running":return e.jsx(f,{});case"completed":return e.jsx(y,{});case"failed":return e.jsx(b,{});case"skipped":return e.jsx(i,{})}},K=(e,s)=>{if(!o)return;const t=o.steps.map(t=>{if(t.id===e)switch(s){case"start":return{...t,status:"running",startTime:A().format("YYYY-MM-DD HH:mm:ss")};case"complete":return{...t,status:"completed",endTime:A().format("YYYY-MM-DD HH:mm:ss"),actualDuration:t.startTime?A().diff(A(t.startTime),"minute"):t.estimatedDuration};case"pause":return{...t,status:"pending"};case"fail":return{...t,status:"failed",endTime:A().format("YYYY-MM-DD HH:mm:ss")};default:return t}return t}),r=t.findIndex(e=>"running"===e.status),i=t.filter(e=>"completed"===e.status).length,n=Math.round(i/t.length*100);Y({...o,steps:t,currentStep:r>=0?r:i,progress:n}),B.success(`步骤${"start"===s?"开始":"complete"===s?"完成":"暂停"}成功`)};return M?e.jsxs("div",{style:{padding:24,textAlign:"center"},children:[e.jsx(r,{spin:!0,style:{fontSize:24}}),e.jsx("div",{style:{marginTop:16},children:"加载批次执行信息..."})]}):o?e.jsxs("div",{style:{padding:24},children:[e.jsx(n,{style:{marginBottom:16},children:e.jsxs(a,{gutter:24,children:[e.jsx(l,{span:18,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[e.jsx(d,{size:48,icon:e.jsx(c,{})}),e.jsxs("div",{children:[e.jsx(O,{level:4,style:{margin:0},children:o.batchName}),e.jsxs(E,{type:"secondary",children:["批次编号: ",o.batchCode," | 操作员: ",o.operator]})]})]})}),e.jsx(l,{span:6,children:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(m,{color:"processing",style:{marginBottom:8},children:"执行中"}),e.jsxs("div",{children:[e.jsx(E,{type:"secondary",children:"进度: "}),e.jsxs(E,{strong:!0,children:[o.progress,"%"]})]})]})})]})}),e.jsxs(a,{gutter:16,children:[e.jsxs(l,{span:16,children:[e.jsxs(n,{title:"实验步骤",style:{marginBottom:16},children:[e.jsx(x,{current:o.currentStep,direction:"horizontal",size:"small",children:o.steps.map((s,t)=>e.jsx(q,{title:s.stepName,description:`${s.estimatedDuration}分钟`,status:"completed"===s.status?"finish":"running"===s.status?"process":"failed"===s.status?"error":"wait",icon:J(s.status)},s.id))}),e.jsx("div",{style:{marginTop:16,textAlign:"center"},children:e.jsx(u,{percent:o.progress,status:"failed"===o.status?"exception":"active",strokeColor:{"0%":"#108ee9","100%":"#87d068"}})})]}),e.jsx(n,{title:"96孔板布局",extra:e.jsxs(p,{children:[e.jsx(h,{size:"small",icon:e.jsx(j,{}),children:"查看详情"}),e.jsx(h,{size:"small",icon:e.jsx(g,{}),children:"设置"})]}),children:(()=>{if(!o)return null;const s=Array.from({length:12},(e,s)=>s+1);return e.jsxs("div",{style:{padding:16,backgroundColor:"#fafafa",borderRadius:8},children:[e.jsxs("div",{style:{display:"flex",marginBottom:8},children:[e.jsx("div",{style:{width:30}}),s.map(s=>e.jsx("div",{style:{width:40,height:20,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:"bold"},children:s},s))]}),["A","B","C","D","E","F","G","H"].map(t=>e.jsxs("div",{style:{display:"flex",marginBottom:4},children:[e.jsx("div",{style:{width:30,height:36,display:"flex",alignItems:"center",justifyContent:"center",fontSize:12,fontWeight:"bold"},children:t}),s.map(s=>{const r=o.plateLayout.find(e=>e.row===t&&e.col===s);return r?e.jsx(N,{title:e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("strong",{children:r.position})}),r.sampleId&&e.jsxs("div",{children:["样本: ",r.sampleId]}),r.sampleName&&e.jsxs("div",{children:["名称: ",r.sampleName]}),e.jsxs("div",{children:["状态: ",Z(r.status)]}),r.volume&&e.jsxs("div",{children:["体积: ",r.volume,"μL"]}),r.concentration&&e.jsxs("div",{children:["浓度: ",r.concentration,"ng/μL"]})]}),children:e.jsx("div",{style:{width:36,height:36,margin:2,backgroundColor:X(r.status),border:"empty"===r.status?"1px dashed #d9d9d9":"1px solid #d9d9d9",borderRadius:4,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:10,fontWeight:r.sampleId?"bold":"normal",transition:"all 0.2s"},onClick:()=>(e=>{G(e),F(!0)})(r),onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.1)",e.currentTarget.style.zIndex="10"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.zIndex="1"},children:r.sampleId?r.sampleId.slice(-2):""})},r.position):null})]},t)),e.jsx("div",{style:{marginTop:16,display:"flex",flexWrap:"wrap",gap:16},children:[{status:"empty",label:"空孔"},{status:"loaded",label:"已加载"},{status:"processing",label:"处理中"},{status:"completed",label:"完成"},{status:"failed",label:"失败"},{status:"contaminated",label:"污染"}].map(s=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4},children:[e.jsx("div",{style:{width:16,height:16,backgroundColor:X(s.status),border:"1px solid #d9d9d9",borderRadius:2}}),e.jsx(E,{style:{fontSize:12},children:s.label})]},s.status))})]})})()})]}),e.jsxs(l,{span:8,children:[e.jsx(n,{title:"当前步骤",style:{marginBottom:16},children:(()=>{const s=o.steps[o.currentStep];return s?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(O,{level:5,children:s.stepName}),e.jsxs(E,{type:"secondary",children:["预计用时: ",s.estimatedDuration,"分钟"]})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(E,{strong:!0,children:"操作要求:"}),e.jsx("ul",{style:{marginTop:8,paddingLeft:20},children:s.requirements.map((s,t)=>e.jsx("li",{children:s},t))})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(E,{strong:!0,children:"参数设置:"}),e.jsx("div",{style:{marginTop:8},children:Object.entries(s.parameters).map(([s,t])=>e.jsx("div",{style:{marginBottom:4},children:e.jsxs(E,{children:[s,": ",t]})},s))})]}),e.jsxs(p,{style:{width:"100%"},direction:"vertical",children:["pending"===s.status&&e.jsx(h,{type:"primary",icon:e.jsx(f,{}),block:!0,onClick:()=>K(s.id,"start"),children:"开始步骤"}),"running"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(h,{type:"primary",icon:e.jsx(y,{}),block:!0,onClick:()=>K(s.id,"complete"),children:"完成步骤"}),e.jsx(h,{icon:e.jsx(v,{}),block:!0,onClick:()=>K(s.id,"pause"),children:"暂停步骤"})]}),e.jsx(h,{danger:!0,icon:e.jsx(b,{}),block:!0,onClick:()=>K(s.id,"fail"),children:"标记失败"})]})]}):e.jsx(E,{children:"所有步骤已完成"})})()}),e.jsx(n,{title:"质量检查",style:{marginBottom:16},children:e.jsx(I,{size:"small",dataSource:o.qualityChecks,renderItem:s=>e.jsx(I.Item,{children:e.jsx(I.Item.Meta,{avatar:e.jsx(T,{status:"passed"===s.status?"success":"failed"===s.status?"error":"default"}),title:s.checkPoint,description:"pending"===s.status?"待检查":s.result||"已完成"})})})}),e.jsx(n,{title:"操作记录",extra:e.jsx(h,{size:"small",type:"link",onClick:()=>R(!0),children:"查看全部"}),children:e.jsxs(S,{size:"small",children:[e.jsx(S.Item,{color:"green",children:e.jsx(E,{style:{fontSize:12},children:"09:55 - 样本加载完成"})}),e.jsx(S.Item,{color:"blue",children:e.jsx(E,{style:{fontSize:12},children:"10:00 - 开始细胞裂解"})}),e.jsx(S.Item,{color:"gray",children:e.jsx(E,{style:{fontSize:12},children:"10:30 - 添加裂解缓冲液"})})]})})]})]}),e.jsx(k,{title:"孔位详情",placement:"right",onClose:()=>F(!1),open:W,width:400,children:_&&e.jsxs("div",{children:[e.jsxs(D,{column:1,size:"small",children:[e.jsx(D.Item,{label:"位置",children:_.position}),e.jsx(D.Item,{label:"样本ID",children:_.sampleId||"无"}),e.jsx(D.Item,{label:"样本名称",children:_.sampleName||"无"}),e.jsx(D.Item,{label:"状态",children:e.jsx(m,{color:"completed"===_.status?"green":"blue",children:Z(_.status)})}),e.jsxs(D.Item,{label:"体积",children:[_.volume||0,"μL"]}),e.jsxs(D.Item,{label:"浓度",children:[_.concentration||0,"ng/μL"]}),e.jsx(D.Item,{label:"备注",children:_.notes||"无"})]}),e.jsx(C,{}),e.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[e.jsx(h,{type:"primary",block:!0,children:"更新状态"}),e.jsx(h,{block:!0,children:"添加备注"}),e.jsx(h,{danger:!0,block:!0,children:"标记异常"})]})]})}),e.jsx(k,{title:"操作记录",placement:"right",onClose:()=>R(!1),open:P,width:500,children:e.jsxs(S,{children:[e.jsx(S.Item,{color:"green",dot:e.jsx(y,{}),children:e.jsxs("div",{children:[e.jsx(E,{strong:!0,children:"样本加载完成"}),e.jsx("br",{}),e.jsx(E,{type:"secondary",children:"2024-01-20 09:55:00 - 张三"}),e.jsx("br",{}),e.jsx(E,{children:"96个样本全部加载完成，质量检查通过"})]})}),e.jsx(S.Item,{color:"blue",dot:e.jsx(f,{}),children:e.jsxs("div",{children:[e.jsx(E,{strong:!0,children:"开始细胞裂解"}),e.jsx("br",{}),e.jsx(E,{type:"secondary",children:"2024-01-20 10:00:00 - 张三"}),e.jsx("br",{}),e.jsx(E,{children:"设置温度56°C，开始裂解反应"})]})}),e.jsx(S.Item,{color:"gray",dot:e.jsx(z,{}),children:e.jsxs("div",{children:[e.jsx(E,{strong:!0,children:"添加裂解缓冲液"}),e.jsx("br",{}),e.jsx(E,{type:"secondary",children:"2024-01-20 10:30:00 - 张三"}),e.jsx("br",{}),e.jsx(E,{children:"每孔添加200μL裂解缓冲液"})]})})]})})]}):e.jsxs("div",{style:{padding:24,textAlign:"center"},children:[e.jsx(i,{style:{fontSize:48,color:"#faad14"}}),e.jsx("div",{style:{marginTop:16},children:"未找到批次执行信息"})]})};export{$ as default};
