import{j as e}from"./index-bgfNE6VX.js";import{r as s}from"./react-vendor-By8n_QN6.js";import{N as t,c as l,d as a,a as i,af as r,a0 as n,ag as o,a1 as d,a4 as c,B as m,U as h,a3 as x,ah as p,W as j,X as u,ae as g,V as y,S as f,a7 as v,a9 as S,ai as w,ad as T,Q as N,aj as C,Y as z}from"./antd-vendor-Cii6xr0v.js";const{Search:I}=n,{Option:b}=d,{RangePicker:k}=c,A=()=>{const[n,c]=s.useState(!1),[A,E]=s.useState([]),[B,D]=s.useState(null),[L,W]=s.useState(!1),[H,M]=s.useState(!1),[P,Q]=s.useState(""),[$,J]=s.useState(""),[K,O]=s.useState(null),R=[{id:"1",sampleCode:"S2024001",sampleName:"土壤样本A",projectName:"微生物多样性分析项目",currentStage:"DNA提取",status:"processing",progress:65,startTime:"2024-01-15 09:00:00",expectedEndTime:"2024-01-20 17:00:00",assignee:"张三",location:"实验室A-101",notes:"样本质量良好，按计划进行"},{id:"2",sampleCode:"S2024002",sampleName:"水体样本B",projectName:"环境监测项目",currentStage:"文库构建",status:"completed",progress:100,startTime:"2024-01-10 08:30:00",expectedEndTime:"2024-01-18 16:00:00",actualEndTime:"2024-01-17 15:30:00",assignee:"李四",location:"实验室B-203",notes:"提前完成，质量优秀"},{id:"3",sampleCode:"S2024003",sampleName:"植物样本C",projectName:"植物基因组研究",currentStage:"质量检测",status:"delayed",progress:30,startTime:"2024-01-12 10:00:00",expectedEndTime:"2024-01-22 18:00:00",assignee:"王五",location:"实验室C-305",notes:"设备故障导致延期，正在处理"}],U=[{id:"1",stepName:"样本接收",status:"completed",startTime:"2024-01-15 09:00:00",endTime:"2024-01-15 09:30:00",operator:"张三",notes:"样本状态良好",duration:30},{id:"2",stepName:"样本预处理",status:"completed",startTime:"2024-01-15 10:00:00",endTime:"2024-01-15 12:00:00",operator:"张三",notes:"预处理完成",duration:120},{id:"3",stepName:"DNA提取",status:"processing",startTime:"2024-01-15 14:00:00",operator:"张三",notes:"正在进行DNA提取",duration:180},{id:"4",stepName:"质量检测",status:"pending",notes:"等待DNA提取完成"},{id:"5",stepName:"文库构建",status:"pending",notes:"等待质量检测通过"}];s.useEffect(()=>{V()},[]);const V=async()=>{c(!0);try{await new Promise(e=>setTimeout(e,1e3)),E(R)}catch(e){}finally{c(!1)}},X=e=>({received:"blue",processing:"orange",completed:"green",delayed:"red",error:"red"}[e]),Y=e=>({received:"已接收",processing:"处理中",completed:"已完成",delayed:"延期",error:"异常"}[e]),q=s=>({completed:e.jsx(z,{style:{color:"#52c41a"}}),processing:e.jsx(C,{spin:!0,style:{color:"#1890ff"}}),pending:e.jsx(N,{style:{color:"#d9d9d9"}}),error:e.jsx(T,{style:{color:"#ff4d4f"}})}[s]),F=A.filter(e=>{const s=!P||e.sampleCode.toLowerCase().includes(P.toLowerCase())||e.sampleName.toLowerCase().includes(P.toLowerCase())||e.projectName.toLowerCase().includes(P.toLowerCase()),l=!$||e.status===$,a=!K||t(e.startTime).isAfter(K[0])&&t(e.startTime).isBefore(K[1]);return s&&l&&a}),G=[{title:"样本编号",dataIndex:"sampleCode",key:"sampleCode",width:120,fixed:"left"},{title:"样本名称",dataIndex:"sampleName",key:"sampleName",width:150,ellipsis:!0},{title:"项目名称",dataIndex:"projectName",key:"projectName",width:200,ellipsis:!0},{title:"当前阶段",dataIndex:"currentStage",key:"currentStage",width:120},{title:"状态",dataIndex:"status",key:"status",width:100,render:s=>e.jsx(j,{color:X(s),children:Y(s)})},{title:"进度",dataIndex:"progress",key:"progress",width:120,render:(s,t)=>e.jsx(u,{percent:s,size:"small",status:"error"===t.status?"exception":"active"})},{title:"负责人",dataIndex:"assignee",key:"assignee",width:100},{title:"位置",dataIndex:"location",key:"location",width:120},{title:"预计完成时间",dataIndex:"expectedEndTime",key:"expectedEndTime",width:150,render:e=>t(e).format("MM-DD HH:mm")},{title:"操作",key:"action",width:150,fixed:"right",render:(s,t)=>e.jsxs(f,{size:"small",children:[e.jsx(v,{title:"查看详情",children:e.jsx(m,{type:"text",icon:e.jsx(S,{}),onClick:()=>(e=>{D(e),W(!0)})(t)})}),e.jsx(v,{title:"查看历史",children:e.jsx(m,{type:"text",icon:e.jsx(w,{}),onClick:()=>(e=>{D(e),M(!0)})(t)})})]})}];return e.jsxs("div",{children:[e.jsxs(l,{gutter:16,style:{marginBottom:16},children:[e.jsx(a,{span:6,children:e.jsx(i,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#1890ff"},children:A.length}),e.jsx("div",{style:{color:"#666"},children:"总样本数"})]})})}),e.jsx(a,{span:6,children:e.jsx(i,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#52c41a"},children:A.filter(e=>"completed"===e.status).length}),e.jsx("div",{style:{color:"#666"},children:"已完成"})]})})}),e.jsx(a,{span:6,children:e.jsx(i,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#faad14"},children:A.filter(e=>"processing"===e.status).length}),e.jsx("div",{style:{color:"#666"},children:"处理中"})]})})}),e.jsx(a,{span:6,children:e.jsx(i,{size:"small",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:24,fontWeight:"bold",color:"#ff4d4f"},children:A.filter(e=>"delayed"===e.status||"error"===e.status).length}),e.jsx("div",{style:{color:"#666"},children:"异常/延期"})]})})})]}),A.some(e=>"delayed"===e.status||"error"===e.status)&&e.jsx(r,{message:"发现异常样本",description:`有 ${A.filter(e=>"delayed"===e.status||"error"===e.status).length} 个样本状态异常，请及时处理`,type:"warning",showIcon:!0,closable:!0,style:{marginBottom:16}}),e.jsx(i,{size:"small",style:{marginBottom:16},children:e.jsxs(l,{gutter:16,children:[e.jsx(a,{span:8,children:e.jsx(I,{placeholder:"搜索样本编号、名称或项目",value:P,onChange:e=>Q(e.target.value),onSearch:V,enterButton:e.jsx(o,{})})}),e.jsx(a,{span:4,children:e.jsxs(d,{placeholder:"状态筛选",value:$,onChange:J,allowClear:!0,style:{width:"100%"},children:[e.jsx(b,{value:"received",children:"已接收"}),e.jsx(b,{value:"processing",children:"处理中"}),e.jsx(b,{value:"completed",children:"已完成"}),e.jsx(b,{value:"delayed",children:"延期"}),e.jsx(b,{value:"error",children:"异常"})]})}),e.jsx(a,{span:8,children:e.jsx(k,{placeholder:["开始时间","结束时间"],value:K,onChange:O,style:{width:"100%"}})}),e.jsx(a,{span:4,children:e.jsx(m,{type:"primary",onClick:V,loading:n,children:"刷新数据"})})]})}),e.jsx(i,{title:"样本追踪列表",size:"small",children:e.jsx(h,{columns:G,dataSource:F,rowKey:"id",loading:n,scroll:{x:1200},pagination:{total:F.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}),e.jsx(x,{title:"样本追踪详情",open:L,onCancel:()=>W(!1),footer:null,width:800,children:B&&e.jsxs("div",{children:[e.jsxs(p,{bordered:!0,size:"small",column:2,children:[e.jsx(p.Item,{label:"样本编号",children:B.sampleCode}),e.jsx(p.Item,{label:"样本名称",children:B.sampleName}),e.jsx(p.Item,{label:"项目名称",span:2,children:B.projectName}),e.jsx(p.Item,{label:"当前阶段",children:B.currentStage}),e.jsx(p.Item,{label:"状态",children:e.jsx(j,{color:X(B.status),children:Y(B.status)})}),e.jsx(p.Item,{label:"进度",children:e.jsx(u,{percent:B.progress,size:"small"})}),e.jsx(p.Item,{label:"负责人",children:B.assignee}),e.jsx(p.Item,{label:"位置",children:B.location}),e.jsx(p.Item,{label:"开始时间",children:B.startTime}),e.jsx(p.Item,{label:"预计完成时间",children:B.expectedEndTime}),B.actualEndTime&&e.jsx(p.Item,{label:"实际完成时间",children:B.actualEndTime}),B.notes&&e.jsx(p.Item,{label:"备注",span:2,children:B.notes})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx("h4",{children:"流程进度"}),e.jsx(g,{direction:"vertical",size:"small",current:2,items:U.map(e=>({title:e.stepName,description:e.notes,status:"error"===e.status?"error":"processing"===e.status?"process":"completed"===e.status?"finish":"wait",icon:q(e.status)}))})]})]})}),e.jsx(x,{title:"样本历史记录",open:H,onCancel:()=>M(!1),footer:null,width:600,children:B&&e.jsx(y,{items:U.filter(e=>"completed"===e.status||"processing"===e.status).map(s=>({dot:q(s.status),children:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:s.stepName}),s.startTime&&e.jsxs("div",{style:{fontSize:12,color:"#666"},children:["开始时间: ",s.startTime]}),s.endTime&&e.jsxs("div",{style:{fontSize:12,color:"#666"},children:["结束时间: ",s.endTime]}),s.operator&&e.jsxs("div",{style:{fontSize:12,color:"#666"},children:["操作人: ",s.operator]}),s.duration&&e.jsxs("div",{style:{fontSize:12,color:"#666"},children:["耗时: ",s.duration," 分钟"]}),s.notes&&e.jsx("div",{style:{fontSize:12,color:"#999",marginTop:4},children:s.notes})]})}))})})]})};export{A as default};
